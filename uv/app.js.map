{
  "version": 3,
  "sources": [
    "../node_modules/requirejs/require.js",
    "modules/uv-shared-module/BaseCommands.js",
    "Params.js",
    "BootstrapParams.js",
    "Bootstrapper.js",
    "modules/uv-shared-module/Panel.js",
    "modules/uv-shared-module/BaseView.js",
    "modules/uv-shared-module/Dialogue.js",
    "modules/uv-dialogues-module/ClickThroughDialogue.js",
    "modules/uv-shared-module/InformationArgs.js",
    "modules/uv-shared-module/InformationType.js",
    "modules/uv-dialogues-module/LoginDialogue.js",
    "modules/uv-shared-module/LoginWarningMessages.js",
    "modules/uv-shared-module/Metric.js",
    "modules/uv-shared-module/Metrics.js",
    "modules/uv-dialogues-module/RestrictedDialogue.js",
    "modules/uv-shared-module/GenericDialogue.js",
    "modules/uv-shared-module/Shell.js",
    "modules/uv-shared-module/BaseExtension.js",
    "modules/uv-shared-module/Bookmark.js",
    "extensions/uv-seadragon-extension/Commands.js",
    "modules/uv-contentleftpanel-module/GalleryView.js",
    "modules/uv-shared-module/BaseExpandPanel.js",
    "modules/uv-shared-module/LeftPanel.js",
    "extensions/uv-seadragon-extension/Mode.js",
    "modules/uv-shared-module/ThumbsView.js",
    "modules/uv-contentleftpanel-module/ThumbsView.js",
    "modules/uv-contentleftpanel-module/TreeView.js",
    "modules/uv-contentleftpanel-module/ContentLeftPanel.js",
    "modules/uv-shared-module/Point.js",
    "extensions/uv-seadragon-extension/CroppedImageDimensions.js",
    "modules/uv-shared-module/DownloadOption.js",
    "modules/uv-dialogues-module/DownloadDialogue.js",
    "extensions/uv-seadragon-extension/DownloadType.js",
    "extensions/uv-seadragon-extension/DownloadDialogue.js",
    "modules/uv-dialogues-module/ExternalContentDialogue.js",
    "modules/uv-shared-module/FooterPanel.js",
    "modules/uv-osdmobilefooterpanel-module/MobileFooter.js",
    "modules/uv-shared-module/AutoComplete.js",
    "modules/uv-searchfooterpanel-module/FooterPanel.js",
    "modules/uv-dialogues-module/HelpDialogue.js",
    "modules/uv-dialogues-module/MoreInfoDialogue.js",
    "modules/uv-shared-module/RightPanel.js",
    "modules/uv-moreinforightpanel-module/MoreInfoRightPanel.js",
    "modules/uv-multiselectdialogue-module/MultiSelectDialogue.js",
    "extensions/uv-seadragon-extension/MultiSelectionArgs.js",
    "modules/uv-shared-module/Information.js",
    "modules/uv-shared-module/InformationAction.js",
    "modules/uv-shared-module/InformationFactory.js",
    "modules/uv-shared-module/HeaderPanel.js",
    "modules/uv-pagingheaderpanel-module/PagingHeaderPanel.js",
    "extensions/uv-seadragon-extension/Bounds.js",
    "modules/uv-shared-module/CenterPanel.js",
    "modules/uv-seadragoncenterpanel-module/SeadragonCenterPanel.js",
    "modules/uv-dialogues-module/SettingsDialogue.js",
    "extensions/uv-seadragon-extension/SettingsDialogue.js",
    "modules/uv-dialogues-module/ShareDialogue.js",
    "extensions/uv-seadragon-extension/ShareDialogue.js",
    "extensions/uv-seadragon-extension/Extension.js",
    "extensions/uv-mediaelement-extension/Commands.js",
    "extensions/uv-mediaelement-extension/DownloadDialogue.js",
    "extensions/uv-mediaelement-extension/ShareDialogue.js",
    "modules/uv-mediaelementcenterpanel-module/MediaElementCenterPanel.js",
    "modules/uv-resourcesleftpanel-module/ThumbsView.js",
    "modules/uv-resourcesleftpanel-module/ResourcesLeftPanel.js",
    "extensions/uv-mediaelement-extension/SettingsDialogue.js",
    "extensions/uv-mediaelement-extension/Extension.js",
    "extensions/uv-pdf-extension/DownloadDialogue.js",
    "extensions/uv-pdf-extension/ShareDialogue.js",
    "modules/uv-pdfcenterpanel-module/PDFCenterPanel.js",
    "extensions/uv-pdf-extension/SettingsDialogue.js",
    "extensions/uv-pdf-extension/Extension.js",
    "extensions/uv-virtex-extension/DownloadDialogue.js",
    "extensions/uv-virtex-extension/ShareDialogue.js",
    "extensions/uv-virtex-extension/SettingsDialogue.js",
    "modules/uv-virtexcenterpanel-module/VirtexCenterPanel.js",
    "extensions/uv-virtex-extension/Extension.js",
    "UV.js",
    "app.js"
  ],
  "names": [],
  "mappings": "AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjmEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACnDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC1IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACxEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC5GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACtEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACzkCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC7MA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/OA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACzEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACzeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC7eA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC5CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9NA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9gBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACzEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC1FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACnfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACpxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACnFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC7HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACnSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC3CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/zBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACnCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AChHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACnCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACpEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "file": "app.js",
  "sourcesContent": [
    "/** vim: et:ts=4:sw=4:sts=4\n * @license RequireJS 2.2.0 Copyright jQuery Foundation and other contributors.\n * Released under MIT license, http://github.com/requirejs/requirejs/LICENSE\n */\n//Not using strict: uneven strict support in browsers, #392, and causes\n//problems with requirejs.exec()/transpiler plugins that may not be strict.\n/*jslint regexp: true, nomen: true, sloppy: true */\n/*global window, navigator, document, importScripts, setTimeout, opera */\n\nvar requirejs, require, define;\n(function (global) {\n    var req, s, head, baseElement, dataMain, src,\n        interactiveScript, currentlyAddingScript, mainScript, subPath,\n        version = '2.2.0',\n        commentRegExp = /(\\/\\*([\\s\\S]*?)\\*\\/|([^:]|^)\\/\\/(.*)$)/mg,\n        cjsRequireRegExp = /[^.]\\s*require\\s*\\(\\s*[\"']([^'\"\\s]+)[\"']\\s*\\)/g,\n        jsSuffixRegExp = /\\.js$/,\n        currDirRegExp = /^\\.\\//,\n        op = Object.prototype,\n        ostring = op.toString,\n        hasOwn = op.hasOwnProperty,\n        isBrowser = !!(typeof window !== 'undefined' && typeof navigator !== 'undefined' && window.document),\n        isWebWorker = !isBrowser && typeof importScripts !== 'undefined',\n        //PS3 indicates loaded and complete, but need to wait for complete\n        //specifically. Sequence is 'loading', 'loaded', execution,\n        // then 'complete'. The UA check is unfortunate, but not sure how\n        //to feature test w/o causing perf issues.\n        readyRegExp = isBrowser && navigator.platform === 'PLAYSTATION 3' ?\n                      /^complete$/ : /^(complete|loaded)$/,\n        defContextName = '_',\n        //Oh the tragedy, detecting opera. See the usage of isOpera for reason.\n        isOpera = typeof opera !== 'undefined' && opera.toString() === '[object Opera]',\n        contexts = {},\n        cfg = {},\n        globalDefQueue = [],\n        useInteractive = false;\n\n    //Could match something like ')//comment', do not lose the prefix to comment.\n    function commentReplace(match, multi, multiText, singlePrefix) {\n        return singlePrefix || '';\n    }\n\n    function isFunction(it) {\n        return ostring.call(it) === '[object Function]';\n    }\n\n    function isArray(it) {\n        return ostring.call(it) === '[object Array]';\n    }\n\n    /**\n     * Helper function for iterating over an array. If the func returns\n     * a true value, it will break out of the loop.\n     */\n    function each(ary, func) {\n        if (ary) {\n            var i;\n            for (i = 0; i < ary.length; i += 1) {\n                if (ary[i] && func(ary[i], i, ary)) {\n                    break;\n                }\n            }\n        }\n    }\n\n    /**\n     * Helper function for iterating over an array backwards. If the func\n     * returns a true value, it will break out of the loop.\n     */\n    function eachReverse(ary, func) {\n        if (ary) {\n            var i;\n            for (i = ary.length - 1; i > -1; i -= 1) {\n                if (ary[i] && func(ary[i], i, ary)) {\n                    break;\n                }\n            }\n        }\n    }\n\n    function hasProp(obj, prop) {\n        return hasOwn.call(obj, prop);\n    }\n\n    function getOwn(obj, prop) {\n        return hasProp(obj, prop) && obj[prop];\n    }\n\n    /**\n     * Cycles over properties in an object and calls a function for each\n     * property value. If the function returns a truthy value, then the\n     * iteration is stopped.\n     */\n    function eachProp(obj, func) {\n        var prop;\n        for (prop in obj) {\n            if (hasProp(obj, prop)) {\n                if (func(obj[prop], prop)) {\n                    break;\n                }\n            }\n        }\n    }\n\n    /**\n     * Simple function to mix in properties from source into target,\n     * but only if target does not already have a property of the same name.\n     */\n    function mixin(target, source, force, deepStringMixin) {\n        if (source) {\n            eachProp(source, function (value, prop) {\n                if (force || !hasProp(target, prop)) {\n                    if (deepStringMixin && typeof value === 'object' && value &&\n                        !isArray(value) && !isFunction(value) &&\n                        !(value instanceof RegExp)) {\n\n                        if (!target[prop]) {\n                            target[prop] = {};\n                        }\n                        mixin(target[prop], value, force, deepStringMixin);\n                    } else {\n                        target[prop] = value;\n                    }\n                }\n            });\n        }\n        return target;\n    }\n\n    //Similar to Function.prototype.bind, but the 'this' object is specified\n    //first, since it is easier to read/figure out what 'this' will be.\n    function bind(obj, fn) {\n        return function () {\n            return fn.apply(obj, arguments);\n        };\n    }\n\n    function scripts() {\n        return document.getElementsByTagName('script');\n    }\n\n    function defaultOnError(err) {\n        throw err;\n    }\n\n    //Allow getting a global that is expressed in\n    //dot notation, like 'a.b.c'.\n    function getGlobal(value) {\n        if (!value) {\n            return value;\n        }\n        var g = global;\n        each(value.split('.'), function (part) {\n            g = g[part];\n        });\n        return g;\n    }\n\n    /**\n     * Constructs an error with a pointer to an URL with more information.\n     * @param {String} id the error ID that maps to an ID on a web page.\n     * @param {String} message human readable error.\n     * @param {Error} [err] the original error, if there is one.\n     *\n     * @returns {Error}\n     */\n    function makeError(id, msg, err, requireModules) {\n        var e = new Error(msg + '\\nhttp://requirejs.org/docs/errors.html#' + id);\n        e.requireType = id;\n        e.requireModules = requireModules;\n        if (err) {\n            e.originalError = err;\n        }\n        return e;\n    }\n\n    if (typeof define !== 'undefined') {\n        //If a define is already in play via another AMD loader,\n        //do not overwrite.\n        return;\n    }\n\n    if (typeof requirejs !== 'undefined') {\n        if (isFunction(requirejs)) {\n            //Do not overwrite an existing requirejs instance.\n            return;\n        }\n        cfg = requirejs;\n        requirejs = undefined;\n    }\n\n    //Allow for a require config object\n    if (typeof require !== 'undefined' && !isFunction(require)) {\n        //assume it is a config object.\n        cfg = require;\n        require = undefined;\n    }\n\n    function newContext(contextName) {\n        var inCheckLoaded, Module, context, handlers,\n            checkLoadedTimeoutId,\n            config = {\n                //Defaults. Do not set a default for map\n                //config to speed up normalize(), which\n                //will run faster if there is no default.\n                waitSeconds: 7,\n                baseUrl: './',\n                paths: {},\n                bundles: {},\n                pkgs: {},\n                shim: {},\n                config: {}\n            },\n            registry = {},\n            //registry of just enabled modules, to speed\n            //cycle breaking code when lots of modules\n            //are registered, but not activated.\n            enabledRegistry = {},\n            undefEvents = {},\n            defQueue = [],\n            defined = {},\n            urlFetched = {},\n            bundlesMap = {},\n            requireCounter = 1,\n            unnormalizedCounter = 1;\n\n        /**\n         * Trims the . and .. from an array of path segments.\n         * It will keep a leading path segment if a .. will become\n         * the first path segment, to help with module name lookups,\n         * which act like paths, but can be remapped. But the end result,\n         * all paths that use this function should look normalized.\n         * NOTE: this method MODIFIES the input array.\n         * @param {Array} ary the array of path segments.\n         */\n        function trimDots(ary) {\n            var i, part;\n            for (i = 0; i < ary.length; i++) {\n                part = ary[i];\n                if (part === '.') {\n                    ary.splice(i, 1);\n                    i -= 1;\n                } else if (part === '..') {\n                    // If at the start, or previous value is still ..,\n                    // keep them so that when converted to a path it may\n                    // still work when converted to a path, even though\n                    // as an ID it is less than ideal. In larger point\n                    // releases, may be better to just kick out an error.\n                    if (i === 0 || (i === 1 && ary[2] === '..') || ary[i - 1] === '..') {\n                        continue;\n                    } else if (i > 0) {\n                        ary.splice(i - 1, 2);\n                        i -= 2;\n                    }\n                }\n            }\n        }\n\n        /**\n         * Given a relative module name, like ./something, normalize it to\n         * a real name that can be mapped to a path.\n         * @param {String} name the relative name\n         * @param {String} baseName a real name that the name arg is relative\n         * to.\n         * @param {Boolean} applyMap apply the map config to the value. Should\n         * only be done if this normalization is for a dependency ID.\n         * @returns {String} normalized name\n         */\n        function normalize(name, baseName, applyMap) {\n            var pkgMain, mapValue, nameParts, i, j, nameSegment, lastIndex,\n                foundMap, foundI, foundStarMap, starI, normalizedBaseParts,\n                baseParts = (baseName && baseName.split('/')),\n                map = config.map,\n                starMap = map && map['*'];\n\n            //Adjust any relative paths.\n            if (name) {\n                name = name.split('/');\n                lastIndex = name.length - 1;\n\n                // If wanting node ID compatibility, strip .js from end\n                // of IDs. Have to do this here, and not in nameToUrl\n                // because node allows either .js or non .js to map\n                // to same file.\n                if (config.nodeIdCompat && jsSuffixRegExp.test(name[lastIndex])) {\n                    name[lastIndex] = name[lastIndex].replace(jsSuffixRegExp, '');\n                }\n\n                // Starts with a '.' so need the baseName\n                if (name[0].charAt(0) === '.' && baseParts) {\n                    //Convert baseName to array, and lop off the last part,\n                    //so that . matches that 'directory' and not name of the baseName's\n                    //module. For instance, baseName of 'one/two/three', maps to\n                    //'one/two/three.js', but we want the directory, 'one/two' for\n                    //this normalization.\n                    normalizedBaseParts = baseParts.slice(0, baseParts.length - 1);\n                    name = normalizedBaseParts.concat(name);\n                }\n\n                trimDots(name);\n                name = name.join('/');\n            }\n\n            //Apply map config if available.\n            if (applyMap && map && (baseParts || starMap)) {\n                nameParts = name.split('/');\n\n                outerLoop: for (i = nameParts.length; i > 0; i -= 1) {\n                    nameSegment = nameParts.slice(0, i).join('/');\n\n                    if (baseParts) {\n                        //Find the longest baseName segment match in the config.\n                        //So, do joins on the biggest to smallest lengths of baseParts.\n                        for (j = baseParts.length; j > 0; j -= 1) {\n                            mapValue = getOwn(map, baseParts.slice(0, j).join('/'));\n\n                            //baseName segment has config, find if it has one for\n                            //this name.\n                            if (mapValue) {\n                                mapValue = getOwn(mapValue, nameSegment);\n                                if (mapValue) {\n                                    //Match, update name to the new value.\n                                    foundMap = mapValue;\n                                    foundI = i;\n                                    break outerLoop;\n                                }\n                            }\n                        }\n                    }\n\n                    //Check for a star map match, but just hold on to it,\n                    //if there is a shorter segment match later in a matching\n                    //config, then favor over this star map.\n                    if (!foundStarMap && starMap && getOwn(starMap, nameSegment)) {\n                        foundStarMap = getOwn(starMap, nameSegment);\n                        starI = i;\n                    }\n                }\n\n                if (!foundMap && foundStarMap) {\n                    foundMap = foundStarMap;\n                    foundI = starI;\n                }\n\n                if (foundMap) {\n                    nameParts.splice(0, foundI, foundMap);\n                    name = nameParts.join('/');\n                }\n            }\n\n            // If the name points to a package's name, use\n            // the package main instead.\n            pkgMain = getOwn(config.pkgs, name);\n\n            return pkgMain ? pkgMain : name;\n        }\n\n        function removeScript(name) {\n            if (isBrowser) {\n                each(scripts(), function (scriptNode) {\n                    if (scriptNode.getAttribute('data-requiremodule') === name &&\n                            scriptNode.getAttribute('data-requirecontext') === context.contextName) {\n                        scriptNode.parentNode.removeChild(scriptNode);\n                        return true;\n                    }\n                });\n            }\n        }\n\n        function hasPathFallback(id) {\n            var pathConfig = getOwn(config.paths, id);\n            if (pathConfig && isArray(pathConfig) && pathConfig.length > 1) {\n                //Pop off the first array value, since it failed, and\n                //retry\n                pathConfig.shift();\n                context.require.undef(id);\n\n                //Custom require that does not do map translation, since\n                //ID is \"absolute\", already mapped/resolved.\n                context.makeRequire(null, {\n                    skipMap: true\n                })([id]);\n\n                return true;\n            }\n        }\n\n        //Turns a plugin!resource to [plugin, resource]\n        //with the plugin being undefined if the name\n        //did not have a plugin prefix.\n        function splitPrefix(name) {\n            var prefix,\n                index = name ? name.indexOf('!') : -1;\n            if (index > -1) {\n                prefix = name.substring(0, index);\n                name = name.substring(index + 1, name.length);\n            }\n            return [prefix, name];\n        }\n\n        /**\n         * Creates a module mapping that includes plugin prefix, module\n         * name, and path. If parentModuleMap is provided it will\n         * also normalize the name via require.normalize()\n         *\n         * @param {String} name the module name\n         * @param {String} [parentModuleMap] parent module map\n         * for the module name, used to resolve relative names.\n         * @param {Boolean} isNormalized: is the ID already normalized.\n         * This is true if this call is done for a define() module ID.\n         * @param {Boolean} applyMap: apply the map config to the ID.\n         * Should only be true if this map is for a dependency.\n         *\n         * @returns {Object}\n         */\n        function makeModuleMap(name, parentModuleMap, isNormalized, applyMap) {\n            var url, pluginModule, suffix, nameParts,\n                prefix = null,\n                parentName = parentModuleMap ? parentModuleMap.name : null,\n                originalName = name,\n                isDefine = true,\n                normalizedName = '';\n\n            //If no name, then it means it is a require call, generate an\n            //internal name.\n            if (!name) {\n                isDefine = false;\n                name = '_@r' + (requireCounter += 1);\n            }\n\n            nameParts = splitPrefix(name);\n            prefix = nameParts[0];\n            name = nameParts[1];\n\n            if (prefix) {\n                prefix = normalize(prefix, parentName, applyMap);\n                pluginModule = getOwn(defined, prefix);\n            }\n\n            //Account for relative paths if there is a base name.\n            if (name) {\n                if (prefix) {\n                    if (pluginModule && pluginModule.normalize) {\n                        //Plugin is loaded, use its normalize method.\n                        normalizedName = pluginModule.normalize(name, function (name) {\n                            return normalize(name, parentName, applyMap);\n                        });\n                    } else {\n                        // If nested plugin references, then do not try to\n                        // normalize, as it will not normalize correctly. This\n                        // places a restriction on resourceIds, and the longer\n                        // term solution is not to normalize until plugins are\n                        // loaded and all normalizations to allow for async\n                        // loading of a loader plugin. But for now, fixes the\n                        // common uses. Details in #1131\n                        normalizedName = name.indexOf('!') === -1 ?\n                                         normalize(name, parentName, applyMap) :\n                                         name;\n                    }\n                } else {\n                    //A regular module.\n                    normalizedName = normalize(name, parentName, applyMap);\n\n                    //Normalized name may be a plugin ID due to map config\n                    //application in normalize. The map config values must\n                    //already be normalized, so do not need to redo that part.\n                    nameParts = splitPrefix(normalizedName);\n                    prefix = nameParts[0];\n                    normalizedName = nameParts[1];\n                    isNormalized = true;\n\n                    url = context.nameToUrl(normalizedName);\n                }\n            }\n\n            //If the id is a plugin id that cannot be determined if it needs\n            //normalization, stamp it with a unique ID so two matching relative\n            //ids that may conflict can be separate.\n            suffix = prefix && !pluginModule && !isNormalized ?\n                     '_unnormalized' + (unnormalizedCounter += 1) :\n                     '';\n\n            return {\n                prefix: prefix,\n                name: normalizedName,\n                parentMap: parentModuleMap,\n                unnormalized: !!suffix,\n                url: url,\n                originalName: originalName,\n                isDefine: isDefine,\n                id: (prefix ?\n                        prefix + '!' + normalizedName :\n                        normalizedName) + suffix\n            };\n        }\n\n        function getModule(depMap) {\n            var id = depMap.id,\n                mod = getOwn(registry, id);\n\n            if (!mod) {\n                mod = registry[id] = new context.Module(depMap);\n            }\n\n            return mod;\n        }\n\n        function on(depMap, name, fn) {\n            var id = depMap.id,\n                mod = getOwn(registry, id);\n\n            if (hasProp(defined, id) &&\n                    (!mod || mod.defineEmitComplete)) {\n                if (name === 'defined') {\n                    fn(defined[id]);\n                }\n            } else {\n                mod = getModule(depMap);\n                if (mod.error && name === 'error') {\n                    fn(mod.error);\n                } else {\n                    mod.on(name, fn);\n                }\n            }\n        }\n\n        function onError(err, errback) {\n            var ids = err.requireModules,\n                notified = false;\n\n            if (errback) {\n                errback(err);\n            } else {\n                each(ids, function (id) {\n                    var mod = getOwn(registry, id);\n                    if (mod) {\n                        //Set error on module, so it skips timeout checks.\n                        mod.error = err;\n                        if (mod.events.error) {\n                            notified = true;\n                            mod.emit('error', err);\n                        }\n                    }\n                });\n\n                if (!notified) {\n                    req.onError(err);\n                }\n            }\n        }\n\n        /**\n         * Internal method to transfer globalQueue items to this context's\n         * defQueue.\n         */\n        function takeGlobalQueue() {\n            //Push all the globalDefQueue items into the context's defQueue\n            if (globalDefQueue.length) {\n                each(globalDefQueue, function(queueItem) {\n                    var id = queueItem[0];\n                    if (typeof id === 'string') {\n                        context.defQueueMap[id] = true;\n                    }\n                    defQueue.push(queueItem);\n                });\n                globalDefQueue = [];\n            }\n        }\n\n        handlers = {\n            'require': function (mod) {\n                if (mod.require) {\n                    return mod.require;\n                } else {\n                    return (mod.require = context.makeRequire(mod.map));\n                }\n            },\n            'exports': function (mod) {\n                mod.usingExports = true;\n                if (mod.map.isDefine) {\n                    if (mod.exports) {\n                        return (defined[mod.map.id] = mod.exports);\n                    } else {\n                        return (mod.exports = defined[mod.map.id] = {});\n                    }\n                }\n            },\n            'module': function (mod) {\n                if (mod.module) {\n                    return mod.module;\n                } else {\n                    return (mod.module = {\n                        id: mod.map.id,\n                        uri: mod.map.url,\n                        config: function () {\n                            return getOwn(config.config, mod.map.id) || {};\n                        },\n                        exports: mod.exports || (mod.exports = {})\n                    });\n                }\n            }\n        };\n\n        function cleanRegistry(id) {\n            //Clean up machinery used for waiting modules.\n            delete registry[id];\n            delete enabledRegistry[id];\n        }\n\n        function breakCycle(mod, traced, processed) {\n            var id = mod.map.id;\n\n            if (mod.error) {\n                mod.emit('error', mod.error);\n            } else {\n                traced[id] = true;\n                each(mod.depMaps, function (depMap, i) {\n                    var depId = depMap.id,\n                        dep = getOwn(registry, depId);\n\n                    //Only force things that have not completed\n                    //being defined, so still in the registry,\n                    //and only if it has not been matched up\n                    //in the module already.\n                    if (dep && !mod.depMatched[i] && !processed[depId]) {\n                        if (getOwn(traced, depId)) {\n                            mod.defineDep(i, defined[depId]);\n                            mod.check(); //pass false?\n                        } else {\n                            breakCycle(dep, traced, processed);\n                        }\n                    }\n                });\n                processed[id] = true;\n            }\n        }\n\n        function checkLoaded() {\n            var err, usingPathFallback,\n                waitInterval = config.waitSeconds * 1000,\n                //It is possible to disable the wait interval by using waitSeconds of 0.\n                expired = waitInterval && (context.startTime + waitInterval) < new Date().getTime(),\n                noLoads = [],\n                reqCalls = [],\n                stillLoading = false,\n                needCycleCheck = true;\n\n            //Do not bother if this call was a result of a cycle break.\n            if (inCheckLoaded) {\n                return;\n            }\n\n            inCheckLoaded = true;\n\n            //Figure out the state of all the modules.\n            eachProp(enabledRegistry, function (mod) {\n                var map = mod.map,\n                    modId = map.id;\n\n                //Skip things that are not enabled or in error state.\n                if (!mod.enabled) {\n                    return;\n                }\n\n                if (!map.isDefine) {\n                    reqCalls.push(mod);\n                }\n\n                if (!mod.error) {\n                    //If the module should be executed, and it has not\n                    //been inited and time is up, remember it.\n                    if (!mod.inited && expired) {\n                        if (hasPathFallback(modId)) {\n                            usingPathFallback = true;\n                            stillLoading = true;\n                        } else {\n                            noLoads.push(modId);\n                            removeScript(modId);\n                        }\n                    } else if (!mod.inited && mod.fetched && map.isDefine) {\n                        stillLoading = true;\n                        if (!map.prefix) {\n                            //No reason to keep looking for unfinished\n                            //loading. If the only stillLoading is a\n                            //plugin resource though, keep going,\n                            //because it may be that a plugin resource\n                            //is waiting on a non-plugin cycle.\n                            return (needCycleCheck = false);\n                        }\n                    }\n                }\n            });\n\n            if (expired && noLoads.length) {\n                //If wait time expired, throw error of unloaded modules.\n                err = makeError('timeout', 'Load timeout for modules: ' + noLoads, null, noLoads);\n                err.contextName = context.contextName;\n                return onError(err);\n            }\n\n            //Not expired, check for a cycle.\n            if (needCycleCheck) {\n                each(reqCalls, function (mod) {\n                    breakCycle(mod, {}, {});\n                });\n            }\n\n            //If still waiting on loads, and the waiting load is something\n            //other than a plugin resource, or there are still outstanding\n            //scripts, then just try back later.\n            if ((!expired || usingPathFallback) && stillLoading) {\n                //Something is still waiting to load. Wait for it, but only\n                //if a timeout is not already in effect.\n                if ((isBrowser || isWebWorker) && !checkLoadedTimeoutId) {\n                    checkLoadedTimeoutId = setTimeout(function () {\n                        checkLoadedTimeoutId = 0;\n                        checkLoaded();\n                    }, 50);\n                }\n            }\n\n            inCheckLoaded = false;\n        }\n\n        Module = function (map) {\n            this.events = getOwn(undefEvents, map.id) || {};\n            this.map = map;\n            this.shim = getOwn(config.shim, map.id);\n            this.depExports = [];\n            this.depMaps = [];\n            this.depMatched = [];\n            this.pluginMaps = {};\n            this.depCount = 0;\n\n            /* this.exports this.factory\n               this.depMaps = [],\n               this.enabled, this.fetched\n            */\n        };\n\n        Module.prototype = {\n            init: function (depMaps, factory, errback, options) {\n                options = options || {};\n\n                //Do not do more inits if already done. Can happen if there\n                //are multiple define calls for the same module. That is not\n                //a normal, common case, but it is also not unexpected.\n                if (this.inited) {\n                    return;\n                }\n\n                this.factory = factory;\n\n                if (errback) {\n                    //Register for errors on this module.\n                    this.on('error', errback);\n                } else if (this.events.error) {\n                    //If no errback already, but there are error listeners\n                    //on this module, set up an errback to pass to the deps.\n                    errback = bind(this, function (err) {\n                        this.emit('error', err);\n                    });\n                }\n\n                //Do a copy of the dependency array, so that\n                //source inputs are not modified. For example\n                //\"shim\" deps are passed in here directly, and\n                //doing a direct modification of the depMaps array\n                //would affect that config.\n                this.depMaps = depMaps && depMaps.slice(0);\n\n                this.errback = errback;\n\n                //Indicate this module has be initialized\n                this.inited = true;\n\n                this.ignore = options.ignore;\n\n                //Could have option to init this module in enabled mode,\n                //or could have been previously marked as enabled. However,\n                //the dependencies are not known until init is called. So\n                //if enabled previously, now trigger dependencies as enabled.\n                if (options.enabled || this.enabled) {\n                    //Enable this module and dependencies.\n                    //Will call this.check()\n                    this.enable();\n                } else {\n                    this.check();\n                }\n            },\n\n            defineDep: function (i, depExports) {\n                //Because of cycles, defined callback for a given\n                //export can be called more than once.\n                if (!this.depMatched[i]) {\n                    this.depMatched[i] = true;\n                    this.depCount -= 1;\n                    this.depExports[i] = depExports;\n                }\n            },\n\n            fetch: function () {\n                if (this.fetched) {\n                    return;\n                }\n                this.fetched = true;\n\n                context.startTime = (new Date()).getTime();\n\n                var map = this.map;\n\n                //If the manager is for a plugin managed resource,\n                //ask the plugin to load it now.\n                if (this.shim) {\n                    context.makeRequire(this.map, {\n                        enableBuildCallback: true\n                    })(this.shim.deps || [], bind(this, function () {\n                        return map.prefix ? this.callPlugin() : this.load();\n                    }));\n                } else {\n                    //Regular dependency.\n                    return map.prefix ? this.callPlugin() : this.load();\n                }\n            },\n\n            load: function () {\n                var url = this.map.url;\n\n                //Regular dependency.\n                if (!urlFetched[url]) {\n                    urlFetched[url] = true;\n                    context.load(this.map.id, url);\n                }\n            },\n\n            /**\n             * Checks if the module is ready to define itself, and if so,\n             * define it.\n             */\n            check: function () {\n                if (!this.enabled || this.enabling) {\n                    return;\n                }\n\n                var err, cjsModule,\n                    id = this.map.id,\n                    depExports = this.depExports,\n                    exports = this.exports,\n                    factory = this.factory;\n\n                if (!this.inited) {\n                    // Only fetch if not already in the defQueue.\n                    if (!hasProp(context.defQueueMap, id)) {\n                        this.fetch();\n                    }\n                } else if (this.error) {\n                    this.emit('error', this.error);\n                } else if (!this.defining) {\n                    //The factory could trigger another require call\n                    //that would result in checking this module to\n                    //define itself again. If already in the process\n                    //of doing that, skip this work.\n                    this.defining = true;\n\n                    if (this.depCount < 1 && !this.defined) {\n                        if (isFunction(factory)) {\n                            //If there is an error listener, favor passing\n                            //to that instead of throwing an error. However,\n                            //only do it for define()'d  modules. require\n                            //errbacks should not be called for failures in\n                            //their callbacks (#699). However if a global\n                            //onError is set, use that.\n                            if ((this.events.error && this.map.isDefine) ||\n                                req.onError !== defaultOnError) {\n                                try {\n                                    exports = context.execCb(id, factory, depExports, exports);\n                                } catch (e) {\n                                    err = e;\n                                }\n                            } else {\n                                exports = context.execCb(id, factory, depExports, exports);\n                            }\n\n                            // Favor return value over exports. If node/cjs in play,\n                            // then will not have a return value anyway. Favor\n                            // module.exports assignment over exports object.\n                            if (this.map.isDefine && exports === undefined) {\n                                cjsModule = this.module;\n                                if (cjsModule) {\n                                    exports = cjsModule.exports;\n                                } else if (this.usingExports) {\n                                    //exports already set the defined value.\n                                    exports = this.exports;\n                                }\n                            }\n\n                            if (err) {\n                                err.requireMap = this.map;\n                                err.requireModules = this.map.isDefine ? [this.map.id] : null;\n                                err.requireType = this.map.isDefine ? 'define' : 'require';\n                                return onError((this.error = err));\n                            }\n\n                        } else {\n                            //Just a literal value\n                            exports = factory;\n                        }\n\n                        this.exports = exports;\n\n                        if (this.map.isDefine && !this.ignore) {\n                            defined[id] = exports;\n\n                            if (req.onResourceLoad) {\n                                var resLoadMaps = [];\n                                each(this.depMaps, function (depMap) {\n                                    resLoadMaps.push(depMap.normalizedMap || depMap);\n                                });\n                                req.onResourceLoad(context, this.map, resLoadMaps);\n                            }\n                        }\n\n                        //Clean up\n                        cleanRegistry(id);\n\n                        this.defined = true;\n                    }\n\n                    //Finished the define stage. Allow calling check again\n                    //to allow define notifications below in the case of a\n                    //cycle.\n                    this.defining = false;\n\n                    if (this.defined && !this.defineEmitted) {\n                        this.defineEmitted = true;\n                        this.emit('defined', this.exports);\n                        this.defineEmitComplete = true;\n                    }\n\n                }\n            },\n\n            callPlugin: function () {\n                var map = this.map,\n                    id = map.id,\n                    //Map already normalized the prefix.\n                    pluginMap = makeModuleMap(map.prefix);\n\n                //Mark this as a dependency for this plugin, so it\n                //can be traced for cycles.\n                this.depMaps.push(pluginMap);\n\n                on(pluginMap, 'defined', bind(this, function (plugin) {\n                    var load, normalizedMap, normalizedMod,\n                        bundleId = getOwn(bundlesMap, this.map.id),\n                        name = this.map.name,\n                        parentName = this.map.parentMap ? this.map.parentMap.name : null,\n                        localRequire = context.makeRequire(map.parentMap, {\n                            enableBuildCallback: true\n                        });\n\n                    //If current map is not normalized, wait for that\n                    //normalized name to load instead of continuing.\n                    if (this.map.unnormalized) {\n                        //Normalize the ID if the plugin allows it.\n                        if (plugin.normalize) {\n                            name = plugin.normalize(name, function (name) {\n                                return normalize(name, parentName, true);\n                            }) || '';\n                        }\n\n                        //prefix and name should already be normalized, no need\n                        //for applying map config again either.\n                        normalizedMap = makeModuleMap(map.prefix + '!' + name,\n                                                      this.map.parentMap);\n                        on(normalizedMap,\n                            'defined', bind(this, function (value) {\n                                this.map.normalizedMap = normalizedMap;\n                                this.init([], function () { return value; }, null, {\n                                    enabled: true,\n                                    ignore: true\n                                });\n                            }));\n\n                        normalizedMod = getOwn(registry, normalizedMap.id);\n                        if (normalizedMod) {\n                            //Mark this as a dependency for this plugin, so it\n                            //can be traced for cycles.\n                            this.depMaps.push(normalizedMap);\n\n                            if (this.events.error) {\n                                normalizedMod.on('error', bind(this, function (err) {\n                                    this.emit('error', err);\n                                }));\n                            }\n                            normalizedMod.enable();\n                        }\n\n                        return;\n                    }\n\n                    //If a paths config, then just load that file instead to\n                    //resolve the plugin, as it is built into that paths layer.\n                    if (bundleId) {\n                        this.map.url = context.nameToUrl(bundleId);\n                        this.load();\n                        return;\n                    }\n\n                    load = bind(this, function (value) {\n                        this.init([], function () { return value; }, null, {\n                            enabled: true\n                        });\n                    });\n\n                    load.error = bind(this, function (err) {\n                        this.inited = true;\n                        this.error = err;\n                        err.requireModules = [id];\n\n                        //Remove temp unnormalized modules for this module,\n                        //since they will never be resolved otherwise now.\n                        eachProp(registry, function (mod) {\n                            if (mod.map.id.indexOf(id + '_unnormalized') === 0) {\n                                cleanRegistry(mod.map.id);\n                            }\n                        });\n\n                        onError(err);\n                    });\n\n                    //Allow plugins to load other code without having to know the\n                    //context or how to 'complete' the load.\n                    load.fromText = bind(this, function (text, textAlt) {\n                        /*jslint evil: true */\n                        var moduleName = map.name,\n                            moduleMap = makeModuleMap(moduleName),\n                            hasInteractive = useInteractive;\n\n                        //As of 2.1.0, support just passing the text, to reinforce\n                        //fromText only being called once per resource. Still\n                        //support old style of passing moduleName but discard\n                        //that moduleName in favor of the internal ref.\n                        if (textAlt) {\n                            text = textAlt;\n                        }\n\n                        //Turn off interactive script matching for IE for any define\n                        //calls in the text, then turn it back on at the end.\n                        if (hasInteractive) {\n                            useInteractive = false;\n                        }\n\n                        //Prime the system by creating a module instance for\n                        //it.\n                        getModule(moduleMap);\n\n                        //Transfer any config to this other module.\n                        if (hasProp(config.config, id)) {\n                            config.config[moduleName] = config.config[id];\n                        }\n\n                        try {\n                            req.exec(text);\n                        } catch (e) {\n                            return onError(makeError('fromtexteval',\n                                             'fromText eval for ' + id +\n                                            ' failed: ' + e,\n                                             e,\n                                             [id]));\n                        }\n\n                        if (hasInteractive) {\n                            useInteractive = true;\n                        }\n\n                        //Mark this as a dependency for the plugin\n                        //resource\n                        this.depMaps.push(moduleMap);\n\n                        //Support anonymous modules.\n                        context.completeLoad(moduleName);\n\n                        //Bind the value of that module to the value for this\n                        //resource ID.\n                        localRequire([moduleName], load);\n                    });\n\n                    //Use parentName here since the plugin's name is not reliable,\n                    //could be some weird string with no path that actually wants to\n                    //reference the parentName's path.\n                    plugin.load(map.name, localRequire, load, config);\n                }));\n\n                context.enable(pluginMap, this);\n                this.pluginMaps[pluginMap.id] = pluginMap;\n            },\n\n            enable: function () {\n                enabledRegistry[this.map.id] = this;\n                this.enabled = true;\n\n                //Set flag mentioning that the module is enabling,\n                //so that immediate calls to the defined callbacks\n                //for dependencies do not trigger inadvertent load\n                //with the depCount still being zero.\n                this.enabling = true;\n\n                //Enable each dependency\n                each(this.depMaps, bind(this, function (depMap, i) {\n                    var id, mod, handler;\n\n                    if (typeof depMap === 'string') {\n                        //Dependency needs to be converted to a depMap\n                        //and wired up to this module.\n                        depMap = makeModuleMap(depMap,\n                                               (this.map.isDefine ? this.map : this.map.parentMap),\n                                               false,\n                                               !this.skipMap);\n                        this.depMaps[i] = depMap;\n\n                        handler = getOwn(handlers, depMap.id);\n\n                        if (handler) {\n                            this.depExports[i] = handler(this);\n                            return;\n                        }\n\n                        this.depCount += 1;\n\n                        on(depMap, 'defined', bind(this, function (depExports) {\n                            if (this.undefed) {\n                                return;\n                            }\n                            this.defineDep(i, depExports);\n                            this.check();\n                        }));\n\n                        if (this.errback) {\n                            on(depMap, 'error', bind(this, this.errback));\n                        } else if (this.events.error) {\n                            // No direct errback on this module, but something\n                            // else is listening for errors, so be sure to\n                            // propagate the error correctly.\n                            on(depMap, 'error', bind(this, function(err) {\n                                this.emit('error', err);\n                            }));\n                        }\n                    }\n\n                    id = depMap.id;\n                    mod = registry[id];\n\n                    //Skip special modules like 'require', 'exports', 'module'\n                    //Also, don't call enable if it is already enabled,\n                    //important in circular dependency cases.\n                    if (!hasProp(handlers, id) && mod && !mod.enabled) {\n                        context.enable(depMap, this);\n                    }\n                }));\n\n                //Enable each plugin that is used in\n                //a dependency\n                eachProp(this.pluginMaps, bind(this, function (pluginMap) {\n                    var mod = getOwn(registry, pluginMap.id);\n                    if (mod && !mod.enabled) {\n                        context.enable(pluginMap, this);\n                    }\n                }));\n\n                this.enabling = false;\n\n                this.check();\n            },\n\n            on: function (name, cb) {\n                var cbs = this.events[name];\n                if (!cbs) {\n                    cbs = this.events[name] = [];\n                }\n                cbs.push(cb);\n            },\n\n            emit: function (name, evt) {\n                each(this.events[name], function (cb) {\n                    cb(evt);\n                });\n                if (name === 'error') {\n                    //Now that the error handler was triggered, remove\n                    //the listeners, since this broken Module instance\n                    //can stay around for a while in the registry.\n                    delete this.events[name];\n                }\n            }\n        };\n\n        function callGetModule(args) {\n            //Skip modules already defined.\n            if (!hasProp(defined, args[0])) {\n                getModule(makeModuleMap(args[0], null, true)).init(args[1], args[2]);\n            }\n        }\n\n        function removeListener(node, func, name, ieName) {\n            //Favor detachEvent because of IE9\n            //issue, see attachEvent/addEventListener comment elsewhere\n            //in this file.\n            if (node.detachEvent && !isOpera) {\n                //Probably IE. If not it will throw an error, which will be\n                //useful to know.\n                if (ieName) {\n                    node.detachEvent(ieName, func);\n                }\n            } else {\n                node.removeEventListener(name, func, false);\n            }\n        }\n\n        /**\n         * Given an event from a script node, get the requirejs info from it,\n         * and then removes the event listeners on the node.\n         * @param {Event} evt\n         * @returns {Object}\n         */\n        function getScriptData(evt) {\n            //Using currentTarget instead of target for Firefox 2.0's sake. Not\n            //all old browsers will be supported, but this one was easy enough\n            //to support and still makes sense.\n            var node = evt.currentTarget || evt.srcElement;\n\n            //Remove the listeners once here.\n            removeListener(node, context.onScriptLoad, 'load', 'onreadystatechange');\n            removeListener(node, context.onScriptError, 'error');\n\n            return {\n                node: node,\n                id: node && node.getAttribute('data-requiremodule')\n            };\n        }\n\n        function intakeDefines() {\n            var args;\n\n            //Any defined modules in the global queue, intake them now.\n            takeGlobalQueue();\n\n            //Make sure any remaining defQueue items get properly processed.\n            while (defQueue.length) {\n                args = defQueue.shift();\n                if (args[0] === null) {\n                    return onError(makeError('mismatch', 'Mismatched anonymous define() module: ' +\n                        args[args.length - 1]));\n                } else {\n                    //args are id, deps, factory. Should be normalized by the\n                    //define() function.\n                    callGetModule(args);\n                }\n            }\n            context.defQueueMap = {};\n        }\n\n        context = {\n            config: config,\n            contextName: contextName,\n            registry: registry,\n            defined: defined,\n            urlFetched: urlFetched,\n            defQueue: defQueue,\n            defQueueMap: {},\n            Module: Module,\n            makeModuleMap: makeModuleMap,\n            nextTick: req.nextTick,\n            onError: onError,\n\n            /**\n             * Set a configuration for the context.\n             * @param {Object} cfg config object to integrate.\n             */\n            configure: function (cfg) {\n                //Make sure the baseUrl ends in a slash.\n                if (cfg.baseUrl) {\n                    if (cfg.baseUrl.charAt(cfg.baseUrl.length - 1) !== '/') {\n                        cfg.baseUrl += '/';\n                    }\n                }\n\n                // Convert old style urlArgs string to a function.\n                if (typeof cfg.urlArgs === 'string') {\n                    var urlArgs = cfg.urlArgs;\n                    cfg.urlArgs = function(id, url) {\n                        return (url.indexOf('?') === -1 ? '?' : '&') + urlArgs;\n                    };\n                }\n\n                //Save off the paths since they require special processing,\n                //they are additive.\n                var shim = config.shim,\n                    objs = {\n                        paths: true,\n                        bundles: true,\n                        config: true,\n                        map: true\n                    };\n\n                eachProp(cfg, function (value, prop) {\n                    if (objs[prop]) {\n                        if (!config[prop]) {\n                            config[prop] = {};\n                        }\n                        mixin(config[prop], value, true, true);\n                    } else {\n                        config[prop] = value;\n                    }\n                });\n\n                //Reverse map the bundles\n                if (cfg.bundles) {\n                    eachProp(cfg.bundles, function (value, prop) {\n                        each(value, function (v) {\n                            if (v !== prop) {\n                                bundlesMap[v] = prop;\n                            }\n                        });\n                    });\n                }\n\n                //Merge shim\n                if (cfg.shim) {\n                    eachProp(cfg.shim, function (value, id) {\n                        //Normalize the structure\n                        if (isArray(value)) {\n                            value = {\n                                deps: value\n                            };\n                        }\n                        if ((value.exports || value.init) && !value.exportsFn) {\n                            value.exportsFn = context.makeShimExports(value);\n                        }\n                        shim[id] = value;\n                    });\n                    config.shim = shim;\n                }\n\n                //Adjust packages if necessary.\n                if (cfg.packages) {\n                    each(cfg.packages, function (pkgObj) {\n                        var location, name;\n\n                        pkgObj = typeof pkgObj === 'string' ? {name: pkgObj} : pkgObj;\n\n                        name = pkgObj.name;\n                        location = pkgObj.location;\n                        if (location) {\n                            config.paths[name] = pkgObj.location;\n                        }\n\n                        //Save pointer to main module ID for pkg name.\n                        //Remove leading dot in main, so main paths are normalized,\n                        //and remove any trailing .js, since different package\n                        //envs have different conventions: some use a module name,\n                        //some use a file name.\n                        config.pkgs[name] = pkgObj.name + '/' + (pkgObj.main || 'main')\n                                     .replace(currDirRegExp, '')\n                                     .replace(jsSuffixRegExp, '');\n                    });\n                }\n\n                //If there are any \"waiting to execute\" modules in the registry,\n                //update the maps for them, since their info, like URLs to load,\n                //may have changed.\n                eachProp(registry, function (mod, id) {\n                    //If module already has init called, since it is too\n                    //late to modify them, and ignore unnormalized ones\n                    //since they are transient.\n                    if (!mod.inited && !mod.map.unnormalized) {\n                        mod.map = makeModuleMap(id, null, true);\n                    }\n                });\n\n                //If a deps array or a config callback is specified, then call\n                //require with those args. This is useful when require is defined as a\n                //config object before require.js is loaded.\n                if (cfg.deps || cfg.callback) {\n                    context.require(cfg.deps || [], cfg.callback);\n                }\n            },\n\n            makeShimExports: function (value) {\n                function fn() {\n                    var ret;\n                    if (value.init) {\n                        ret = value.init.apply(global, arguments);\n                    }\n                    return ret || (value.exports && getGlobal(value.exports));\n                }\n                return fn;\n            },\n\n            makeRequire: function (relMap, options) {\n                options = options || {};\n\n                function localRequire(deps, callback, errback) {\n                    var id, map, requireMod;\n\n                    if (options.enableBuildCallback && callback && isFunction(callback)) {\n                        callback.__requireJsBuild = true;\n                    }\n\n                    if (typeof deps === 'string') {\n                        if (isFunction(callback)) {\n                            //Invalid call\n                            return onError(makeError('requireargs', 'Invalid require call'), errback);\n                        }\n\n                        //If require|exports|module are requested, get the\n                        //value for them from the special handlers. Caveat:\n                        //this only works while module is being defined.\n                        if (relMap && hasProp(handlers, deps)) {\n                            return handlers[deps](registry[relMap.id]);\n                        }\n\n                        //Synchronous access to one module. If require.get is\n                        //available (as in the Node adapter), prefer that.\n                        if (req.get) {\n                            return req.get(context, deps, relMap, localRequire);\n                        }\n\n                        //Normalize module name, if it contains . or ..\n                        map = makeModuleMap(deps, relMap, false, true);\n                        id = map.id;\n\n                        if (!hasProp(defined, id)) {\n                            return onError(makeError('notloaded', 'Module name \"' +\n                                        id +\n                                        '\" has not been loaded yet for context: ' +\n                                        contextName +\n                                        (relMap ? '' : '. Use require([])')));\n                        }\n                        return defined[id];\n                    }\n\n                    //Grab defines waiting in the global queue.\n                    intakeDefines();\n\n                    //Mark all the dependencies as needing to be loaded.\n                    context.nextTick(function () {\n                        //Some defines could have been added since the\n                        //require call, collect them.\n                        intakeDefines();\n\n                        requireMod = getModule(makeModuleMap(null, relMap));\n\n                        //Store if map config should be applied to this require\n                        //call for dependencies.\n                        requireMod.skipMap = options.skipMap;\n\n                        requireMod.init(deps, callback, errback, {\n                            enabled: true\n                        });\n\n                        checkLoaded();\n                    });\n\n                    return localRequire;\n                }\n\n                mixin(localRequire, {\n                    isBrowser: isBrowser,\n\n                    /**\n                     * Converts a module name + .extension into an URL path.\n                     * *Requires* the use of a module name. It does not support using\n                     * plain URLs like nameToUrl.\n                     */\n                    toUrl: function (moduleNamePlusExt) {\n                        var ext,\n                            index = moduleNamePlusExt.lastIndexOf('.'),\n                            segment = moduleNamePlusExt.split('/')[0],\n                            isRelative = segment === '.' || segment === '..';\n\n                        //Have a file extension alias, and it is not the\n                        //dots from a relative path.\n                        if (index !== -1 && (!isRelative || index > 1)) {\n                            ext = moduleNamePlusExt.substring(index, moduleNamePlusExt.length);\n                            moduleNamePlusExt = moduleNamePlusExt.substring(0, index);\n                        }\n\n                        return context.nameToUrl(normalize(moduleNamePlusExt,\n                                                relMap && relMap.id, true), ext,  true);\n                    },\n\n                    defined: function (id) {\n                        return hasProp(defined, makeModuleMap(id, relMap, false, true).id);\n                    },\n\n                    specified: function (id) {\n                        id = makeModuleMap(id, relMap, false, true).id;\n                        return hasProp(defined, id) || hasProp(registry, id);\n                    }\n                });\n\n                //Only allow undef on top level require calls\n                if (!relMap) {\n                    localRequire.undef = function (id) {\n                        //Bind any waiting define() calls to this context,\n                        //fix for #408\n                        takeGlobalQueue();\n\n                        var map = makeModuleMap(id, relMap, true),\n                            mod = getOwn(registry, id);\n\n                        mod.undefed = true;\n                        removeScript(id);\n\n                        delete defined[id];\n                        delete urlFetched[map.url];\n                        delete undefEvents[id];\n\n                        //Clean queued defines too. Go backwards\n                        //in array so that the splices do not\n                        //mess up the iteration.\n                        eachReverse(defQueue, function(args, i) {\n                            if (args[0] === id) {\n                                defQueue.splice(i, 1);\n                            }\n                        });\n                        delete context.defQueueMap[id];\n\n                        if (mod) {\n                            //Hold on to listeners in case the\n                            //module will be attempted to be reloaded\n                            //using a different config.\n                            if (mod.events.defined) {\n                                undefEvents[id] = mod.events;\n                            }\n\n                            cleanRegistry(id);\n                        }\n                    };\n                }\n\n                return localRequire;\n            },\n\n            /**\n             * Called to enable a module if it is still in the registry\n             * awaiting enablement. A second arg, parent, the parent module,\n             * is passed in for context, when this method is overridden by\n             * the optimizer. Not shown here to keep code compact.\n             */\n            enable: function (depMap) {\n                var mod = getOwn(registry, depMap.id);\n                if (mod) {\n                    getModule(depMap).enable();\n                }\n            },\n\n            /**\n             * Internal method used by environment adapters to complete a load event.\n             * A load event could be a script load or just a load pass from a synchronous\n             * load call.\n             * @param {String} moduleName the name of the module to potentially complete.\n             */\n            completeLoad: function (moduleName) {\n                var found, args, mod,\n                    shim = getOwn(config.shim, moduleName) || {},\n                    shExports = shim.exports;\n\n                takeGlobalQueue();\n\n                while (defQueue.length) {\n                    args = defQueue.shift();\n                    if (args[0] === null) {\n                        args[0] = moduleName;\n                        //If already found an anonymous module and bound it\n                        //to this name, then this is some other anon module\n                        //waiting for its completeLoad to fire.\n                        if (found) {\n                            break;\n                        }\n                        found = true;\n                    } else if (args[0] === moduleName) {\n                        //Found matching define call for this script!\n                        found = true;\n                    }\n\n                    callGetModule(args);\n                }\n                context.defQueueMap = {};\n\n                //Do this after the cycle of callGetModule in case the result\n                //of those calls/init calls changes the registry.\n                mod = getOwn(registry, moduleName);\n\n                if (!found && !hasProp(defined, moduleName) && mod && !mod.inited) {\n                    if (config.enforceDefine && (!shExports || !getGlobal(shExports))) {\n                        if (hasPathFallback(moduleName)) {\n                            return;\n                        } else {\n                            return onError(makeError('nodefine',\n                                             'No define call for ' + moduleName,\n                                             null,\n                                             [moduleName]));\n                        }\n                    } else {\n                        //A script that does not call define(), so just simulate\n                        //the call for it.\n                        callGetModule([moduleName, (shim.deps || []), shim.exportsFn]);\n                    }\n                }\n\n                checkLoaded();\n            },\n\n            /**\n             * Converts a module name to a file path. Supports cases where\n             * moduleName may actually be just an URL.\n             * Note that it **does not** call normalize on the moduleName,\n             * it is assumed to have already been normalized. This is an\n             * internal API, not a public one. Use toUrl for the public API.\n             */\n            nameToUrl: function (moduleName, ext, skipExt) {\n                var paths, syms, i, parentModule, url,\n                    parentPath, bundleId,\n                    pkgMain = getOwn(config.pkgs, moduleName);\n\n                if (pkgMain) {\n                    moduleName = pkgMain;\n                }\n\n                bundleId = getOwn(bundlesMap, moduleName);\n\n                if (bundleId) {\n                    return context.nameToUrl(bundleId, ext, skipExt);\n                }\n\n                //If a colon is in the URL, it indicates a protocol is used and it is just\n                //an URL to a file, or if it starts with a slash, contains a query arg (i.e. ?)\n                //or ends with .js, then assume the user meant to use an url and not a module id.\n                //The slash is important for protocol-less URLs as well as full paths.\n                if (req.jsExtRegExp.test(moduleName)) {\n                    //Just a plain path, not module name lookup, so just return it.\n                    //Add extension if it is included. This is a bit wonky, only non-.js things pass\n                    //an extension, this method probably needs to be reworked.\n                    url = moduleName + (ext || '');\n                } else {\n                    //A module that needs to be converted to a path.\n                    paths = config.paths;\n\n                    syms = moduleName.split('/');\n                    //For each module name segment, see if there is a path\n                    //registered for it. Start with most specific name\n                    //and work up from it.\n                    for (i = syms.length; i > 0; i -= 1) {\n                        parentModule = syms.slice(0, i).join('/');\n\n                        parentPath = getOwn(paths, parentModule);\n                        if (parentPath) {\n                            //If an array, it means there are a few choices,\n                            //Choose the one that is desired\n                            if (isArray(parentPath)) {\n                                parentPath = parentPath[0];\n                            }\n                            syms.splice(0, i, parentPath);\n                            break;\n                        }\n                    }\n\n                    //Join the path parts together, then figure out if baseUrl is needed.\n                    url = syms.join('/');\n                    url += (ext || (/^data\\:|^blob\\:|\\?/.test(url) || skipExt ? '' : '.js'));\n                    url = (url.charAt(0) === '/' || url.match(/^[\\w\\+\\.\\-]+:/) ? '' : config.baseUrl) + url;\n                }\n\n                return config.urlArgs && !/^blob\\:/.test(url) ?\n                       url + config.urlArgs(moduleName, url) : url;\n            },\n\n            //Delegates to req.load. Broken out as a separate function to\n            //allow overriding in the optimizer.\n            load: function (id, url) {\n                req.load(context, id, url);\n            },\n\n            /**\n             * Executes a module callback function. Broken out as a separate function\n             * solely to allow the build system to sequence the files in the built\n             * layer in the right sequence.\n             *\n             * @private\n             */\n            execCb: function (name, callback, args, exports) {\n                return callback.apply(exports, args);\n            },\n\n            /**\n             * callback for script loads, used to check status of loading.\n             *\n             * @param {Event} evt the event from the browser for the script\n             * that was loaded.\n             */\n            onScriptLoad: function (evt) {\n                //Using currentTarget instead of target for Firefox 2.0's sake. Not\n                //all old browsers will be supported, but this one was easy enough\n                //to support and still makes sense.\n                if (evt.type === 'load' ||\n                        (readyRegExp.test((evt.currentTarget || evt.srcElement).readyState))) {\n                    //Reset interactive script so a script node is not held onto for\n                    //to long.\n                    interactiveScript = null;\n\n                    //Pull out the name of the module and the context.\n                    var data = getScriptData(evt);\n                    context.completeLoad(data.id);\n                }\n            },\n\n            /**\n             * Callback for script errors.\n             */\n            onScriptError: function (evt) {\n                var data = getScriptData(evt);\n                if (!hasPathFallback(data.id)) {\n                    var parents = [];\n                    eachProp(registry, function(value, key) {\n                        if (key.indexOf('_@r') !== 0) {\n                            each(value.depMaps, function(depMap) {\n                                if (depMap.id === data.id) {\n                                    parents.push(key);\n                                    return true;\n                                }\n                            });\n                        }\n                    });\n                    return onError(makeError('scripterror', 'Script error for \"' + data.id +\n                                             (parents.length ?\n                                             '\", needed by: ' + parents.join(', ') :\n                                             '\"'), evt, [data.id]));\n                }\n            }\n        };\n\n        context.require = context.makeRequire();\n        return context;\n    }\n\n    /**\n     * Main entry point.\n     *\n     * If the only argument to require is a string, then the module that\n     * is represented by that string is fetched for the appropriate context.\n     *\n     * If the first argument is an array, then it will be treated as an array\n     * of dependency string names to fetch. An optional function callback can\n     * be specified to execute when all of those dependencies are available.\n     *\n     * Make a local req variable to help Caja compliance (it assumes things\n     * on a require that are not standardized), and to give a short\n     * name for minification/local scope use.\n     */\n    req = requirejs = function (deps, callback, errback, optional) {\n\n        //Find the right context, use default\n        var context, config,\n            contextName = defContextName;\n\n        // Determine if have config object in the call.\n        if (!isArray(deps) && typeof deps !== 'string') {\n            // deps is a config object\n            config = deps;\n            if (isArray(callback)) {\n                // Adjust args if there are dependencies\n                deps = callback;\n                callback = errback;\n                errback = optional;\n            } else {\n                deps = [];\n            }\n        }\n\n        if (config && config.context) {\n            contextName = config.context;\n        }\n\n        context = getOwn(contexts, contextName);\n        if (!context) {\n            context = contexts[contextName] = req.s.newContext(contextName);\n        }\n\n        if (config) {\n            context.configure(config);\n        }\n\n        return context.require(deps, callback, errback);\n    };\n\n    /**\n     * Support require.config() to make it easier to cooperate with other\n     * AMD loaders on globally agreed names.\n     */\n    req.config = function (config) {\n        return req(config);\n    };\n\n    /**\n     * Execute something after the current tick\n     * of the event loop. Override for other envs\n     * that have a better solution than setTimeout.\n     * @param  {Function} fn function to execute later.\n     */\n    req.nextTick = typeof setTimeout !== 'undefined' ? function (fn) {\n        setTimeout(fn, 4);\n    } : function (fn) { fn(); };\n\n    /**\n     * Export require as a global, but only if it does not already exist.\n     */\n    if (!require) {\n        require = req;\n    }\n\n    req.version = version;\n\n    //Used to filter out dependencies that are already paths.\n    req.jsExtRegExp = /^\\/|:|\\?|\\.js$/;\n    req.isBrowser = isBrowser;\n    s = req.s = {\n        contexts: contexts,\n        newContext: newContext\n    };\n\n    //Create default context.\n    req({});\n\n    //Exports some context-sensitive methods on global require.\n    each([\n        'toUrl',\n        'undef',\n        'defined',\n        'specified'\n    ], function (prop) {\n        //Reference from contexts instead of early binding to default context,\n        //so that during builds, the latest instance of the default context\n        //with its config gets used.\n        req[prop] = function () {\n            var ctx = contexts[defContextName];\n            return ctx.require[prop].apply(ctx, arguments);\n        };\n    });\n\n    if (isBrowser) {\n        head = s.head = document.getElementsByTagName('head')[0];\n        //If BASE tag is in play, using appendChild is a problem for IE6.\n        //When that browser dies, this can be removed. Details in this jQuery bug:\n        //http://dev.jquery.com/ticket/2709\n        baseElement = document.getElementsByTagName('base')[0];\n        if (baseElement) {\n            head = s.head = baseElement.parentNode;\n        }\n    }\n\n    /**\n     * Any errors that require explicitly generates will be passed to this\n     * function. Intercept/override it if you want custom error handling.\n     * @param {Error} err the error object.\n     */\n    req.onError = defaultOnError;\n\n    /**\n     * Creates the node for the load command. Only used in browser envs.\n     */\n    req.createNode = function (config, moduleName, url) {\n        var node = config.xhtml ?\n                document.createElementNS('http://www.w3.org/1999/xhtml', 'html:script') :\n                document.createElement('script');\n        node.type = config.scriptType || 'text/javascript';\n        node.charset = 'utf-8';\n        node.async = true;\n        return node;\n    };\n\n    /**\n     * Does the request to load a module for the browser case.\n     * Make this a separate function to allow other environments\n     * to override it.\n     *\n     * @param {Object} context the require context to find state.\n     * @param {String} moduleName the name of the module.\n     * @param {Object} url the URL to the module.\n     */\n    req.load = function (context, moduleName, url) {\n        var config = (context && context.config) || {},\n            node;\n        if (isBrowser) {\n            //In the browser so use a script tag\n            node = req.createNode(config, moduleName, url);\n\n            node.setAttribute('data-requirecontext', context.contextName);\n            node.setAttribute('data-requiremodule', moduleName);\n\n            //Set up load listener. Test attachEvent first because IE9 has\n            //a subtle issue in its addEventListener and script onload firings\n            //that do not match the behavior of all other browsers with\n            //addEventListener support, which fire the onload event for a\n            //script right after the script execution. See:\n            //https://connect.microsoft.com/IE/feedback/details/648057/script-onload-event-is-not-fired-immediately-after-script-execution\n            //UNFORTUNATELY Opera implements attachEvent but does not follow the script\n            //script execution mode.\n            if (node.attachEvent &&\n                    //Check if node.attachEvent is artificially added by custom script or\n                    //natively supported by browser\n                    //read https://github.com/requirejs/requirejs/issues/187\n                    //if we can NOT find [native code] then it must NOT natively supported.\n                    //in IE8, node.attachEvent does not have toString()\n                    //Note the test for \"[native code\" with no closing brace, see:\n                    //https://github.com/requirejs/requirejs/issues/273\n                    !(node.attachEvent.toString && node.attachEvent.toString().indexOf('[native code') < 0) &&\n                    !isOpera) {\n                //Probably IE. IE (at least 6-8) do not fire\n                //script onload right after executing the script, so\n                //we cannot tie the anonymous define call to a name.\n                //However, IE reports the script as being in 'interactive'\n                //readyState at the time of the define call.\n                useInteractive = true;\n\n                node.attachEvent('onreadystatechange', context.onScriptLoad);\n                //It would be great to add an error handler here to catch\n                //404s in IE9+. However, onreadystatechange will fire before\n                //the error handler, so that does not help. If addEventListener\n                //is used, then IE will fire error before load, but we cannot\n                //use that pathway given the connect.microsoft.com issue\n                //mentioned above about not doing the 'script execute,\n                //then fire the script load event listener before execute\n                //next script' that other browsers do.\n                //Best hope: IE10 fixes the issues,\n                //and then destroys all installs of IE 6-9.\n                //node.attachEvent('onerror', context.onScriptError);\n            } else {\n                node.addEventListener('load', context.onScriptLoad, false);\n                node.addEventListener('error', context.onScriptError, false);\n            }\n            node.src = url;\n\n            //Calling onNodeCreated after all properties on the node have been\n            //set, but before it is placed in the DOM.\n            if (config.onNodeCreated) {\n                config.onNodeCreated(node, config, moduleName, url);\n            }\n\n            //For some cache cases in IE 6-8, the script executes before the end\n            //of the appendChild execution, so to tie an anonymous define\n            //call to the module name (which is stored on the node), hold on\n            //to a reference to this node, but clear after the DOM insertion.\n            currentlyAddingScript = node;\n            if (baseElement) {\n                head.insertBefore(node, baseElement);\n            } else {\n                head.appendChild(node);\n            }\n            currentlyAddingScript = null;\n\n            return node;\n        } else if (isWebWorker) {\n            try {\n                //In a web worker, use importScripts. This is not a very\n                //efficient use of importScripts, importScripts will block until\n                //its script is downloaded and evaluated. However, if web workers\n                //are in play, the expectation is that a build has been done so\n                //that only one script needs to be loaded anyway. This may need\n                //to be reevaluated if other use cases become common.\n\n                // Post a task to the event loop to work around a bug in WebKit\n                // where the worker gets garbage-collected after calling\n                // importScripts(): https://webkit.org/b/153317\n                setTimeout(function() {}, 0);\n                importScripts(url);\n\n                //Account for anonymous modules\n                context.completeLoad(moduleName);\n            } catch (e) {\n                context.onError(makeError('importscripts',\n                                'importScripts failed for ' +\n                                    moduleName + ' at ' + url,\n                                e,\n                                [moduleName]));\n            }\n        }\n    };\n\n    function getInteractiveScript() {\n        if (interactiveScript && interactiveScript.readyState === 'interactive') {\n            return interactiveScript;\n        }\n\n        eachReverse(scripts(), function (script) {\n            if (script.readyState === 'interactive') {\n                return (interactiveScript = script);\n            }\n        });\n        return interactiveScript;\n    }\n\n    //Look for a data-main script attribute, which could also adjust the baseUrl.\n    if (isBrowser && !cfg.skipDataMain) {\n        //Figure out baseUrl. Get it from the script tag with require.js in it.\n        eachReverse(scripts(), function (script) {\n            //Set the 'head' where we can append children by\n            //using the script's parent.\n            if (!head) {\n                head = script.parentNode;\n            }\n\n            //Look for a data-main attribute to set main script for the page\n            //to load. If it is there, the path to data main becomes the\n            //baseUrl, if it is not already set.\n            dataMain = script.getAttribute('data-main');\n            if (dataMain) {\n                //Preserve dataMain in case it is a path (i.e. contains '?')\n                mainScript = dataMain;\n\n                //Set final baseUrl if there is not already an explicit one,\n                //but only do so if the data-main value is not a loader plugin\n                //module ID.\n                if (!cfg.baseUrl && mainScript.indexOf('!') === -1) {\n                    //Pull off the directory of data-main for use as the\n                    //baseUrl.\n                    src = mainScript.split('/');\n                    mainScript = src.pop();\n                    subPath = src.length ? src.join('/')  + '/' : './';\n\n                    cfg.baseUrl = subPath;\n                }\n\n                //Strip off any trailing .js since mainScript is now\n                //like a module name.\n                mainScript = mainScript.replace(jsSuffixRegExp, '');\n\n                //If mainScript is still a path, fall back to dataMain\n                if (req.jsExtRegExp.test(mainScript)) {\n                    mainScript = dataMain;\n                }\n\n                //Put the data-main script in the files to load.\n                cfg.deps = cfg.deps ? cfg.deps.concat(mainScript) : [mainScript];\n\n                return true;\n            }\n        });\n    }\n\n    /**\n     * The function that handles definitions of modules. Differs from\n     * require() in that a string for the module should be the first argument,\n     * and the function to execute after dependencies are loaded should\n     * return a value to define the module corresponding to the first argument's\n     * name.\n     */\n    define = function (name, deps, callback) {\n        var node, context;\n\n        //Allow for anonymous modules\n        if (typeof name !== 'string') {\n            //Adjust args appropriately\n            callback = deps;\n            deps = name;\n            name = null;\n        }\n\n        //This module may not have dependencies\n        if (!isArray(deps)) {\n            callback = deps;\n            deps = null;\n        }\n\n        //If no name, and callback is a function, then figure out if it a\n        //CommonJS thing with dependencies.\n        if (!deps && isFunction(callback)) {\n            deps = [];\n            //Remove comments from the callback string,\n            //look for require calls, and pull them into the dependencies,\n            //but only if there are function args.\n            if (callback.length) {\n                callback\n                    .toString()\n                    .replace(commentRegExp, commentReplace)\n                    .replace(cjsRequireRegExp, function (match, dep) {\n                        deps.push(dep);\n                    });\n\n                //May be a CommonJS thing even without require calls, but still\n                //could use exports, and module. Avoid doing exports and module\n                //work though if it just needs require.\n                //REQUIRES the function to expect the CommonJS variables in the\n                //order listed below.\n                deps = (callback.length === 1 ? ['require'] : ['require', 'exports', 'module']).concat(deps);\n            }\n        }\n\n        //If in IE 6-8 and hit an anonymous define() call, do the interactive\n        //work.\n        if (useInteractive) {\n            node = currentlyAddingScript || getInteractiveScript();\n            if (node) {\n                if (!name) {\n                    name = node.getAttribute('data-requiremodule');\n                }\n                context = contexts[node.getAttribute('data-requirecontext')];\n            }\n        }\n\n        //Always save off evaluating the def call until the script onload handler.\n        //This allows multiple modules to be in a file without prematurely\n        //tracing dependencies, and allows for anonymous module support,\n        //where the module name is not known until the script onload event\n        //occurs. If no context, use the global queue, and get it processed\n        //in the onscript load callback.\n        if (context) {\n            context.defQueue.push([name, deps, callback]);\n            context.defQueueMap[name] = true;\n        } else {\n            globalDefQueue.push([name, deps, callback]);\n        }\n    };\n\n    define.amd = {\n        jQuery: true\n    };\n\n    /**\n     * Executes the text. Normally just uses eval, but can be modified\n     * to use a better, environment-specific call. Only used for transpiling\n     * loader plugins, not for plain JS modules.\n     * @param {String} text the text to execute/evaluate.\n     */\n    req.exec = function (text) {\n        /*jslint evil: true */\n        return eval(text);\n    };\n\n    //Set up with config info.\n    req(cfg);\n}(this));\n\ndefine(\"requireLib\", function(){});\n\n",
    "define('modules/uv-shared-module/BaseCommands',[\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    var BaseCommands = (function () {\r\n        function BaseCommands() {\r\n        }\r\n        return BaseCommands;\r\n    }());\r\n    BaseCommands.namespace = 'uv.';\r\n    BaseCommands.ACCEPT_TERMS = BaseCommands.namespace + 'onAcceptTerms';\r\n    BaseCommands.BOOKMARK = BaseCommands.namespace + 'onBookmark';\r\n    BaseCommands.CANVAS_INDEX_CHANGE_FAILED = BaseCommands.namespace + 'onCanvasIndexChangeFailed';\r\n    BaseCommands.CANVAS_INDEX_CHANGED = BaseCommands.namespace + 'onCanvasIndexChanged';\r\n    BaseCommands.CLICKTHROUGH = BaseCommands.namespace + 'onClickthrough';\r\n    BaseCommands.CLOSE_ACTIVE_DIALOGUE = BaseCommands.namespace + 'onCloseActiveDialogue';\r\n    BaseCommands.CLOSE_LEFT_PANEL = BaseCommands.namespace + 'onCloseLeftPanel';\r\n    BaseCommands.CLOSE_RIGHT_PANEL = BaseCommands.namespace + 'onCloseRightPanel';\r\n    BaseCommands.CREATED = BaseCommands.namespace + 'onCreated';\r\n    BaseCommands.DOWN_ARROW = BaseCommands.namespace + 'onDownArrow';\r\n    BaseCommands.DOWNLOAD = BaseCommands.namespace + 'onDownload';\r\n    BaseCommands.DROP = BaseCommands.namespace + 'onDrop';\r\n    BaseCommands.END = BaseCommands.namespace + 'onEnd';\r\n    BaseCommands.ESCAPE = BaseCommands.namespace + 'onEscape';\r\n    BaseCommands.EXTERNAL_LINK_CLICKED = BaseCommands.namespace + 'onExternalLinkClicked';\r\n    BaseCommands.FEEDBACK = BaseCommands.namespace + 'onFeedback';\r\n    BaseCommands.FORBIDDEN = BaseCommands.namespace + 'onForbidden';\r\n    BaseCommands.HIDE_CLICKTHROUGH_DIALOGUE = BaseCommands.namespace + 'onHideClickthroughDialogue';\r\n    BaseCommands.HIDE_DOWNLOAD_DIALOGUE = BaseCommands.namespace + 'onHideDownloadDialogue';\r\n    BaseCommands.HIDE_EMBED_DIALOGUE = BaseCommands.namespace + 'onHideEmbedDialogue';\r\n    BaseCommands.HIDE_EXTERNALCONTENT_DIALOGUE = BaseCommands.namespace + 'onHideExternalContentDialogue';\r\n    BaseCommands.HIDE_GENERIC_DIALOGUE = BaseCommands.namespace + 'onHideGenericDialogue';\r\n    BaseCommands.HIDE_HELP_DIALOGUE = BaseCommands.namespace + 'onHideHelpDialogue';\r\n    BaseCommands.HIDE_INFORMATION = BaseCommands.namespace + 'onHideInformation';\r\n    BaseCommands.HIDE_LOGIN_DIALOGUE = BaseCommands.namespace + 'onHideLoginDialogue';\r\n    BaseCommands.HIDE_MOREINFO_DIALOGUE = BaseCommands.namespace + 'onHideMoreInfoDialogue';\r\n    BaseCommands.HIDE_OVERLAY = BaseCommands.namespace + 'onHideOverlay';\r\n    BaseCommands.HIDE_RESTRICTED_DIALOGUE = BaseCommands.namespace + 'onHideRestrictedDialogue';\r\n    BaseCommands.HIDE_SETTINGS_DIALOGUE = BaseCommands.namespace + 'onHideSettingsDialogue';\r\n    BaseCommands.HIDE_SHARE_DIALOGUE = BaseCommands.namespace + 'onHideShareDialogue';\r\n    BaseCommands.HOME = BaseCommands.namespace + 'onHome';\r\n    BaseCommands.LEFT_ARROW = BaseCommands.namespace + 'onLeftArrow';\r\n    BaseCommands.LEFTPANEL_COLLAPSE_FULL_FINISH = BaseCommands.namespace + 'onLeftPanelCollapseFullFinish';\r\n    BaseCommands.LEFTPANEL_COLLAPSE_FULL_START = BaseCommands.namespace + 'onLeftPanelCollapseFullStart';\r\n    BaseCommands.LEFTPANEL_EXPAND_FULL_FINISH = BaseCommands.namespace + 'onLeftPanelExpandFullFinish';\r\n    BaseCommands.LEFTPANEL_EXPAND_FULL_START = BaseCommands.namespace + 'onLeftPanelExpandFullStart';\r\n    BaseCommands.LOAD_FAILED = BaseCommands.namespace + 'onLoadFailed';\r\n    BaseCommands.LOAD = BaseCommands.namespace + 'onLoad';\r\n    BaseCommands.LOGIN_FAILED = BaseCommands.namespace + 'onLoginFailed';\r\n    BaseCommands.LOGIN = BaseCommands.namespace + 'onLogin';\r\n    BaseCommands.LOGOUT = BaseCommands.namespace + 'onLogout';\r\n    BaseCommands.METRIC_CHANGED = BaseCommands.namespace + 'onMetricChanged';\r\n    BaseCommands.MINUS = BaseCommands.namespace + 'onMinus';\r\n    BaseCommands.NOT_FOUND = BaseCommands.namespace + 'onNotFound';\r\n    BaseCommands.OPEN_EXTERNAL_RESOURCE = BaseCommands.namespace + 'onOpenExternalResource';\r\n    BaseCommands.OPEN_LEFT_PANEL = BaseCommands.namespace + 'onOpenLeftPanel';\r\n    BaseCommands.OPEN_RIGHT_PANEL = BaseCommands.namespace + 'onOpenRightPanel';\r\n    BaseCommands.OPEN = BaseCommands.namespace + 'onOpen';\r\n    BaseCommands.PAGE_DOWN = BaseCommands.namespace + 'onPageDown';\r\n    BaseCommands.PAGE_UP = BaseCommands.namespace + 'onPageUp';\r\n    BaseCommands.PARENT_EXIT_FULLSCREEN = BaseCommands.namespace + 'onParentExitFullScreen';\r\n    BaseCommands.PLUS = BaseCommands.namespace + 'onPlus';\r\n    BaseCommands.REDIRECT = BaseCommands.namespace + 'onRedirect';\r\n    BaseCommands.REFRESH = BaseCommands.namespace + 'onRefresh';\r\n    BaseCommands.RESIZE = BaseCommands.namespace + 'onResize';\r\n    BaseCommands.RESOURCE_DEGRADED = BaseCommands.namespace + 'onResourceDegraded';\r\n    BaseCommands.RETRY = BaseCommands.namespace + 'onRetry';\r\n    BaseCommands.RETURN = BaseCommands.namespace + 'onReturn';\r\n    BaseCommands.RIGHT_ARROW = BaseCommands.namespace + 'onRightArrow';\r\n    BaseCommands.RIGHTPANEL_COLLAPSE_FULL_FINISH = BaseCommands.namespace + 'onRightPanelCollapseFullFinish';\r\n    BaseCommands.RIGHTPANEL_COLLAPSE_FULL_START = BaseCommands.namespace + 'onRightPanelCollapseFullStart';\r\n    BaseCommands.RIGHTPANEL_EXPAND_FULL_FINISH = BaseCommands.namespace + 'onRightPanelExpandFullFinish';\r\n    BaseCommands.RIGHTPANEL_EXPAND_FULL_START = BaseCommands.namespace + 'onRightPanelExpandFullStart';\r\n    BaseCommands.SEQUENCE_INDEX_CHANGED = BaseCommands.namespace + 'onSequenceIndexChanged';\r\n    BaseCommands.SETTINGS_CHANGED = BaseCommands.namespace + 'onSettingsChanged';\r\n    BaseCommands.SHOW_CLICKTHROUGH_DIALOGUE = BaseCommands.namespace + 'onShowClickThroughDialogue';\r\n    BaseCommands.SHOW_DOWNLOAD_DIALOGUE = BaseCommands.namespace + 'onShowDownloadDialogue';\r\n    BaseCommands.SHOW_EMBED_DIALOGUE = BaseCommands.namespace + 'onShowEmbedDialogue';\r\n    BaseCommands.SHOW_EXTERNALCONTENT_DIALOGUE = BaseCommands.namespace + 'onShowExternalContentDialogue';\r\n    BaseCommands.SHOW_GENERIC_DIALOGUE = BaseCommands.namespace + 'onShowGenericDialogue';\r\n    BaseCommands.SHOW_HELP_DIALOGUE = BaseCommands.namespace + 'onShowHelpDialogue';\r\n    BaseCommands.SHOW_INFORMATION = BaseCommands.namespace + 'onShowInformation';\r\n    BaseCommands.SHOW_LOGIN_DIALOGUE = BaseCommands.namespace + 'onShowLoginDialogue';\r\n    BaseCommands.SHOW_MOREINFO_DIALOGUE = BaseCommands.namespace + 'onShowMoreInfoDialogue';\r\n    BaseCommands.SHOW_OVERLAY = BaseCommands.namespace + 'onShowOverlay';\r\n    BaseCommands.SHOW_RESTRICTED_DIALOGUE = BaseCommands.namespace + 'onShowRestrictedDialogue';\r\n    BaseCommands.SHOW_SETTINGS_DIALOGUE = BaseCommands.namespace + 'onShowSettingsDialogue';\r\n    BaseCommands.SHOW_SHARE_DIALOGUE = BaseCommands.namespace + 'onShowShareDialogue';\r\n    BaseCommands.SHOW_TERMS_OF_USE = BaseCommands.namespace + 'onShowTermsOfUse';\r\n    BaseCommands.THUMB_SELECTED = BaseCommands.namespace + 'onThumbSelected';\r\n    BaseCommands.TOGGLE_EXPAND_LEFT_PANEL = BaseCommands.namespace + 'onToggleExpandLeftPanel';\r\n    BaseCommands.TOGGLE_EXPAND_RIGHT_PANEL = BaseCommands.namespace + 'onToggleExpandRightPanel';\r\n    BaseCommands.TOGGLE_FULLSCREEN = BaseCommands.namespace + 'onToggleFullScreen';\r\n    BaseCommands.UP_ARROW = BaseCommands.namespace + 'onUpArrow';\r\n    BaseCommands.UPDATE_SETTINGS = BaseCommands.namespace + 'onUpdateSettings';\r\n    BaseCommands.VIEW_FULL_TERMS = BaseCommands.namespace + 'onViewFullTerms';\r\n    BaseCommands.WINDOW_UNLOAD = BaseCommands.namespace + 'onWindowUnload';\r\n    exports.BaseCommands = BaseCommands;\r\n});\r\n//# sourceMappingURL=BaseCommands.js.map;\n",
    "define('Params',[\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    // do not change order, index is important!\r\n    var Params;\r\n    (function (Params) {\r\n        Params[Params[\"collectionIndex\"] = 0] = \"collectionIndex\";\r\n        Params[Params[\"manifestIndex\"] = 1] = \"manifestIndex\";\r\n        Params[Params[\"sequenceIndex\"] = 2] = \"sequenceIndex\";\r\n        Params[Params[\"canvasIndex\"] = 3] = \"canvasIndex\";\r\n        Params[Params[\"xywh\"] = 4] = \"xywh\";\r\n        Params[Params[\"rotation\"] = 5] = \"rotation\";\r\n        Params[Params[\"highlight\"] = 6] = \"highlight\";\r\n        Params[Params[\"anchor\"] = 7] = \"anchor\";\r\n    })(Params = exports.Params || (exports.Params = {}));\r\n});\r\n//# sourceMappingURL=Params.js.map;\n",
    "define('BootstrapParams',[\"require\", \"exports\", \"./Params\"], function (require, exports, Params_1) {\r\n    \"use strict\";\r\n    var BootstrapParams = (function () {\r\n        function BootstrapParams() {\r\n            this.paramMap = ['c', 'm', 's', 'cv', 'xywh', 'r', 'h', 'a']; // todo: move xywh, r, h, a to their respective extensions\r\n            this.config = Utils.Urls.getQuerystringParameter('config');\r\n            this.domain = Utils.Urls.getQuerystringParameter('domain');\r\n            this.embedDomain = Utils.Urls.getQuerystringParameter('embedDomain');\r\n            this.embedScriptUri = Utils.Urls.getQuerystringParameter('embedScriptUri');\r\n            this.isHomeDomain = Utils.Urls.getQuerystringParameter('isHomeDomain') === 'true';\r\n            this.isLightbox = Utils.Urls.getQuerystringParameter('isLightbox') === 'true';\r\n            this.isOnlyInstance = Utils.Urls.getQuerystringParameter('isOnlyInstance') === 'true';\r\n            this.isReload = Utils.Urls.getQuerystringParameter('isReload') === 'true';\r\n            var jsonpParam = Utils.Urls.getQuerystringParameter('jsonp');\r\n            this.jsonp = jsonpParam === null ? null : !(jsonpParam === 'false' || jsonpParam === '0');\r\n            this.manifestUri = Utils.Urls.getQuerystringParameter('manifestUri');\r\n            var locale = Utils.Urls.getQuerystringParameter('locale') || 'en-GB';\r\n            this.setLocale(locale);\r\n            this.collectionIndex = this.getParam(Params_1.Params.collectionIndex);\r\n            this.manifestIndex = this.getParam(Params_1.Params.manifestIndex);\r\n            this.sequenceIndex = this.getParam(Params_1.Params.sequenceIndex);\r\n            this.canvasIndex = this.getParam(Params_1.Params.canvasIndex);\r\n        }\r\n        BootstrapParams.prototype.getLocaleName = function () {\r\n            return this.localeName;\r\n        };\r\n        BootstrapParams.prototype.getParam = function (param) {\r\n            if (this.hashParamsAvailable()) {\r\n                // get param from parent document\r\n                var p = parseInt(Utils.Urls.getHashParameter(this.paramMap[param], parent.document));\r\n                if (p || p === 0)\r\n                    return p;\r\n            }\r\n            // get param from iframe querystring\r\n            return parseInt(Utils.Urls.getQuerystringParameter(this.paramMap[param])) || 0;\r\n        };\r\n        BootstrapParams.prototype.hashParamsAvailable = function () {\r\n            return (this.isHomeDomain && !this.isReload && this.isOnlyInstance);\r\n        };\r\n        // parse string 'en-GB' or 'en-GB:English,cy-GB:Welsh' into array\r\n        BootstrapParams.prototype.setLocale = function (locale) {\r\n            this.locale = locale;\r\n            this.locales = [];\r\n            var l = this.locale.split(',');\r\n            for (var i = 0; i < l.length; i++) {\r\n                var v = l[i].split(':');\r\n                this.locales.push({\r\n                    name: v[0].trim(),\r\n                    label: (v[1]) ? v[1].trim() : \"\"\r\n                });\r\n            }\r\n            this.localeName = this.locales[0].name;\r\n        };\r\n        return BootstrapParams;\r\n    }());\r\n    exports.BootstrapParams = BootstrapParams;\r\n});\r\n//# sourceMappingURL=BootstrapParams.js.map;\n",
    "define('Bootstrapper',[\"require\", \"exports\", \"./modules/uv-shared-module/BaseCommands\", \"./BootstrapParams\"], function (require, exports, BaseCommands_1, BootstrapParams_1) {\r\n    \"use strict\";\r\n    // The Bootstrapper is concerned with loading the manifest/collection (iiifResource)\r\n    // then determining which extension to use and instantiating it.\r\n    var Bootstrapper = (function () {\r\n        function Bootstrapper(extensions) {\r\n            this.isFullScreen = false;\r\n            this.extensions = extensions;\r\n        }\r\n        Bootstrapper.prototype.bootstrap = function (params) {\r\n            var _this = this;\r\n            this.params = new BootstrapParams_1.BootstrapParams();\r\n            // merge new params\r\n            if (params) {\r\n                this.params = $.extend(true, this.params, params);\r\n            }\r\n            if (!this.params.manifestUri)\r\n                return;\r\n            // empty app div\r\n            $('#app').empty();\r\n            // add loading class\r\n            $('#app').addClass('loading');\r\n            // remove any existing css\r\n            $('link[type*=\"text/css\"]').remove();\r\n            jQuery.support.cors = true;\r\n            Manifold.loadManifest({\r\n                iiifResourceUri: this.params.manifestUri,\r\n                collectionIndex: this.params.collectionIndex,\r\n                manifestIndex: this.params.manifestIndex,\r\n                sequenceIndex: this.params.sequenceIndex,\r\n                canvasIndex: this.params.canvasIndex,\r\n                locale: this.params.localeName\r\n            }).then(function (helper) {\r\n                var trackingLabel = helper.getTrackingLabel();\r\n                trackingLabel += ', URI: ' + _this.params.embedDomain;\r\n                window.trackingLabel = trackingLabel;\r\n                var sequence = helper.getSequenceByIndex(_this.params.sequenceIndex);\r\n                if (!sequence) {\r\n                    _this.notFound();\r\n                    return;\r\n                }\r\n                var canvas = helper.getCanvasByIndex(_this.params.canvasIndex);\r\n                if (!canvas) {\r\n                    _this.notFound();\r\n                    return;\r\n                }\r\n                var canvasType = canvas.getType();\r\n                // try using canvasType\r\n                var extension = _this.extensions[canvasType.toString()];\r\n                // if there isn't an extension for the canvasType, try the format\r\n                if (!extension) {\r\n                    var format = canvas.getProperty('format');\r\n                    extension = _this.extensions[format];\r\n                }\r\n                // if there still isn't a matching extension, show an error.\r\n                if (!extension) {\r\n                    alert(\"No matching UV extension found.\");\r\n                    return;\r\n                }\r\n                extension.helper = helper;\r\n                _this.featureDetect(function () {\r\n                    _this.configure(extension, function (config) {\r\n                        _this.injectCss(extension, config, function () {\r\n                            _this.createExtension(extension, config);\r\n                        });\r\n                    });\r\n                });\r\n            })[\"catch\"](function () {\r\n                this.notFound();\r\n            });\r\n        };\r\n        Bootstrapper.prototype.isCORSEnabled = function () {\r\n            // No jsonp setting? Then use autodetection. Otherwise, use explicit setting.\r\n            return (null === this.params.jsonp) ? Modernizr.cors : !this.params.jsonp;\r\n        };\r\n        Bootstrapper.prototype.notFound = function () {\r\n            try {\r\n                parent.$(parent.document).trigger(BaseCommands_1.BaseCommands.NOT_FOUND);\r\n                return;\r\n            }\r\n            catch (e) { }\r\n        };\r\n        Bootstrapper.prototype.featureDetect = function (cb) {\r\n            yepnope({\r\n                test: window.btoa && window.atob,\r\n                nope: 'lib/base64.min.js',\r\n                complete: function () {\r\n                    cb();\r\n                }\r\n            });\r\n        };\r\n        Bootstrapper.prototype.configure = function (extension, cb) {\r\n            var _this = this;\r\n            var that = this;\r\n            this.getConfigExtension(extension, function (configExtension) {\r\n                // todo: use a compiler flag when available\r\n                var configPath = 'lib/' + extension.name + '.' + that.params.getLocaleName() + '.config.json';\r\n                $.getJSON(configPath, function (config) {\r\n                    _this.extendConfig(extension, config, configExtension, cb);\r\n                });\r\n            });\r\n        };\r\n        Bootstrapper.prototype.extendConfig = function (extension, config, configExtension, cb) {\r\n            config.name = extension.name;\r\n            // if data-config has been set, extend the existing config object.\r\n            if (configExtension) {\r\n                // save a reference to the config extension uri.\r\n                config.uri = this.params.config;\r\n                $.extend(true, config, configExtension);\r\n            }\r\n            cb(config);\r\n        };\r\n        Bootstrapper.prototype.getConfigExtension = function (extension, cb) {\r\n            var sessionConfig = sessionStorage.getItem(extension.name + '.' + this.params.localeName);\r\n            if (sessionConfig) {\r\n                cb(JSON.parse(sessionConfig));\r\n            }\r\n            else if (this.params.config) {\r\n                if (this.isCORSEnabled()) {\r\n                    $.getJSON(this.params.config, function (configExtension) {\r\n                        cb(configExtension);\r\n                    });\r\n                }\r\n                else {\r\n                    // use jsonp\r\n                    var settings = {\r\n                        url: this.params.config,\r\n                        type: 'GET',\r\n                        dataType: 'jsonp',\r\n                        jsonp: 'callback',\r\n                        jsonpCallback: 'configExtensionCallback'\r\n                    };\r\n                    $.ajax(settings);\r\n                    window.configExtensionCallback = function (configExtension) {\r\n                        cb(configExtension);\r\n                    };\r\n                }\r\n            }\r\n            else {\r\n                cb(null);\r\n            }\r\n        };\r\n        Bootstrapper.prototype.injectCss = function (extension, config, cb) {\r\n            // todo: use a compiler flag when available\r\n            var cssPath = 'themes/' + config.options.theme + '/css/' + extension.name + '/theme.css';\r\n            yepnope.injectCss(cssPath, function () {\r\n                cb();\r\n            });\r\n        };\r\n        Bootstrapper.prototype.createExtension = function (extension, config) {\r\n            this.config = config;\r\n            var helper = extension.helper;\r\n            this.extension = new extension.type(this);\r\n            this.extension.helper = helper;\r\n            this.extension.name = extension.name;\r\n            this.extension.create();\r\n        };\r\n        return Bootstrapper;\r\n    }());\r\n    exports.Bootstrapper = Bootstrapper;\r\n});\r\n//# sourceMappingURL=Bootstrapper.js.map;\n",
    "define('modules/uv-shared-module/Panel',[\"require\", \"exports\", \"./BaseCommands\"], function (require, exports, BaseCommands_1) {\r\n    \"use strict\";\r\n    var Panel = (function () {\r\n        function Panel($element, fitToParentWidth, fitToParentHeight) {\r\n            this.isResized = false;\r\n            this.$element = $element;\r\n            this.fitToParentWidth = fitToParentWidth || false;\r\n            this.fitToParentHeight = fitToParentHeight || false;\r\n            this.create();\r\n        }\r\n        Panel.prototype.create = function () {\r\n            var _this = this;\r\n            $.subscribe(BaseCommands_1.BaseCommands.RESIZE, function () {\r\n                _this.resize();\r\n            });\r\n        };\r\n        Panel.prototype.resize = function () {\r\n            var $parent = this.$element.parent();\r\n            if (this.fitToParentWidth) {\r\n                this.$element.width($parent.width());\r\n            }\r\n            if (this.fitToParentHeight) {\r\n                this.$element.height($parent.height());\r\n            }\r\n            this.isResized = true;\r\n        };\r\n        return Panel;\r\n    }());\r\n    exports.Panel = Panel;\r\n});\r\n//# sourceMappingURL=Panel.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-shared-module/BaseView',[\"require\", \"exports\", \"./Panel\"], function (require, exports, Panel_1) {\r\n    \"use strict\";\r\n    var BaseView = (function (_super) {\r\n        __extends(BaseView, _super);\r\n        function BaseView($element, fitToParentWidth, fitToParentHeight) {\r\n            return _super.call(this, $element, fitToParentWidth, fitToParentHeight) || this;\r\n        }\r\n        BaseView.prototype.create = function () {\r\n            this.bootstrapper = $(\"body > #app\").data(\"bootstrapper\");\r\n            _super.prototype.create.call(this);\r\n            this.extension = this.bootstrapper.extension;\r\n            this.config = {};\r\n            this.config.content = {};\r\n            this.config.options = {};\r\n            this.content = this.config.content;\r\n            this.options = this.config.options;\r\n            var that = this;\r\n            // build config inheritance chain\r\n            if (that.modules && that.modules.length) {\r\n                that.modules = that.modules.reverse();\r\n                $.each(that.modules, function (index, moduleName) {\r\n                    that.config = $.extend(true, that.config, that.extension.config.modules[moduleName]);\r\n                });\r\n            }\r\n        };\r\n        BaseView.prototype.init = function () {\r\n        };\r\n        BaseView.prototype.setConfig = function (moduleName) {\r\n            if (!this.modules) {\r\n                this.modules = [];\r\n            }\r\n            this.modules.push(moduleName);\r\n        };\r\n        BaseView.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n        };\r\n        return BaseView;\r\n    }(Panel_1.Panel));\r\n    exports.BaseView = BaseView;\r\n});\r\n//# sourceMappingURL=BaseView.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-shared-module/Dialogue',[\"require\", \"exports\", \"./BaseView\", \"./BaseCommands\"], function (require, exports, BaseView_1, BaseCommands_1) {\r\n    \"use strict\";\r\n    var Dialogue = (function (_super) {\r\n        __extends(Dialogue, _super);\r\n        function Dialogue($element) {\r\n            var _this = _super.call(this, $element, false, false) || this;\r\n            _this.allowClose = true;\r\n            _this.isActive = false;\r\n            _this.isUnopened = true;\r\n            return _this;\r\n        }\r\n        Dialogue.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('dialogue');\r\n            _super.prototype.create.call(this);\r\n            // events.\r\n            $.subscribe(BaseCommands_1.BaseCommands.CLOSE_ACTIVE_DIALOGUE, function () {\r\n                if (_this.isActive) {\r\n                    if (_this.allowClose) {\r\n                        _this.close();\r\n                    }\r\n                }\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.ESCAPE, function () {\r\n                if (_this.isActive) {\r\n                    if (_this.allowClose) {\r\n                        _this.close();\r\n                    }\r\n                }\r\n            });\r\n            this.$top = $('<div class=\"top\"></div>');\r\n            this.$element.append(this.$top);\r\n            this.$closeButton = $('<a href=\"#\" class=\"close\" tabindex=\"0\">' + this.content.close + '</a>');\r\n            this.$top.append(this.$closeButton);\r\n            this.$middle = $('<div class=\"middle\"></div>');\r\n            this.$element.append(this.$middle);\r\n            this.$content = $('<div class=\"content\"></div>');\r\n            this.$middle.append(this.$content);\r\n            this.$bottom = $('<div class=\"bottom\"></div>');\r\n            this.$element.append(this.$bottom);\r\n            this.$closeButton.on('click', function (e) {\r\n                e.preventDefault();\r\n                _this.close();\r\n            });\r\n            this.returnFunc = this.close;\r\n        };\r\n        Dialogue.prototype.enableClose = function () {\r\n            this.allowClose = true;\r\n            this.$closeButton.show();\r\n        };\r\n        Dialogue.prototype.disableClose = function () {\r\n            this.allowClose = false;\r\n            this.$closeButton.hide();\r\n        };\r\n        Dialogue.prototype.setDockedPosition = function () {\r\n            var top = Math.floor(this.extension.height() - this.$element.outerHeight(true));\r\n            var left = 0;\r\n            var arrowLeft = 0;\r\n            if (this.$triggerButton) {\r\n                // get the normalised position of the button\r\n                var buttonPos = Math.normalise(this.$triggerButton.offset().left, 0, this.extension.width());\r\n                left = Math.floor((this.extension.width() * buttonPos) - (this.$element.width() * buttonPos));\r\n                arrowLeft = (this.$element.width() * buttonPos);\r\n            }\r\n            this.$bottom.css('backgroundPosition', arrowLeft + 'px 0px');\r\n            this.$element.css({\r\n                'top': top,\r\n                'left': left\r\n            });\r\n        };\r\n        Dialogue.prototype.open = function ($triggerButton) {\r\n            var _this = this;\r\n            this.$element.show();\r\n            if ($triggerButton && $triggerButton.length) {\r\n                this.$triggerButton = $triggerButton;\r\n                this.$bottom.show();\r\n            }\r\n            else {\r\n                this.$bottom.hide();\r\n            }\r\n            this.isActive = true;\r\n            // set the focus to the default button.\r\n            setTimeout(function () {\r\n                var $defaultButton = _this.$element.find('.default');\r\n                if ($defaultButton.length) {\r\n                    $defaultButton.focus();\r\n                }\r\n                else {\r\n                    // if there's no default button, focus on the first visible input\r\n                    var $input = _this.$element.find('input:visible').first();\r\n                    if ($input.length) {\r\n                        $input.focus();\r\n                    }\r\n                    else {\r\n                        // if there's no visible first input, focus on the close button\r\n                        _this.$closeButton.focus();\r\n                    }\r\n                }\r\n            }, 1);\r\n            $.publish(BaseCommands_1.BaseCommands.SHOW_OVERLAY);\r\n            if (this.isUnopened) {\r\n                this.isUnopened = false;\r\n                this.afterFirstOpen();\r\n            }\r\n            this.resize();\r\n        };\r\n        Dialogue.prototype.afterFirstOpen = function () {\r\n        };\r\n        Dialogue.prototype.close = function () {\r\n            if (!this.isActive)\r\n                return;\r\n            this.$element.hide();\r\n            this.isActive = false;\r\n            $.publish(this.closeCommand);\r\n            $.publish(BaseCommands_1.BaseCommands.HIDE_OVERLAY);\r\n        };\r\n        Dialogue.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n            this.$element.css({\r\n                'top': Math.floor((this.extension.height() / 2) - (this.$element.height() / 2)),\r\n                'left': Math.floor((this.extension.width() / 2) - (this.$element.width() / 2))\r\n            });\r\n        };\r\n        return Dialogue;\r\n    }(BaseView_1.BaseView));\r\n    exports.Dialogue = Dialogue;\r\n});\r\n//# sourceMappingURL=Dialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-dialogues-module/ClickThroughDialogue',[\"require\", \"exports\", \"../uv-shared-module/BaseCommands\", \"../uv-shared-module/Dialogue\"], function (require, exports, BaseCommands_1, Dialogue_1) {\r\n    \"use strict\";\r\n    var ClickThroughDialogue = (function (_super) {\r\n        __extends(ClickThroughDialogue, _super);\r\n        function ClickThroughDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        ClickThroughDialogue.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('clickThroughDialogue');\r\n            _super.prototype.create.call(this);\r\n            this.openCommand = BaseCommands_1.BaseCommands.SHOW_CLICKTHROUGH_DIALOGUE;\r\n            this.closeCommand = BaseCommands_1.BaseCommands.HIDE_CLICKTHROUGH_DIALOGUE;\r\n            $.subscribe(this.openCommand, function (e, params) {\r\n                _this.acceptCallback = params.acceptCallback;\r\n                _this.resource = params.resource;\r\n                _this.open();\r\n            });\r\n            $.subscribe(this.closeCommand, function (e) {\r\n                _this.close();\r\n            });\r\n            this.$title = $('<h1></h1>');\r\n            this.$content.append(this.$title);\r\n            this.$content.append('\\\r\n            <div>\\\r\n                <p class=\"message scroll\"></p>\\\r\n                <div class=\"buttons\">\\\r\n                    <a class=\"acceptTerms btn btn-primary\" href=\"#\" target=\"_parent\"></a>\\\r\n                </div>\\\r\n            </div>');\r\n            this.$message = this.$content.find(\".message\");\r\n            this.$acceptTermsButton = this.$content.find(\".acceptTerms\");\r\n            // TODO: get from config this.$acceptTermsButton.text(this.content.acceptTerms); // figure out config\r\n            this.$acceptTermsButton.text(\"Accept Terms and Open\");\r\n            this.$element.hide();\r\n            this.$acceptTermsButton.on('click', function (e) {\r\n                e.preventDefault();\r\n                _this.close();\r\n                $.publish(BaseCommands_1.BaseCommands.ACCEPT_TERMS);\r\n                if (_this.acceptCallback)\r\n                    _this.acceptCallback();\r\n            });\r\n        };\r\n        ClickThroughDialogue.prototype.open = function () {\r\n            _super.prototype.open.call(this);\r\n            this.$title.text(this.resource.clickThroughService.getProperty('label'));\r\n            this.$message.html(this.resource.clickThroughService.getProperty('description'));\r\n            this.$message.targetBlank();\r\n            this.$message.find('a').on('click', function () {\r\n                var url = $(this).attr('href');\r\n                $.publish(BaseCommands_1.BaseCommands.EXTERNAL_LINK_CLICKED, [url]);\r\n            });\r\n            this.resize();\r\n        };\r\n        ClickThroughDialogue.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n        };\r\n        return ClickThroughDialogue;\r\n    }(Dialogue_1.Dialogue));\r\n    exports.ClickThroughDialogue = ClickThroughDialogue;\r\n});\r\n//# sourceMappingURL=ClickThroughDialogue.js.map;\n",
    "define('modules/uv-shared-module/InformationArgs',[\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    var InformationArgs = (function () {\r\n        function InformationArgs(informationType, param) {\r\n            this.informationType = informationType;\r\n            this.param = param;\r\n        }\r\n        return InformationArgs;\r\n    }());\r\n    exports.InformationArgs = InformationArgs;\r\n});\r\n//# sourceMappingURL=InformationArgs.js.map;\n",
    "define('modules/uv-shared-module/InformationType',[\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    var InformationType;\r\n    (function (InformationType) {\r\n        InformationType[InformationType[\"AUTH_CORS_ERROR\"] = 0] = \"AUTH_CORS_ERROR\";\r\n        InformationType[InformationType[\"DEGRADED_RESOURCE\"] = 1] = \"DEGRADED_RESOURCE\";\r\n    })(InformationType = exports.InformationType || (exports.InformationType = {}));\r\n});\r\n//# sourceMappingURL=InformationType.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-dialogues-module/LoginDialogue',[\"require\", \"exports\", \"../uv-shared-module/BaseCommands\", \"../uv-shared-module/Dialogue\"], function (require, exports, BaseCommands_1, Dialogue_1) {\r\n    \"use strict\";\r\n    var LoginDialogue = (function (_super) {\r\n        __extends(LoginDialogue, _super);\r\n        function LoginDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        LoginDialogue.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('loginDialogue');\r\n            _super.prototype.create.call(this);\r\n            this.openCommand = BaseCommands_1.BaseCommands.SHOW_LOGIN_DIALOGUE;\r\n            this.closeCommand = BaseCommands_1.BaseCommands.HIDE_LOGIN_DIALOGUE;\r\n            $.subscribe(this.openCommand, function (s, e) {\r\n                _this.loginCallback = e.loginCallback;\r\n                _this.logoutCallback = e.logoutCallback;\r\n                _this.options = e.options;\r\n                _this.resource = e.resource;\r\n                _this.open();\r\n            });\r\n            $.subscribe(this.closeCommand, function (e) {\r\n                _this.close();\r\n            });\r\n            this.$title = $('<h1></h1>');\r\n            this.$content.append(this.$title);\r\n            this.$content.append('\\\r\n            <div>\\\r\n                <p class=\"message scroll\"></p>\\\r\n                <div class=\"buttons\">\\\r\n                    <a class=\"logout btn btn-primary\" href=\"#\" target=\"_parent\"></a>\\\r\n                    <a class=\"login btn btn-primary\" href=\"#\" target=\"_parent\"></a>\\\r\n                    <a class=\"cancel btn btn-primary\" href=\"#\"></a>\\\r\n                </div>\\\r\n            </div>');\r\n            this.$message = this.$content.find('.message');\r\n            this.$loginButton = this.$content.find('.login');\r\n            this.$loginButton.text(this.content.login);\r\n            this.$logoutButton = this.$content.find('.logout');\r\n            this.$logoutButton.text(this.content.logout);\r\n            this.$cancelButton = this.$content.find('.cancel');\r\n            this.$cancelButton.text(this.content.cancel);\r\n            this.$element.hide();\r\n            this.$loginButton.on('click', function (e) {\r\n                e.preventDefault();\r\n                _this.close();\r\n                if (_this.loginCallback)\r\n                    _this.loginCallback();\r\n            });\r\n            this.$logoutButton.on('click', function (e) {\r\n                e.preventDefault();\r\n                _this.close();\r\n                if (_this.logoutCallback)\r\n                    _this.logoutCallback();\r\n            });\r\n            this.$cancelButton.on('click', function (e) {\r\n                e.preventDefault();\r\n                _this.close();\r\n            });\r\n            this.updateLogoutButton();\r\n        };\r\n        LoginDialogue.prototype.open = function () {\r\n            _super.prototype.open.call(this);\r\n            this.$title.text(this.resource.loginService.getProperty('label'));\r\n            var message = this.resource.loginService.getProperty('description');\r\n            if (this.options.warningMessage) {\r\n                message = '<span class=\"warning\">' + this.extension.config.content[this.options.warningMessage] + '</span><span class=\"description\">' + message + '</span>';\r\n            }\r\n            this.updateLogoutButton();\r\n            this.$message.html(message);\r\n            this.$message.targetBlank();\r\n            this.$message.find('a').on('click', function () {\r\n                var url = $(this).attr('href');\r\n                $.publish(BaseCommands_1.BaseCommands.EXTERNAL_LINK_CLICKED, [url]);\r\n            });\r\n            if (this.options.showCancelButton) {\r\n                this.$cancelButton.show();\r\n            }\r\n            else {\r\n                this.$cancelButton.hide();\r\n            }\r\n            this.resize();\r\n        };\r\n        LoginDialogue.prototype.updateLogoutButton = function () {\r\n            if (this.extension.isLoggedIn) {\r\n                this.$logoutButton.show();\r\n            }\r\n            else {\r\n                this.$logoutButton.hide();\r\n            }\r\n        };\r\n        LoginDialogue.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n        };\r\n        return LoginDialogue;\r\n    }(Dialogue_1.Dialogue));\r\n    exports.LoginDialogue = LoginDialogue;\r\n});\r\n//# sourceMappingURL=LoginDialogue.js.map;\n",
    "define('modules/uv-shared-module/LoginWarningMessages',[\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    var LoginWarningMessages = (function () {\r\n        function LoginWarningMessages() {\r\n        }\r\n        return LoginWarningMessages;\r\n    }());\r\n    LoginWarningMessages.FORBIDDEN = \"forbiddenResourceMessage\";\r\n    exports.LoginWarningMessages = LoginWarningMessages;\r\n});\r\n//# sourceMappingURL=LoginWarningMessages.js.map;\n",
    "define('modules/uv-shared-module/Metric',[\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    var Metric = (function () {\r\n        function Metric(minWidth, maxWidth) {\r\n            this.minWidth = minWidth;\r\n            this.maxWidth = maxWidth;\r\n        }\r\n        return Metric;\r\n    }());\r\n    exports.Metric = Metric;\r\n});\r\n//# sourceMappingURL=Metric.js.map;\n",
    "define('modules/uv-shared-module/Metrics',[\"require\", \"exports\", \"./Metric\"], function (require, exports, Metric_1) {\r\n    \"use strict\";\r\n    var Metrics = (function () {\r\n        function Metrics() {\r\n        }\r\n        return Metrics;\r\n    }());\r\n    Metrics.MOBILE_LANDSCAPE = new Metric_1.Metric(0, 640);\r\n    Metrics.LAPTOP = new Metric_1.Metric(640, Infinity);\r\n    exports.Metrics = Metrics;\r\n});\r\n//# sourceMappingURL=Metrics.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-dialogues-module/RestrictedDialogue',[\"require\", \"exports\", \"../uv-shared-module/BaseCommands\", \"../uv-shared-module/Dialogue\"], function (require, exports, BaseCommands_1, Dialogue_1) {\r\n    \"use strict\";\r\n    var RestrictedDialogue = (function (_super) {\r\n        __extends(RestrictedDialogue, _super);\r\n        function RestrictedDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        RestrictedDialogue.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('restrictedDialogue');\r\n            _super.prototype.create.call(this);\r\n            this.openCommand = BaseCommands_1.BaseCommands.SHOW_RESTRICTED_DIALOGUE;\r\n            this.closeCommand = BaseCommands_1.BaseCommands.HIDE_RESTRICTED_DIALOGUE;\r\n            $.subscribe(this.openCommand, function (s, e) {\r\n                _this.acceptCallback = e.acceptCallback;\r\n                _this.options = e.options;\r\n                _this.resource = e.resource;\r\n                _this.open();\r\n            });\r\n            $.subscribe(this.closeCommand, function (e) {\r\n                _this.close();\r\n            });\r\n            this.$title = $('<h1></h1>');\r\n            this.$content.append(this.$title);\r\n            this.$content.append('\\\r\n            <div>\\\r\n                <p class=\"message scroll\"></p>\\\r\n                <div class=\"buttons\">\\\r\n                    <a class=\"cancel btn btn-primary\" href=\"#\" target=\"_parent\"></a>\\\r\n                </div>\\\r\n            </div>');\r\n            this.$message = this.$content.find('.message');\r\n            this.$message.targetBlank();\r\n            // todo: revisit?\r\n            //this.$nextVisibleButton = this.$content.find('.nextvisible');\r\n            //this.$nextVisibleButton.text(this.content.nextVisibleItem);\r\n            this.$cancelButton = this.$content.find('.cancel');\r\n            this.$cancelButton.text(this.content.cancel);\r\n            this.$element.hide();\r\n            this.$cancelButton.on('click', function (e) {\r\n                e.preventDefault();\r\n                _this.close();\r\n            });\r\n        };\r\n        RestrictedDialogue.prototype.open = function () {\r\n            _super.prototype.open.call(this);\r\n            this.isAccepted = false;\r\n            this.$title.text(this.resource.restrictedService.getProperty('label'));\r\n            var message = this.resource.restrictedService.getProperty('description');\r\n            this.$message.html(message);\r\n            this.$message.targetBlank();\r\n            this.$message.find('a').on('click', function () {\r\n                var url = $(this).attr('href');\r\n                $.publish(BaseCommands_1.BaseCommands.EXTERNAL_LINK_CLICKED, [url]);\r\n            });\r\n            this.resize();\r\n        };\r\n        RestrictedDialogue.prototype.close = function () {\r\n            _super.prototype.close.call(this);\r\n            if (!this.isAccepted && this.acceptCallback) {\r\n                this.isAccepted = true;\r\n                this.acceptCallback();\r\n            }\r\n        };\r\n        RestrictedDialogue.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n        };\r\n        return RestrictedDialogue;\r\n    }(Dialogue_1.Dialogue));\r\n    exports.RestrictedDialogue = RestrictedDialogue;\r\n});\r\n//# sourceMappingURL=RestrictedDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-shared-module/GenericDialogue',[\"require\", \"exports\", \"./BaseCommands\", \"./Dialogue\"], function (require, exports, BaseCommands_1, Dialogue_1) {\r\n    \"use strict\";\r\n    var GenericDialogue = (function (_super) {\r\n        __extends(GenericDialogue, _super);\r\n        function GenericDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        GenericDialogue.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('genericDialogue');\r\n            _super.prototype.create.call(this);\r\n            this.openCommand = BaseCommands_1.BaseCommands.SHOW_GENERIC_DIALOGUE;\r\n            this.closeCommand = BaseCommands_1.BaseCommands.HIDE_GENERIC_DIALOGUE;\r\n            $.subscribe(this.openCommand, function (e, params) {\r\n                _this.acceptCallback = params.acceptCallback;\r\n                _this.showMessage(params);\r\n            });\r\n            $.subscribe(this.closeCommand, function (e) {\r\n                _this.close();\r\n            });\r\n            this.$message = $('<p></p>');\r\n            this.$content.append(this.$message);\r\n            this.$acceptButton = $('<a href=\"#\" class=\"btn btn-primary accept default\"></a>');\r\n            this.$content.append(this.$acceptButton);\r\n            this.$acceptButton.text(this.content.ok);\r\n            this.$acceptButton.onPressed(function () {\r\n                _this.accept();\r\n            });\r\n            this.returnFunc = function () {\r\n                if (_this.isActive) {\r\n                    _this.accept();\r\n                }\r\n            };\r\n            this.$element.hide();\r\n        };\r\n        GenericDialogue.prototype.accept = function () {\r\n            $.publish(BaseCommands_1.BaseCommands.CLOSE_ACTIVE_DIALOGUE);\r\n            if (this.acceptCallback)\r\n                this.acceptCallback();\r\n        };\r\n        GenericDialogue.prototype.showMessage = function (params) {\r\n            this.$message.html(params.message);\r\n            if (params.buttonText) {\r\n                this.$acceptButton.text(params.buttonText);\r\n            }\r\n            else {\r\n                this.$acceptButton.text(this.content.ok);\r\n            }\r\n            if (params.allowClose === false) {\r\n                this.disableClose();\r\n            }\r\n            this.open();\r\n        };\r\n        GenericDialogue.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n        };\r\n        return GenericDialogue;\r\n    }(Dialogue_1.Dialogue));\r\n    exports.GenericDialogue = GenericDialogue;\r\n});\r\n//# sourceMappingURL=GenericDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-shared-module/Shell',[\"require\", \"exports\", \"./BaseCommands\", \"./BaseView\", \"./GenericDialogue\"], function (require, exports, BaseCommands_1, BaseView_1, GenericDialogue_1) {\r\n    \"use strict\";\r\n    var Shell = (function (_super) {\r\n        __extends(Shell, _super);\r\n        function Shell($element) {\r\n            var _this = this;\r\n            Shell.$element = $element;\r\n            _this = _super.call(this, Shell.$element, true, true) || this;\r\n            return _this;\r\n        }\r\n        Shell.prototype.create = function () {\r\n            _super.prototype.create.call(this);\r\n            $.subscribe(BaseCommands_1.BaseCommands.SHOW_OVERLAY, function () {\r\n                Shell.$overlays.show();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.HIDE_OVERLAY, function () {\r\n                Shell.$overlays.hide();\r\n            });\r\n            Shell.$headerPanel = $('<div class=\"headerPanel\"></div>');\r\n            Shell.$element.append(Shell.$headerPanel);\r\n            Shell.$mainPanel = $('<div class=\"mainPanel\"></div>');\r\n            Shell.$element.append(Shell.$mainPanel);\r\n            Shell.$centerPanel = $('<div class=\"centerPanel\"></div>');\r\n            Shell.$mainPanel.append(Shell.$centerPanel);\r\n            Shell.$leftPanel = $('<div class=\"leftPanel\"></div>');\r\n            Shell.$mainPanel.append(Shell.$leftPanel);\r\n            Shell.$rightPanel = $('<div class=\"rightPanel\"></div>');\r\n            Shell.$mainPanel.append(Shell.$rightPanel);\r\n            Shell.$footerPanel = $('<div class=\"footerPanel\"></div>');\r\n            Shell.$element.append(Shell.$footerPanel);\r\n            Shell.$mobileFooterPanel = $('<div class=\"footerPanel mobile\"></div>');\r\n            Shell.$element.append(Shell.$mobileFooterPanel);\r\n            Shell.$overlays = $('<div class=\"overlays\"></div>');\r\n            Shell.$element.append(Shell.$overlays);\r\n            Shell.$genericDialogue = $('<div class=\"overlay genericDialogue\"></div>');\r\n            Shell.$overlays.append(Shell.$genericDialogue);\r\n            Shell.$overlays.on('click', function (e) {\r\n                if ($(e.target).hasClass('overlays')) {\r\n                    e.preventDefault();\r\n                    $.publish(BaseCommands_1.BaseCommands.CLOSE_ACTIVE_DIALOGUE);\r\n                }\r\n            });\r\n            // create shared views.\r\n            new GenericDialogue_1.GenericDialogue(Shell.$genericDialogue);\r\n        };\r\n        Shell.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n            Shell.$overlays.width(this.extension.width());\r\n            Shell.$overlays.height(this.extension.height());\r\n            var mainHeight = this.$element.height() - parseInt(Shell.$mainPanel.css('marginTop'))\r\n                - (Shell.$headerPanel.is(':visible') ? Shell.$headerPanel.height() : 0)\r\n                - (Shell.$footerPanel.is(':visible') ? Shell.$footerPanel.height() : 0)\r\n                - (Shell.$mobileFooterPanel.is(':visible') ? Shell.$mobileFooterPanel.height() : 0);\r\n            Shell.$mainPanel.height(mainHeight);\r\n        };\r\n        return Shell;\r\n    }(BaseView_1.BaseView));\r\n    exports.Shell = Shell;\r\n});\r\n//# sourceMappingURL=Shell.js.map;\n",
    "define('modules/uv-shared-module/BaseExtension',[\"require\", \"exports\", \"./BaseCommands\", \"../../BootstrapParams\", \"../../modules/uv-dialogues-module/ClickThroughDialogue\", \"./InformationArgs\", \"./InformationType\", \"../../modules/uv-dialogues-module/LoginDialogue\", \"./LoginWarningMessages\", \"../../modules/uv-shared-module/Metrics\", \"../../Params\", \"../../modules/uv-dialogues-module/RestrictedDialogue\", \"./Shell\"], function (require, exports, BaseCommands_1, BootstrapParams_1, ClickThroughDialogue_1, InformationArgs_1, InformationType_1, LoginDialogue_1, LoginWarningMessages_1, Metrics_1, Params_1, RestrictedDialogue_1, Shell_1) {\r\n    \"use strict\";\r\n    var BaseExtension = (function () {\r\n        function BaseExtension(bootstrapper) {\r\n            this.isCreated = false;\r\n            this.isLoggedIn = false;\r\n            this.shifted = false;\r\n            this.tabbing = false;\r\n            this.bootstrapper = bootstrapper;\r\n            this.config = this.bootstrapper.config;\r\n            this.jsonp = this.bootstrapper.params.jsonp;\r\n            this.locale = this.bootstrapper.params.getLocaleName();\r\n            this.isHomeDomain = this.bootstrapper.params.isHomeDomain;\r\n            this.isReload = this.bootstrapper.params.isReload;\r\n            this.embedDomain = this.bootstrapper.params.embedDomain;\r\n            this.isOnlyInstance = this.bootstrapper.params.isOnlyInstance;\r\n            this.embedScriptUri = this.bootstrapper.params.embedScriptUri;\r\n            this.domain = this.bootstrapper.params.domain;\r\n            this.isLightbox = this.bootstrapper.params.isLightbox;\r\n        }\r\n        BaseExtension.prototype.create = function () {\r\n            var _this = this;\r\n            var that = this;\r\n            this.$element = $('#app');\r\n            this.$element.data(\"bootstrapper\", this.bootstrapper);\r\n            // initial sizing.\r\n            var $win = $(window);\r\n            this.embedWidth = $win.width();\r\n            this.embedHeight = $win.height();\r\n            this.$element.width(this.embedWidth);\r\n            this.$element.height(this.embedHeight);\r\n            if (!this.isReload && Utils.Documents.isInIFrame()) {\r\n                // communication with parent frame (if it exists).\r\n                this.bootstrapper.socket = new easyXDM.Socket({\r\n                    onMessage: function (message, origin) {\r\n                        message = $.parseJSON(message);\r\n                        _this.handleParentFrameEvent(message);\r\n                    }\r\n                });\r\n            }\r\n            this.triggerSocket(BaseCommands_1.BaseCommands.LOAD, {\r\n                bootstrapper: {\r\n                    config: this.bootstrapper.config,\r\n                    params: this.bootstrapper.params\r\n                },\r\n                settings: this.getSettings(),\r\n                preview: this.getSharePreview()\r\n            });\r\n            // add/remove classes.\r\n            this.$element.empty();\r\n            this.$element.removeClass();\r\n            this.$element.addClass('browser-' + window.browserDetect.browser);\r\n            this.$element.addClass('browser-version-' + window.browserDetect.version);\r\n            if (!this.isHomeDomain)\r\n                this.$element.addClass('embedded');\r\n            if (this.isLightbox)\r\n                this.$element.addClass('lightbox');\r\n            $(document).on('mousemove', function (e) {\r\n                _this.mouseX = e.pageX;\r\n                _this.mouseY = e.pageY;\r\n            });\r\n            // events\r\n            if (!this.isReload) {\r\n                window.onresize = function () {\r\n                    var $win = $(window);\r\n                    $('body').height($win.height());\r\n                    _this.resize();\r\n                };\r\n                var visibilityProp = Utils.Documents.getHiddenProp();\r\n                if (visibilityProp) {\r\n                    var evtname = visibilityProp.replace(/[H|h]idden/, '') + 'visibilitychange';\r\n                    document.addEventListener(evtname, function () {\r\n                        // resize after a tab has been shown (fixes safari layout issue)\r\n                        if (!Utils.Documents.isHidden()) {\r\n                            _this.resize();\r\n                        }\r\n                    });\r\n                }\r\n                if (Utils.Bools.getBool(this.config.options.dropEnabled, true)) {\r\n                    this.$element.on('drop', (function (e) {\r\n                        e.preventDefault();\r\n                        var dropUrl = e.originalEvent.dataTransfer.getData(\"URL\");\r\n                        var url = Utils.Urls.getUrlParts(dropUrl);\r\n                        var manifestUri = Utils.Urls.getQuerystringParameterFromString('manifest', url.search);\r\n                        //var canvasUri = Utils.Urls.getQuerystringParameterFromString('canvas', url.search);\r\n                        if (manifestUri) {\r\n                            _this.triggerSocket(BaseCommands_1.BaseCommands.DROP, manifestUri);\r\n                            var p = new BootstrapParams_1.BootstrapParams();\r\n                            p.manifestUri = manifestUri;\r\n                            _this.reload(p);\r\n                        }\r\n                    }));\r\n                }\r\n                this.$element.on('dragover', (function (e) {\r\n                    // allow drop\r\n                    e.preventDefault();\r\n                }));\r\n                // keyboard events.\r\n                $(document).on('keyup keydown', function (e) {\r\n                    _this.shifted = e.shiftKey;\r\n                    _this.tabbing = e.keyCode === KeyCodes.KeyDown.Tab;\r\n                });\r\n                $(document).keydown(function (e) {\r\n                    var event = null;\r\n                    var preventDefault = true;\r\n                    if (!e.ctrlKey && !e.altKey && !e.shiftKey) {\r\n                        if (e.keyCode === KeyCodes.KeyDown.Enter) {\r\n                            event = BaseCommands_1.BaseCommands.RETURN;\r\n                            preventDefault = false;\r\n                        }\r\n                        if (e.keyCode === KeyCodes.KeyDown.Escape)\r\n                            event = BaseCommands_1.BaseCommands.ESCAPE;\r\n                        if (e.keyCode === KeyCodes.KeyDown.PageUp)\r\n                            event = BaseCommands_1.BaseCommands.PAGE_UP;\r\n                        if (e.keyCode === KeyCodes.KeyDown.PageDown)\r\n                            event = BaseCommands_1.BaseCommands.PAGE_DOWN;\r\n                        if (e.keyCode === KeyCodes.KeyDown.End)\r\n                            event = BaseCommands_1.BaseCommands.END;\r\n                        if (e.keyCode === KeyCodes.KeyDown.Home)\r\n                            event = BaseCommands_1.BaseCommands.HOME;\r\n                        if (e.keyCode === KeyCodes.KeyDown.NumpadPlus || e.keyCode === 171 || e.keyCode === KeyCodes.KeyDown.Equals) {\r\n                            event = BaseCommands_1.BaseCommands.PLUS;\r\n                            preventDefault = false;\r\n                        }\r\n                        if (e.keyCode === KeyCodes.KeyDown.NumpadMinus || e.keyCode === 173 || e.keyCode === KeyCodes.KeyDown.Dash) {\r\n                            event = BaseCommands_1.BaseCommands.MINUS;\r\n                            preventDefault = false;\r\n                        }\r\n                        if (that.useArrowKeysToNavigate()) {\r\n                            if (e.keyCode === KeyCodes.KeyDown.LeftArrow)\r\n                                event = BaseCommands_1.BaseCommands.LEFT_ARROW;\r\n                            if (e.keyCode === KeyCodes.KeyDown.UpArrow)\r\n                                event = BaseCommands_1.BaseCommands.UP_ARROW;\r\n                            if (e.keyCode === KeyCodes.KeyDown.RightArrow)\r\n                                event = BaseCommands_1.BaseCommands.RIGHT_ARROW;\r\n                            if (e.keyCode === KeyCodes.KeyDown.DownArrow)\r\n                                event = BaseCommands_1.BaseCommands.DOWN_ARROW;\r\n                        }\r\n                    }\r\n                    if (event) {\r\n                        if (preventDefault) {\r\n                            e.preventDefault();\r\n                        }\r\n                        $.publish(event);\r\n                    }\r\n                });\r\n                if (this.bootstrapper.params.isHomeDomain && Utils.Documents.isInIFrame()) {\r\n                    $.subscribe(BaseCommands_1.BaseCommands.PARENT_EXIT_FULLSCREEN, function () {\r\n                        if (_this.isOverlayActive()) {\r\n                            $.publish(BaseCommands_1.BaseCommands.ESCAPE);\r\n                        }\r\n                        $.publish(BaseCommands_1.BaseCommands.ESCAPE);\r\n                        $.publish(BaseCommands_1.BaseCommands.RESIZE);\r\n                    });\r\n                }\r\n            }\r\n            this.$element.append('<a href=\"/\" id=\"top\"></a>');\r\n            this.$element.append('<iframe id=\"commsFrame\" style=\"display:none\"></iframe>');\r\n            $.subscribe(BaseCommands_1.BaseCommands.ACCEPT_TERMS, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.ACCEPT_TERMS);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LOGIN_FAILED, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.LOGIN_FAILED);\r\n                _this.showMessage(_this.config.content.authorisationFailedMessage);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LOGIN, function () {\r\n                _this.isLoggedIn = true;\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.LOGIN);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LOGOUT, function () {\r\n                _this.isLoggedIn = false;\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.LOGOUT);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.BOOKMARK, function () {\r\n                _this.bookmark();\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.BOOKMARK);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.CANVAS_INDEX_CHANGE_FAILED, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.CANVAS_INDEX_CHANGE_FAILED);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.CANVAS_INDEX_CHANGED, function (e, canvasIndex) {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.CANVAS_INDEX_CHANGED, canvasIndex);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.CLICKTHROUGH, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.CLICKTHROUGH);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.CLOSE_ACTIVE_DIALOGUE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.CLOSE_ACTIVE_DIALOGUE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.CLOSE_LEFT_PANEL, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.CLOSE_LEFT_PANEL);\r\n                _this.resize();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.CLOSE_RIGHT_PANEL, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.CLOSE_RIGHT_PANEL);\r\n                _this.resize();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.CREATED, function () {\r\n                _this.isCreated = true;\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.CREATED);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.DOWN_ARROW, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.DOWN_ARROW);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.DOWNLOAD, function (e, obj) {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.DOWNLOAD, obj);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.END, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.END);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.ESCAPE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.ESCAPE);\r\n                if (_this.isFullScreen() && !_this.isOverlayActive()) {\r\n                    $.publish(BaseCommands_1.BaseCommands.TOGGLE_FULLSCREEN);\r\n                }\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.EXTERNAL_LINK_CLICKED, function (e, url) {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.EXTERNAL_LINK_CLICKED, url);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.FEEDBACK, function () {\r\n                _this.feedback();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.FORBIDDEN, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.FORBIDDEN);\r\n                $.publish(BaseCommands_1.BaseCommands.OPEN_EXTERNAL_RESOURCE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.HIDE_DOWNLOAD_DIALOGUE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.HIDE_DOWNLOAD_DIALOGUE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.HIDE_EMBED_DIALOGUE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.HIDE_EMBED_DIALOGUE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.HIDE_EXTERNALCONTENT_DIALOGUE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.HIDE_EXTERNALCONTENT_DIALOGUE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.HIDE_GENERIC_DIALOGUE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.HIDE_GENERIC_DIALOGUE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.HIDE_HELP_DIALOGUE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.HIDE_HELP_DIALOGUE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.HIDE_INFORMATION, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.HIDE_INFORMATION);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.HIDE_LOGIN_DIALOGUE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.HIDE_LOGIN_DIALOGUE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.HIDE_OVERLAY, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.HIDE_OVERLAY);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.HIDE_RESTRICTED_DIALOGUE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.HIDE_RESTRICTED_DIALOGUE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.HIDE_SETTINGS_DIALOGUE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.HIDE_SETTINGS_DIALOGUE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.HOME, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.HOME);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LEFT_ARROW, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.LEFT_ARROW);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LEFTPANEL_COLLAPSE_FULL_FINISH, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.LEFTPANEL_COLLAPSE_FULL_FINISH);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LEFTPANEL_COLLAPSE_FULL_START, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.LEFTPANEL_COLLAPSE_FULL_START);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LEFTPANEL_EXPAND_FULL_FINISH, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.LEFTPANEL_EXPAND_FULL_FINISH);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LEFTPANEL_EXPAND_FULL_START, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.LEFTPANEL_EXPAND_FULL_START);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LOAD_FAILED, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.LOAD_FAILED);\r\n                if (!_.isNull(that.lastCanvasIndex) && that.lastCanvasIndex !== that.helper.canvasIndex) {\r\n                    _this.viewCanvas(that.lastCanvasIndex);\r\n                }\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.NOT_FOUND, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.NOT_FOUND);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.OPEN, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.OPEN);\r\n                var openUri = String.format(_this.config.options.openTemplate, _this.helper.iiifResourceUri);\r\n                window.open(openUri);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.OPEN_LEFT_PANEL, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.OPEN_LEFT_PANEL);\r\n                _this.resize();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.OPEN_EXTERNAL_RESOURCE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.OPEN_EXTERNAL_RESOURCE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.OPEN_RIGHT_PANEL, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.OPEN_RIGHT_PANEL);\r\n                _this.resize();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.PAGE_DOWN, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.PAGE_DOWN);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.PAGE_UP, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.PAGE_UP);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.RESOURCE_DEGRADED, function (e, resource) {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.RESOURCE_DEGRADED);\r\n                _this.handleDegraded(resource);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.RETURN, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.RETURN);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.RIGHT_ARROW, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.RIGHT_ARROW);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.RIGHTPANEL_COLLAPSE_FULL_FINISH, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.RIGHTPANEL_COLLAPSE_FULL_FINISH);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.RIGHTPANEL_COLLAPSE_FULL_START, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.RIGHTPANEL_COLLAPSE_FULL_START);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.RIGHTPANEL_EXPAND_FULL_FINISH, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.RIGHTPANEL_EXPAND_FULL_FINISH);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.RIGHTPANEL_EXPAND_FULL_START, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.RIGHTPANEL_EXPAND_FULL_START);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.SEQUENCE_INDEX_CHANGED, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.SEQUENCE_INDEX_CHANGED);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.SETTINGS_CHANGED, function (e, args) {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.SETTINGS_CHANGED, args);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.SHOW_DOWNLOAD_DIALOGUE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.SHOW_DOWNLOAD_DIALOGUE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.SHOW_EMBED_DIALOGUE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.SHOW_EMBED_DIALOGUE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.SHOW_EXTERNALCONTENT_DIALOGUE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.SHOW_EXTERNALCONTENT_DIALOGUE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.SHOW_GENERIC_DIALOGUE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.SHOW_GENERIC_DIALOGUE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.SHOW_HELP_DIALOGUE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.SHOW_HELP_DIALOGUE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.SHOW_INFORMATION, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.SHOW_INFORMATION);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.SHOW_LOGIN_DIALOGUE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.SHOW_LOGIN_DIALOGUE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.SHOW_CLICKTHROUGH_DIALOGUE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.SHOW_CLICKTHROUGH_DIALOGUE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.SHOW_RESTRICTED_DIALOGUE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.SHOW_RESTRICTED_DIALOGUE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.SHOW_OVERLAY, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.SHOW_OVERLAY);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.SHOW_SETTINGS_DIALOGUE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.SHOW_SETTINGS_DIALOGUE);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.SHOW_TERMS_OF_USE, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.SHOW_TERMS_OF_USE);\r\n                // todo: Eventually this should be replaced with a suitable IIIF Presentation API field - until then, use attribution\r\n                var terms = _this.helper.getAttribution();\r\n                _this.showMessage(terms);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.THUMB_SELECTED, function (e, thumb) {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.THUMB_SELECTED, thumb.index);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.TOGGLE_FULLSCREEN, function () {\r\n                $('#top').focus();\r\n                _this.bootstrapper.isFullScreen = !_this.bootstrapper.isFullScreen;\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.TOGGLE_FULLSCREEN, {\r\n                    isFullScreen: _this.bootstrapper.isFullScreen,\r\n                    overrideFullScreen: _this.config.options.overrideFullScreen\r\n                });\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.UP_ARROW, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.UP_ARROW);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.UPDATE_SETTINGS, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.UPDATE_SETTINGS);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.VIEW_FULL_TERMS, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.VIEW_FULL_TERMS);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.WINDOW_UNLOAD, function () {\r\n                _this.triggerSocket(BaseCommands_1.BaseCommands.WINDOW_UNLOAD);\r\n            });\r\n            // create shell and shared views.\r\n            this.shell = new Shell_1.Shell(this.$element);\r\n            // dependencies\r\n            this.getDependencies(function (deps) {\r\n                _this.loadDependencies(deps);\r\n            });\r\n        };\r\n        BaseExtension.prototype.createModules = function () {\r\n            this.$clickThroughDialogue = $('<div class=\"overlay clickthrough\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$clickThroughDialogue);\r\n            this.clickThroughDialogue = new ClickThroughDialogue_1.ClickThroughDialogue(this.$clickThroughDialogue);\r\n            this.$restrictedDialogue = $('<div class=\"overlay login\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$restrictedDialogue);\r\n            this.restrictedDialogue = new RestrictedDialogue_1.RestrictedDialogue(this.$restrictedDialogue);\r\n            this.$loginDialogue = $('<div class=\"overlay login\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$loginDialogue);\r\n            this.loginDialogue = new LoginDialogue_1.LoginDialogue(this.$loginDialogue);\r\n        };\r\n        BaseExtension.prototype.modulesCreated = function () {\r\n        };\r\n        BaseExtension.prototype.getDependencies = function (cb) {\r\n            var that = this;\r\n            // todo: use compiler flag (when available)\r\n            var depsUri = 'lib/' + this.name + '-dependencies';\r\n            // check if the deps are already loaded\r\n            var scripts = $('script[data-requiremodule]')\r\n                .filter(function () {\r\n                var attr = $(this).attr('data-requiremodule');\r\n                return (attr.indexOf(that.name) != -1 && attr.indexOf('dependencies') != -1);\r\n            });\r\n            if (!scripts.length) {\r\n                require([depsUri], function (deps) {\r\n                    var baseUri = 'lib/';\r\n                    // for each dependency, prepend baseUri.\r\n                    for (var i = 0; i < deps.dependencies.length; i++) {\r\n                        deps.dependencies[i] = baseUri + deps.dependencies[i];\r\n                    }\r\n                    cb(deps);\r\n                });\r\n            }\r\n            else {\r\n                cb(null);\r\n            }\r\n        };\r\n        BaseExtension.prototype.loadDependencies = function (deps) {\r\n            var that = this;\r\n            if (deps) {\r\n                require(deps.dependencies, function () {\r\n                    that.dependenciesLoaded();\r\n                });\r\n            }\r\n            else {\r\n                that.dependenciesLoaded();\r\n            }\r\n        };\r\n        BaseExtension.prototype.dependenciesLoaded = function () {\r\n            this.createModules();\r\n            this.modulesCreated();\r\n            $.publish(BaseCommands_1.BaseCommands.RESIZE); // initial sizing\r\n            $.publish(BaseCommands_1.BaseCommands.CREATED);\r\n            this.setParams();\r\n            this.setDefaultFocus();\r\n            this.viewCanvas(this.getCanvasIndexParam());\r\n        };\r\n        BaseExtension.prototype.setParams = function () {\r\n            if (!this.isHomeDomain)\r\n                return;\r\n            this.setParam(Params_1.Params.collectionIndex, this.helper.collectionIndex);\r\n            this.setParam(Params_1.Params.manifestIndex, this.helper.manifestIndex);\r\n            this.setParam(Params_1.Params.sequenceIndex, this.helper.sequenceIndex);\r\n            this.setParam(Params_1.Params.canvasIndex, this.helper.canvasIndex);\r\n        };\r\n        BaseExtension.prototype.setDefaultFocus = function () {\r\n            var _this = this;\r\n            setTimeout(function () {\r\n                if (_this.config.options.allowStealFocus) {\r\n                    $('[tabindex=0]').focus();\r\n                }\r\n            }, 1);\r\n        };\r\n        BaseExtension.prototype.width = function () {\r\n            return $(window).width();\r\n        };\r\n        BaseExtension.prototype.height = function () {\r\n            return $(window).height();\r\n        };\r\n        BaseExtension.prototype.triggerSocket = function (eventName, eventObject) {\r\n            jQuery(document).trigger(eventName, [eventObject]);\r\n            if (this.bootstrapper.socket) {\r\n                this.bootstrapper.socket.postMessage(JSON.stringify({ eventName: eventName, eventObject: eventObject }));\r\n            }\r\n        };\r\n        BaseExtension.prototype.redirect = function (uri) {\r\n            this.triggerSocket(BaseCommands_1.BaseCommands.REDIRECT, uri);\r\n        };\r\n        BaseExtension.prototype.refresh = function () {\r\n            this.triggerSocket(BaseCommands_1.BaseCommands.REFRESH, null);\r\n        };\r\n        BaseExtension.prototype._updateMetric = function () {\r\n            var keys = Object.keys(Metrics_1.Metrics);\r\n            for (var i = 0; i < keys.length; i++) {\r\n                var metric = Metrics_1.Metrics[keys[i]];\r\n                if (this.width() > metric.minWidth && this.width() <= metric.maxWidth) {\r\n                    if (this.metric !== metric) {\r\n                        this.metric = metric;\r\n                        $.publish(BaseCommands_1.BaseCommands.METRIC_CHANGED);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        BaseExtension.prototype.resize = function () {\r\n            this._updateMetric();\r\n            $.publish(BaseCommands_1.BaseCommands.RESIZE);\r\n        };\r\n        BaseExtension.prototype.handleParentFrameEvent = function (message) {\r\n            var _this = this;\r\n            Utils.Async.waitFor(function () {\r\n                return _this.isCreated;\r\n            }, function () {\r\n                switch (message.eventName) {\r\n                    case BaseCommands_1.BaseCommands.TOGGLE_FULLSCREEN:\r\n                        $.publish(BaseCommands_1.BaseCommands.TOGGLE_FULLSCREEN, message.eventObject);\r\n                        break;\r\n                    case BaseCommands_1.BaseCommands.PARENT_EXIT_FULLSCREEN:\r\n                        $.publish(BaseCommands_1.BaseCommands.PARENT_EXIT_FULLSCREEN);\r\n                        break;\r\n                }\r\n            });\r\n        };\r\n        // re-bootstraps the application with new querystring params\r\n        BaseExtension.prototype.reload = function (params) {\r\n            var p = new BootstrapParams_1.BootstrapParams();\r\n            if (params) {\r\n                p = $.extend(p, params);\r\n            }\r\n            p.isReload = true;\r\n            $.disposePubSub();\r\n            this.bootstrapper.bootstrap(p);\r\n        };\r\n        BaseExtension.prototype.getCanvasIndexParam = function () {\r\n            return this.bootstrapper.params.getParam(Params_1.Params.canvasIndex);\r\n        };\r\n        BaseExtension.prototype.getSequenceIndexParam = function () {\r\n            return this.bootstrapper.params.getParam(Params_1.Params.sequenceIndex);\r\n        };\r\n        BaseExtension.prototype.isSeeAlsoEnabled = function () {\r\n            return this.config.options.seeAlsoEnabled !== false;\r\n        };\r\n        BaseExtension.prototype.getShareUrl = function () {\r\n            // If embedded on the home domain and it's the only instance of the UV on the page\r\n            if (this.isDeepLinkingEnabled()) {\r\n                // Use the current page URL with hash params\r\n                if (Utils.Documents.isInIFrame()) {\r\n                    return parent.document.location.href;\r\n                }\r\n                else {\r\n                    return document.location.href;\r\n                }\r\n            }\r\n            else {\r\n                // If there's a `related` property of format `text/html` in the manifest\r\n                if (this.helper.hasRelatedPage()) {\r\n                    // Use the `related` property in the URL box\r\n                    var related = this.helper.getRelated();\r\n                    if (related && related.length) {\r\n                        related = related[0];\r\n                    }\r\n                    return related['@id'];\r\n                }\r\n            }\r\n            return null;\r\n        };\r\n        BaseExtension.prototype.getIIIFShareUrl = function () {\r\n            return this.helper.iiifResourceUri + \"?manifest=\" + this.helper.iiifResourceUri;\r\n        };\r\n        BaseExtension.prototype.addTimestamp = function (uri) {\r\n            return uri + \"?t=\" + Utils.Dates.getTimeStamp();\r\n        };\r\n        BaseExtension.prototype.isDeepLinkingEnabled = function () {\r\n            return (this.isHomeDomain && this.isOnlyInstance);\r\n        };\r\n        BaseExtension.prototype.isOnHomeDomain = function () {\r\n            return this.isDeepLinkingEnabled();\r\n        };\r\n        BaseExtension.prototype.getDomain = function () {\r\n            var parts = Utils.Urls.getUrlParts(this.helper.iiifResourceUri);\r\n            return parts.host;\r\n        };\r\n        BaseExtension.prototype.getEmbedDomain = function () {\r\n            return this.embedDomain;\r\n        };\r\n        BaseExtension.prototype.getSettings = function () {\r\n            if (Utils.Bools.getBool(this.config.options.saveUserSettings, false)) {\r\n                var settings = Utils.Storage.get(\"uv.settings\", Utils.StorageType.local);\r\n                if (settings) {\r\n                    return $.extend(this.config.options, settings.value);\r\n                }\r\n            }\r\n            return this.config.options;\r\n        };\r\n        BaseExtension.prototype.updateSettings = function (settings) {\r\n            if (Utils.Bools.getBool(this.config.options.saveUserSettings, false)) {\r\n                var storedSettings = Utils.Storage.get(\"uv.settings\", Utils.StorageType.local);\r\n                if (storedSettings) {\r\n                    settings = $.extend(storedSettings.value, settings);\r\n                }\r\n                // store for ten years\r\n                Utils.Storage.set(\"uv.settings\", settings, 315360000, Utils.StorageType.local);\r\n            }\r\n            this.config.options = $.extend(this.config.options, settings);\r\n        };\r\n        BaseExtension.prototype.sanitize = function (html) {\r\n            var elem = document.createElement('div');\r\n            var $elem = $(elem);\r\n            $elem.html(html);\r\n            var s = new Sanitize({\r\n                elements: ['a', 'b', 'br', 'img', 'p', 'i', 'span'],\r\n                attributes: {\r\n                    a: ['href'],\r\n                    img: ['src', 'alt']\r\n                },\r\n                protocols: {\r\n                    a: { href: ['http', 'https'] }\r\n                }\r\n            });\r\n            $elem.html(s.clean_node(elem));\r\n            return $elem.html();\r\n        };\r\n        BaseExtension.prototype.getLocales = function () {\r\n            if (this.locales)\r\n                return this.locales;\r\n            // use data-locales to prioritise\r\n            var items = this.config.localisation.locales.clone();\r\n            var sorting = this.bootstrapper.params.locales;\r\n            var result = [];\r\n            // loop through sorting array\r\n            // if items contains sort item, add it to results.\r\n            // if sort item has a label, substitute it\r\n            // mark item as added.\r\n            // if limitLocales is disabled,\r\n            // loop through remaining items and add to results.\r\n            $.each(sorting, function (index, sortItem) {\r\n                var match = _.filter(items, function (item) { return item.name === sortItem.name; });\r\n                if (match.length) {\r\n                    var m = match[0];\r\n                    if (sortItem.label)\r\n                        m.label = sortItem.label;\r\n                    m.added = true;\r\n                    result.push(m);\r\n                }\r\n            });\r\n            var limitLocales = Utils.Bools.getBool(this.config.options.limitLocales, false);\r\n            if (!limitLocales) {\r\n                $.each(items, function (index, item) {\r\n                    if (!item.added) {\r\n                        result.push(item);\r\n                    }\r\n                    delete item.added;\r\n                });\r\n            }\r\n            return this.locales = result;\r\n        };\r\n        BaseExtension.prototype.getAlternateLocale = function () {\r\n            var locales = this.getLocales();\r\n            var alternateLocale;\r\n            for (var i = 0; i < locales.length; i++) {\r\n                var l = locales[i];\r\n                if (l.name !== this.locale) {\r\n                    alternateLocale = l;\r\n                }\r\n            }\r\n            return l;\r\n        };\r\n        BaseExtension.prototype.changeLocale = function (locale) {\r\n            // if the current locale is \"en-GB:English,cy-GB:Welsh\"\r\n            // and \"cy-GB\" is passed, it becomes \"cy-GB:Welsh,en-GB:English\"\r\n            // re-order locales so the passed locale is first\r\n            var locales = this.locales.clone();\r\n            var index = locales.indexOfTest(function (l) {\r\n                return l.name === locale;\r\n            });\r\n            locales.move(index, 0);\r\n            // convert to comma-separated string\r\n            var str = this.serializeLocales(locales);\r\n            var p = new BootstrapParams_1.BootstrapParams();\r\n            p.setLocale(str);\r\n            this.reload(p);\r\n        };\r\n        BaseExtension.prototype.serializeLocales = function (locales) {\r\n            var str = '';\r\n            if (!locales)\r\n                return str;\r\n            for (var i = 0; i < locales.length; i++) {\r\n                var l = locales[i];\r\n                if (i > 0)\r\n                    str += ',';\r\n                str += l.name;\r\n                if (l.label) {\r\n                    str += ':' + l.label;\r\n                }\r\n            }\r\n            return str;\r\n        };\r\n        BaseExtension.prototype.getSerializedLocales = function () {\r\n            return this.serializeLocales(this.locales);\r\n        };\r\n        BaseExtension.prototype.getSharePreview = function () {\r\n            var preview = {};\r\n            preview.title = this.helper.getLabel();\r\n            // todo: use getThumb (when implemented)\r\n            var canvas = this.helper.getCurrentCanvas();\r\n            var thumbnail = canvas.getProperty('thumbnail');\r\n            if (!thumbnail || !_.isString(thumbnail)) {\r\n                thumbnail = canvas.getCanonicalImageUri(this.config.options.bookmarkThumbWidth);\r\n            }\r\n            preview.image = thumbnail;\r\n            return preview;\r\n        };\r\n        BaseExtension.prototype.getPagedIndices = function (canvasIndex) {\r\n            if (typeof (canvasIndex) === 'undefined')\r\n                canvasIndex = this.helper.canvasIndex;\r\n            return [canvasIndex];\r\n        };\r\n        BaseExtension.prototype.getCurrentCanvases = function () {\r\n            var indices = this.getPagedIndices(this.helper.canvasIndex);\r\n            var canvases = [];\r\n            for (var i = 0; i < indices.length; i++) {\r\n                var index = indices[i];\r\n                var canvas = this.helper.getCanvasByIndex(index);\r\n                canvases.push(canvas);\r\n            }\r\n            return canvases;\r\n        };\r\n        BaseExtension.prototype.getCanvasLabels = function (label) {\r\n            var indices = this.getPagedIndices();\r\n            var labels = \"\";\r\n            if (indices.length === 1) {\r\n                labels = label;\r\n            }\r\n            else {\r\n                for (var i = 1; i <= indices.length; i++) {\r\n                    if (labels.length)\r\n                        labels += \",\";\r\n                    labels += label + \" \" + i;\r\n                }\r\n            }\r\n            return labels;\r\n        };\r\n        BaseExtension.prototype.getCurrentCanvasRange = function () {\r\n            //var rangePath: string = this.currentRangePath ? this.currentRangePath : '';\r\n            //var range: Manifesto.IRange = this.helper.getCanvasRange(this.helper.getCurrentCanvas(), rangePath);\r\n            var range = this.helper.getCanvasRange(this.helper.getCurrentCanvas());\r\n            return range;\r\n        };\r\n        BaseExtension.prototype.getExternalResources = function (resources) {\r\n            var _this = this;\r\n            var indices = this.getPagedIndices();\r\n            var resourcesToLoad = [];\r\n            _.each(indices, function (index) {\r\n                var canvas = _this.helper.getCanvasByIndex(index);\r\n                var r = new Manifold.ExternalResource(canvas, _this.helper.getInfoUri);\r\n                r.index = index;\r\n                // used to reload resources with isResponseHandled = true.\r\n                if (resources) {\r\n                    var found = _.find(resources, function (f) {\r\n                        return f.dataUri === r.dataUri;\r\n                    });\r\n                    if (found) {\r\n                        resourcesToLoad.push(found);\r\n                    }\r\n                    else {\r\n                        resourcesToLoad.push(r);\r\n                    }\r\n                }\r\n                else {\r\n                    resourcesToLoad.push(r);\r\n                }\r\n            });\r\n            var storageStrategy = this.config.options.tokenStorage;\r\n            return new Promise(function (resolve) {\r\n                manifesto.Utils.loadExternalResources(resourcesToLoad, storageStrategy, _this.clickThrough, _this.restricted, _this.login, _this.getAccessToken, _this.storeAccessToken, _this.getStoredAccessToken, _this.handleExternalResourceResponse).then(function (r) {\r\n                    _this.resources = $.map(r, function (resource) {\r\n                        resource.data.index = resource.index;\r\n                        return _.toPlainObject(resource.data);\r\n                    });\r\n                    resolve(_this.resources);\r\n                })['catch'](function (error) {\r\n                    switch (error.name) {\r\n                        case manifesto.StatusCodes.AUTHORIZATION_FAILED.toString():\r\n                            $.publish(BaseCommands_1.BaseCommands.LOGIN_FAILED);\r\n                            break;\r\n                        case manifesto.StatusCodes.FORBIDDEN.toString():\r\n                            $.publish(BaseCommands_1.BaseCommands.FORBIDDEN);\r\n                            break;\r\n                        case manifesto.StatusCodes.RESTRICTED.toString():\r\n                            // do nothing\r\n                            break;\r\n                        default:\r\n                            _this.showMessage(error.message || error);\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        // get hash or data-attribute params depending on whether the UV is embedded.\r\n        BaseExtension.prototype.getParam = function (key) {\r\n            var value;\r\n            // deep linking is only allowed when hosted on home domain.\r\n            if (this.isDeepLinkingEnabled()) {\r\n                // todo: use a static type on bootstrapper.params\r\n                value = Utils.Urls.getHashParameter(this.bootstrapper.params.paramMap[key], parent.document);\r\n            }\r\n            if (!value) {\r\n                // todo: use a static type on bootstrapper.params\r\n                value = Utils.Urls.getQuerystringParameter(this.bootstrapper.params.paramMap[key]);\r\n            }\r\n            return value;\r\n        };\r\n        // set hash params depending on whether the UV is embedded.\r\n        BaseExtension.prototype.setParam = function (key, value) {\r\n            if (this.isDeepLinkingEnabled()) {\r\n                Utils.Urls.setHashParameter(this.bootstrapper.params.paramMap[key], value, parent.document);\r\n            }\r\n        };\r\n        BaseExtension.prototype.viewCanvas = function (canvasIndex) {\r\n            if (this.helper.isCanvasIndexOutOfRange(canvasIndex)) {\r\n                this.showMessage(this.config.content.canvasIndexOutOfRange);\r\n                canvasIndex = 0;\r\n            }\r\n            this.lastCanvasIndex = this.helper.canvasIndex;\r\n            this.helper.canvasIndex = canvasIndex;\r\n            $.publish(BaseCommands_1.BaseCommands.CANVAS_INDEX_CHANGED, [canvasIndex]);\r\n            $.publish(BaseCommands_1.BaseCommands.OPEN_EXTERNAL_RESOURCE);\r\n            this.setParam(Params_1.Params.canvasIndex, canvasIndex);\r\n        };\r\n        BaseExtension.prototype.showMessage = function (message, acceptCallback, buttonText, allowClose) {\r\n            this.closeActiveDialogue();\r\n            $.publish(BaseCommands_1.BaseCommands.SHOW_GENERIC_DIALOGUE, [\r\n                {\r\n                    message: message,\r\n                    acceptCallback: acceptCallback,\r\n                    buttonText: buttonText,\r\n                    allowClose: allowClose\r\n                }\r\n            ]);\r\n        };\r\n        BaseExtension.prototype.closeActiveDialogue = function () {\r\n            $.publish(BaseCommands_1.BaseCommands.CLOSE_ACTIVE_DIALOGUE);\r\n        };\r\n        BaseExtension.prototype.isOverlayActive = function () {\r\n            return Shell_1.Shell.$overlays.is(':visible');\r\n        };\r\n        BaseExtension.prototype.viewManifest = function (manifest) {\r\n            var p = new BootstrapParams_1.BootstrapParams();\r\n            p.manifestUri = this.helper.iiifResourceUri;\r\n            p.collectionIndex = this.helper.getCollectionIndex(manifest);\r\n            p.manifestIndex = manifest.index;\r\n            p.sequenceIndex = 0;\r\n            p.canvasIndex = 0;\r\n            this.reload(p);\r\n        };\r\n        BaseExtension.prototype.viewCollection = function (collection) {\r\n            var p = new BootstrapParams_1.BootstrapParams();\r\n            p.manifestUri = this.helper.iiifResourceUri;\r\n            p.collectionIndex = collection.index;\r\n            p.manifestIndex = 0;\r\n            p.sequenceIndex = 0;\r\n            p.canvasIndex = 0;\r\n            this.reload(p);\r\n        };\r\n        BaseExtension.prototype.isFullScreen = function () {\r\n            return this.bootstrapper.isFullScreen;\r\n        };\r\n        BaseExtension.prototype.isHeaderPanelEnabled = function () {\r\n            return Utils.Bools.getBool(this.config.options.headerPanelEnabled, true);\r\n        };\r\n        BaseExtension.prototype.isLeftPanelEnabled = function () {\r\n            if (Utils.Bools.getBool(this.config.options.leftPanelEnabled, true)) {\r\n                if (this.helper.hasParentCollection()) {\r\n                    return true;\r\n                }\r\n                else if (this.helper.isMultiCanvas()) {\r\n                    if (this.helper.getViewingHint().toString() !== manifesto.ViewingHint.continuous().toString()) {\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n            return false;\r\n        };\r\n        BaseExtension.prototype.isRightPanelEnabled = function () {\r\n            return Utils.Bools.getBool(this.config.options.rightPanelEnabled, true);\r\n        };\r\n        BaseExtension.prototype.isFooterPanelEnabled = function () {\r\n            return Utils.Bools.getBool(this.config.options.footerPanelEnabled, true);\r\n        };\r\n        BaseExtension.prototype.useArrowKeysToNavigate = function () {\r\n            return Utils.Bools.getBool(this.config.options.useArrowKeysToNavigate, true);\r\n        };\r\n        BaseExtension.prototype.bookmark = function () {\r\n            // override for each extension\r\n        };\r\n        BaseExtension.prototype.feedback = function () {\r\n            this.triggerSocket(BaseCommands_1.BaseCommands.FEEDBACK, new BootstrapParams_1.BootstrapParams());\r\n        };\r\n        BaseExtension.prototype.getBookmarkUri = function () {\r\n            var absUri = parent.document.URL;\r\n            var parts = Utils.Urls.getUrlParts(absUri);\r\n            var relUri = parts.pathname + parts.search + parent.document.location.hash;\r\n            if (!relUri.startsWith(\"/\")) {\r\n                relUri = \"/\" + relUri;\r\n            }\r\n            return relUri;\r\n        };\r\n        // auth\r\n        BaseExtension.prototype.clickThrough = function (resource) {\r\n            return new Promise(function (resolve) {\r\n                $.publish(BaseCommands_1.BaseCommands.SHOW_CLICKTHROUGH_DIALOGUE, [{\r\n                        resource: resource,\r\n                        acceptCallback: function () {\r\n                            var win = window.open(resource.clickThroughService.id);\r\n                            var pollTimer = window.setInterval(function () {\r\n                                if (win.closed) {\r\n                                    window.clearInterval(pollTimer);\r\n                                    $.publish(BaseCommands_1.BaseCommands.CLICKTHROUGH);\r\n                                    resolve();\r\n                                }\r\n                            }, 500);\r\n                        }\r\n                    }]);\r\n            });\r\n        };\r\n        BaseExtension.prototype.restricted = function (resource) {\r\n            return new Promise(function (resolve, reject) {\r\n                $.publish(BaseCommands_1.BaseCommands.SHOW_RESTRICTED_DIALOGUE, [{\r\n                        resource: resource,\r\n                        acceptCallback: function () {\r\n                            $.publish(BaseCommands_1.BaseCommands.LOAD_FAILED);\r\n                            reject(resource);\r\n                        }\r\n                    }]);\r\n            });\r\n        };\r\n        BaseExtension.prototype.login = function (resource) {\r\n            return new Promise(function (resolve) {\r\n                var options = {};\r\n                if (resource.status === HTTPStatusCode.FORBIDDEN) {\r\n                    options.warningMessage = LoginWarningMessages_1.LoginWarningMessages.FORBIDDEN;\r\n                    options.showCancelButton = true;\r\n                }\r\n                $.publish(BaseCommands_1.BaseCommands.SHOW_LOGIN_DIALOGUE, [{\r\n                        resource: resource,\r\n                        loginCallback: function () {\r\n                            var win = window.open(resource.loginService.id + \"?t=\" + new Date().getTime());\r\n                            var pollTimer = window.setInterval(function () {\r\n                                if (win.closed) {\r\n                                    window.clearInterval(pollTimer);\r\n                                    $.publish(BaseCommands_1.BaseCommands.LOGIN);\r\n                                    resolve();\r\n                                }\r\n                            }, 500);\r\n                        },\r\n                        logoutCallback: function () {\r\n                            var win = window.open(resource.logoutService.id + \"?t=\" + new Date().getTime());\r\n                            var pollTimer = window.setInterval(function () {\r\n                                if (win.closed) {\r\n                                    window.clearInterval(pollTimer);\r\n                                    $.publish(BaseCommands_1.BaseCommands.LOGOUT);\r\n                                    resolve();\r\n                                }\r\n                            }, 500);\r\n                        },\r\n                        options: options\r\n                    }]);\r\n            });\r\n        };\r\n        BaseExtension.prototype.getAccessToken = function (resource, rejectOnError) {\r\n            return new Promise(function (resolve, reject) {\r\n                var serviceUri = resource.tokenService.id;\r\n                // pick an identifier for this message. We might want to keep track of sent messages\r\n                var msgId = serviceUri + \"|\" + new Date().getTime();\r\n                var receiveAccessToken = function (e) {\r\n                    window.removeEventListener(\"message\", receiveAccessToken);\r\n                    var token = e.data;\r\n                    if (token.error) {\r\n                        if (rejectOnError) {\r\n                            reject(token.errorDescription);\r\n                        }\r\n                        else {\r\n                            resolve(null);\r\n                        }\r\n                    }\r\n                    else {\r\n                        resolve(token);\r\n                    }\r\n                };\r\n                window.addEventListener(\"message\", receiveAccessToken, false);\r\n                var tokenUri = serviceUri + \"?messageId=\" + msgId;\r\n                $('#commsFrame').prop('src', tokenUri);\r\n            });\r\n            // deprecated JSONP method - keep this around for reference\r\n            //return new Promise<Manifesto.IAccessToken>((resolve, reject) => {\r\n            //    $.getJSON(resource.tokenService.id + \"?callback=?\", (token: Manifesto.IAccessToken) => {\r\n            //        if (token.error){\r\n            //            if(rejectOnError) {\r\n            //                reject(token.errorDescription);\r\n            //            } else {\r\n            //                resolve(null);\r\n            //            }\r\n            //        } else {\r\n            //            resolve(token);\r\n            //        }\r\n            //    }).fail((error) => {\r\n            //        if(rejectOnError) {\r\n            //            reject(error);\r\n            //        } else {\r\n            //            resolve(null);\r\n            //        }\r\n            //    });\r\n            //});\r\n        };\r\n        BaseExtension.prototype.storeAccessToken = function (resource, token, storageStrategy) {\r\n            return new Promise(function (resolve, reject) {\r\n                Utils.Storage.set(resource.tokenService.id, token, token.expiresIn, new Utils.StorageType(storageStrategy));\r\n                resolve();\r\n            });\r\n        };\r\n        BaseExtension.prototype.getStoredAccessToken = function (resource, storageStrategy) {\r\n            return new Promise(function (resolve, reject) {\r\n                var foundItems = [];\r\n                var item;\r\n                // try to match on the tokenService, if the resource has one:\r\n                if (resource.tokenService) {\r\n                    item = Utils.Storage.get(resource.tokenService.id, new Utils.StorageType(storageStrategy));\r\n                }\r\n                if (item) {\r\n                    foundItems.push(item);\r\n                }\r\n                else {\r\n                    // find an access token for the domain\r\n                    var domain = Utils.Urls.getUrlParts(resource.dataUri).hostname;\r\n                    var items = Utils.Storage.getItems(new Utils.StorageType(storageStrategy));\r\n                    for (var i = 0; i < items.length; i++) {\r\n                        item = items[i];\r\n                        if (item.key.contains(domain)) {\r\n                            foundItems.push(item);\r\n                        }\r\n                    }\r\n                }\r\n                // sort by expiresAt\r\n                foundItems = _.sortBy(foundItems, function (item) {\r\n                    return item.expiresAt;\r\n                });\r\n                var foundToken;\r\n                if (foundItems.length) {\r\n                    foundToken = foundItems.last().value;\r\n                }\r\n                resolve(foundToken);\r\n            });\r\n        };\r\n        BaseExtension.prototype.handleExternalResourceResponse = function (resource) {\r\n            return new Promise(function (resolve, reject) {\r\n                resource.isResponseHandled = true;\r\n                if (resource.status === HTTPStatusCode.OK) {\r\n                    resolve(resource);\r\n                }\r\n                else if (resource.status === HTTPStatusCode.MOVED_TEMPORARILY) {\r\n                    resolve(resource);\r\n                    $.publish(BaseCommands_1.BaseCommands.RESOURCE_DEGRADED, [resource]);\r\n                }\r\n                else {\r\n                    if (resource.error.status === HTTPStatusCode.UNAUTHORIZED ||\r\n                        resource.error.status === HTTPStatusCode.INTERNAL_SERVER_ERROR) {\r\n                        // if the browser doesn't support CORS\r\n                        if (!Modernizr.cors) {\r\n                            var informationArgs = new InformationArgs_1.InformationArgs(InformationType_1.InformationType.AUTH_CORS_ERROR, null);\r\n                            $.publish(BaseCommands_1.BaseCommands.SHOW_INFORMATION, [informationArgs]);\r\n                            resolve(resource);\r\n                        }\r\n                        else {\r\n                            reject(resource.error.statusText);\r\n                        }\r\n                    }\r\n                    else if (resource.error.status === HTTPStatusCode.FORBIDDEN) {\r\n                        var error = new Error();\r\n                        error.message = \"Forbidden\";\r\n                        error.name = manifesto.StatusCodes.FORBIDDEN.toString();\r\n                        reject(error);\r\n                    }\r\n                    else {\r\n                        reject(resource.error.statusText);\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        BaseExtension.prototype.handleDegraded = function (resource) {\r\n            var informationArgs = new InformationArgs_1.InformationArgs(InformationType_1.InformationType.DEGRADED_RESOURCE, resource);\r\n            $.publish(BaseCommands_1.BaseCommands.SHOW_INFORMATION, [informationArgs]);\r\n        };\r\n        return BaseExtension;\r\n    }());\r\n    exports.BaseExtension = BaseExtension;\r\n});\r\n//# sourceMappingURL=BaseExtension.js.map;\n",
    "define('modules/uv-shared-module/Bookmark',[\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    var Bookmark = (function () {\r\n        function Bookmark() {\r\n        }\r\n        return Bookmark;\r\n    }());\r\n    exports.Bookmark = Bookmark;\r\n});\r\n//# sourceMappingURL=Bookmark.js.map;\n",
    "define('extensions/uv-seadragon-extension/Commands',[\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    var Commands = (function () {\r\n        function Commands() {\r\n        }\r\n        return Commands;\r\n    }());\r\n    Commands.namespace = 'seadragonExtension.';\r\n    Commands.CLEAR_SEARCH = Commands.namespace + 'onClearSearch';\r\n    Commands.CURRENT_VIEW_URI = Commands.namespace + 'onCurrentViewUri';\r\n    Commands.FIRST = Commands.namespace + 'onFirst';\r\n    Commands.GALLERY_DECREASE_SIZE = Commands.namespace + 'onGalleryDecreaseSize';\r\n    Commands.GALLERY_INCREASE_SIZE = Commands.namespace + 'onGalleryIncreaseSize';\r\n    Commands.GALLERY_THUMB_SELECTED = Commands.namespace + 'onGalleryThumbSelected';\r\n    Commands.HIDE_MULTISELECT_DIALOGUE = Commands.namespace + 'onHideMultiSelectDialogue';\r\n    Commands.IMAGE_SEARCH = Commands.namespace + 'onImageSearch';\r\n    Commands.LAST = Commands.namespace + 'onLast';\r\n    Commands.MODE_CHANGED = Commands.namespace + 'onModeChanged';\r\n    Commands.MULTISELECT_CHANGE = Commands.namespace + 'onMultiSelectChange';\r\n    Commands.MULTISELECTION_MADE = Commands.namespace + 'onMultiSelectionMade';\r\n    Commands.NEXT_SEARCH_RESULT = Commands.namespace + 'onNextSearchResult';\r\n    Commands.NEXT = Commands.namespace + 'onNext';\r\n    Commands.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE = Commands.namespace + 'onNextImagesSearchResultUnavailable';\r\n    Commands.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE = Commands.namespace + 'onPrevImagesSearchResultUnavailable';\r\n    Commands.OPEN_THUMBS_VIEW = Commands.namespace + 'onOpenThumbsView';\r\n    Commands.OPEN_TREE_VIEW = Commands.namespace + 'onOpenTreeView';\r\n    Commands.PAGE_SEARCH = Commands.namespace + 'onPageSearch';\r\n    Commands.PAGING_TOGGLED = Commands.namespace + 'onPagingToggled';\r\n    Commands.PREV_SEARCH_RESULT = Commands.namespace + 'onPrevSearchResult';\r\n    Commands.PREV = Commands.namespace + 'onPrev';\r\n    Commands.PRINT = Commands.namespace + 'onPrint';\r\n    Commands.ROTATE = Commands.namespace + 'onRotate';\r\n    Commands.SEADRAGON_ANIMATION_FINISH = Commands.namespace + 'onAnimationfinish';\r\n    Commands.SEADRAGON_ANIMATION_START = Commands.namespace + 'onAnimationStart';\r\n    Commands.SEADRAGON_ANIMATION = Commands.namespace + 'onAnimation';\r\n    Commands.SEADRAGON_OPEN = Commands.namespace + 'onOpen';\r\n    Commands.SEADRAGON_RESIZE = Commands.namespace + 'onResize';\r\n    Commands.SEADRAGON_ROTATION = Commands.namespace + 'onRotation';\r\n    Commands.SEARCH_PREVIEW_FINISH = Commands.namespace + 'onSearchPreviewFinish';\r\n    Commands.SEARCH_PREVIEW_START = Commands.namespace + 'onSearchPreviewStart';\r\n    Commands.SEARCH_RESULT_CANVAS_CHANGED = Commands.namespace + 'onSearchResultCanvasChanged';\r\n    Commands.SEARCH_RESULT_RECT_CHANGED = Commands.namespace + 'onSearchResultRectChanged';\r\n    Commands.SEARCH_RESULTS_EMPTY = Commands.namespace + 'onSearchResultsEmpty';\r\n    Commands.SEARCH_RESULTS = Commands.namespace + 'onSearchResults';\r\n    Commands.SEARCH_RESULTS_CLEARED = Commands.namespace + 'onSearchResultsCleared';\r\n    Commands.SEARCH = Commands.namespace + 'onSearch';\r\n    Commands.SHOW_MULTISELECT_DIALOGUE = Commands.namespace + 'onShowMultiSelectDialogue';\r\n    Commands.THUMB_MULTISELECTED = Commands.namespace + 'onThumbMultiSelected';\r\n    Commands.TREE_NODE_MULTISELECTED = Commands.namespace + 'onTreeNodeMultiSelected';\r\n    Commands.TREE_NODE_SELECTED = Commands.namespace + 'onTreeNodeSelected';\r\n    Commands.VIEW_PAGE = Commands.namespace + 'onViewPage';\r\n    Commands.ZOOM_IN = Commands.namespace + 'onZoomIn';\r\n    Commands.ZOOM_OUT = Commands.namespace + 'onZoomOut';\r\n    exports.Commands = Commands;\r\n});\r\n//# sourceMappingURL=Commands.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-contentleftpanel-module/GalleryView',[\"require\", \"exports\", \"../uv-shared-module/BaseCommands\", \"../uv-shared-module/BaseView\", \"../../extensions/uv-seadragon-extension/Commands\"], function (require, exports, BaseCommands_1, BaseView_1, Commands_1) {\r\n    \"use strict\";\r\n    var GalleryView = (function (_super) {\r\n        __extends(GalleryView, _super);\r\n        function GalleryView($element) {\r\n            var _this = _super.call(this, $element, true, true) || this;\r\n            _this.isOpen = false;\r\n            return _this;\r\n        }\r\n        GalleryView.prototype.create = function () {\r\n            this.setConfig('contentLeftPanel');\r\n            _super.prototype.create.call(this);\r\n            // search preview doesn't work well with the gallery because it loads thumbs in \"chunks\"\r\n            // $.subscribe(Commands.SEARCH_PREVIEW_START, (e, canvasIndex) => {\r\n            //     this.component.searchPreviewStart(canvasIndex);\r\n            // });\r\n            // $.subscribe(Commands.SEARCH_PREVIEW_FINISH, () => {\r\n            //     this.component.searchPreviewFinish();\r\n            // });\r\n            this.$gallery = $('<div class=\"iiif-gallery-component\"></div>');\r\n            this.$element.append(this.$gallery);\r\n        };\r\n        GalleryView.prototype.setup = function () {\r\n            this.component = new IIIFComponents.GalleryComponent({\r\n                target: this.$gallery[0],\r\n                data: this.galleryData\r\n            });\r\n            this.component.on('thumbSelected', function (args) {\r\n                var thumb = args[0];\r\n                $.publish(Commands_1.Commands.GALLERY_THUMB_SELECTED, [thumb]);\r\n                $.publish(BaseCommands_1.BaseCommands.THUMB_SELECTED, [thumb]);\r\n            });\r\n            this.component.on('decreaseSize', function () {\r\n                $.publish(Commands_1.Commands.GALLERY_DECREASE_SIZE);\r\n            });\r\n            this.component.on('increaseSize', function () {\r\n                $.publish(Commands_1.Commands.GALLERY_INCREASE_SIZE);\r\n            });\r\n        };\r\n        GalleryView.prototype.databind = function () {\r\n            this.component.options.data = this.galleryData;\r\n            this.component.set(null); // todo: should be passing options.data\r\n            this.resize();\r\n        };\r\n        GalleryView.prototype.show = function () {\r\n            var _this = this;\r\n            this.isOpen = true;\r\n            this.$element.show();\r\n            // todo: would be better to have no imperative methods on components and use a reactive pattern\r\n            setTimeout(function () {\r\n                _this.component.selectIndex(_this.extension.helper.canvasIndex);\r\n            }, 10);\r\n        };\r\n        GalleryView.prototype.hide = function () {\r\n            this.isOpen = false;\r\n            this.$element.hide();\r\n        };\r\n        GalleryView.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n            var $main = this.$gallery.find('.main');\r\n            var $header = this.$gallery.find('.header');\r\n            $main.height(this.$element.height() - $header.height());\r\n        };\r\n        return GalleryView;\r\n    }(BaseView_1.BaseView));\r\n    exports.GalleryView = GalleryView;\r\n});\r\n//# sourceMappingURL=GalleryView.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-shared-module/BaseExpandPanel',[\"require\", \"exports\", \"./BaseView\"], function (require, exports, BaseView_1) {\r\n    \"use strict\";\r\n    var BaseExpandPanel = (function (_super) {\r\n        __extends(BaseExpandPanel, _super);\r\n        function BaseExpandPanel($element) {\r\n            var _this = _super.call(this, $element, false, true) || this;\r\n            _this.isExpanded = false;\r\n            _this.isFullyExpanded = false;\r\n            _this.isUnopened = true;\r\n            _this.autoToggled = false;\r\n            _this.expandFullEnabled = true;\r\n            return _this;\r\n        }\r\n        BaseExpandPanel.prototype.create = function () {\r\n            var _this = this;\r\n            _super.prototype.create.call(this);\r\n            this.$top = $('<div class=\"top\"></div>');\r\n            this.$element.append(this.$top);\r\n            this.$title = $('<div class=\"title\"></div>');\r\n            this.$title.prop('title', this.content.title);\r\n            this.$top.append(this.$title);\r\n            this.$expandFullButton = $('<a class=\"expandFullButton\" tabindex=\"0\"></a>');\r\n            this.$expandFullButton.prop('title', this.content.expandFull);\r\n            this.$top.append(this.$expandFullButton);\r\n            if (!Utils.Bools.getBool(this.config.options.expandFullEnabled, true)) {\r\n                this.$expandFullButton.hide();\r\n            }\r\n            this.$collapseButton = $('<div class=\"collapseButton\" tabindex=\"0\"></div>');\r\n            this.$collapseButton.prop('title', this.content.collapse);\r\n            this.$top.append(this.$collapseButton);\r\n            this.$closed = $('<div class=\"closed\"></div>');\r\n            this.$element.append(this.$closed);\r\n            this.$expandButton = $('<a class=\"expandButton\" tabindex=\"0\"></a>');\r\n            this.$expandButton.prop('title', this.content.expand);\r\n            this.$closed.append(this.$expandButton);\r\n            this.$closedTitle = $('<a class=\"title\"></a>');\r\n            this.$closedTitle.prop('title', this.content.title);\r\n            this.$closed.append(this.$closedTitle);\r\n            this.$main = $('<div class=\"main\"></div>');\r\n            this.$element.append(this.$main);\r\n            this.$expandButton.onPressed(function () {\r\n                _this.toggle();\r\n            });\r\n            this.$expandFullButton.onPressed(function () {\r\n                _this.expandFull();\r\n            });\r\n            this.$closedTitle.onPressed(function () {\r\n                _this.toggle();\r\n            });\r\n            this.$title.onPressed(function () {\r\n                if (_this.isFullyExpanded) {\r\n                    _this.collapseFull();\r\n                }\r\n                else {\r\n                    _this.toggle();\r\n                }\r\n            });\r\n            this.$collapseButton.onPressed(function () {\r\n                if (_this.isFullyExpanded) {\r\n                    _this.collapseFull();\r\n                }\r\n                else {\r\n                    _this.toggle();\r\n                }\r\n            });\r\n            this.$top.hide();\r\n            this.$main.hide();\r\n        };\r\n        BaseExpandPanel.prototype.init = function () {\r\n            _super.prototype.init.call(this);\r\n        };\r\n        BaseExpandPanel.prototype.setTitle = function (title) {\r\n            this.$title.text(title);\r\n            this.$closedTitle.text(title);\r\n        };\r\n        BaseExpandPanel.prototype.toggle = function (autoToggled) {\r\n            var _this = this;\r\n            (autoToggled) ? this.autoToggled = true : this.autoToggled = false;\r\n            // if collapsing, hide contents immediately.\r\n            if (this.isExpanded) {\r\n                this.$top.hide();\r\n                this.$main.hide();\r\n                this.$closed.show();\r\n            }\r\n            this.$element.stop().animate({\r\n                width: this.getTargetWidth(),\r\n                left: this.getTargetLeft()\r\n            }, this.options.panelAnimationDuration, function () {\r\n                _this.toggled();\r\n            });\r\n        };\r\n        BaseExpandPanel.prototype.toggled = function () {\r\n            this.toggleStart();\r\n            this.isExpanded = !this.isExpanded;\r\n            // if expanded show content when animation finished.\r\n            if (this.isExpanded) {\r\n                this.$closed.hide();\r\n                this.$top.show();\r\n                this.$main.show();\r\n            }\r\n            this.toggleFinish();\r\n            this.isUnopened = false;\r\n        };\r\n        BaseExpandPanel.prototype.expandFull = function () {\r\n            var _this = this;\r\n            if (!this.isExpanded) {\r\n                this.toggled();\r\n            }\r\n            var targetWidth = this.getFullTargetWidth();\r\n            var targetLeft = this.getFullTargetLeft();\r\n            this.expandFullStart();\r\n            this.$element.stop().animate({\r\n                width: targetWidth,\r\n                left: targetLeft\r\n            }, this.options.panelAnimationDuration, function () {\r\n                _this.expandFullFinish();\r\n            });\r\n        };\r\n        BaseExpandPanel.prototype.collapseFull = function () {\r\n            var _this = this;\r\n            var targetWidth = this.getTargetWidth();\r\n            var targetLeft = this.getTargetLeft();\r\n            this.collapseFullStart();\r\n            this.$element.stop().animate({\r\n                width: targetWidth,\r\n                left: targetLeft\r\n            }, this.options.panelAnimationDuration, function () {\r\n                _this.collapseFullFinish();\r\n            });\r\n        };\r\n        BaseExpandPanel.prototype.getTargetWidth = function () {\r\n            return 0;\r\n        };\r\n        BaseExpandPanel.prototype.getTargetLeft = function () {\r\n            return 0;\r\n        };\r\n        BaseExpandPanel.prototype.getFullTargetWidth = function () {\r\n            return 0;\r\n        };\r\n        BaseExpandPanel.prototype.getFullTargetLeft = function () {\r\n            return 0;\r\n        };\r\n        BaseExpandPanel.prototype.toggleStart = function () {\r\n        };\r\n        BaseExpandPanel.prototype.toggleFinish = function () {\r\n            if (this.isExpanded && !this.autoToggled) {\r\n                this.focusCollapseButton();\r\n            }\r\n            else {\r\n                this.focusExpandButton();\r\n            }\r\n        };\r\n        BaseExpandPanel.prototype.expandFullStart = function () {\r\n        };\r\n        BaseExpandPanel.prototype.expandFullFinish = function () {\r\n            this.isFullyExpanded = true;\r\n            this.$expandFullButton.hide();\r\n            this.focusCollapseButton();\r\n        };\r\n        BaseExpandPanel.prototype.collapseFullStart = function () {\r\n        };\r\n        BaseExpandPanel.prototype.collapseFullFinish = function () {\r\n            this.isFullyExpanded = false;\r\n            if (this.expandFullEnabled) {\r\n                this.$expandFullButton.show();\r\n            }\r\n            this.focusExpandFullButton();\r\n        };\r\n        BaseExpandPanel.prototype.focusExpandButton = function () {\r\n            var _this = this;\r\n            setTimeout(function () {\r\n                _this.$expandButton.focus();\r\n            }, 1);\r\n        };\r\n        BaseExpandPanel.prototype.focusExpandFullButton = function () {\r\n            var _this = this;\r\n            setTimeout(function () {\r\n                _this.$expandFullButton.focus();\r\n            }, 1);\r\n        };\r\n        BaseExpandPanel.prototype.focusCollapseButton = function () {\r\n            var _this = this;\r\n            setTimeout(function () {\r\n                _this.$collapseButton.focus();\r\n            }, 1);\r\n        };\r\n        BaseExpandPanel.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n            this.$main.height(this.$element.parent().height() - this.$top.outerHeight(true));\r\n        };\r\n        return BaseExpandPanel;\r\n    }(BaseView_1.BaseView));\r\n    exports.BaseExpandPanel = BaseExpandPanel;\r\n});\r\n//# sourceMappingURL=BaseExpandPanel.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-shared-module/LeftPanel',[\"require\", \"exports\", \"./BaseCommands\", \"./BaseExpandPanel\"], function (require, exports, BaseCommands_1, BaseExpandPanel_1) {\r\n    \"use strict\";\r\n    var LeftPanel = (function (_super) {\r\n        __extends(LeftPanel, _super);\r\n        function LeftPanel($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        LeftPanel.prototype.create = function () {\r\n            var _this = this;\r\n            _super.prototype.create.call(this);\r\n            this.$element.width(this.options.panelCollapsedWidth);\r\n            $.subscribe(BaseCommands_1.BaseCommands.TOGGLE_EXPAND_LEFT_PANEL, function () {\r\n                if (_this.isFullyExpanded) {\r\n                    _this.collapseFull();\r\n                }\r\n                else {\r\n                    _this.expandFull();\r\n                }\r\n            });\r\n        };\r\n        LeftPanel.prototype.init = function () {\r\n            _super.prototype.init.call(this);\r\n            var shouldOpenPanel = Utils.Bools.getBool(this.extension.getSettings().leftPanelOpen, this.options.panelOpen);\r\n            if (shouldOpenPanel) {\r\n                this.toggle(true);\r\n            }\r\n        };\r\n        LeftPanel.prototype.getTargetWidth = function () {\r\n            if (this.isFullyExpanded || !this.isExpanded) {\r\n                return this.options.panelExpandedWidth;\r\n            }\r\n            else {\r\n                return this.options.panelCollapsedWidth;\r\n            }\r\n        };\r\n        LeftPanel.prototype.getFullTargetWidth = function () {\r\n            return this.$element.parent().width();\r\n        };\r\n        LeftPanel.prototype.toggleFinish = function () {\r\n            _super.prototype.toggleFinish.call(this);\r\n            if (this.isExpanded) {\r\n                $.publish(BaseCommands_1.BaseCommands.OPEN_LEFT_PANEL);\r\n            }\r\n            else {\r\n                $.publish(BaseCommands_1.BaseCommands.CLOSE_LEFT_PANEL);\r\n            }\r\n            this.extension.updateSettings({ leftPanelOpen: this.isExpanded });\r\n        };\r\n        LeftPanel.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n            if (this.isFullyExpanded) {\r\n                this.$element.width(this.$element.parent().width());\r\n            }\r\n        };\r\n        return LeftPanel;\r\n    }(BaseExpandPanel_1.BaseExpandPanel));\r\n    exports.LeftPanel = LeftPanel;\r\n});\r\n//# sourceMappingURL=LeftPanel.js.map;\n",
    "define('extensions/uv-seadragon-extension/Mode',[\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    var Mode = (function () {\r\n        function Mode(value) {\r\n            this.value = value;\r\n        }\r\n        Mode.prototype.toString = function () {\r\n            return this.value;\r\n        };\r\n        return Mode;\r\n    }());\r\n    Mode.image = new Mode(\"image\");\r\n    Mode.page = new Mode(\"page\");\r\n    exports.Mode = Mode;\r\n});\r\n//# sourceMappingURL=Mode.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-shared-module/ThumbsView',[\"require\", \"exports\", \"./BaseCommands\", \"./BaseView\"], function (require, exports, BaseCommands_1, BaseView_1) {\r\n    \"use strict\";\r\n    var ThumbsView = (function (_super) {\r\n        __extends(ThumbsView, _super);\r\n        function ThumbsView($element) {\r\n            var _this = _super.call(this, $element, true, true) || this;\r\n            _this.isCreated = false;\r\n            _this.isOpen = false;\r\n            return _this;\r\n        }\r\n        ThumbsView.prototype.create = function () {\r\n            var _this = this;\r\n            _super.prototype.create.call(this);\r\n            $.subscribe(BaseCommands_1.BaseCommands.CANVAS_INDEX_CHANGED, function (e, index) {\r\n                _this.selectIndex(parseInt(index));\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LOGIN, function () {\r\n                _this.loadThumbs();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.CLICKTHROUGH, function () {\r\n                _this.loadThumbs();\r\n            });\r\n            this.$thumbs = $('<div class=\"thumbs\"></div>');\r\n            this.$element.append(this.$thumbs);\r\n            this.$thumbs.addClass(this.extension.helper.getViewingDirection().toString()); // defaults to \"left-to-right\"\r\n            var that = this;\r\n            $.templates({\r\n                thumbsTemplate: '<div id=\"thumb{{>index}}\" class=\"{{:~className()}}\" data-src=\"{{>uri}}\" data-visible=\"{{>visible}}\" data-index=\"{{>index}}\">\\\r\n                                <div class=\"wrap\" style=\"height:{{>height + ~extraHeight()}}px\"></div>\\\r\n                                <div class=\"info\">\\\r\n                                    <span class=\"index\">{{:#index + 1}}</span>\\\r\n                                    <span class=\"label\" title=\"{{>label}}\">{{>label}}&nbsp;</span>\\\r\n                                    <span class=\"searchResults\" title=\"{{:~searchResultsTitle()}}\">{{>data.searchResults}}</span>\\\r\n                                </div>\\\r\n                             </div>\\\r\n                             {{if ~separator()}} \\\r\n                                 <div class=\"separator\"></div> \\\r\n                             {{/if}}'\r\n            });\r\n            var extraHeight = this.options.thumbsExtraHeight;\r\n            $.views.helpers({\r\n                separator: function () {\r\n                    return false;\r\n                },\r\n                extraHeight: function () {\r\n                    return extraHeight;\r\n                },\r\n                className: function () {\r\n                    var className = \"thumb\";\r\n                    if (this.data.index === 0) {\r\n                        className += \" first\";\r\n                    }\r\n                    if (!this.data.uri) {\r\n                        className += \" placeholder\";\r\n                    }\r\n                    var viewingDirection = that.extension.helper.getViewingDirection().toString();\r\n                    if (viewingDirection === manifesto.ViewingDirection.topToBottom().toString() || viewingDirection === manifesto.ViewingDirection.bottomToTop().toString()) {\r\n                        className += \" oneCol\";\r\n                    }\r\n                    else {\r\n                        className += \" twoCol\";\r\n                    }\r\n                    return className;\r\n                },\r\n                searchResultsTitle: function () {\r\n                    var searchResults = Number(this.data.data.searchResults);\r\n                    if (searchResults) {\r\n                        if (searchResults > 1) {\r\n                            return String.format(that.content.searchResults, searchResults);\r\n                        }\r\n                        return String.format(that.content.searchResult, searchResults);\r\n                    }\r\n                }\r\n            });\r\n            // use unevent to detect scroll stop.\r\n            this.$element.on('scroll', function () {\r\n                _this.scrollStop();\r\n            }, 100);\r\n            this.resize();\r\n        };\r\n        ThumbsView.prototype.databind = function () {\r\n            if (!this.thumbs)\r\n                return;\r\n            this._thumbsCache = null; // delete cache\r\n            this.createThumbs();\r\n            // do initial load to show padlocks\r\n            this.loadThumbs(0);\r\n            this.selectIndex(this.extension.helper.canvasIndex);\r\n        };\r\n        ThumbsView.prototype.createThumbs = function () {\r\n            var that = this;\r\n            if (!this.thumbs)\r\n                return;\r\n            // get median height\r\n            var heights = [];\r\n            for (var i = 0; i < this.thumbs.length; i++) {\r\n                var thumb = this.thumbs[i];\r\n                heights.push(thumb.height);\r\n            }\r\n            var medianHeight = Math.median(heights);\r\n            for (var i = 0; i < this.thumbs.length; i++) {\r\n                var thumb = this.thumbs[i];\r\n                thumb.height = medianHeight;\r\n            }\r\n            this.$thumbs.link($.templates.thumbsTemplate, this.thumbs);\r\n            this.$thumbs.undelegate('.thumb', 'click');\r\n            this.$thumbs.delegate(\".thumb\", \"click\", function (e) {\r\n                e.preventDefault();\r\n                var data = $.view(this).data;\r\n                that.lastThumbClickedIndex = data.index;\r\n                $.publish(BaseCommands_1.BaseCommands.THUMB_SELECTED, [data]);\r\n            });\r\n            this.setLabel();\r\n            this.isCreated = true;\r\n        };\r\n        ThumbsView.prototype.selectAll = function (selected) {\r\n        };\r\n        ThumbsView.prototype.scrollStop = function () {\r\n            var scrollPos = 1 / ((this.$thumbs.height() - this.$element.height()) / this.$element.scrollTop());\r\n            if (scrollPos > 1)\r\n                scrollPos = 1;\r\n            var thumbRangeMid = Math.floor((this.thumbs.length - 1) * scrollPos);\r\n            this.loadThumbs(thumbRangeMid);\r\n        };\r\n        ThumbsView.prototype.loadThumbs = function (index) {\r\n            if (!this.thumbs || !this.thumbs.length)\r\n                return;\r\n            if (_.isUndefined(index)) {\r\n                index = this.extension.helper.canvasIndex;\r\n            }\r\n            var thumbRangeMid = index;\r\n            var thumbLoadRange = this.options.thumbsLoadRange;\r\n            var thumbRange = {\r\n                start: (thumbRangeMid > thumbLoadRange) ? thumbRangeMid - thumbLoadRange : 0,\r\n                end: (thumbRangeMid < (this.thumbs.length - 1) - thumbLoadRange) ? thumbRangeMid + thumbLoadRange : this.thumbs.length - 1\r\n            };\r\n            //console.log('start: ' + thumbRange.start + ' end: ' + thumbRange.end);\r\n            var fadeDuration = this.options.thumbsImageFadeInDuration;\r\n            for (var i = thumbRange.start; i <= thumbRange.end; i++) {\r\n                var $thumb = this.getThumbByIndex(i);\r\n                var $wrap = $thumb.find('.wrap');\r\n                // if no img has been added yet\r\n                if (!$wrap.hasClass('loading') && !$wrap.hasClass('loaded')) {\r\n                    var visible = $thumb.attr('data-visible');\r\n                    if (visible !== \"false\") {\r\n                        $wrap.removeClass('loadingFailed');\r\n                        $wrap.addClass('loading');\r\n                        var src = $thumb.attr('data-src');\r\n                        src += '?t=' + Utils.Dates.getTimeStamp();\r\n                        //console.log(i, src);\r\n                        var img = $('<img src=\"' + src + '\" />');\r\n                        // fade in on load.\r\n                        $(img).hide().load(function () {\r\n                            $(this).fadeIn(fadeDuration, function () {\r\n                                $(this).parent().swapClass('loading', 'loaded');\r\n                            });\r\n                        }).error(function () {\r\n                            $(this).parent().swapClass('loading', 'loadingFailed');\r\n                        });\r\n                        $wrap.append(img);\r\n                    }\r\n                    else {\r\n                        $wrap.addClass('hidden');\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        ThumbsView.prototype.show = function () {\r\n            var _this = this;\r\n            this.isOpen = true;\r\n            this.$element.show();\r\n            setTimeout(function () {\r\n                _this.selectIndex(_this.extension.helper.canvasIndex);\r\n            }, 1);\r\n        };\r\n        ThumbsView.prototype.hide = function () {\r\n            this.isOpen = false;\r\n            this.$element.hide();\r\n        };\r\n        ThumbsView.prototype.isPDF = function () {\r\n            // todo: use constants\r\n            return (this.extension.helper.getElementType().toString().contains(\"pdf\"));\r\n        };\r\n        ThumbsView.prototype.setLabel = function () {\r\n            $(this.$thumbs).find('span.index').hide();\r\n            $(this.$thumbs).find('span.label').show();\r\n        };\r\n        ThumbsView.prototype.addSelectedClassToThumbs = function (index) {\r\n            this.getThumbByIndex(index).addClass('selected');\r\n        };\r\n        ThumbsView.prototype.selectIndex = function (index) {\r\n            // may be authenticating\r\n            if (index === -1)\r\n                return;\r\n            if (!this.thumbs || !this.thumbs.length)\r\n                return;\r\n            this.getAllThumbs().removeClass('selected');\r\n            this.$selectedThumb = this.getThumbByIndex(index);\r\n            this.addSelectedClassToThumbs(index);\r\n            var indices = this.extension.getPagedIndices(index);\r\n            // scroll to thumb if the index change didn't originate\r\n            // within the thumbs view.\r\n            if (!~indices.indexOf(this.lastThumbClickedIndex)) {\r\n                this.$element.scrollTop(this.$selectedThumb.position().top);\r\n            }\r\n            // make sure visible images are loaded.\r\n            this.loadThumbs(index);\r\n        };\r\n        ThumbsView.prototype.getAllThumbs = function () {\r\n            if (!this._thumbsCache) {\r\n                this._thumbsCache = this.$thumbs.find('.thumb');\r\n            }\r\n            return this._thumbsCache;\r\n        };\r\n        ThumbsView.prototype.getThumbByIndex = function (canvasIndex) {\r\n            return this.$thumbs.find('[data-index=\"' + canvasIndex + '\"]');\r\n        };\r\n        ThumbsView.prototype.scrollToThumb = function (canvasIndex) {\r\n            var $thumb = this.getThumbByIndex(canvasIndex);\r\n            this.$element.scrollTop($thumb.position().top);\r\n        };\r\n        ThumbsView.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n        };\r\n        return ThumbsView;\r\n    }(BaseView_1.BaseView));\r\n    exports.ThumbsView = ThumbsView;\r\n});\r\n//# sourceMappingURL=ThumbsView.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-contentleftpanel-module/ThumbsView',[\"require\", \"exports\", \"../uv-shared-module/ThumbsView\", \"../../extensions/uv-seadragon-extension/Commands\", \"../../extensions/uv-seadragon-extension/Mode\"], function (require, exports, ThumbsView_1, Commands_1, Mode_1) {\r\n    \"use strict\";\r\n    var ThumbsView = (function (_super) {\r\n        __extends(ThumbsView, _super);\r\n        function ThumbsView() {\r\n            return _super !== null && _super.apply(this, arguments) || this;\r\n        }\r\n        ThumbsView.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('contentLeftPanel');\r\n            _super.prototype.create.call(this);\r\n            // todo: this should be a setting\r\n            $.subscribe(Commands_1.Commands.MODE_CHANGED, function (e, mode) {\r\n                _this.setLabel();\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEARCH_PREVIEW_START, function (e, canvasIndex) {\r\n                _this.searchPreviewStart(canvasIndex);\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEARCH_PREVIEW_FINISH, function () {\r\n                _this.searchPreviewFinish();\r\n            });\r\n            if (this.extension.helper.isPaged()) {\r\n                this.$thumbs.addClass('paged');\r\n            }\r\n            var that = this;\r\n            $.views.helpers({\r\n                separator: function () {\r\n                    if (that.extension.helper.isVerticallyAligned()) {\r\n                        return true; // one thumb per line\r\n                    }\r\n                    // two thumbs per line\r\n                    if (that.extension.helper.isPaged()) {\r\n                        return ((this.data.index - 1) % 2 == 0) ? false : true;\r\n                    }\r\n                    return false;\r\n                }\r\n            });\r\n        };\r\n        ThumbsView.prototype.addSelectedClassToThumbs = function (index) {\r\n            if (this.extension.isPagingSettingEnabled()) {\r\n                var indices = this.extension.getPagedIndices(index);\r\n                for (var i = 0; i < indices.length; i++) {\r\n                    this.getThumbByIndex(indices[i]).addClass('selected');\r\n                }\r\n            }\r\n            else {\r\n                this.getThumbByIndex(index).addClass('selected');\r\n            }\r\n        };\r\n        ThumbsView.prototype.isPageModeEnabled = function () {\r\n            if (typeof this.extension.getMode === \"function\") {\r\n                return this.config.options.pageModeEnabled && this.extension.getMode().toString() === Mode_1.Mode.page.toString();\r\n            }\r\n            return this.config.options.pageModeEnabled;\r\n        };\r\n        ThumbsView.prototype.searchPreviewStart = function (canvasIndex) {\r\n            this.scrollToThumb(canvasIndex);\r\n            var $thumb = this.getThumbByIndex(canvasIndex);\r\n            $thumb.addClass('searchpreview');\r\n        };\r\n        ThumbsView.prototype.searchPreviewFinish = function () {\r\n            this.scrollToThumb(this.extension.helper.canvasIndex);\r\n            this.getAllThumbs().removeClass('searchpreview');\r\n        };\r\n        ThumbsView.prototype.setLabel = function () {\r\n            if (this.isPDF()) {\r\n                $(this.$thumbs).find('span.index').hide();\r\n                $(this.$thumbs).find('span.label').hide();\r\n            }\r\n            else {\r\n                if (this.isPageModeEnabled()) {\r\n                    $(this.$thumbs).find('span.index').hide();\r\n                    $(this.$thumbs).find('span.label').show();\r\n                }\r\n                else {\r\n                    $(this.$thumbs).find('span.index').show();\r\n                    $(this.$thumbs).find('span.label').hide();\r\n                }\r\n            }\r\n        };\r\n        return ThumbsView;\r\n    }(ThumbsView_1.ThumbsView));\r\n    exports.ThumbsView = ThumbsView;\r\n});\r\n//# sourceMappingURL=ThumbsView.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-contentleftpanel-module/TreeView',[\"require\", \"exports\", \"../uv-shared-module/BaseView\", \"../../extensions/uv-seadragon-extension/Commands\"], function (require, exports, BaseView_1, Commands_1) {\r\n    \"use strict\";\r\n    var TreeView = (function (_super) {\r\n        __extends(TreeView, _super);\r\n        function TreeView($element) {\r\n            var _this = _super.call(this, $element, true, true) || this;\r\n            _this.isOpen = false;\r\n            return _this;\r\n        }\r\n        TreeView.prototype.create = function () {\r\n            this.setConfig('contentLeftPanel');\r\n            _super.prototype.create.call(this);\r\n            this.$tree = $('<div class=\"iiif-tree-component\"></div>');\r\n            this.$element.append(this.$tree);\r\n        };\r\n        TreeView.prototype.setup = function () {\r\n            var that = this;\r\n            this.component = new IIIFComponents.TreeComponent({\r\n                target: this.$tree[0],\r\n                data: this.treeData\r\n            });\r\n            // todo: casting as <any> is necessary because IBaseComponent doesn't implement ITinyEmitter\r\n            // it is mixed-in a runtime. figure out how to add .on etc to IBaseComponent without needing\r\n            // to implement it in BaseComponent.\r\n            this.component.on('treeNodeSelected', function (args) {\r\n                var node = args[0];\r\n                $.publish(Commands_1.Commands.TREE_NODE_SELECTED, [node]);\r\n            });\r\n            this.component.on('treeNodeMultiSelected', function (args) {\r\n                var node = args[0];\r\n                $.publish(Commands_1.Commands.TREE_NODE_MULTISELECTED, [node]);\r\n            });\r\n        };\r\n        TreeView.prototype.databind = function () {\r\n            this.component.options.data = this.treeData;\r\n            this.component.set(null); // todo: should be passing options.data\r\n            this.resize();\r\n        };\r\n        TreeView.prototype.show = function () {\r\n            this.isOpen = true;\r\n            this.$element.show();\r\n        };\r\n        TreeView.prototype.hide = function () {\r\n            this.isOpen = false;\r\n            this.$element.hide();\r\n        };\r\n        TreeView.prototype.selectNode = function (node) {\r\n            this.component.selectNode(node);\r\n        };\r\n        TreeView.prototype.deselectCurrentNode = function () {\r\n            this.component.deselectCurrentNode();\r\n        };\r\n        TreeView.prototype.getNodeById = function (id) {\r\n            return this.component.getNodeById(id);\r\n        };\r\n        TreeView.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n        };\r\n        return TreeView;\r\n    }(BaseView_1.BaseView));\r\n    exports.TreeView = TreeView;\r\n});\r\n//# sourceMappingURL=TreeView.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-contentleftpanel-module/ContentLeftPanel',[\"require\", \"exports\", \"../uv-shared-module/BaseCommands\", \"../../extensions/uv-seadragon-extension/Commands\", \"./GalleryView\", \"../uv-shared-module/LeftPanel\", \"../uv-shared-module/Metrics\", \"../../extensions/uv-seadragon-extension/Mode\", \"./ThumbsView\", \"./TreeView\"], function (require, exports, BaseCommands_1, Commands_1, GalleryView_1, LeftPanel_1, Metrics_1, Mode_1, ThumbsView_1, TreeView_1) {\r\n    \"use strict\";\r\n    var ContentLeftPanel = (function (_super) {\r\n        __extends(ContentLeftPanel, _super);\r\n        function ContentLeftPanel($element) {\r\n            var _this = _super.call(this, $element) || this;\r\n            _this.expandFullEnabled = false;\r\n            _this.isThumbsViewOpen = false;\r\n            _this.isTreeViewOpen = false;\r\n            _this.treeSortType = Manifold.TreeSortType.NONE;\r\n            return _this;\r\n        }\r\n        ContentLeftPanel.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('contentLeftPanel');\r\n            _super.prototype.create.call(this);\r\n            var that = this;\r\n            $.subscribe(BaseCommands_1.BaseCommands.SETTINGS_CHANGED, function () {\r\n                _this.databind();\r\n            });\r\n            $.subscribe(Commands_1.Commands.GALLERY_THUMB_SELECTED, function () {\r\n                _this.collapseFull();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.METRIC_CHANGED, function () {\r\n                if (_this.extension.metric === Metrics_1.Metrics.MOBILE_LANDSCAPE) {\r\n                    if (_this.isFullyExpanded) {\r\n                        _this.collapseFull();\r\n                    }\r\n                }\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEARCH_RESULTS, function () {\r\n                _this.databindThumbsView();\r\n                _this.databindGalleryView();\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEARCH_RESULTS_CLEARED, function () {\r\n                _this.databindThumbsView();\r\n                _this.databindGalleryView();\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEARCH_RESULTS_EMPTY, function () {\r\n                _this.databindThumbsView();\r\n                _this.databindGalleryView();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.CANVAS_INDEX_CHANGED, function (e, index) {\r\n                if (_this.isFullyExpanded) {\r\n                    _this.collapseFull();\r\n                }\r\n                _this.selectCurrentTreeNode();\r\n                _this.updateTreeTabBySelection();\r\n            });\r\n            this.$tabs = $('<div class=\"tabs\"></div>');\r\n            this.$main.append(this.$tabs);\r\n            this.$treeButton = $('<a class=\"index tab\" tabindex=\"0\">' + this.content.index + '</a>');\r\n            this.$tabs.append(this.$treeButton);\r\n            this.$thumbsButton = $('<a class=\"thumbs tab\" tabindex=\"0\">' + this.content.thumbnails + '</a>');\r\n            this.$thumbsButton.prop('title', this.content.thumbnails);\r\n            this.$tabs.append(this.$thumbsButton);\r\n            this.$tabsContent = $('<div class=\"tabsContent\"></div>');\r\n            this.$main.append(this.$tabsContent);\r\n            this.$options = $('<div class=\"options\"></div>');\r\n            this.$tabsContent.append(this.$options);\r\n            this.$topOptions = $('<div class=\"top\"></div>');\r\n            this.$options.append(this.$topOptions);\r\n            this.$treeSelect = $('<select></select>');\r\n            this.$topOptions.append(this.$treeSelect);\r\n            this.$bottomOptions = $('<div class=\"bottom\"></div>');\r\n            this.$options.append(this.$bottomOptions);\r\n            this.$leftOptions = $('<div class=\"left\"></div>');\r\n            this.$bottomOptions.append(this.$leftOptions);\r\n            this.$rightOptions = $('<div class=\"right\"></div>');\r\n            this.$bottomOptions.append(this.$rightOptions);\r\n            this.$treeViewOptions = $('<div class=\"treeView\"></div>');\r\n            this.$leftOptions.append(this.$treeViewOptions);\r\n            this.$sortByLabel = $('<span class=\"sort\">' + this.content.sortBy + '</span>');\r\n            this.$treeViewOptions.append(this.$sortByLabel);\r\n            this.$sortButtonGroup = $('<div class=\"btn-group\"></div>');\r\n            this.$treeViewOptions.append(this.$sortButtonGroup);\r\n            this.$sortByDateButton = $('<button class=\"btn tabindex=\"0\"\">' + this.content.date + '</button>');\r\n            this.$sortButtonGroup.append(this.$sortByDateButton);\r\n            this.$sortByVolumeButton = $('<button class=\"btn\" tabindex=\"0\">' + this.content.volume + '</button>');\r\n            this.$sortButtonGroup.append(this.$sortByVolumeButton);\r\n            this.$views = $('<div class=\"views\"></div>');\r\n            this.$tabsContent.append(this.$views);\r\n            this.$treeView = $('<div class=\"treeView\"></div>');\r\n            this.$views.append(this.$treeView);\r\n            this.$thumbsView = $('<div class=\"thumbsView\" tabindex=\"0\"></div>');\r\n            this.$views.append(this.$thumbsView);\r\n            this.$galleryView = $('<div class=\"galleryView\"></div>');\r\n            this.$views.append(this.$galleryView);\r\n            this.$treeSelect.hide();\r\n            this.$treeSelect.change(function () {\r\n                _this.databindTreeView();\r\n                _this.selectCurrentTreeNode();\r\n                _this.updateTreeTabBySelection();\r\n            });\r\n            this.$sortByDateButton.on('click', function () {\r\n                _this.sortByDate();\r\n            });\r\n            this.$sortByVolumeButton.on('click', function () {\r\n                _this.sortByVolume();\r\n            });\r\n            this.$treeViewOptions.hide();\r\n            this.$treeButton.onPressed(function () {\r\n                _this.openTreeView();\r\n                $.publish(Commands_1.Commands.OPEN_TREE_VIEW);\r\n            });\r\n            this.$thumbsButton.onPressed(function () {\r\n                _this.openThumbsView();\r\n                $.publish(Commands_1.Commands.OPEN_THUMBS_VIEW);\r\n            });\r\n            this.setTitle(this.content.title);\r\n            this.$sortByVolumeButton.addClass('on');\r\n            var tabOrderConfig = this.options.tabOrder;\r\n            if (tabOrderConfig) {\r\n                // sort tabs\r\n                tabOrderConfig = tabOrderConfig.toLowerCase();\r\n                tabOrderConfig = tabOrderConfig.replace(/ /g, \"\");\r\n                var tabOrder = tabOrderConfig.split(',');\r\n                if (tabOrder[0] === 'thumbs') {\r\n                    this.$treeButton.before(this.$thumbsButton);\r\n                    this.$thumbsButton.addClass('first');\r\n                }\r\n                else {\r\n                    this.$treeButton.addClass('first');\r\n                }\r\n            }\r\n        };\r\n        ContentLeftPanel.prototype.createTreeView = function () {\r\n            this.treeView = new TreeView_1.TreeView(this.$treeView);\r\n            this.treeView.treeData = this.getTreeData();\r\n            this.treeView.setup();\r\n            this.databindTreeView();\r\n            // populate the tree select drop down when there are multiple top-level ranges\r\n            var topRanges = this.extension.helper.getTopRanges();\r\n            if (topRanges.length > 1) {\r\n                for (var i = 0; i < topRanges.length; i++) {\r\n                    var range = topRanges[i];\r\n                    this.$treeSelect.append('<option value=\"' + range.id + '\">' + Manifesto.TranslationCollection.getValue(range.getLabel()) + '</option>');\r\n                }\r\n            }\r\n            this.updateTreeViewOptions();\r\n        };\r\n        ContentLeftPanel.prototype.databind = function () {\r\n            this.databindThumbsView();\r\n            this.databindTreeView();\r\n            this.databindGalleryView();\r\n        };\r\n        ContentLeftPanel.prototype.updateTreeViewOptions = function () {\r\n            var treeData = this.getTree();\r\n            if (this.isCollection() && this.extension.helper.treeHasNavDates(treeData)) {\r\n                this.$treeViewOptions.show();\r\n            }\r\n            else {\r\n                this.$treeViewOptions.hide();\r\n            }\r\n            if (this.$treeSelect.find('option').length) {\r\n                this.$treeSelect.show();\r\n            }\r\n            else {\r\n                this.$treeSelect.hide();\r\n            }\r\n        };\r\n        ContentLeftPanel.prototype.sortByDate = function () {\r\n            this.treeSortType = Manifold.TreeSortType.DATE;\r\n            this.treeView.treeData = this.getTreeData();\r\n            this.treeView.databind();\r\n            this.selectCurrentTreeNode();\r\n            this.$sortByDateButton.addClass('on');\r\n            this.$sortByVolumeButton.removeClass('on');\r\n            this.resize();\r\n        };\r\n        ContentLeftPanel.prototype.sortByVolume = function () {\r\n            this.treeSortType = Manifold.TreeSortType.NONE;\r\n            this.treeView.treeData = this.getTreeData();\r\n            this.treeView.databind();\r\n            this.selectCurrentTreeNode();\r\n            this.$sortByDateButton.removeClass('on');\r\n            this.$sortByVolumeButton.addClass('on');\r\n            this.resize();\r\n        };\r\n        ContentLeftPanel.prototype.isCollection = function () {\r\n            var treeData = this.getTree();\r\n            return treeData.data.type === manifesto.TreeNodeType.collection().toString();\r\n        };\r\n        ContentLeftPanel.prototype.databindTreeView = function () {\r\n            if (!this.treeView)\r\n                return;\r\n            this.treeView.treeData = this.getTreeData();\r\n            this.treeView.databind();\r\n            this.selectCurrentTreeNode();\r\n        };\r\n        ContentLeftPanel.prototype.getTreeData = function () {\r\n            return {\r\n                branchNodesSelectable: false,\r\n                helper: this.extension.helper,\r\n                topRangeIndex: this.getSelectedTopRangeIndex(),\r\n                treeSortType: this.treeSortType\r\n            };\r\n        };\r\n        ContentLeftPanel.prototype.updateTreeTabByCanvasIndex = function () {\r\n            // update tab to current top range label (if there is one)\r\n            var topRanges = this.extension.helper.getTopRanges();\r\n            if (topRanges.length > 1) {\r\n                var index = this.getCurrentCanvasTopRangeIndex();\r\n                var currentRange = topRanges[index];\r\n                this.setTreeTabTitle(Manifesto.TranslationCollection.getValue(currentRange.getLabel()));\r\n            }\r\n            else {\r\n                this.setTreeTabTitle(this.content.index);\r\n            }\r\n        };\r\n        ContentLeftPanel.prototype.setTreeTabTitle = function (title) {\r\n            this.$treeButton.text(title);\r\n            this.$treeButton.prop('title', title);\r\n        };\r\n        ContentLeftPanel.prototype.updateTreeTabBySelection = function () {\r\n            var title;\r\n            var topRanges = this.extension.helper.getTopRanges();\r\n            if (topRanges.length > 1) {\r\n                if (this.treeView) {\r\n                    title = this.getSelectedTree().text();\r\n                }\r\n                else {\r\n                    title = Manifesto.TranslationCollection.getValue(topRanges[0].getLabel());\r\n                }\r\n            }\r\n            if (title) {\r\n                this.setTreeTabTitle(title);\r\n            }\r\n            else {\r\n                this.setTreeTabTitle(this.content.index);\r\n            }\r\n        };\r\n        ContentLeftPanel.prototype.getViewingDirection = function () {\r\n            return this.extension.helper.getViewingDirection();\r\n        };\r\n        ContentLeftPanel.prototype.createThumbsView = function () {\r\n            this.thumbsView = new ThumbsView_1.ThumbsView(this.$thumbsView);\r\n            this.databindThumbsView();\r\n        };\r\n        ContentLeftPanel.prototype.databindThumbsView = function () {\r\n            if (!this.thumbsView)\r\n                return;\r\n            var width, height;\r\n            var viewingDirection = this.getViewingDirection().toString();\r\n            if (viewingDirection === manifesto.ViewingDirection.topToBottom().toString() || viewingDirection === manifesto.ViewingDirection.bottomToTop().toString()) {\r\n                width = this.config.options.oneColThumbWidth;\r\n                height = this.config.options.oneColThumbHeight;\r\n            }\r\n            else {\r\n                width = this.config.options.twoColThumbWidth;\r\n                height = this.config.options.twoColThumbHeight;\r\n            }\r\n            var thumbs = this.extension.helper.getThumbs(width, height);\r\n            if (viewingDirection === manifesto.ViewingDirection.bottomToTop().toString()) {\r\n                thumbs.reverse();\r\n            }\r\n            // add a search result icon for pages with results\r\n            var searchResults = this.extension.searchResults;\r\n            if (searchResults && searchResults.length) {\r\n                for (var i = 0; i < searchResults.length; i++) {\r\n                    var searchResult = searchResults[i];\r\n                    // find the thumb with the same canvasIndex and add the searchResult\r\n                    var thumb = thumbs.en().where(function (t) { return t.index === searchResult.canvasIndex; }).first();\r\n                    // clone the data so searchResults isn't persisted on the canvas.\r\n                    var data = $.extend(true, {}, thumb.data);\r\n                    data.searchResults = searchResult.rects.length;\r\n                    thumb.data = data;\r\n                }\r\n            }\r\n            this.thumbsView.thumbs = thumbs;\r\n            this.thumbsView.databind();\r\n        };\r\n        ContentLeftPanel.prototype.createGalleryView = function () {\r\n            this.galleryView = new GalleryView_1.GalleryView(this.$galleryView);\r\n            this.galleryView.galleryData = this.getGalleryData();\r\n            this.galleryView.setup();\r\n            this.databindGalleryView();\r\n        };\r\n        ContentLeftPanel.prototype.databindGalleryView = function () {\r\n            if (!this.galleryView)\r\n                return;\r\n            this.galleryView.galleryData = this.getGalleryData();\r\n            this.galleryView.databind();\r\n        };\r\n        ContentLeftPanel.prototype.getGalleryData = function () {\r\n            return {\r\n                helper: this.extension.helper,\r\n                chunkedResizingThreshold: this.config.options.galleryThumbChunkedResizingThreshold,\r\n                content: this.config.content,\r\n                debug: false,\r\n                imageFadeInDuration: 300,\r\n                initialZoom: 6,\r\n                minLabelWidth: 20,\r\n                pageModeEnabled: this.isPageModeEnabled(),\r\n                scrollStopDuration: 100,\r\n                searchResults: this.extension.searchResults,\r\n                sizingEnabled: Modernizr.inputtypes.range,\r\n                thumbHeight: this.config.options.galleryThumbHeight,\r\n                thumbLoadPadding: this.config.options.galleryThumbLoadPadding,\r\n                thumbWidth: this.config.options.galleryThumbWidth,\r\n                viewingDirection: this.getViewingDirection()\r\n            };\r\n        };\r\n        ContentLeftPanel.prototype.isPageModeEnabled = function () {\r\n            // todo: checks if the panel is being used in the openseadragon extension.\r\n            // pass a `isPageModeEnabled` function to the panel's constructor instead?\r\n            if (typeof this.extension.getMode === \"function\") {\r\n                return Utils.Bools.getBool(this.config.options.pageModeEnabled, true) && this.extension.getMode().toString() === Mode_1.Mode.page.toString();\r\n            }\r\n            return Utils.Bools.getBool(this.config.options.pageModeEnabled, true);\r\n        };\r\n        ContentLeftPanel.prototype.getSelectedTree = function () {\r\n            return this.$treeSelect.find(':selected');\r\n        };\r\n        ContentLeftPanel.prototype.getSelectedTopRangeIndex = function () {\r\n            var topRangeIndex = this.getSelectedTree().index();\r\n            if (topRangeIndex === -1) {\r\n                topRangeIndex = 0;\r\n            }\r\n            return topRangeIndex;\r\n        };\r\n        ContentLeftPanel.prototype.getTree = function () {\r\n            var topRangeIndex = this.getSelectedTopRangeIndex();\r\n            return this.extension.helper.getTree(topRangeIndex, Manifold.TreeSortType.NONE);\r\n        };\r\n        ContentLeftPanel.prototype.toggleFinish = function () {\r\n            _super.prototype.toggleFinish.call(this);\r\n            if (this.isUnopened) {\r\n                var treeEnabled = Utils.Bools.getBool(this.config.options.treeEnabled, true);\r\n                var thumbsEnabled = Utils.Bools.getBool(this.config.options.thumbsEnabled, true);\r\n                var treeData = this.getTree();\r\n                if (!treeData || !treeData.nodes.length) {\r\n                    treeEnabled = false;\r\n                }\r\n                // hide the tabs if either tree or thumbs are disabled\r\n                if (!treeEnabled || !thumbsEnabled)\r\n                    this.$tabs.hide();\r\n                if (thumbsEnabled && this.defaultToThumbsView()) {\r\n                    this.openThumbsView();\r\n                }\r\n                else if (treeEnabled) {\r\n                    this.openTreeView();\r\n                }\r\n            }\r\n        };\r\n        ContentLeftPanel.prototype.defaultToThumbsView = function () {\r\n            var defaultToTreeEnabled = Utils.Bools.getBool(this.config.options.defaultToTreeEnabled, false);\r\n            var defaultToTreeIfGreaterThan = this.config.options.defaultToTreeIfGreaterThan || 0;\r\n            var treeData = this.getTree();\r\n            if (defaultToTreeEnabled) {\r\n                if (treeData.nodes.length > defaultToTreeIfGreaterThan) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        };\r\n        ContentLeftPanel.prototype.expandFullStart = function () {\r\n            _super.prototype.expandFullStart.call(this);\r\n            $.publish(BaseCommands_1.BaseCommands.LEFTPANEL_EXPAND_FULL_START);\r\n        };\r\n        ContentLeftPanel.prototype.expandFullFinish = function () {\r\n            _super.prototype.expandFullFinish.call(this);\r\n            if (this.$treeButton.hasClass('on')) {\r\n                this.openTreeView();\r\n            }\r\n            else if (this.$thumbsButton.hasClass('on')) {\r\n                this.openThumbsView();\r\n            }\r\n            $.publish(BaseCommands_1.BaseCommands.LEFTPANEL_EXPAND_FULL_FINISH);\r\n        };\r\n        ContentLeftPanel.prototype.collapseFullStart = function () {\r\n            _super.prototype.collapseFullStart.call(this);\r\n            $.publish(BaseCommands_1.BaseCommands.LEFTPANEL_COLLAPSE_FULL_START);\r\n        };\r\n        ContentLeftPanel.prototype.collapseFullFinish = function () {\r\n            _super.prototype.collapseFullFinish.call(this);\r\n            // todo: write a more generic tabs system with base tab class.\r\n            // thumbsView may not necessarily have been created yet.\r\n            // replace thumbsView with galleryView.\r\n            if (this.$thumbsButton.hasClass('on')) {\r\n                this.openThumbsView();\r\n            }\r\n            $.publish(BaseCommands_1.BaseCommands.LEFTPANEL_COLLAPSE_FULL_FINISH);\r\n        };\r\n        ContentLeftPanel.prototype.openTreeView = function () {\r\n            this.isTreeViewOpen = true;\r\n            this.isThumbsViewOpen = false;\r\n            if (!this.treeView) {\r\n                this.createTreeView();\r\n            }\r\n            this.$treeButton.addClass('on');\r\n            this.$thumbsButton.removeClass('on');\r\n            this.treeView.show();\r\n            if (this.thumbsView)\r\n                this.thumbsView.hide();\r\n            if (this.galleryView)\r\n                this.galleryView.hide();\r\n            this.updateTreeViewOptions();\r\n            this.selectCurrentTreeNode();\r\n            this.resize();\r\n            this.treeView.resize();\r\n        };\r\n        ContentLeftPanel.prototype.openThumbsView = function () {\r\n            this.isTreeViewOpen = false;\r\n            this.isThumbsViewOpen = true;\r\n            if (!this.thumbsView) {\r\n                this.createThumbsView();\r\n            }\r\n            if (this.isFullyExpanded && !this.galleryView) {\r\n                this.createGalleryView();\r\n            }\r\n            this.$treeButton.removeClass('on');\r\n            this.$thumbsButton.addClass('on');\r\n            if (this.treeView)\r\n                this.treeView.hide();\r\n            this.$treeSelect.hide();\r\n            this.$treeViewOptions.hide();\r\n            this.resize();\r\n            if (this.isFullyExpanded) {\r\n                this.thumbsView.hide();\r\n                if (this.galleryView)\r\n                    this.galleryView.show();\r\n                if (this.galleryView)\r\n                    this.galleryView.resize();\r\n            }\r\n            else {\r\n                if (this.galleryView)\r\n                    this.galleryView.hide();\r\n                this.thumbsView.show();\r\n                this.thumbsView.resize();\r\n            }\r\n        };\r\n        ContentLeftPanel.prototype.selectTopRangeIndex = function (index) {\r\n            this.$treeSelect.prop('selectedIndex', index);\r\n        };\r\n        ContentLeftPanel.prototype.getCurrentCanvasTopRangeIndex = function () {\r\n            var topRangeIndex = -1;\r\n            var range = this.extension.getCurrentCanvasRange();\r\n            if (range) {\r\n                topRangeIndex = Number(range.path.split('/')[0]);\r\n            }\r\n            return topRangeIndex;\r\n        };\r\n        ContentLeftPanel.prototype.selectCurrentTreeNode = function () {\r\n            if (this.treeView) {\r\n                var id;\r\n                var node;\r\n                var currentCanvasTopRangeIndex = this.getCurrentCanvasTopRangeIndex();\r\n                var selectedTopRangeIndex = this.getSelectedTopRangeIndex();\r\n                var usingCorrectTree = currentCanvasTopRangeIndex === selectedTopRangeIndex;\r\n                if (currentCanvasTopRangeIndex != -1) {\r\n                    var range = this.extension.getCurrentCanvasRange();\r\n                    if (range && range.treeNode) {\r\n                        node = this.treeView.getNodeById(range.treeNode.id);\r\n                    }\r\n                }\r\n                // use manifest root node\r\n                // if (!node){\r\n                //     id = this.extension.helper.manifest.defaultTree.id;\r\n                //     node = this.treeView.getNodeById(id);\r\n                // }\r\n                if (node && usingCorrectTree) {\r\n                    this.treeView.selectNode(node);\r\n                }\r\n                else {\r\n                    this.treeView.deselectCurrentNode();\r\n                }\r\n            }\r\n        };\r\n        ContentLeftPanel.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n            this.$tabsContent.height(this.$main.height() - (this.$tabs.is(':visible') ? this.$tabs.height() : 0) - this.$tabsContent.verticalPadding());\r\n            this.$views.height(this.$tabsContent.height() - this.$options.outerHeight());\r\n        };\r\n        return ContentLeftPanel;\r\n    }(LeftPanel_1.LeftPanel));\r\n    exports.ContentLeftPanel = ContentLeftPanel;\r\n});\r\n//# sourceMappingURL=ContentLeftPanel.js.map;\n",
    "define('modules/uv-shared-module/Point',[\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    var Point = (function () {\r\n        function Point(x, y) {\r\n            this.x = x;\r\n            this.y = y;\r\n        }\r\n        return Point;\r\n    }());\r\n    exports.Point = Point;\r\n});\r\n//# sourceMappingURL=Point.js.map;\n",
    "define('extensions/uv-seadragon-extension/CroppedImageDimensions',[\"require\", \"exports\", \"../../modules/uv-shared-module/Point\"], function (require, exports, Point_1) {\r\n    \"use strict\";\r\n    var Size = Utils.Measurements.Size;\r\n    var CroppedImageDimensions = (function () {\r\n        function CroppedImageDimensions() {\r\n            this.region = new Size(0, 0);\r\n            this.regionPos = new Point_1.Point(0, 0);\r\n            this.size = new Size(0, 0);\r\n        }\r\n        return CroppedImageDimensions;\r\n    }());\r\n    exports.CroppedImageDimensions = CroppedImageDimensions;\r\n});\r\n//# sourceMappingURL=CroppedImageDimensions.js.map;\n",
    "define('modules/uv-shared-module/DownloadOption',[\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    var DownloadOption = (function () {\r\n        function DownloadOption(value) {\r\n            this.value = value;\r\n        }\r\n        DownloadOption.prototype.toString = function () {\r\n            return this.value;\r\n        };\r\n        return DownloadOption;\r\n    }());\r\n    DownloadOption.currentViewAsJpg = new DownloadOption(\"currentViewAsJpg\");\r\n    DownloadOption.dynamicCanvasRenderings = new DownloadOption(\"dynamicCanvasRenderings\");\r\n    DownloadOption.dynamicImageRenderings = new DownloadOption(\"dynamicImageRenderings\");\r\n    DownloadOption.dynamicSequenceRenderings = new DownloadOption(\"dynamicSequenceRenderings\");\r\n    DownloadOption.entireFileAsOriginal = new DownloadOption(\"entireFileAsOriginal\");\r\n    DownloadOption.selection = new DownloadOption(\"selection\");\r\n    DownloadOption.wholeImageHighRes = new DownloadOption(\"wholeImageHighRes\");\r\n    DownloadOption.wholeImagesHighRes = new DownloadOption(\"wholeImagesHighRes\");\r\n    DownloadOption.wholeImageLowResAsJpg = new DownloadOption(\"wholeImageLowResAsJpg\");\r\n    exports.DownloadOption = DownloadOption;\r\n});\r\n//# sourceMappingURL=DownloadOption.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-dialogues-module/DownloadDialogue',[\"require\", \"exports\", \"../uv-shared-module/BaseCommands\", \"../uv-shared-module/Dialogue\", \"../uv-shared-module/DownloadOption\"], function (require, exports, BaseCommands_1, Dialogue_1, DownloadOption_1) {\r\n    \"use strict\";\r\n    var DownloadDialogue = (function (_super) {\r\n        __extends(DownloadDialogue, _super);\r\n        function DownloadDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        DownloadDialogue.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('downloadDialogue');\r\n            _super.prototype.create.call(this);\r\n            this.openCommand = BaseCommands_1.BaseCommands.SHOW_DOWNLOAD_DIALOGUE;\r\n            this.closeCommand = BaseCommands_1.BaseCommands.HIDE_DOWNLOAD_DIALOGUE;\r\n            $.subscribe(this.openCommand, function (e, $triggerButton) {\r\n                _this.open($triggerButton);\r\n            });\r\n            $.subscribe(this.closeCommand, function (e) {\r\n                _this.close();\r\n            });\r\n            // create ui.\r\n            this.$title = $('<h1>' + this.content.title + '</h1>');\r\n            this.$content.append(this.$title);\r\n            this.$noneAvailable = $('<div class=\"noneAvailable\">' + this.content.noneAvailable + '</div>');\r\n            this.$content.append(this.$noneAvailable);\r\n            this.$downloadOptions = $('<ol class=\"options\"></ol>');\r\n            this.$content.append(this.$downloadOptions);\r\n            this.$footer = $('<div class=\"footer\"></div>');\r\n            this.$content.append(this.$footer);\r\n            this.$termsOfUseButton = $('<a href=\"#\">' + this.extension.config.content.termsOfUse + '</a>');\r\n            this.$footer.append(this.$termsOfUseButton);\r\n            this.$termsOfUseButton.onPressed(function () {\r\n                $.publish(BaseCommands_1.BaseCommands.SHOW_TERMS_OF_USE);\r\n            });\r\n            // hide\r\n            this.$element.hide();\r\n            this.updateTermsOfUseButton();\r\n        };\r\n        DownloadDialogue.prototype.addEntireFileDownloadOptions = function () {\r\n            var _this = this;\r\n            if (this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.entireFileAsOriginal)) {\r\n                this.$downloadOptions.empty();\r\n                // add each file src\r\n                var canvas = this.extension.helper.getCurrentCanvas();\r\n                var renderingFound = false;\r\n                $.each(canvas.getRenderings(), function (index, rendering) {\r\n                    var renderingFormat = rendering.getFormat();\r\n                    var format = '';\r\n                    if (renderingFormat) {\r\n                        format = renderingFormat.toString();\r\n                    }\r\n                    _this.addEntireFileDownloadOption(rendering.id, Manifesto.TranslationCollection.getValue(rendering.getLabel()), format);\r\n                    renderingFound = true;\r\n                });\r\n                if (!renderingFound) {\r\n                    this.addEntireFileDownloadOption(canvas.id, null, null);\r\n                }\r\n            }\r\n        };\r\n        DownloadDialogue.prototype.addEntireFileDownloadOption = function (uri, label, format) {\r\n            if (label) {\r\n                label += \" ({0})\";\r\n            }\r\n            else {\r\n                label = this.content.entireFileAsOriginal;\r\n            }\r\n            var fileType;\r\n            if (format) {\r\n                fileType = Utils.Files.simplifyMimeType(format);\r\n            }\r\n            else {\r\n                fileType = this.getFileExtension(uri);\r\n            }\r\n            this.$downloadOptions.append('<li><a href=\"' + uri + '\" target=\"_blank\" download tabindex=\"0\">' + String.format(label, fileType) + '</li>');\r\n        };\r\n        DownloadDialogue.prototype.updateNoneAvailable = function () {\r\n            if (!this.$downloadOptions.find('li:visible').length) {\r\n                this.$noneAvailable.show();\r\n            }\r\n            else {\r\n                // select first option.\r\n                this.$noneAvailable.hide();\r\n            }\r\n        };\r\n        DownloadDialogue.prototype.updateTermsOfUseButton = function () {\r\n            var attribution = this.extension.helper.getAttribution(); // todo: this should eventually use a suitable IIIF 'terms' field.\r\n            if (Utils.Bools.getBool(this.extension.config.options.termsOfUseEnabled, false) && attribution) {\r\n                this.$termsOfUseButton.show();\r\n            }\r\n            else {\r\n                this.$termsOfUseButton.hide();\r\n            }\r\n        };\r\n        DownloadDialogue.prototype.getFileExtension = function (fileUri) {\r\n            return fileUri.split('.').pop();\r\n        };\r\n        DownloadDialogue.prototype.isDownloadOptionAvailable = function (option) {\r\n            switch (option) {\r\n                case DownloadOption_1.DownloadOption.entireFileAsOriginal:\r\n                    // check if ui-extensions disable it\r\n                    var uiExtensions = this.extension.helper.manifest.getService(manifesto.ServiceProfile.uiExtensions());\r\n                    if (!this.extension.helper.isUIEnabled('mediaDownload')) {\r\n                        return false;\r\n                    }\r\n            }\r\n            return true;\r\n        };\r\n        DownloadDialogue.prototype.close = function () {\r\n            _super.prototype.close.call(this);\r\n        };\r\n        DownloadDialogue.prototype.resize = function () {\r\n            this.setDockedPosition();\r\n        };\r\n        return DownloadDialogue;\r\n    }(Dialogue_1.Dialogue));\r\n    exports.DownloadDialogue = DownloadDialogue;\r\n});\r\n//# sourceMappingURL=DownloadDialogue.js.map;\n",
    "define('extensions/uv-seadragon-extension/DownloadType',[\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    var DownloadType = (function () {\r\n        function DownloadType() {\r\n        }\r\n        return DownloadType;\r\n    }());\r\n    DownloadType.CURRENTVIEW = \"currentView\";\r\n    DownloadType.ENTIREDOCUMENTASPDF = \"entireDocumentAsPdf\";\r\n    DownloadType.ENTIREDOCUMENTASTEXT = \"entireDocumentAsText\";\r\n    DownloadType.WHOLEIMAGEHIGHRES = \"wholeImageHighRes\";\r\n    DownloadType.WHOLEIMAGESHIGHRES = \"wholeImageHighRes\";\r\n    DownloadType.WHOLEIMAGELOWRES = \"wholeImageLowRes\";\r\n    DownloadType.UNKNOWN = \"unknown\";\r\n    exports.DownloadType = DownloadType;\r\n});\r\n//# sourceMappingURL=DownloadType.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('extensions/uv-seadragon-extension/DownloadDialogue',[\"require\", \"exports\", \"../../modules/uv-shared-module/BaseCommands\", \"../../modules/uv-dialogues-module/DownloadDialogue\", \"./Commands\", \"../../modules/uv-shared-module/DownloadOption\", \"./DownloadType\"], function (require, exports, BaseCommands_1, DownloadDialogue_1, Commands_1, DownloadOption_1, DownloadType_1) {\r\n    \"use strict\";\r\n    var Size = Utils.Measurements.Size;\r\n    var DownloadDialogue = (function (_super) {\r\n        __extends(DownloadDialogue, _super);\r\n        function DownloadDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        DownloadDialogue.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('downloadDialogue');\r\n            _super.prototype.create.call(this);\r\n            // create ui.\r\n            // this.$settingsButton = $('<a class=\"settings\" href=\"#\">' + this.content.editSettings + '</a>');\r\n            // this.$pagingNote = $('<div class=\"pagingNote\">' + this.content.pagingNote + ' </div>');\r\n            // this.$pagingNote.append(this.$settingsButton);\r\n            // this.$content.append(this.$pagingNote);\r\n            this.$imageOptionsContainer = $('<li class=\"group image\"></li>');\r\n            this.$downloadOptions.append(this.$imageOptionsContainer);\r\n            this.$imageOptions = $('<ul></ul>');\r\n            this.$imageOptionsContainer.append(this.$imageOptions);\r\n            this.$currentViewAsJpgButton = $('<li class=\"option single\"><input id=\"' + DownloadOption_1.DownloadOption.currentViewAsJpg.toString() + '\" type=\"radio\" name=\"downloadOptions\" tabindex=\"0\" /><label for=\"' + DownloadOption_1.DownloadOption.currentViewAsJpg.toString() + '\"></label></li>');\r\n            this.$imageOptions.append(this.$currentViewAsJpgButton);\r\n            this.$currentViewAsJpgButton.hide();\r\n            this.$wholeImageHighResButton = $('<li class=\"option single\"><input id=\"' + DownloadOption_1.DownloadOption.wholeImageHighRes.toString() + '\" type=\"radio\" name=\"downloadOptions\" tabindex=\"0\" /><label id=\"' + DownloadOption_1.DownloadOption.wholeImageHighRes.toString() + 'label\" for=\"' + DownloadOption_1.DownloadOption.wholeImageHighRes.toString() + '\"></label></li>');\r\n            this.$imageOptions.append(this.$wholeImageHighResButton);\r\n            this.$wholeImageHighResButton.hide();\r\n            this.$wholeImagesHighResButton = $('<li class=\"option multiple\"><input id=\"' + DownloadOption_1.DownloadOption.wholeImagesHighRes.toString() + '\" type=\"radio\" name=\"downloadOptions\" tabindex=\"0\" /><label id=\"' + DownloadOption_1.DownloadOption.wholeImagesHighRes.toString() + 'label\" for=\"' + DownloadOption_1.DownloadOption.wholeImagesHighRes.toString() + '\"></label></li>');\r\n            this.$imageOptions.append(this.$wholeImagesHighResButton);\r\n            this.$wholeImageHighResButton.hide();\r\n            this.$wholeImageLowResAsJpgButton = $('<li class=\"option single\"><input id=\"' + DownloadOption_1.DownloadOption.wholeImageLowResAsJpg.toString() + '\" type=\"radio\" name=\"downloadOptions\" tabindex=\"0\" /><label for=\"' + DownloadOption_1.DownloadOption.wholeImageLowResAsJpg.toString() + '\">' + this.content.wholeImageLowResAsJpg + '</label></li>');\r\n            this.$imageOptions.append(this.$wholeImageLowResAsJpgButton);\r\n            this.$wholeImageLowResAsJpgButton.hide();\r\n            this.$canvasOptionsContainer = $('<li class=\"group canvas\"></li>');\r\n            this.$downloadOptions.append(this.$canvasOptionsContainer);\r\n            this.$canvasOptions = $('<ul></ul>');\r\n            this.$canvasOptionsContainer.append(this.$canvasOptions);\r\n            this.$sequenceOptionsContainer = $('<li class=\"group sequence\"></li>');\r\n            this.$downloadOptions.append(this.$sequenceOptionsContainer);\r\n            this.$sequenceOptions = $('<ul></ul>');\r\n            this.$sequenceOptionsContainer.append(this.$sequenceOptions);\r\n            this.$selectionButton = $('<li class=\"option\"><input id=\"' + DownloadOption_1.DownloadOption.selection.toString() + '\" type=\"radio\" name=\"downloadOptions\" tabindex=\"0\" /><label id=\"' + DownloadOption_1.DownloadOption.selection.toString() + 'label\" for=\"' + DownloadOption_1.DownloadOption.selection.toString() + '\"></label></li>');\r\n            this.$sequenceOptions.append(this.$selectionButton);\r\n            this.$selectionButton.hide();\r\n            this.$buttonsContainer = $('<div class=\"buttons\"></div>');\r\n            this.$content.append(this.$buttonsContainer);\r\n            this.$downloadButton = $('<a class=\"btn btn-primary\" href=\"#\" tabindex=\"0\">' + this.content.download + '</a>');\r\n            this.$buttonsContainer.append(this.$downloadButton);\r\n            this.$explanatoryTextTemplate = $('<span class=\"explanatory\"></span>');\r\n            var that = this;\r\n            this.$downloadButton.on('click', function (e) {\r\n                e.preventDefault();\r\n                var $selectedOption = that.getSelectedOption();\r\n                var id = $selectedOption.attr('id');\r\n                var label = $selectedOption.attr('title');\r\n                var mime = $selectedOption.data('mime');\r\n                var type = DownloadType_1.DownloadType.UNKNOWN;\r\n                var canvas = _this.extension.helper.getCurrentCanvas();\r\n                if (_this.renderingUrls[id]) {\r\n                    if (mime) {\r\n                        if (mime.toLowerCase().indexOf('pdf') !== -1) {\r\n                            type = DownloadType_1.DownloadType.ENTIREDOCUMENTASPDF;\r\n                        }\r\n                        else if (mime.toLowerCase().indexOf('txt') !== -1) {\r\n                            type = DownloadType_1.DownloadType.ENTIREDOCUMENTASTEXT;\r\n                        }\r\n                    }\r\n                    if (type = DownloadType_1.DownloadType.ENTIREDOCUMENTASPDF) {\r\n                        //var printService: Manifesto.IService = this.extension.helper.manifest.getService(manifesto.ServiceProfile.printExtensions());\r\n                        // if downloading a pdf - if there's a print service, generate an event instead of opening a new window.\r\n                        // if (printService && this.extension.isOnHomeDomain()){\r\n                        //     $.publish(Commands.PRINT);\r\n                        // } else {\r\n                        window.open(_this.renderingUrls[id]);\r\n                    }\r\n                }\r\n                else {\r\n                    switch (id) {\r\n                        case DownloadOption_1.DownloadOption.currentViewAsJpg.toString():\r\n                            var viewer = that.extension.getViewer();\r\n                            window.open(that.extension.getCroppedImageUri(canvas, viewer));\r\n                            type = DownloadType_1.DownloadType.CURRENTVIEW;\r\n                            break;\r\n                        case DownloadOption_1.DownloadOption.selection.toString():\r\n                            Utils.Async.waitFor(function () {\r\n                                return !_this.isActive;\r\n                            }, function () {\r\n                                $.publish(Commands_1.Commands.SHOW_MULTISELECT_DIALOGUE);\r\n                            });\r\n                            break;\r\n                        case DownloadOption_1.DownloadOption.wholeImageHighRes.toString():\r\n                            window.open(_this.getCanvasHighResImageUri(_this.extension.helper.getCurrentCanvas()));\r\n                            type = DownloadType_1.DownloadType.WHOLEIMAGEHIGHRES;\r\n                            break;\r\n                        case DownloadOption_1.DownloadOption.wholeImagesHighRes.toString():\r\n                            var indices = _this.extension.getPagedIndices();\r\n                            for (var i = 0; i < indices.length; i++) {\r\n                                window.open(_this.getCanvasHighResImageUri(_this.extension.helper.getCanvasByIndex(indices[i])));\r\n                            }\r\n                            type = DownloadType_1.DownloadType.WHOLEIMAGESHIGHRES;\r\n                            break;\r\n                        case DownloadOption_1.DownloadOption.wholeImageLowResAsJpg.toString():\r\n                            window.open(that.extension.getConfinedImageUri(canvas, that.options.confinedImageSize));\r\n                            type = DownloadType_1.DownloadType.WHOLEIMAGELOWRES;\r\n                            break;\r\n                    }\r\n                }\r\n                $.publish(BaseCommands_1.BaseCommands.DOWNLOAD, [{\r\n                        \"type\": type,\r\n                        \"label\": label\r\n                    }]);\r\n                _this.close();\r\n            });\r\n            // this.$settingsButton.onPressed(() => {\r\n            //     $.publish(BaseCommands.HIDE_DOWNLOAD_DIALOGUE);\r\n            //     $.publish(BaseCommands.SHOW_SETTINGS_DIALOGUE);\r\n            // });\r\n        };\r\n        DownloadDialogue.prototype.open = function ($triggerButton) {\r\n            _super.prototype.open.call(this, $triggerButton);\r\n            var canvas = this.extension.helper.getCurrentCanvas();\r\n            var rotation = this.extension.getViewerRotation();\r\n            var hasNormalDimensions = rotation % 180 == 0;\r\n            if (this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.currentViewAsJpg)) {\r\n                var $input = this.$currentViewAsJpgButton.find('input');\r\n                var $label = this.$currentViewAsJpgButton.find('label');\r\n                var label = this.content.currentViewAsJpg;\r\n                var viewer = this.extension.getViewer();\r\n                var dimensions = this.extension.getCroppedImageDimensions(canvas, viewer);\r\n                // dimensions\r\n                if (dimensions) {\r\n                    label = hasNormalDimensions ?\r\n                        String.format(label, dimensions.size.width, dimensions.size.height) :\r\n                        String.format(label, dimensions.size.height, dimensions.size.width);\r\n                    $label.text(label);\r\n                    $input.prop('title', label);\r\n                    this.$currentViewAsJpgButton.data('width', dimensions.size.width);\r\n                    this.$currentViewAsJpgButton.data('height', dimensions.size.height);\r\n                    this.$currentViewAsJpgButton.show();\r\n                }\r\n                else {\r\n                    this.$currentViewAsJpgButton.hide();\r\n                }\r\n                // explanatory text\r\n                if (Utils.Bools.getBool(this.options.optionsExplanatoryTextEnabled, false)) {\r\n                    var text = this.content.currentViewAsJpgExplanation;\r\n                    if (text) {\r\n                        var $span = this.$explanatoryTextTemplate.clone();\r\n                        $span.text(text);\r\n                        $label.append($span);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                this.$currentViewAsJpgButton.hide();\r\n            }\r\n            if (this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.wholeImageHighRes)) {\r\n                var $input = this.$wholeImageHighResButton.find('input');\r\n                var $label = this.$wholeImageHighResButton.find('label');\r\n                var mime = this.getCanvasMimeType(this.extension.helper.getCurrentCanvas());\r\n                if (mime) {\r\n                    mime = Utils.Files.simplifyMimeType(mime);\r\n                }\r\n                else {\r\n                    mime = '?';\r\n                }\r\n                // dimensions\r\n                var size = this.getCanvasComputedDimensions(this.extension.helper.getCurrentCanvas());\r\n                if (!size) {\r\n                    this.$wholeImageHighResButton.hide();\r\n                }\r\n                else {\r\n                    var label = hasNormalDimensions ?\r\n                        String.format(this.content.wholeImageHighRes, size.width, size.height, mime) :\r\n                        String.format(this.content.wholeImageHighRes, size.height, size.width, mime);\r\n                    $label.text(label);\r\n                    $input.prop('title', label);\r\n                    this.$wholeImageHighResButton.data('width', size.width);\r\n                    this.$wholeImageHighResButton.data('height', size.height);\r\n                    this.$wholeImageHighResButton.show();\r\n                }\r\n                // explanatory text\r\n                if (Utils.Bools.getBool(this.options.optionsExplanatoryTextEnabled, false)) {\r\n                    var text = this.content.wholeImageHighResExplanation;\r\n                    if (text) {\r\n                        var $span = this.$explanatoryTextTemplate.clone();\r\n                        $span.text(text);\r\n                        $label.append($span);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                this.$wholeImageHighResButton.hide();\r\n            }\r\n            if (this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.wholeImagesHighRes)) {\r\n                var $input = this.$wholeImagesHighResButton.find('input');\r\n                var $label = this.$wholeImagesHighResButton.find('label');\r\n                var mime = this.getCanvasMimeType(this.extension.helper.getCurrentCanvas());\r\n                if (mime) {\r\n                    mime = Utils.Files.simplifyMimeType(mime);\r\n                }\r\n                else {\r\n                    mime = '?';\r\n                }\r\n                var label = String.format(this.content.wholeImagesHighRes, mime);\r\n                $label.text(label);\r\n                $input.prop('title', label);\r\n                this.$wholeImagesHighResButton.show();\r\n                // explanatory text\r\n                if (Utils.Bools.getBool(this.options.optionsExplanatoryTextEnabled, false)) {\r\n                    var text = this.content.wholeImagesHighResExplanation;\r\n                    if (text) {\r\n                        var $span = this.$explanatoryTextTemplate.clone();\r\n                        $span.text(text);\r\n                        $label.append($span);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                this.$wholeImagesHighResButton.hide();\r\n            }\r\n            if (this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.wholeImageLowResAsJpg)) {\r\n                var $input = this.$wholeImageLowResAsJpgButton.find('input');\r\n                var $label = this.$wholeImageLowResAsJpgButton.find('label');\r\n                var size = this.extension.getConfinedImageDimensions(canvas, this.options.confinedImageSize);\r\n                var label = hasNormalDimensions ?\r\n                    String.format(this.content.wholeImageLowResAsJpg, size.width, size.height) :\r\n                    String.format(this.content.wholeImageLowResAsJpg, size.height, size.width);\r\n                $label.text(label);\r\n                $input.prop('title', label);\r\n                this.$wholeImageLowResAsJpgButton.data('width', size.width);\r\n                this.$wholeImageLowResAsJpgButton.data('height', size.height);\r\n                this.$wholeImageLowResAsJpgButton.show();\r\n                // explanatory text\r\n                if (Utils.Bools.getBool(this.options.optionsExplanatoryTextEnabled, false)) {\r\n                    var text = this.content.wholeImageLowResAsJpgExplanation;\r\n                    if (text) {\r\n                        var $span = this.$explanatoryTextTemplate.clone();\r\n                        $span.text(text);\r\n                        $label.append($span);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                this.$wholeImageLowResAsJpgButton.hide();\r\n            }\r\n            if (this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.selection)) {\r\n                var $input = this.$selectionButton.find('input');\r\n                var $label = this.$selectionButton.find('label');\r\n                $label.text(this.content.downloadSelection);\r\n                $input.prop('title', this.content.downloadSelection);\r\n                this.$selectionButton.show();\r\n                // explanatory text\r\n                if (Utils.Bools.getBool(this.options.optionsExplanatoryTextEnabled, false)) {\r\n                    var text = this.content.selectionExplanation;\r\n                    if (text) {\r\n                        var $span = this.$explanatoryTextTemplate.clone();\r\n                        $span.text(text);\r\n                        $label.append($span);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                this.$selectionButton.hide();\r\n            }\r\n            this.resetDynamicDownloadOptions();\r\n            if (this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.dynamicImageRenderings)) {\r\n                var images = canvas.getImages();\r\n                for (var i = 0; i < images.length; i++) {\r\n                    this.addDownloadOptionsForRenderings(images[i].getResource(), this.content.entireFileAsOriginal, DownloadOption_1.DownloadOption.dynamicImageRenderings);\r\n                }\r\n            }\r\n            if (this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.dynamicCanvasRenderings)) {\r\n                this.addDownloadOptionsForRenderings(canvas, this.content.entireFileAsOriginal, DownloadOption_1.DownloadOption.dynamicCanvasRenderings);\r\n            }\r\n            if (this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.dynamicSequenceRenderings)) {\r\n                this.addDownloadOptionsForRenderings(this.extension.helper.getCurrentSequence(), this.content.entireDocument, DownloadOption_1.DownloadOption.dynamicSequenceRenderings);\r\n            }\r\n            // hide the current view option if it's equivalent to whole image.\r\n            if (this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.currentViewAsJpg)) {\r\n                var currentWidth = parseInt(this.$currentViewAsJpgButton.data('width').toString());\r\n                var currentHeight = parseInt(this.$currentViewAsJpgButton.data('height').toString());\r\n                var wholeWidth = parseInt(this.$wholeImageHighResButton.data('width').toString());\r\n                var wholeHeight = parseInt(this.$wholeImageHighResButton.data('height').toString());\r\n                var percentageWidth = (currentWidth / wholeWidth) * 100;\r\n                var percentageHeight = (currentHeight / wholeHeight) * 100;\r\n                var disabledPercentage = this.options.currentViewDisabledPercentage;\r\n                // if over disabledPercentage of the size of whole image\r\n                if (percentageWidth >= disabledPercentage && percentageHeight >= disabledPercentage) {\r\n                    this.$currentViewAsJpgButton.hide();\r\n                }\r\n                else {\r\n                    this.$currentViewAsJpgButton.show();\r\n                }\r\n            }\r\n            // order by image area\r\n            var $options = this.$imageOptions.find('li.single');\r\n            $options = $options.sort(function (a, b) {\r\n                var aWidth = $(a).data('width');\r\n                aWidth ? aWidth = parseInt(aWidth.toString()) : 0;\r\n                var aHeight = $(a).data('height');\r\n                aHeight ? aHeight = parseInt(aHeight.toString()) : 0;\r\n                var bWidth = $(b).data('width');\r\n                bWidth ? bWidth = parseInt(bWidth.toString()) : 0;\r\n                var bHeight = $(b).data('height');\r\n                bHeight ? bHeight = parseInt(bHeight.toString()) : 0;\r\n                var aArea = aWidth * aHeight;\r\n                var bArea = bWidth * bHeight;\r\n                if (aArea < bArea) {\r\n                    return -1;\r\n                }\r\n                if (aArea > bArea) {\r\n                    return 1;\r\n                }\r\n                return 0;\r\n            });\r\n            $options.detach().appendTo(this.$imageOptions);\r\n            // hide empty groups\r\n            var $groups = this.$downloadOptions.find('li.group');\r\n            $groups.each(function (index, group) {\r\n                var $group = $(group);\r\n                $group.show();\r\n                if ($group.find('li.option:hidden').length === $group.find('li.option').length) {\r\n                    // all options are hidden, hide group.\r\n                    $group.hide();\r\n                }\r\n            });\r\n            this.$downloadOptions.find('li.group:visible').last().addClass('lastVisible');\r\n            if (!this.$downloadOptions.find('li.option:visible').length) {\r\n                this.$noneAvailable.show();\r\n                this.$downloadButton.hide();\r\n            }\r\n            else {\r\n                // select first option.\r\n                this.$downloadOptions.find('li.option input:visible:first').prop(\"checked\", true);\r\n                this.$noneAvailable.hide();\r\n                this.$downloadButton.show();\r\n            }\r\n            this.resize();\r\n        };\r\n        DownloadDialogue.prototype.resetDynamicDownloadOptions = function () {\r\n            this.renderingUrls = [];\r\n            this.renderingUrlsCount = 0;\r\n            this.$downloadOptions.find('li.dynamic').remove();\r\n        };\r\n        DownloadDialogue.prototype.addDownloadOptionsForRenderings = function (resource, defaultLabel, type) {\r\n            var renderings = resource.getRenderings();\r\n            for (var i = 0; i < renderings.length; i++) {\r\n                var rendering = renderings[i];\r\n                if (rendering) {\r\n                    var label = Manifesto.TranslationCollection.getValue(rendering.getLabel());\r\n                    var currentId = \"downloadOption\" + ++this.renderingUrlsCount;\r\n                    if (label) {\r\n                        label += \" ({0})\";\r\n                    }\r\n                    else {\r\n                        label = defaultLabel;\r\n                    }\r\n                    var mime = Utils.Files.simplifyMimeType(rendering.getFormat().toString());\r\n                    label = String.format(label, mime);\r\n                    this.renderingUrls[currentId] = rendering.id;\r\n                    var $button = $('<li class=\"option dynamic\"><input id=\"' + currentId + '\" data-mime=\"' + mime + '\" title=\"' + label + '\" type=\"radio\" name=\"downloadOptions\" tabindex=\"0\" /><label for=\"' + currentId + '\">' + label + '</label></li>');\r\n                    switch (type) {\r\n                        case DownloadOption_1.DownloadOption.dynamicImageRenderings:\r\n                            this.$imageOptions.append($button);\r\n                            break;\r\n                        case DownloadOption_1.DownloadOption.dynamicCanvasRenderings:\r\n                            this.$canvasOptions.append($button);\r\n                            break;\r\n                        case DownloadOption_1.DownloadOption.dynamicSequenceRenderings:\r\n                            this.$sequenceOptions.append($button);\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        DownloadDialogue.prototype.getSelectedOption = function () {\r\n            return this.$downloadOptions.find(\"li.option input:checked\");\r\n        };\r\n        DownloadDialogue.prototype.getCanvasImageResource = function (canvas) {\r\n            var images = canvas.getImages();\r\n            if (images[0]) {\r\n                return images[0].getResource();\r\n            }\r\n            return null;\r\n        };\r\n        DownloadDialogue.prototype.getCanvasHighResImageUri = function (canvas) {\r\n            var size = this.getCanvasComputedDimensions(canvas);\r\n            if (size) {\r\n                var width = size.width;\r\n                var uri = canvas.getCanonicalImageUri(width);\r\n                var uri_parts = uri.split('/');\r\n                var rotation = this.extension.getViewerRotation();\r\n                uri_parts[uri_parts.length - 2] = String(rotation);\r\n                uri = uri_parts.join('/');\r\n                return uri;\r\n            }\r\n            return '';\r\n        };\r\n        DownloadDialogue.prototype.getCanvasMimeType = function (canvas) {\r\n            var resource = this.getCanvasImageResource(canvas);\r\n            var format = resource.getFormat();\r\n            if (format) {\r\n                return format.toString();\r\n            }\r\n            return null;\r\n        };\r\n        DownloadDialogue.prototype.getCanvasDimensions = function (canvas) {\r\n            // externalResource may not have loaded yet\r\n            if (canvas.externalResource.data) {\r\n                return new Size(canvas.externalResource.data.width, canvas.externalResource.data.height);\r\n            }\r\n            return new Size(0, 0);\r\n        };\r\n        DownloadDialogue.prototype.getCanvasMaxDimensions = function (canvas) {\r\n            if (canvas.externalResource.data && canvas.externalResource.data.profile[1]) {\r\n                return new Size(canvas.externalResource.data.profile[1].maxWidth, canvas.externalResource.data.profile[1].maxHeight);\r\n            }\r\n            return null;\r\n        };\r\n        DownloadDialogue.prototype.getCanvasComputedDimensions = function (canvas) {\r\n            var size = this.getCanvasDimensions(canvas);\r\n            var maxSize = this.getCanvasMaxDimensions(canvas);\r\n            if (!maxSize)\r\n                return null;\r\n            var finalWidth = size.width;\r\n            var finalHeight = size.height;\r\n            // if the maxWidth is less than the advertised width\r\n            if (!_.isUndefined(maxSize.width) && maxSize.width < size.width) {\r\n                finalWidth = maxSize.width;\r\n                if (!_.isUndefined(maxSize.height)) {\r\n                    finalHeight = maxSize.height;\r\n                }\r\n                else {\r\n                    // calculate finalHeight\r\n                    var ratio = Math.normalise(maxSize.width, 0, size.width);\r\n                    finalHeight = Math.floor(size.height * ratio);\r\n                }\r\n            }\r\n            return new Size(finalWidth, finalHeight);\r\n        };\r\n        DownloadDialogue.prototype.isDownloadOptionAvailable = function (option) {\r\n            switch (option) {\r\n                case DownloadOption_1.DownloadOption.currentViewAsJpg:\r\n                case DownloadOption_1.DownloadOption.dynamicCanvasRenderings:\r\n                case DownloadOption_1.DownloadOption.dynamicImageRenderings:\r\n                case DownloadOption_1.DownloadOption.wholeImageHighRes:\r\n                    // if in one-up mode, or in two-up mode with a single page being shown\r\n                    if (!this.extension.isPagingSettingEnabled() ||\r\n                        this.extension.isPagingSettingEnabled() && this.extension.resources && this.extension.resources.length === 1) {\r\n                        var maxSize = this.getCanvasMaxDimensions(this.extension.helper.getCurrentCanvas());\r\n                        if (maxSize) {\r\n                            if (_.isUndefined(maxSize.width)) {\r\n                                return true;\r\n                            }\r\n                            else if (maxSize.width <= this.options.maxImageWidth) {\r\n                                return true;\r\n                            }\r\n                        }\r\n                    }\r\n                    return false;\r\n                case DownloadOption_1.DownloadOption.wholeImagesHighRes:\r\n                    if (this.extension.isPagingSettingEnabled() && this.extension.resources && this.extension.resources.length > 1) {\r\n                        return true;\r\n                    }\r\n                    return false;\r\n                case DownloadOption_1.DownloadOption.wholeImageLowResAsJpg:\r\n                    // hide low-res option if hi-res width is smaller than constraint\r\n                    var size = this.getCanvasComputedDimensions(this.extension.helper.getCurrentCanvas());\r\n                    if (!size)\r\n                        return false;\r\n                    return (!this.extension.isPagingSettingEnabled() && (size.width > this.options.confinedImageSize));\r\n                case DownloadOption_1.DownloadOption.selection:\r\n                    return this.options.selectionEnabled;\r\n                default:\r\n                    return _super.prototype.isDownloadOptionAvailable.call(this, option);\r\n            }\r\n        };\r\n        return DownloadDialogue;\r\n    }(DownloadDialogue_1.DownloadDialogue));\r\n    exports.DownloadDialogue = DownloadDialogue;\r\n});\r\n//# sourceMappingURL=DownloadDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-dialogues-module/ExternalContentDialogue',[\"require\", \"exports\", \"../uv-shared-module/BaseCommands\", \"../uv-shared-module/Dialogue\"], function (require, exports, BaseCommands_1, Dialogue_1) {\r\n    \"use strict\";\r\n    var ExternalContentDialogue = (function (_super) {\r\n        __extends(ExternalContentDialogue, _super);\r\n        function ExternalContentDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        ExternalContentDialogue.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('externalContentDialogue');\r\n            _super.prototype.create.call(this);\r\n            this.openCommand = BaseCommands_1.BaseCommands.SHOW_EXTERNALCONTENT_DIALOGUE;\r\n            this.closeCommand = BaseCommands_1.BaseCommands.HIDE_EXTERNALCONTENT_DIALOGUE;\r\n            $.subscribe(this.openCommand, function (e, params) {\r\n                _this.open();\r\n                _this.$iframe.prop('src', params.uri);\r\n            });\r\n            $.subscribe(this.closeCommand, function (e) {\r\n                _this.close();\r\n            });\r\n            this.$iframe = $('<iframe></iframe>');\r\n            this.$content.append(this.$iframe);\r\n            this.$element.hide();\r\n        };\r\n        ExternalContentDialogue.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n            this.$iframe.width(this.$content.width());\r\n            this.$iframe.height(this.$content.height());\r\n        };\r\n        return ExternalContentDialogue;\r\n    }(Dialogue_1.Dialogue));\r\n    exports.ExternalContentDialogue = ExternalContentDialogue;\r\n});\r\n//# sourceMappingURL=ExternalContentDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-shared-module/FooterPanel',[\"require\", \"exports\", \"./BaseCommands\", \"./BaseView\", \"./Metrics\"], function (require, exports, BaseCommands_1, BaseView_1, Metrics_1) {\r\n    \"use strict\";\r\n    var FooterPanel = (function (_super) {\r\n        __extends(FooterPanel, _super);\r\n        function FooterPanel($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        FooterPanel.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('footerPanel');\r\n            _super.prototype.create.call(this);\r\n            $.subscribe(BaseCommands_1.BaseCommands.TOGGLE_FULLSCREEN, function () {\r\n                _this.updateFullScreenButton();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.METRIC_CHANGED, function () {\r\n                _this.updateMinimisedButtons();\r\n                _this.updateMoreInfoButton();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.SETTINGS_CHANGED, function () {\r\n                _this.updateDownloadButton();\r\n            });\r\n            this.$options = $('<div class=\"options\"></div>');\r\n            this.$element.append(this.$options);\r\n            this.$feedbackButton = $('<a class=\"feedback\" title=\"' + this.content.feedback + '\" tabindex=\"0\">' + this.content.feedback + '</a>');\r\n            this.$options.prepend(this.$feedbackButton);\r\n            this.$openButton = $('<a class=\"open\" title=\"' + this.content.open + '\" tabindex=\"0\">' + this.content.open + '</a>');\r\n            this.$options.prepend(this.$openButton);\r\n            this.$bookmarkButton = $('<a class=\"bookmark\" title=\"' + this.content.bookmark + '\" tabindex=\"0\">' + this.content.bookmark + '</a>');\r\n            this.$options.prepend(this.$bookmarkButton);\r\n            this.$shareButton = $('<a href=\"#\" class=\"share\" title=\"' + this.content.share + '\" tabindex=\"0\">' + this.content.share + '</a>');\r\n            this.$options.append(this.$shareButton);\r\n            this.$embedButton = $('<a href=\"#\" class=\"embed\" title=\"' + this.content.embed + '\" tabindex=\"0\">' + this.content.embed + '</a>');\r\n            this.$options.append(this.$embedButton);\r\n            this.$downloadButton = $('<a class=\"download\" title=\"' + this.content.download + '\" tabindex=\"0\">' + this.content.download + '</a>');\r\n            this.$options.prepend(this.$downloadButton);\r\n            this.$moreInfoButton = $('<a href=\"#\" class=\"moreInfo\" title=\"' + this.content.moreInfo + '\" tabindex=\"0\">' + this.content.moreInfo + '</a>');\r\n            this.$options.prepend(this.$moreInfoButton);\r\n            this.$fullScreenBtn = $('<a href=\"#\" class=\"fullScreen\" title=\"' + this.content.fullScreen + '\" tabindex=\"0\">' + this.content.fullScreen + '</a>');\r\n            this.$options.append(this.$fullScreenBtn);\r\n            this.$openButton.onPressed(function () {\r\n                $.publish(BaseCommands_1.BaseCommands.OPEN);\r\n            });\r\n            this.$feedbackButton.onPressed(function () {\r\n                $.publish(BaseCommands_1.BaseCommands.FEEDBACK);\r\n            });\r\n            this.$bookmarkButton.onPressed(function () {\r\n                $.publish(BaseCommands_1.BaseCommands.BOOKMARK);\r\n            });\r\n            this.$shareButton.onPressed(function () {\r\n                $.publish(BaseCommands_1.BaseCommands.SHOW_SHARE_DIALOGUE, [_this.$shareButton]);\r\n            });\r\n            this.$embedButton.onPressed(function () {\r\n                $.publish(BaseCommands_1.BaseCommands.SHOW_EMBED_DIALOGUE, [_this.$embedButton]);\r\n            });\r\n            this.$downloadButton.onPressed(function () {\r\n                $.publish(BaseCommands_1.BaseCommands.SHOW_DOWNLOAD_DIALOGUE, [_this.$downloadButton]);\r\n            });\r\n            this.$moreInfoButton.onPressed(function () {\r\n                $.publish(BaseCommands_1.BaseCommands.SHOW_MOREINFO_DIALOGUE, [_this.$moreInfoButton]);\r\n            });\r\n            this.$fullScreenBtn.on('click', function (e) {\r\n                e.preventDefault();\r\n                $.publish(BaseCommands_1.BaseCommands.TOGGLE_FULLSCREEN);\r\n            });\r\n            if (!Utils.Bools.getBool(this.options.embedEnabled, true)) {\r\n                this.$embedButton.hide();\r\n            }\r\n            this.updateMoreInfoButton();\r\n            this.updateOpenButton();\r\n            this.updateFeedbackButton();\r\n            this.updateBookmarkButton();\r\n            this.updateEmbedButton();\r\n            this.updateDownloadButton();\r\n            this.updateFullScreenButton();\r\n            this.updateShareButton();\r\n            this.updateMinimisedButtons();\r\n        };\r\n        FooterPanel.prototype.updateMinimisedButtons = function () {\r\n            // if configured to always minimise buttons\r\n            if (Utils.Bools.getBool(this.options.minimiseButtons, false)) {\r\n                this.$options.addClass('minimiseButtons');\r\n                return;\r\n            }\r\n            // otherwise, check metric\r\n            if (this.extension.metric === Metrics_1.Metrics.MOBILE_LANDSCAPE) {\r\n                this.$options.addClass('minimiseButtons');\r\n            }\r\n            else {\r\n                this.$options.removeClass('minimiseButtons');\r\n            }\r\n        };\r\n        FooterPanel.prototype.updateMoreInfoButton = function () {\r\n            var configEnabled = Utils.Bools.getBool(this.options.moreInfoEnabled, false);\r\n            if (configEnabled && this.extension.metric === Metrics_1.Metrics.MOBILE_LANDSCAPE) {\r\n                this.$moreInfoButton.show();\r\n            }\r\n            else {\r\n                this.$moreInfoButton.hide();\r\n            }\r\n        };\r\n        FooterPanel.prototype.updateOpenButton = function () {\r\n            var configEnabled = Utils.Bools.getBool(this.options.openEnabled, false);\r\n            if (configEnabled && !this.extension.isHomeDomain) {\r\n                this.$openButton.show();\r\n            }\r\n            else {\r\n                this.$openButton.hide();\r\n            }\r\n        };\r\n        FooterPanel.prototype.updateFullScreenButton = function () {\r\n            if (!Utils.Bools.getBool(this.options.fullscreenEnabled, true)) {\r\n                this.$fullScreenBtn.hide();\r\n            }\r\n            if (this.extension.isLightbox) {\r\n                this.$fullScreenBtn.addClass('lightbox');\r\n            }\r\n            if (this.extension.isFullScreen()) {\r\n                this.$fullScreenBtn.swapClass('fullScreen', 'exitFullscreen');\r\n                this.$fullScreenBtn.text(this.content.exitFullScreen);\r\n                this.$fullScreenBtn.attr('title', this.content.exitFullScreen);\r\n            }\r\n            else {\r\n                this.$fullScreenBtn.swapClass('exitFullscreen', 'fullScreen');\r\n                this.$fullScreenBtn.text(this.content.fullScreen);\r\n                this.$fullScreenBtn.attr('title', this.content.fullScreen);\r\n            }\r\n        };\r\n        FooterPanel.prototype.updateEmbedButton = function () {\r\n            if (this.extension.helper.isUIEnabled('embed') && Utils.Bools.getBool(this.options.embedEnabled, false)) {\r\n                //current jquery version sets display to 'inline' in mobile version, while this should remain hidden (see media query)\r\n                if (!$.browser.mobile) {\r\n                    this.$embedButton.show();\r\n                }\r\n            }\r\n            else {\r\n                this.$embedButton.hide();\r\n            }\r\n        };\r\n        FooterPanel.prototype.updateShareButton = function () {\r\n            if (this.extension.helper.isUIEnabled('share') && Utils.Bools.getBool(this.options.shareEnabled, true)) {\r\n                this.$shareButton.show();\r\n            }\r\n            else {\r\n                this.$shareButton.hide();\r\n            }\r\n        };\r\n        FooterPanel.prototype.updateDownloadButton = function () {\r\n            var configEnabled = Utils.Bools.getBool(this.options.downloadEnabled, true);\r\n            if (configEnabled) {\r\n                this.$downloadButton.show();\r\n            }\r\n            else {\r\n                this.$downloadButton.hide();\r\n            }\r\n        };\r\n        FooterPanel.prototype.updateFeedbackButton = function () {\r\n            var configEnabled = Utils.Bools.getBool(this.options.feedbackEnabled, false);\r\n            if (configEnabled) {\r\n                this.$feedbackButton.show();\r\n            }\r\n            else {\r\n                this.$feedbackButton.hide();\r\n            }\r\n        };\r\n        FooterPanel.prototype.updateBookmarkButton = function () {\r\n            var configEnabled = Utils.Bools.getBool(this.options.bookmarkEnabled, false);\r\n            if (configEnabled) {\r\n                this.$bookmarkButton.show();\r\n            }\r\n            else {\r\n                this.$bookmarkButton.hide();\r\n            }\r\n        };\r\n        FooterPanel.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n        };\r\n        return FooterPanel;\r\n    }(BaseView_1.BaseView));\r\n    exports.FooterPanel = FooterPanel;\r\n});\r\n//# sourceMappingURL=FooterPanel.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-osdmobilefooterpanel-module/MobileFooter',[\"require\", \"exports\", \"../uv-shared-module/FooterPanel\", \"../../extensions/uv-seadragon-extension/Commands\"], function (require, exports, FooterPanel_1, Commands_1) {\r\n    \"use strict\";\r\n    var FooterPanel = (function (_super) {\r\n        __extends(FooterPanel, _super);\r\n        function FooterPanel($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        FooterPanel.prototype.create = function () {\r\n            this.setConfig('mobileFooterPanel');\r\n            _super.prototype.create.call(this);\r\n            this.$spacer = $('<div class=\"spacer\"></div>');\r\n            this.$options.prepend(this.$spacer);\r\n            this.$rotateButton = $('<a class=\"rotate\" title=\"' + this.content.rotateRight + '\" tabindex=\"0\">' + this.content.rotateRight + '</a>');\r\n            this.$options.prepend(this.$rotateButton);\r\n            this.$zoomOutButton = $('<a class=\"zoomOut\" title=\"' + this.content.zoomOut + '\" tabindex=\"0\">' + this.content.zoomOut + '</a>');\r\n            this.$options.prepend(this.$zoomOutButton);\r\n            this.$zoomInButton = $('<a class=\"zoomIn\" title=\"' + this.content.zoomIn + '\" tabindex=\"0\">' + this.content.zoomIn + '</a>');\r\n            this.$options.prepend(this.$zoomInButton);\r\n            this.$zoomInButton.onPressed(function () {\r\n                $.publish(Commands_1.Commands.ZOOM_IN);\r\n            });\r\n            this.$zoomOutButton.onPressed(function () {\r\n                $.publish(Commands_1.Commands.ZOOM_OUT);\r\n            });\r\n            this.$rotateButton.onPressed(function () {\r\n                $.publish(Commands_1.Commands.ROTATE);\r\n            });\r\n        };\r\n        FooterPanel.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n            this.$options.css('left', Math.floor((this.$element.width() / 2) - (this.$options.width() / 2)));\r\n        };\r\n        return FooterPanel;\r\n    }(FooterPanel_1.FooterPanel));\r\n    exports.FooterPanel = FooterPanel;\r\n});\r\n//# sourceMappingURL=MobileFooter.js.map;\n",
    "define('modules/uv-shared-module/AutoComplete',[\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    var AutoComplete = (function () {\r\n        function AutoComplete(element, autoCompleteFunc, parseResultsFunc, onSelect, delay, minChars, positionAbove) {\r\n            if (delay === void 0) { delay = 300; }\r\n            if (minChars === void 0) { minChars = 2; }\r\n            if (positionAbove === void 0) { positionAbove = false; }\r\n            var _this = this;\r\n            // valid keys that are not \r\n            this._validKeyDownCodes = [KeyCodes.KeyDown.Backspace, KeyCodes.KeyDown.Spacebar, KeyCodes.KeyDown.Tab, KeyCodes.KeyDown.LeftArrow, KeyCodes.KeyDown.RightArrow, KeyCodes.KeyDown.Delete];\r\n            this._validKeyPressCodes = [KeyCodes.KeyPress.GraveAccent, KeyCodes.KeyPress.DoubleQuote];\r\n            this._lastKeyDownWasValid = false;\r\n            this._$element = element;\r\n            this._autoCompleteFunc = autoCompleteFunc;\r\n            this._delay = delay;\r\n            this._minChars = minChars;\r\n            this._onSelect = onSelect;\r\n            this._parseResultsFunc = parseResultsFunc;\r\n            this._positionAbove = positionAbove;\r\n            // create ui.\r\n            this._$searchResultsList = $('<ul class=\"autocomplete\"></ul>');\r\n            if (this._positionAbove) {\r\n                this._$element.parent().prepend(this._$searchResultsList);\r\n            }\r\n            else {\r\n                this._$element.parent().append(this._$searchResultsList);\r\n            }\r\n            this._$searchResultTemplate = $('<li class=\"result\"><a href=\"#\" tabindex=\"-1\"></a></li>');\r\n            // init ui.\r\n            // callback after set period.\r\n            var typewatch = (function () {\r\n                var timer = 0;\r\n                return function (callback, ms) {\r\n                    clearTimeout(timer);\r\n                    timer = setTimeout(callback, ms);\r\n                };\r\n            })();\r\n            var that = this;\r\n            // validate\r\n            this._$element.on(\"keydown\", function (e) {\r\n                var originalEvent = e.originalEvent;\r\n                that._lastKeyDownWasValid = that._isValidKeyDown(originalEvent);\r\n                var charCode = Utils.Keyboard.getCharCode(originalEvent);\r\n                var cancelEvent = false;\r\n                if (charCode === KeyCodes.KeyDown.LeftArrow) {\r\n                    cancelEvent = true;\r\n                }\r\n                else if (charCode === KeyCodes.KeyDown.RightArrow) {\r\n                    cancelEvent = true;\r\n                }\r\n                if (cancelEvent) {\r\n                    originalEvent.cancelBubble = true;\r\n                    if (originalEvent.stopPropagation)\r\n                        originalEvent.stopPropagation();\r\n                }\r\n            });\r\n            // prevent invalid characters being entered\r\n            this._$element.on(\"keypress\", function (e) {\r\n                var isValidKeyPress = that._isValidKeyPress(e.originalEvent);\r\n                if (!(that._lastKeyDownWasValid || isValidKeyPress)) {\r\n                    e.preventDefault();\r\n                    return false;\r\n                }\r\n                return true;\r\n            });\r\n            // auto complete\r\n            this._$element.on(\"keyup\", function (e) {\r\n                // if pressing enter without a list item selected\r\n                if (!that._getSelectedListItem().length && e.keyCode === KeyCodes.KeyDown.Enter) {\r\n                    that._onSelect(that._getTerms());\r\n                    return;\r\n                }\r\n                // If there are search results\r\n                if (that._$searchResultsList.is(':visible') && that._results.length) {\r\n                    if (e.keyCode === KeyCodes.KeyDown.Enter) {\r\n                        that._searchForItem(that._getSelectedListItem());\r\n                    }\r\n                    else if (e.keyCode === KeyCodes.KeyDown.DownArrow) {\r\n                        that._setSelectedResultIndex(1);\r\n                        return;\r\n                    }\r\n                    else if (e.keyCode === KeyCodes.KeyDown.UpArrow) {\r\n                        that._setSelectedResultIndex(-1);\r\n                        return;\r\n                    }\r\n                }\r\n                if (e.keyCode !== KeyCodes.KeyDown.Enter) {\r\n                    // after a delay, show autocomplete list.\r\n                    typewatch(function () {\r\n                        var val = that._getTerms();\r\n                        // if there are more than x chars and no spaces\r\n                        // update the autocomplete list.\r\n                        if (val && val.length > that._minChars && !val.contains(' ')) {\r\n                            that._search(val);\r\n                        }\r\n                        else {\r\n                            // otherwise, hide the autocomplete list.\r\n                            that._clearResults();\r\n                            that._hideResults();\r\n                        }\r\n                    }, that._delay);\r\n                }\r\n            });\r\n            // hide results if clicked outside.\r\n            $(document).on('mouseup', function (e) {\r\n                if (_this._$searchResultsList.parent().has($(e.target)[0]).length === 0) {\r\n                    _this._clearResults();\r\n                    _this._hideResults();\r\n                }\r\n            });\r\n            this._hideResults();\r\n        }\r\n        AutoComplete.prototype._isValidKeyDown = function (e) {\r\n            var isValid = this._validKeyDownCodes.contains(Utils.Keyboard.getCharCode(e));\r\n            return isValid;\r\n        };\r\n        AutoComplete.prototype._isValidKeyPress = function (e) {\r\n            var charCode = Utils.Keyboard.getCharCode(e);\r\n            var key = String.fromCharCode(charCode);\r\n            var isValid = key.isAlphanumeric() || this._validKeyPressCodes.contains(charCode);\r\n            return isValid;\r\n        };\r\n        AutoComplete.prototype._getTerms = function () {\r\n            return this._$element.val().trim();\r\n        };\r\n        AutoComplete.prototype._setSelectedResultIndex = function (direction) {\r\n            var nextIndex;\r\n            if (direction === 1) {\r\n                nextIndex = this._selectedResultIndex + 1;\r\n            }\r\n            else {\r\n                nextIndex = this._selectedResultIndex - 1;\r\n            }\r\n            var $items = this._$searchResultsList.find('li');\r\n            if (nextIndex < 0) {\r\n                nextIndex = $items.length - 1;\r\n            }\r\n            else if (nextIndex > $items.length - 1) {\r\n                nextIndex = 0;\r\n            }\r\n            this._selectedResultIndex = nextIndex;\r\n            $items.removeClass('selected');\r\n            var $selectedItem = $items.eq(this._selectedResultIndex);\r\n            $selectedItem.addClass('selected');\r\n            //var top = selectedItem.offset().top;\r\n            var top = $selectedItem.outerHeight(true) * this._selectedResultIndex;\r\n            this._$searchResultsList.scrollTop(top);\r\n        };\r\n        AutoComplete.prototype._search = function (term) {\r\n            this._results = [];\r\n            this._clearResults();\r\n            this._showResults();\r\n            this._$searchResultsList.append('<li class=\"loading\"></li>');\r\n            this._updateListPosition();\r\n            var that = this;\r\n            this._autoCompleteFunc(term, function (results) {\r\n                that._listResults(results);\r\n            });\r\n        };\r\n        AutoComplete.prototype._clearResults = function () {\r\n            this._$searchResultsList.empty();\r\n        };\r\n        AutoComplete.prototype._hideResults = function () {\r\n            this._$searchResultsList.hide();\r\n        };\r\n        AutoComplete.prototype._showResults = function () {\r\n            this._selectedResultIndex = -1;\r\n            this._$searchResultsList.show();\r\n        };\r\n        AutoComplete.prototype._updateListPosition = function () {\r\n            if (this._positionAbove) {\r\n                this._$searchResultsList.css({\r\n                    'top': this._$searchResultsList.outerHeight(true) * -1\r\n                });\r\n            }\r\n            else {\r\n                this._$searchResultsList.css({\r\n                    'top': this._$element.outerHeight(true)\r\n                });\r\n            }\r\n        };\r\n        AutoComplete.prototype._listResults = function (results) {\r\n            // get an array of strings\r\n            this._results = this._parseResultsFunc(results);\r\n            this._clearResults();\r\n            if (!this._results.length) {\r\n                // don't do this, because there still may be results for the PHRASE but not the word.\r\n                // they won't know until they do the search.\r\n                //this.searchResultsList.append('<li>no results</li>');\r\n                this._hideResults();\r\n                return;\r\n            }\r\n            for (var i = 0; i < this._results.length; i++) {\r\n                var result = this._results[i];\r\n                var $resultItem = this._$searchResultTemplate.clone();\r\n                var $a = $resultItem.find('a');\r\n                $a.text(result);\r\n                this._$searchResultsList.append($resultItem);\r\n            }\r\n            this._updateListPosition();\r\n            var that = this;\r\n            this._$searchResultsList.find('li').on('click', function (e) {\r\n                e.preventDefault();\r\n                that._searchForItem($(this));\r\n            });\r\n        };\r\n        AutoComplete.prototype._searchForItem = function ($item) {\r\n            var term = $item.find('a').text();\r\n            this._$element.val(term);\r\n            this._hideResults();\r\n            this._onSelect(term);\r\n            this._clearResults();\r\n            this._hideResults();\r\n        };\r\n        AutoComplete.prototype._getSelectedListItem = function () {\r\n            return this._$searchResultsList.find('li.selected');\r\n        };\r\n        return AutoComplete;\r\n    }());\r\n    exports.AutoComplete = AutoComplete;\r\n});\r\n//# sourceMappingURL=AutoComplete.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-searchfooterpanel-module/FooterPanel',[\"require\", \"exports\", \"../uv-shared-module/AutoComplete\", \"../uv-shared-module/BaseCommands\", \"../uv-shared-module/FooterPanel\", \"../../extensions/uv-seadragon-extension/Commands\", \"../../extensions/uv-seadragon-extension/Mode\"], function (require, exports, AutoComplete_1, BaseCommands_1, FooterPanel_1, Commands_1, Mode_1) {\r\n    \"use strict\";\r\n    var FooterPanel = (function (_super) {\r\n        __extends(FooterPanel, _super);\r\n        function FooterPanel($element) {\r\n            var _this = _super.call(this, $element) || this;\r\n            _this.placemarkerTouched = false;\r\n            return _this;\r\n        }\r\n        FooterPanel.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('searchFooterPanel');\r\n            _super.prototype.create.call(this);\r\n            $.subscribe(BaseCommands_1.BaseCommands.CANVAS_INDEX_CHANGED, function (e, canvasIndex) {\r\n                _this.canvasIndexChanged();\r\n                _this.setCurrentSearchResultPlacemarker();\r\n                _this.updatePrevButton();\r\n                _this.updateNextButton();\r\n            });\r\n            // todo: this should be a setting\r\n            $.subscribe(Commands_1.Commands.MODE_CHANGED, function (e, mode) {\r\n                _this.settingsChanged();\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEARCH, function (e, terms) {\r\n                _this.terms = terms;\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEARCH_RESULTS, function (e, obj) {\r\n                _this.displaySearchResults(obj.terms, obj.results);\r\n                _this.setCurrentSearchResultPlacemarker();\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEARCH_RESULTS_EMPTY, function () {\r\n                _this.hideSearchSpinner();\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEARCH_RESULT_RECT_CHANGED, function () {\r\n                _this.updatePrevButton();\r\n                _this.updateNextButton();\r\n            });\r\n            this.$printButton = $('<a class=\"print\" title=\"' + this.content.print + '\" tabindex=\"0\">' + this.content.print + '</a>');\r\n            this.$options.prepend(this.$printButton);\r\n            // search input.\r\n            this.$searchContainer = $('<div class=\"search\"></div>');\r\n            this.$element.prepend(this.$searchContainer);\r\n            this.$searchOptions = $('<div class=\"searchOptions\"></div>');\r\n            this.$searchContainer.append(this.$searchOptions);\r\n            this.$searchLabel = $('<span class=\"label\">' + this.content.searchWithin + '</span>');\r\n            this.$searchOptions.append(this.$searchLabel);\r\n            this.$searchTextContainer = $('<div class=\"searchTextContainer\"></div>');\r\n            this.$searchOptions.append(this.$searchTextContainer);\r\n            this.$searchText = $('<input class=\"searchText\" type=\"text\" maxlength=\"100\" value=\"' + this.content.enterKeyword + '\" />');\r\n            this.$searchTextContainer.append(this.$searchText);\r\n            this.$searchButton = $('<a class=\"imageButton searchButton\" tabindex=\"0\"></a>');\r\n            this.$searchTextContainer.append(this.$searchButton);\r\n            // search results.\r\n            this.$searchPagerContainer = $('<div class=\"searchPager\"></div>');\r\n            this.$element.prepend(this.$searchPagerContainer);\r\n            this.$searchPagerControls = $('<div class=\"controls\"></div>');\r\n            this.$searchPagerContainer.prepend(this.$searchPagerControls);\r\n            this.$previousResultButton = $('<a class=\"previousResult\" title=\"' + this.content.previousResult + '\">' + this.content.previousResult + '</a>');\r\n            this.$searchPagerControls.append(this.$previousResultButton);\r\n            this.$searchResultsInfo = $('<div class=\"searchResultsInfo\"><span class=\"number\">x</span> <span class=\"foundFor\"></span> \\'<span class=\"terms\">y</span>\\'</div>');\r\n            this.$searchPagerControls.append(this.$searchResultsInfo);\r\n            this.$clearSearchResultsButton = $('<a class=\"clearSearch\" title=\"' + this.content.clearSearch + '\">' + this.content.clearSearch + '</a>');\r\n            this.$searchResultsInfo.append(this.$clearSearchResultsButton);\r\n            this.$nextResultButton = $('<a class=\"nextResult\" title=\"' + this.content.nextResult + '\">' + this.content.nextResult + '</a>');\r\n            this.$searchPagerControls.append(this.$nextResultButton);\r\n            // placemarker line.\r\n            this.$searchResultsContainer = $('<div class=\"searchResults\"></div>');\r\n            this.$element.prepend(this.$searchResultsContainer);\r\n            this.$line = $('<div class=\"line\"></div>');\r\n            this.$searchResultsContainer.append(this.$line);\r\n            this.$pagePositionMarker = $('<div class=\"positionPlacemarker\"></div>');\r\n            this.$searchResultsContainer.append(this.$pagePositionMarker);\r\n            this.$pagePositionLabel = $('<div class=\"label\"></div>');\r\n            this.$searchResultsContainer.append(this.$pagePositionLabel);\r\n            this.$placemarkerDetails = $('<div class=\"placeMarkerDetails\"></div>');\r\n            this.$searchResultsContainer.append(this.$placemarkerDetails);\r\n            this.$placemarkerDetailsTop = $('<h1></h1>');\r\n            this.$placemarkerDetails.append(this.$placemarkerDetailsTop);\r\n            this.$placemarkerDetailsBottom = $('<p></p>');\r\n            this.$placemarkerDetails.append(this.$placemarkerDetailsBottom);\r\n            // initialise ui.\r\n            this.$searchPagerContainer.hide();\r\n            this.$placemarkerDetails.hide();\r\n            // ui event handlers.\r\n            var that = this;\r\n            this.$searchButton.on('click', function (e) {\r\n                e.preventDefault();\r\n                _this.search(_this.$searchText.val());\r\n            });\r\n            this.$searchText.on('focus', function () {\r\n                // clear initial text.\r\n                if (_this.$searchText.val() === _this.content.enterKeyword)\r\n                    _this.$searchText.val('');\r\n            });\r\n            this.$placemarkerDetails.on('mouseover', function () {\r\n                $.publish(Commands_1.Commands.SEARCH_PREVIEW_START, [_this.currentPlacemarkerIndex]);\r\n            });\r\n            this.$placemarkerDetails.on('mouseleave', function () {\r\n                $(this).hide();\r\n                $.publish(Commands_1.Commands.SEARCH_PREVIEW_FINISH);\r\n                // reset all placemarkers.\r\n                var placemarkers = that.getSearchResultPlacemarkers();\r\n                placemarkers.removeClass('hover');\r\n            });\r\n            this.$placemarkerDetails.on('click', function (e) {\r\n                $.publish(Commands_1.Commands.VIEW_PAGE, [_this.currentPlacemarkerIndex]);\r\n            });\r\n            this.$previousResultButton.on('click', function (e) {\r\n                e.preventDefault();\r\n                $.publish(Commands_1.Commands.PREV_SEARCH_RESULT);\r\n            });\r\n            this.$nextResultButton.on('click', function (e) {\r\n                e.preventDefault();\r\n                $.publish(Commands_1.Commands.NEXT_SEARCH_RESULT);\r\n            });\r\n            this.$clearSearchResultsButton.on('click', function (e) {\r\n                e.preventDefault();\r\n                $.publish(Commands_1.Commands.CLEAR_SEARCH);\r\n                _this.clearSearchResults();\r\n            });\r\n            // hide search options if not enabled/supported.\r\n            if (!this.extension.isSearchWithinEnabled()) {\r\n                this.$searchContainer.hide();\r\n                this.$searchPagerContainer.hide();\r\n                this.$searchResultsContainer.hide();\r\n                this.$element.addClass('min');\r\n            }\r\n            if (this.extension.helper.getTotalCanvases() === 1) {\r\n                this.$searchResultsContainer.hide();\r\n            }\r\n            var autocompleteService = this.extension.getAutoCompleteUri();\r\n            if (autocompleteService) {\r\n                new AutoComplete_1.AutoComplete(this.$searchText, function (terms, cb) {\r\n                    $.getJSON(String.format(autocompleteService, terms), function (results) {\r\n                        cb(results);\r\n                    });\r\n                }, function (results) {\r\n                    return $.map(results.terms, function (result) {\r\n                        return result.match;\r\n                    });\r\n                }, function (terms) {\r\n                    _this.search(terms);\r\n                }, 300, 2, true);\r\n            }\r\n            else {\r\n                this.$searchText.on(\"keyup\", function (e) {\r\n                    if (e.keyCode === KeyCodes.KeyDown.Enter) {\r\n                        that.search(that.$searchText.val());\r\n                    }\r\n                });\r\n            }\r\n            this.$printButton.onPressed(function () {\r\n                $.publish(Commands_1.Commands.PRINT);\r\n            });\r\n            this.updatePrintButton();\r\n            var positionMarkerEnabled = Utils.Bools.getBool(this.config.options.positionMarkerEnabled, true);\r\n            if (!positionMarkerEnabled) {\r\n                this.$pagePositionMarker.hide();\r\n                this.$pagePositionLabel.hide();\r\n            }\r\n        };\r\n        FooterPanel.prototype.isZoomToSearchResultEnabled = function () {\r\n            return Utils.Bools.getBool(this.extension.config.options.zoomToSearchResultEnabled, true);\r\n        };\r\n        FooterPanel.prototype.isPreviousButtonEnabled = function () {\r\n            var currentCanvasIndex = this.extension.helper.canvasIndex;\r\n            var firstSearchResultCanvasIndex = this.getFirstSearchResultCanvasIndex();\r\n            var currentSearchResultRectIndex = this.getCurrentSearchResultRectIndex();\r\n            // if zoom to search result is enabled and there is a highlighted search result.\r\n            if (this.isZoomToSearchResultEnabled() && this.extension.currentSearchResultRect) {\r\n                if (currentCanvasIndex < firstSearchResultCanvasIndex) {\r\n                    return false;\r\n                }\r\n                else if (currentCanvasIndex === firstSearchResultCanvasIndex) {\r\n                    if (currentSearchResultRectIndex === 0) {\r\n                        return false;\r\n                    }\r\n                }\r\n                return true;\r\n            }\r\n            return (currentCanvasIndex > firstSearchResultCanvasIndex);\r\n        };\r\n        FooterPanel.prototype.isCanvasIndexLessThanFirstSearchResultIndex = function () {\r\n            var searchResults = this.extension.searchResults;\r\n            return this.extension.helper.canvasIndex <= searchResults[0].canvasIndex;\r\n        };\r\n        FooterPanel.prototype.isNextButtonEnabled = function () {\r\n            var currentCanvasIndex = this.extension.helper.canvasIndex;\r\n            var lastSearchResultCanvasIndex = this.getLastSearchResultCanvasIndex();\r\n            var currentSearchResultRectIndex = this.getCurrentSearchResultRectIndex();\r\n            // if zoom to search result is enabled and there is a highlighted search result.\r\n            if (this.isZoomToSearchResultEnabled() && this.extension.currentSearchResultRect) {\r\n                if (currentCanvasIndex > lastSearchResultCanvasIndex) {\r\n                    return false;\r\n                }\r\n                else if (currentCanvasIndex === lastSearchResultCanvasIndex) {\r\n                    if (currentSearchResultRectIndex === this.getLastSearchResultRectIndex()) {\r\n                        return false;\r\n                    }\r\n                }\r\n                return true;\r\n            }\r\n            return (currentCanvasIndex < lastSearchResultCanvasIndex);\r\n        };\r\n        FooterPanel.prototype.getSearchResults = function () {\r\n            return this.extension.searchResults;\r\n        };\r\n        FooterPanel.prototype.getCurrentSearchResultRectIndex = function () {\r\n            return this.extension.getCurrentSearchResultRectIndex();\r\n        };\r\n        FooterPanel.prototype.getFirstSearchResultCanvasIndex = function () {\r\n            var searchResults = this.getSearchResults();\r\n            var firstSearchResultCanvasIndex = searchResults[0].canvasIndex;\r\n            return firstSearchResultCanvasIndex;\r\n        };\r\n        FooterPanel.prototype.getLastSearchResultCanvasIndex = function () {\r\n            var searchResults = this.getSearchResults();\r\n            var lastSearchResultCanvasIndex = searchResults[searchResults.length - 1].canvasIndex;\r\n            return lastSearchResultCanvasIndex;\r\n        };\r\n        FooterPanel.prototype.getLastSearchResultRectIndex = function () {\r\n            return this.extension.getLastSearchResultRectIndex();\r\n        };\r\n        FooterPanel.prototype.updateNextButton = function () {\r\n            var searchResults = this.extension.searchResults;\r\n            if (searchResults && searchResults.length) {\r\n                if (this.isNextButtonEnabled()) {\r\n                    this.$nextResultButton.removeClass('disabled');\r\n                }\r\n                else {\r\n                    this.$nextResultButton.addClass('disabled');\r\n                }\r\n            }\r\n        };\r\n        FooterPanel.prototype.updatePrevButton = function () {\r\n            var searchResults = this.extension.searchResults;\r\n            if (searchResults && searchResults.length) {\r\n                if (this.isPreviousButtonEnabled()) {\r\n                    this.$previousResultButton.removeClass('disabled');\r\n                }\r\n                else {\r\n                    this.$previousResultButton.addClass('disabled');\r\n                }\r\n            }\r\n        };\r\n        FooterPanel.prototype.updatePrintButton = function () {\r\n            var configEnabled = Utils.Bools.getBool(this.options.printEnabled, false);\r\n            //var printService: Manifesto.IService = this.extension.helper.manifest.getService(manifesto.ServiceProfile.printExtensions());\r\n            //if (configEnabled && printService && this.extension.isOnHomeDomain()){\r\n            if (configEnabled) {\r\n                this.$printButton.show();\r\n            }\r\n            else {\r\n                this.$printButton.hide();\r\n            }\r\n        };\r\n        FooterPanel.prototype.search = function (terms) {\r\n            this.terms = terms;\r\n            if (this.terms === '' || this.terms === this.content.enterKeyword) {\r\n                this.extension.showMessage(this.config.modules.genericDialogue.content.emptyValue, function () {\r\n                    this.$searchText.focus();\r\n                });\r\n                return;\r\n            }\r\n            // blur search field\r\n            this.$searchText.blur();\r\n            this.showSearchSpinner();\r\n            $.publish(Commands_1.Commands.SEARCH, [this.terms]);\r\n        };\r\n        FooterPanel.prototype.getSearchResultPlacemarkers = function () {\r\n            return this.$searchResultsContainer.find('.searchResultPlacemarker');\r\n        };\r\n        FooterPanel.prototype.setCurrentSearchResultPlacemarker = function () {\r\n            var placemarkers = this.getSearchResultPlacemarkers();\r\n            placemarkers.parent().find('.current').removeClass('current');\r\n            var $current = $('.searchResultPlacemarker[data-index=\"' + this.extension.helper.canvasIndex + '\"]');\r\n            $current.addClass('current');\r\n        };\r\n        FooterPanel.prototype.positionSearchResultPlacemarkers = function () {\r\n            var results = this.extension.searchResults;\r\n            if (!results.length)\r\n                return;\r\n            // clear all existing placemarkers\r\n            var placemarkers = this.getSearchResultPlacemarkers();\r\n            placemarkers.remove();\r\n            var pageWidth = this.getPageLineRatio();\r\n            var lineTop = this.$line.position().top;\r\n            var lineLeft = this.$line.position().left;\r\n            var that = this;\r\n            // for each page with a result, place a marker along the line.\r\n            for (var i = 0; i < results.length; i++) {\r\n                var result = results[i];\r\n                var distance = result.canvasIndex * pageWidth;\r\n                var $placemarker = $('<div class=\"searchResultPlacemarker\" data-index=\"' + result.canvasIndex + '\"></div>');\r\n                $placemarker[0].ontouchstart = function (e) { that.onPlacemarkerTouchStart.call(this, that); };\r\n                $placemarker.click(function (e) { that.onPlacemarkerClick.call(this, that); });\r\n                $placemarker.mouseenter(function (e) { that.onPlacemarkerMouseEnter.call(this, that); });\r\n                $placemarker.mouseleave(function (e) { that.onPlacemarkerMouseLeave.call(this, e, that); });\r\n                this.$searchResultsContainer.append($placemarker);\r\n                var top = lineTop - $placemarker.height();\r\n                var left = lineLeft + distance - ($placemarker.width() / 2);\r\n                $placemarker.css({\r\n                    top: top,\r\n                    left: left\r\n                });\r\n            }\r\n        };\r\n        FooterPanel.prototype.onPlacemarkerTouchStart = function (that) {\r\n            that.placemarkerTouched = true;\r\n            var $placemarker = $(this);\r\n            var index = parseInt($placemarker.attr('data-index'));\r\n            $.publish(Commands_1.Commands.VIEW_PAGE, [index]);\r\n        };\r\n        FooterPanel.prototype.onPlacemarkerClick = function (that) {\r\n            if (that.placemarkerTouched)\r\n                return;\r\n            that.placemarkerTouched = false;\r\n            var $placemarker = $(this);\r\n            var index = parseInt($placemarker.attr('data-index'));\r\n            $.publish(Commands_1.Commands.VIEW_PAGE, [index]);\r\n        };\r\n        FooterPanel.prototype.onPlacemarkerMouseEnter = function (that) {\r\n            if (that.placemarkerTouched)\r\n                return;\r\n            var $placemarker = $(this);\r\n            $placemarker.addClass('hover');\r\n            var canvasIndex = parseInt($placemarker.attr('data-index'));\r\n            $.publish(Commands_1.Commands.SEARCH_PREVIEW_START, [canvasIndex]);\r\n            var placemarkers = that.getSearchResultPlacemarkers();\r\n            var elemIndex = placemarkers.index($placemarker[0]);\r\n            that.currentPlacemarkerIndex = canvasIndex;\r\n            that.$placemarkerDetails.show();\r\n            var title = \"{0} {1}\";\r\n            var mode = that.extension.getMode();\r\n            if (mode.toString() === Mode_1.Mode.page.toString()) {\r\n                var canvas = that.extension.helper.getCanvasByIndex(canvasIndex);\r\n                var label = Manifesto.TranslationCollection.getValue(canvas.getLabel());\r\n                if (label === \"\") {\r\n                    label = this.extension.helper.manifest.options.defaultLabel;\r\n                }\r\n                title = String.format(title, that.content.pageCaps, label);\r\n            }\r\n            else {\r\n                title = String.format(title, that.content.imageCaps, canvasIndex + 1);\r\n            }\r\n            that.$placemarkerDetailsTop.html(title);\r\n            var result = that.extension.searchResults[elemIndex];\r\n            var terms = Utils.Strings.ellipsis(that.terms, that.options.elideDetailsTermsCount);\r\n            var instancesFoundText;\r\n            if (result.rects.length === 1) {\r\n                instancesFoundText = that.content.instanceFound;\r\n                instancesFoundText = String.format(instancesFoundText, terms);\r\n            }\r\n            else {\r\n                instancesFoundText = that.content.instancesFound;\r\n                instancesFoundText = String.format(instancesFoundText, result.rects.length, terms);\r\n            }\r\n            that.$placemarkerDetailsBottom.html(instancesFoundText);\r\n            var pos = $placemarker.position();\r\n            var top = pos.top - that.$placemarkerDetails.height();\r\n            var left = pos.left;\r\n            if (left < that.$placemarkerDetails.width() / 2) {\r\n                left = 0 - ($placemarker.width() / 2);\r\n            }\r\n            else if (left > that.$line.width() - (that.$placemarkerDetails.width() / 2)) {\r\n                left = that.$line.width() - that.$placemarkerDetails.width() + ($placemarker.width() / 2);\r\n            }\r\n            else {\r\n                left -= (that.$placemarkerDetails.width() / 2);\r\n            }\r\n            that.$placemarkerDetails.css({\r\n                top: top,\r\n                left: left\r\n            });\r\n        };\r\n        FooterPanel.prototype.onPlacemarkerMouseLeave = function (e, that) {\r\n            $.publish(Commands_1.Commands.SEARCH_PREVIEW_FINISH);\r\n            var $placemarker = $(this);\r\n            var newElement = e.toElement || e.relatedTarget;\r\n            var isChild = $(newElement).closest(that.$placemarkerDetails).length;\r\n            if (newElement != that.$placemarkerDetails.get(0) && isChild === 0) {\r\n                that.$placemarkerDetails.hide();\r\n                $placemarker.removeClass('hover');\r\n            }\r\n        };\r\n        FooterPanel.prototype.setPageMarkerPosition = function () {\r\n            if (this.extension.helper.canvasIndex == null)\r\n                return;\r\n            // position placemarker showing current page.\r\n            var pageLineRatio = this.getPageLineRatio();\r\n            var lineTop = this.$line.position().top;\r\n            var lineLeft = this.$line.position().left;\r\n            var position = this.extension.helper.canvasIndex * pageLineRatio;\r\n            var top = lineTop;\r\n            var left = lineLeft + position;\r\n            this.$pagePositionMarker.css({\r\n                top: top,\r\n                left: left\r\n            });\r\n            // if the remaining distance to the right is less than the width of the label\r\n            // shift it to the left.\r\n            var lineWidth = this.$line.width();\r\n            if (left + this.$pagePositionLabel.outerWidth(true) > lineWidth) {\r\n                left -= this.$pagePositionLabel.outerWidth(true);\r\n                this.$pagePositionLabel.removeClass('right');\r\n                this.$pagePositionLabel.addClass('left');\r\n            }\r\n            else {\r\n                this.$pagePositionLabel.removeClass('left');\r\n                this.$pagePositionLabel.addClass('right');\r\n            }\r\n            this.$pagePositionLabel.css({\r\n                top: top,\r\n                left: left\r\n            });\r\n        };\r\n        FooterPanel.prototype.clearSearchResults = function () {\r\n            this.extension.searchResults = [];\r\n            // clear all existing placemarkers\r\n            var placemarkers = this.getSearchResultPlacemarkers();\r\n            placemarkers.remove();\r\n            // clear search input field.\r\n            this.$searchText.val(this.content.enterKeyword);\r\n            // hide pager.\r\n            this.$searchContainer.show();\r\n            this.$searchPagerContainer.hide();\r\n            // set focus to search box.\r\n            this.$searchText.focus();\r\n        };\r\n        FooterPanel.prototype.getPageLineRatio = function () {\r\n            var lineWidth = this.$line.width();\r\n            // find page/width ratio by dividing the line width by the number of pages in the book.\r\n            if (this.extension.helper.getTotalCanvases() === 1)\r\n                return 0;\r\n            return lineWidth / (this.extension.helper.getTotalCanvases() - 1);\r\n        };\r\n        FooterPanel.prototype.canvasIndexChanged = function () {\r\n            this.setPageMarkerPosition();\r\n            this.setPlacemarkerLabel();\r\n        };\r\n        FooterPanel.prototype.settingsChanged = function () {\r\n            this.setPlacemarkerLabel();\r\n        };\r\n        FooterPanel.prototype.setPlacemarkerLabel = function () {\r\n            var displaying = this.content.displaying;\r\n            var index = this.extension.helper.canvasIndex;\r\n            if (this.isPageModeEnabled()) {\r\n                var canvas = this.extension.helper.getCanvasByIndex(index);\r\n                var label = Manifesto.TranslationCollection.getValue(canvas.getLabel());\r\n                if (label === \"\") {\r\n                    label = this.content.defaultLabel;\r\n                }\r\n                var lastCanvasOrderLabel = this.extension.helper.getLastCanvasLabel(true);\r\n                this.$pagePositionLabel.html(String.format(displaying, this.content.page, this.extension.sanitize(label), this.extension.sanitize(lastCanvasOrderLabel)));\r\n            }\r\n            else {\r\n                this.$pagePositionLabel.html(String.format(displaying, this.content.image, index + 1, this.extension.helper.getTotalCanvases()));\r\n            }\r\n        };\r\n        FooterPanel.prototype.isPageModeEnabled = function () {\r\n            return this.config.options.pageModeEnabled && this.extension.getMode().toString() === Mode_1.Mode.page.toString();\r\n        };\r\n        FooterPanel.prototype.showSearchSpinner = function () {\r\n            this.$searchText.addClass('searching');\r\n        };\r\n        FooterPanel.prototype.hideSearchSpinner = function () {\r\n            this.$searchText.removeClass('searching');\r\n        };\r\n        FooterPanel.prototype.displaySearchResults = function (terms, results) {\r\n            if (!results)\r\n                return;\r\n            this.hideSearchSpinner();\r\n            this.positionSearchResultPlacemarkers();\r\n            // show pager.\r\n            this.$searchContainer.hide();\r\n            this.$searchPagerControls.css({\r\n                'left': 0\r\n            });\r\n            var $number = this.$searchPagerContainer.find('.number');\r\n            $number.text(this.extension.getTotalSearchResultRects());\r\n            var foundFor = this.$searchResultsInfo.find('.foundFor');\r\n            if (results.length === 1) {\r\n                foundFor.html(this.content.resultFoundFor);\r\n            }\r\n            else {\r\n                foundFor.html(this.content.resultsFoundFor);\r\n            }\r\n            var $terms = this.$searchPagerContainer.find('.terms');\r\n            $terms.html(Utils.Strings.ellipsis(terms, this.options.elideResultsTermsCount));\r\n            $terms.prop('title', terms);\r\n            this.$searchPagerContainer.show();\r\n            this.resize();\r\n        };\r\n        FooterPanel.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n            var searchResults = this.extension.searchResults;\r\n            if (searchResults && searchResults.length) {\r\n                this.positionSearchResultPlacemarkers();\r\n            }\r\n            this.setPageMarkerPosition();\r\n            this.$searchPagerContainer.width(this.$element.width());\r\n            var center = this.$element.width() / 2;\r\n            // position search pager controls.\r\n            this.$searchPagerControls.css({\r\n                'left': center - (this.$searchPagerControls.width() / 2)\r\n            });\r\n            // position search input.\r\n            this.$searchOptions.css({\r\n                'left': center - (this.$searchOptions.outerWidth() / 2)\r\n            });\r\n        };\r\n        return FooterPanel;\r\n    }(FooterPanel_1.FooterPanel));\r\n    exports.FooterPanel = FooterPanel;\r\n});\r\n//# sourceMappingURL=FooterPanel.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-dialogues-module/HelpDialogue',[\"require\", \"exports\", \"../uv-shared-module/BaseCommands\", \"../uv-shared-module/Dialogue\"], function (require, exports, BaseCommands_1, Dialogue_1) {\r\n    \"use strict\";\r\n    var HelpDialogue = (function (_super) {\r\n        __extends(HelpDialogue, _super);\r\n        function HelpDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        HelpDialogue.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('helpDialogue');\r\n            _super.prototype.create.call(this);\r\n            this.openCommand = BaseCommands_1.BaseCommands.SHOW_HELP_DIALOGUE;\r\n            this.closeCommand = BaseCommands_1.BaseCommands.HIDE_HELP_DIALOGUE;\r\n            $.subscribe(this.openCommand, function (e, params) {\r\n                _this.open();\r\n            });\r\n            $.subscribe(this.closeCommand, function (e) {\r\n                _this.close();\r\n            });\r\n            this.$title = $('<h1></h1>');\r\n            this.$content.append(this.$title);\r\n            this.$scroll = $('<div class=\"scroll\"></div>');\r\n            this.$content.append(this.$scroll);\r\n            this.$message = $('<p></p>');\r\n            this.$scroll.append(this.$message);\r\n            // initialise ui.\r\n            this.$title.text(this.content.title);\r\n            this.$message.html(this.content.text);\r\n            // ensure anchor tags link to _blank.\r\n            this.$message.targetBlank();\r\n            this.$element.hide();\r\n        };\r\n        HelpDialogue.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n        };\r\n        return HelpDialogue;\r\n    }(Dialogue_1.Dialogue));\r\n    exports.HelpDialogue = HelpDialogue;\r\n});\r\n//# sourceMappingURL=HelpDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-dialogues-module/MoreInfoDialogue',[\"require\", \"exports\", \"../uv-shared-module/BaseCommands\", \"../uv-shared-module/Dialogue\"], function (require, exports, BaseCommands_1, Dialogue_1) {\r\n    \"use strict\";\r\n    var MoreInfoDialogue = (function (_super) {\r\n        __extends(MoreInfoDialogue, _super);\r\n        function MoreInfoDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        MoreInfoDialogue.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('moreInfoDialogue');\r\n            _super.prototype.create.call(this);\r\n            this.openCommand = BaseCommands_1.BaseCommands.SHOW_MOREINFO_DIALOGUE;\r\n            this.closeCommand = BaseCommands_1.BaseCommands.HIDE_MOREINFO_DIALOGUE;\r\n            $.subscribe(this.openCommand, function (e, $triggerButton) {\r\n                _this.open($triggerButton);\r\n            });\r\n            $.subscribe(this.closeCommand, function (e) {\r\n                _this.close();\r\n            });\r\n            this.config.content = this.extension.config.modules.moreInfoRightPanel.content;\r\n            this.config.options = this.extension.config.modules.moreInfoRightPanel.options;\r\n            // create ui\r\n            this.$title = $('<h1>' + this.config.content.title + '</h1>');\r\n            this.$content.append(this.$title);\r\n            this.$metadata = $('<div class=\"iiif-metadata-component\"></div>');\r\n            this.$content.append(this.$metadata);\r\n            this.component = new IIIFComponents.MetadataComponent({\r\n                target: this.$metadata[0],\r\n                data: this._getData()\r\n            });\r\n            // hide\r\n            this.$element.hide();\r\n        };\r\n        MoreInfoDialogue.prototype.open = function ($triggerButton) {\r\n            _super.prototype.open.call(this, $triggerButton);\r\n            this.component.set(null); // todo: should be passing data\r\n        };\r\n        MoreInfoDialogue.prototype._getData = function () {\r\n            var _this = this;\r\n            return {\r\n                canvasDisplayOrder: this.config.options.canvasDisplayOrder,\r\n                canvases: this.extension.getCurrentCanvases(),\r\n                canvasExclude: this.config.options.canvasExclude,\r\n                canvasLabels: this.extension.getCanvasLabels(this.content.page),\r\n                content: this.config.content,\r\n                copiedMessageDuration: 2000,\r\n                copyToClipboardEnabled: Utils.Bools.getBool(this.config.options.copyToClipboardEnabled, false),\r\n                helper: this.extension.helper,\r\n                licenseFormatter: null,\r\n                limit: this.config.options.textLimit || 4,\r\n                limitType: IIIFComponents.MetadataComponentOptions.LimitType.LINES,\r\n                manifestDisplayOrder: this.config.options.manifestDisplayOrder,\r\n                manifestExclude: this.config.options.manifestExclude,\r\n                range: this.extension.getCurrentCanvasRange(),\r\n                rtlLanguageCodes: this.config.options.rtlLanguageCodes,\r\n                sanitizer: function (html) {\r\n                    return _this.extension.sanitize(html);\r\n                },\r\n                showAllLanguages: this.config.options.showAllLanguages\r\n            };\r\n        };\r\n        MoreInfoDialogue.prototype.close = function () {\r\n            _super.prototype.close.call(this);\r\n        };\r\n        MoreInfoDialogue.prototype.resize = function () {\r\n            this.setDockedPosition();\r\n        };\r\n        return MoreInfoDialogue;\r\n    }(Dialogue_1.Dialogue));\r\n    exports.MoreInfoDialogue = MoreInfoDialogue;\r\n});\r\n//# sourceMappingURL=MoreInfoDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-shared-module/RightPanel',[\"require\", \"exports\", \"./BaseCommands\", \"./BaseExpandPanel\"], function (require, exports, BaseCommands_1, BaseExpandPanel_1) {\r\n    \"use strict\";\r\n    var RightPanel = (function (_super) {\r\n        __extends(RightPanel, _super);\r\n        function RightPanel($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        RightPanel.prototype.create = function () {\r\n            _super.prototype.create.call(this);\r\n            this.$element.width(this.options.panelCollapsedWidth);\r\n        };\r\n        RightPanel.prototype.init = function () {\r\n            var _this = this;\r\n            _super.prototype.init.call(this);\r\n            var shouldOpenPanel = Utils.Bools.getBool(this.extension.getSettings().rightPanelOpen, this.options.panelOpen);\r\n            if (shouldOpenPanel) {\r\n                this.toggle(true);\r\n            }\r\n            $.subscribe(BaseCommands_1.BaseCommands.TOGGLE_EXPAND_RIGHT_PANEL, function () {\r\n                if (_this.isFullyExpanded) {\r\n                    _this.collapseFull();\r\n                }\r\n                else {\r\n                    _this.expandFull();\r\n                }\r\n            });\r\n        };\r\n        RightPanel.prototype.getTargetWidth = function () {\r\n            return this.isExpanded ? this.options.panelCollapsedWidth : this.options.panelExpandedWidth;\r\n        };\r\n        RightPanel.prototype.getTargetLeft = function () {\r\n            return this.isExpanded ? this.$element.parent().width() - this.options.panelCollapsedWidth : this.$element.parent().width() - this.options.panelExpandedWidth;\r\n        };\r\n        RightPanel.prototype.toggleFinish = function () {\r\n            _super.prototype.toggleFinish.call(this);\r\n            if (this.isExpanded) {\r\n                $.publish(BaseCommands_1.BaseCommands.OPEN_RIGHT_PANEL);\r\n            }\r\n            else {\r\n                $.publish(BaseCommands_1.BaseCommands.CLOSE_RIGHT_PANEL);\r\n            }\r\n            this.extension.updateSettings({ rightPanelOpen: this.isExpanded });\r\n        };\r\n        RightPanel.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n            this.$element.css({\r\n                'left': Math.floor(this.$element.parent().width() - this.$element.outerWidth())\r\n            });\r\n        };\r\n        return RightPanel;\r\n    }(BaseExpandPanel_1.BaseExpandPanel));\r\n    exports.RightPanel = RightPanel;\r\n});\r\n//# sourceMappingURL=RightPanel.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-moreinforightpanel-module/MoreInfoRightPanel',[\"require\", \"exports\", \"../uv-shared-module/BaseCommands\", \"../uv-shared-module/RightPanel\"], function (require, exports, BaseCommands_1, RightPanel_1) {\r\n    \"use strict\";\r\n    var MoreInfoRightPanel = (function (_super) {\r\n        __extends(MoreInfoRightPanel, _super);\r\n        function MoreInfoRightPanel($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        MoreInfoRightPanel.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('moreInfoRightPanel');\r\n            _super.prototype.create.call(this);\r\n            $.subscribe(BaseCommands_1.BaseCommands.CANVAS_INDEX_CHANGED, function (e, canvasIndex) {\r\n                _this.databind();\r\n            });\r\n            this.setTitle(this.config.content.title);\r\n            this.$metadata = $('<div class=\"iiif-metadata-component\"></div>');\r\n            this.$main.append(this.$metadata);\r\n            this.component = new IIIFComponents.MetadataComponent({\r\n                target: this.$metadata[0],\r\n                data: this._getData()\r\n            });\r\n        };\r\n        MoreInfoRightPanel.prototype.toggleFinish = function () {\r\n            _super.prototype.toggleFinish.call(this);\r\n            this.databind();\r\n        };\r\n        MoreInfoRightPanel.prototype.databind = function () {\r\n            this.component.options.data = this._getData();\r\n            this.component.set(null); // todo: should be passing data\r\n        };\r\n        MoreInfoRightPanel.prototype._getData = function () {\r\n            var _this = this;\r\n            return {\r\n                canvasDisplayOrder: this.config.options.canvasDisplayOrder,\r\n                canvases: this.extension.getCurrentCanvases(),\r\n                canvasExclude: this.config.options.canvasExclude,\r\n                canvasLabels: this.extension.getCanvasLabels(this.content.page),\r\n                content: this.config.content,\r\n                copiedMessageDuration: 2000,\r\n                copyToClipboardEnabled: Utils.Bools.getBool(this.config.options.copyToClipboardEnabled, false),\r\n                helper: this.extension.helper,\r\n                licenseFormatter: null,\r\n                limit: this.config.options.textLimit || 4,\r\n                limitType: IIIFComponents.MetadataComponentOptions.LimitType.LINES,\r\n                manifestDisplayOrder: this.config.options.manifestDisplayOrder,\r\n                manifestExclude: this.config.options.manifestExclude,\r\n                range: this.extension.getCurrentCanvasRange(),\r\n                rtlLanguageCodes: this.config.options.rtlLanguageCodes,\r\n                sanitizer: function (html) {\r\n                    return _this.extension.sanitize(html);\r\n                },\r\n                showAllLanguages: this.config.options.showAllLanguages\r\n            };\r\n        };\r\n        MoreInfoRightPanel.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n            this.$main.height(this.$element.height() - this.$top.height() - this.$main.verticalMargins());\r\n        };\r\n        return MoreInfoRightPanel;\r\n    }(RightPanel_1.RightPanel));\r\n    exports.MoreInfoRightPanel = MoreInfoRightPanel;\r\n});\r\n//# sourceMappingURL=MoreInfoRightPanel.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-multiselectdialogue-module/MultiSelectDialogue',[\"require\", \"exports\", \"../../extensions/uv-seadragon-extension/Commands\", \"../../modules/uv-shared-module/Dialogue\", \"../../extensions/uv-seadragon-extension/Mode\"], function (require, exports, Commands_1, Dialogue_1, Mode_1) {\r\n    \"use strict\";\r\n    var MultiSelectDialogue = (function (_super) {\r\n        __extends(MultiSelectDialogue, _super);\r\n        function MultiSelectDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        MultiSelectDialogue.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('multiSelectDialogue');\r\n            _super.prototype.create.call(this);\r\n            var that = this;\r\n            this.openCommand = Commands_1.Commands.SHOW_MULTISELECT_DIALOGUE;\r\n            this.closeCommand = Commands_1.Commands.HIDE_MULTISELECT_DIALOGUE;\r\n            $.subscribe(this.openCommand, function (e, params) {\r\n                _this.open();\r\n                var multiSelectState = _this.extension.helper.getMultiSelectState();\r\n                multiSelectState.setEnabled(true);\r\n                _this.component.set(null); // todo: should be passing data\r\n            });\r\n            $.subscribe(this.closeCommand, function (e) {\r\n                _this.close();\r\n                var multiSelectState = _this.extension.helper.getMultiSelectState();\r\n                multiSelectState.setEnabled(false);\r\n            });\r\n            this.$title = $('<h1></h1>');\r\n            this.$content.append(this.$title);\r\n            this.$title.text(this.content.title);\r\n            this.$gallery = $('<div class=\"iiif-gallery-component\"></div>');\r\n            this.$content.append(this.$gallery);\r\n            this.data = {\r\n                helper: this.extension.helper,\r\n                chunkedResizingThreshold: this.config.options.galleryThumbChunkedResizingThreshold,\r\n                content: this.config.content,\r\n                debug: false,\r\n                imageFadeInDuration: 300,\r\n                initialZoom: 4,\r\n                minLabelWidth: 20,\r\n                pageModeEnabled: this.isPageModeEnabled(),\r\n                searchResults: [],\r\n                scrollStopDuration: 100,\r\n                sizingEnabled: true,\r\n                thumbHeight: this.config.options.galleryThumbHeight,\r\n                thumbLoadPadding: this.config.options.galleryThumbLoadPadding,\r\n                thumbWidth: this.config.options.galleryThumbWidth,\r\n                viewingDirection: this.extension.helper.getViewingDirection()\r\n            };\r\n            this.component = new IIIFComponents.GalleryComponent({\r\n                target: this.$gallery[0],\r\n                data: this.data\r\n            });\r\n            var $selectButton = this.$gallery.find('a.select');\r\n            $selectButton.addClass('btn btn-primary');\r\n            this.component.on('multiSelectionMade', function (args) {\r\n                var ids = args[0];\r\n                $.publish(Commands_1.Commands.MULTISELECTION_MADE, [ids]);\r\n                that.close();\r\n            });\r\n            this.$element.hide();\r\n        };\r\n        MultiSelectDialogue.prototype.isPageModeEnabled = function () {\r\n            return Utils.Bools.getBool(this.config.options.pageModeEnabled, true) && this.extension.getMode().toString() === Mode_1.Mode.page.toString();\r\n        };\r\n        MultiSelectDialogue.prototype.open = function () {\r\n            _super.prototype.open.call(this);\r\n        };\r\n        MultiSelectDialogue.prototype.close = function () {\r\n            _super.prototype.close.call(this);\r\n        };\r\n        MultiSelectDialogue.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n            var $main = this.$gallery.find('.main');\r\n            var $header = this.$gallery.find('.header');\r\n            $main.height(this.$content.height() - this.$title.outerHeight() - this.$title.verticalMargins() - $header.height());\r\n        };\r\n        return MultiSelectDialogue;\r\n    }(Dialogue_1.Dialogue));\r\n    exports.MultiSelectDialogue = MultiSelectDialogue;\r\n});\r\n//# sourceMappingURL=MultiSelectDialogue.js.map;\n",
    "define('extensions/uv-seadragon-extension/MultiSelectionArgs',[\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    var MultiSelectionArgs = (function () {\r\n        function MultiSelectionArgs() {\r\n        }\r\n        return MultiSelectionArgs;\r\n    }());\r\n    exports.MultiSelectionArgs = MultiSelectionArgs;\r\n});\r\n//# sourceMappingURL=MultiSelectionArgs.js.map;\n",
    "define('modules/uv-shared-module/Information',[\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    var Information = (function () {\r\n        function Information(message, actions) {\r\n            this.message = message;\r\n            this.actions = actions;\r\n        }\r\n        return Information;\r\n    }());\r\n    exports.Information = Information;\r\n});\r\n//# sourceMappingURL=Information.js.map;\n",
    "define('modules/uv-shared-module/InformationAction',[\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    var InformationAction = (function () {\r\n        function InformationAction() {\r\n        }\r\n        return InformationAction;\r\n    }());\r\n    exports.InformationAction = InformationAction;\r\n});\r\n//# sourceMappingURL=InformationAction.js.map;\n",
    "define('modules/uv-shared-module/InformationFactory',[\"require\", \"exports\", \"./BaseCommands\", \"./Information\", \"./InformationAction\", \"./InformationType\"], function (require, exports, BaseCommands_1, Information_1, InformationAction_1, InformationType_1) {\r\n    \"use strict\";\r\n    var InformationFactory = (function () {\r\n        function InformationFactory(extension) {\r\n            this.extension = extension;\r\n        }\r\n        InformationFactory.prototype.Get = function (args) {\r\n            switch (args.informationType) {\r\n                case (InformationType_1.InformationType.AUTH_CORS_ERROR):\r\n                    return new Information_1.Information(this.extension.config.content.authCORSError, []);\r\n                case (InformationType_1.InformationType.DEGRADED_RESOURCE):\r\n                    var actions = [];\r\n                    var loginAction = new InformationAction_1.InformationAction();\r\n                    loginAction.label = this.extension.config.content.degradedResourceLogin;\r\n                    loginAction.action = function () {\r\n                        $.publish(BaseCommands_1.BaseCommands.HIDE_INFORMATION);\r\n                        $.publish(BaseCommands_1.BaseCommands.OPEN_EXTERNAL_RESOURCE, [[args.param]]);\r\n                    };\r\n                    actions.push(loginAction);\r\n                    return new Information_1.Information(this.extension.config.content.degradedResourceMessage, actions);\r\n            }\r\n        };\r\n        return InformationFactory;\r\n    }());\r\n    exports.InformationFactory = InformationFactory;\r\n});\r\n//# sourceMappingURL=InformationFactory.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-shared-module/HeaderPanel',[\"require\", \"exports\", \"./BaseCommands\", \"./BaseView\", \"../uv-shared-module/InformationFactory\"], function (require, exports, BaseCommands_1, BaseView_1, InformationFactory_1) {\r\n    \"use strict\";\r\n    var HeaderPanel = (function (_super) {\r\n        __extends(HeaderPanel, _super);\r\n        function HeaderPanel($element) {\r\n            return _super.call(this, $element, false, false) || this;\r\n        }\r\n        HeaderPanel.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('headerPanel');\r\n            _super.prototype.create.call(this);\r\n            $.subscribe(BaseCommands_1.BaseCommands.SHOW_INFORMATION, function (e, args) {\r\n                _this.showInformation(args);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.HIDE_INFORMATION, function () {\r\n                _this.hideInformation();\r\n            });\r\n            this.$options = $('<div class=\"options\"></div>');\r\n            this.$element.append(this.$options);\r\n            this.$centerOptions = $('<div class=\"centerOptions\"></div>');\r\n            this.$options.append(this.$centerOptions);\r\n            this.$rightOptions = $('<div class=\"rightOptions\"></div>');\r\n            this.$options.append(this.$rightOptions);\r\n            //this.$helpButton = $('<a href=\"#\" class=\"action help\">' + this.content.help + '</a>');\r\n            //this.$rightOptions.append(this.$helpButton);\r\n            this.$localeToggleButton = $('<a class=\"localeToggle\" tabindex=\"0\"></a>');\r\n            this.$rightOptions.append(this.$localeToggleButton);\r\n            this.$settingsButton = $('<a class=\"imageBtn settings\" tabindex=\"0\"></a>');\r\n            this.$settingsButton.attr('title', this.content.settings);\r\n            this.$rightOptions.append(this.$settingsButton);\r\n            this.$informationBox = $('<div class=\"informationBox\"> \\\r\n                                    <div class=\"message\"></div> \\\r\n                                    <div class=\"actions\"></div> \\\r\n                                    <div class=\"close\"></div> \\\r\n                                  </div>');\r\n            this.$element.append(this.$informationBox);\r\n            this.$informationBox.hide();\r\n            this.$informationBox.find('.close').attr('title', this.content.close);\r\n            this.$informationBox.find('.close').on('click', function (e) {\r\n                e.preventDefault();\r\n                $.publish(BaseCommands_1.BaseCommands.HIDE_INFORMATION);\r\n            });\r\n            this.$localeToggleButton.on('click', function () {\r\n                _this.extension.changeLocale(String(_this.$localeToggleButton.data('locale')));\r\n            });\r\n            this.$settingsButton.onPressed(function () {\r\n                $.publish(BaseCommands_1.BaseCommands.SHOW_SETTINGS_DIALOGUE);\r\n            });\r\n            this.updateLocaleToggle();\r\n            this.updateSettingsButton();\r\n        };\r\n        HeaderPanel.prototype.updateLocaleToggle = function () {\r\n            if (!this.localeToggleIsVisible()) {\r\n                this.$localeToggleButton.hide();\r\n                return;\r\n            }\r\n            var alternateLocale = this.extension.getAlternateLocale();\r\n            var text = alternateLocale.name.split('-')[0].toUpperCase();\r\n            this.$localeToggleButton.data('locale', alternateLocale.name);\r\n            this.$localeToggleButton.attr('title', alternateLocale.label);\r\n            this.$localeToggleButton.text(text);\r\n        };\r\n        HeaderPanel.prototype.updateSettingsButton = function () {\r\n            var settingsEnabled = Utils.Bools.getBool(this.options.settingsButtonEnabled, true);\r\n            if (!settingsEnabled) {\r\n                this.$settingsButton.hide();\r\n            }\r\n            else {\r\n                this.$settingsButton.show();\r\n            }\r\n        };\r\n        HeaderPanel.prototype.localeToggleIsVisible = function () {\r\n            return this.extension.getLocales().length > 1 && Utils.Bools.getBool(this.options.localeToggleEnabled, false);\r\n        };\r\n        HeaderPanel.prototype.showInformation = function (args) {\r\n            var informationFactory = new InformationFactory_1.InformationFactory(this.extension);\r\n            this.information = informationFactory.Get(args);\r\n            var $message = this.$informationBox.find('.message');\r\n            $message.html(this.information.message).find('a').attr('target', '_top');\r\n            var $actions = this.$informationBox.find('.actions');\r\n            $actions.empty();\r\n            for (var i = 0; i < this.information.actions.length; i++) {\r\n                var action = this.information.actions[i];\r\n                var $action = $('<a href=\"#\" class=\"btn btn-default\">' + action.label + '</a>');\r\n                $action.on('click', action.action);\r\n                $actions.append($action);\r\n            }\r\n            this.$informationBox.show();\r\n            this.$element.addClass('showInformation');\r\n            this.extension.resize();\r\n        };\r\n        HeaderPanel.prototype.hideInformation = function () {\r\n            this.$element.removeClass('showInformation');\r\n            this.$informationBox.hide();\r\n            this.extension.resize();\r\n        };\r\n        HeaderPanel.prototype.getSettings = function () {\r\n            return this.extension.getSettings();\r\n        };\r\n        HeaderPanel.prototype.updateSettings = function (settings) {\r\n            this.extension.updateSettings(settings);\r\n            $.publish(BaseCommands_1.BaseCommands.UPDATE_SETTINGS, [settings]);\r\n        };\r\n        HeaderPanel.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n            var headerWidth = this.$element.width();\r\n            var center = headerWidth / 2;\r\n            var containerWidth = this.$centerOptions.outerWidth();\r\n            var pos = center - (containerWidth / 2);\r\n            this.$centerOptions.css({\r\n                left: pos\r\n            });\r\n            if (this.$informationBox.is(':visible')) {\r\n                var $actions = this.$informationBox.find('.actions');\r\n                var $message = this.$informationBox.find('.message');\r\n                $message.width(this.$element.width() - $message.horizontalMargins() - $actions.outerWidth(true) - this.$informationBox.find('.close').outerWidth(true) - 1);\r\n                $message.ellipsisFill(this.information.message);\r\n            }\r\n            // hide toggle buttons below minimum width\r\n            if (this.extension.width() < this.extension.config.options.minWidthBreakPoint) {\r\n                if (this.localeToggleIsVisible())\r\n                    this.$localeToggleButton.hide();\r\n            }\r\n            else {\r\n                if (this.localeToggleIsVisible())\r\n                    this.$localeToggleButton.show();\r\n            }\r\n        };\r\n        return HeaderPanel;\r\n    }(BaseView_1.BaseView));\r\n    exports.HeaderPanel = HeaderPanel;\r\n});\r\n//# sourceMappingURL=HeaderPanel.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-pagingheaderpanel-module/PagingHeaderPanel',[\"require\", \"exports\", \"../uv-shared-module/AutoComplete\", \"../uv-shared-module/BaseCommands\", \"../../extensions/uv-seadragon-extension/Commands\", \"../uv-shared-module/HeaderPanel\", \"../../extensions/uv-seadragon-extension/Mode\"], function (require, exports, AutoComplete_1, BaseCommands_1, Commands_1, HeaderPanel_1, Mode_1) {\r\n    \"use strict\";\r\n    var PagingHeaderPanel = (function (_super) {\r\n        __extends(PagingHeaderPanel, _super);\r\n        function PagingHeaderPanel($element) {\r\n            var _this = _super.call(this, $element) || this;\r\n            _this.firstButtonEnabled = false;\r\n            _this.lastButtonEnabled = false;\r\n            _this.nextButtonEnabled = false;\r\n            _this.prevButtonEnabled = false;\r\n            return _this;\r\n        }\r\n        PagingHeaderPanel.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('pagingHeaderPanel');\r\n            _super.prototype.create.call(this);\r\n            $.subscribe(BaseCommands_1.BaseCommands.CANVAS_INDEX_CHANGED, function (e, canvasIndex) {\r\n                _this.canvasIndexChanged(canvasIndex);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.SETTINGS_CHANGED, function (e) {\r\n                _this.modeChanged();\r\n                _this.updatePagingToggle();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.CANVAS_INDEX_CHANGE_FAILED, function (e) {\r\n                _this.setSearchFieldValue(_this.extension.helper.canvasIndex);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LEFTPANEL_EXPAND_FULL_START, function (e) {\r\n                _this.openGallery();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LEFTPANEL_COLLAPSE_FULL_START, function (e) {\r\n                _this.closeGallery();\r\n            });\r\n            this.$prevOptions = $('<div class=\"prevOptions\"></div>');\r\n            this.$centerOptions.append(this.$prevOptions);\r\n            this.$firstButton = $('<a class=\"imageBtn first\" tabindex=\"0\"></a>');\r\n            this.$prevOptions.append(this.$firstButton);\r\n            this.$prevButton = $('<a class=\"imageBtn prev\" tabindex=\"0\"></a>');\r\n            this.$prevOptions.append(this.$prevButton);\r\n            this.$modeOptions = $('<div class=\"mode\"></div>');\r\n            this.$centerOptions.append(this.$modeOptions);\r\n            this.$imageModeLabel = $('<label for=\"image\">' + this.content.image + '</label>');\r\n            this.$modeOptions.append(this.$imageModeLabel);\r\n            this.$imageModeOption = $('<input type=\"radio\" id=\"image\" name=\"mode\" tabindex=\"0\"/>');\r\n            this.$modeOptions.append(this.$imageModeOption);\r\n            this.$pageModeLabel = $('<label for=\"page\"></label>');\r\n            this.$modeOptions.append(this.$pageModeLabel);\r\n            this.$pageModeOption = $('<input type=\"radio\" id=\"page\" name=\"mode\" tabindex=\"0\"/>');\r\n            this.$modeOptions.append(this.$pageModeOption);\r\n            this.$search = $('<div class=\"search\"></div>');\r\n            this.$centerOptions.append(this.$search);\r\n            this.$searchText = $('<input class=\"searchText\" maxlength=\"50\" type=\"text\" tabindex=\"0\"/>');\r\n            this.$search.append(this.$searchText);\r\n            if (Utils.Bools.getBool(this.options.autoCompleteBoxEnabled, true)) {\r\n                this.$searchText.hide();\r\n                this.$autoCompleteBox = $('<input class=\"autocompleteText\" type=\"text\" maxlength=\"100\" />');\r\n                this.$search.append(this.$autoCompleteBox);\r\n                new AutoComplete_1.AutoComplete(this.$autoCompleteBox, function (term, cb) {\r\n                    var results = [];\r\n                    var canvases = _this.extension.helper.getCanvases();\r\n                    // if in page mode, get canvases by label.\r\n                    if (_this.isPageModeEnabled()) {\r\n                        for (var i = 0; i < canvases.length; i++) {\r\n                            var canvas = canvases[i];\r\n                            var label = Manifesto.TranslationCollection.getValue(canvas.getLabel());\r\n                            if (label.startsWith(term)) {\r\n                                results.push(label);\r\n                            }\r\n                        }\r\n                    }\r\n                    else {\r\n                        // get canvas by index\r\n                        for (var i = 0; i < canvases.length; i++) {\r\n                            var canvas = canvases[i];\r\n                            if (canvas.index.toString().startsWith(term)) {\r\n                                results.push(canvas.index.toString());\r\n                            }\r\n                        }\r\n                    }\r\n                    cb(results);\r\n                }, function (results) {\r\n                    return results;\r\n                }, function (terms) {\r\n                    _this.search(terms);\r\n                }, 300, 0);\r\n            }\r\n            else if (Utils.Bools.getBool(this.options.imageSelectionBoxEnabled, true)) {\r\n                this.$selectionBoxOptions = $('<div class=\"image-selectionbox-options\"></div>');\r\n                this.$centerOptions.append(this.$selectionBoxOptions);\r\n                this.$imageSelectionBox = $('<select class=\"image-selectionbox\" name=\"image-select\" tabindex=\"0\" ></select>');\r\n                this.$selectionBoxOptions.append(this.$imageSelectionBox);\r\n                for (var imageIndex = 0; imageIndex < this.extension.helper.getTotalCanvases(); imageIndex++) {\r\n                    var canvas = this.extension.helper.getCanvasByIndex(imageIndex);\r\n                    var label = this.extension.sanitize(Manifesto.TranslationCollection.getValue(canvas.getLabel()));\r\n                    this.$imageSelectionBox.append('<option value=' + (imageIndex) + '>' + label + '</option>');\r\n                }\r\n                this.$imageSelectionBox.change(function () {\r\n                    var imageIndex = parseInt(_this.$imageSelectionBox.val());\r\n                    $.publish(Commands_1.Commands.IMAGE_SEARCH, [imageIndex]);\r\n                });\r\n            }\r\n            this.$total = $('<span class=\"total\"></span>');\r\n            this.$search.append(this.$total);\r\n            this.$searchButton = $('<a class=\"go btn btn-primary\" tabindex=\"0\">' + this.content.go + '</a>');\r\n            this.$search.append(this.$searchButton);\r\n            this.$nextOptions = $('<div class=\"nextOptions\"></div>');\r\n            this.$centerOptions.append(this.$nextOptions);\r\n            this.$nextButton = $('<a class=\"imageBtn next\" tabindex=\"0\"></a>');\r\n            this.$nextOptions.append(this.$nextButton);\r\n            this.$lastButton = $('<a class=\"imageBtn last\" tabindex=\"0\"></a>');\r\n            this.$nextOptions.append(this.$lastButton);\r\n            if (this.isPageModeEnabled()) {\r\n                this.$pageModeOption.attr('checked', 'checked');\r\n                this.$pageModeOption.removeAttr('disabled');\r\n                this.$pageModeLabel.removeClass('disabled');\r\n            }\r\n            else {\r\n                this.$imageModeOption.attr('checked', 'checked');\r\n                // disable page mode option.\r\n                this.$pageModeOption.attr('disabled', 'disabled');\r\n                this.$pageModeLabel.addClass('disabled');\r\n            }\r\n            if (this.extension.helper.getManifestType().toString() === manifesto.ManifestType.manuscript().toString()) {\r\n                this.$pageModeLabel.text(this.content.folio);\r\n            }\r\n            else {\r\n                this.$pageModeLabel.text(this.content.page);\r\n            }\r\n            this.$galleryButton = $('<a class=\"imageBtn gallery\" title=\"' + this.content.gallery + '\" tabindex=\"0\"></a>');\r\n            this.$rightOptions.prepend(this.$galleryButton);\r\n            this.$pagingToggleButtons = $('<div class=\"pagingToggleButtons\"></div>');\r\n            this.$rightOptions.prepend(this.$pagingToggleButtons);\r\n            this.$oneUpButton = $('<a class=\"imageBtn one-up\" title=\"' + this.content.oneUp + '\" tabindex=\"0\"></a>');\r\n            this.$pagingToggleButtons.append(this.$oneUpButton);\r\n            this.$twoUpButton = $('<a class=\"imageBtn two-up\" title=\"' + this.content.twoUp + '\" tabindex=\"0\"></a>');\r\n            this.$pagingToggleButtons.append(this.$twoUpButton);\r\n            this.updatePagingToggle();\r\n            this.updateGalleryButton();\r\n            this.$oneUpButton.onPressed(function () {\r\n                var enabled = false;\r\n                _this.updateSettings({ pagingEnabled: enabled });\r\n                $.publish(Commands_1.Commands.PAGING_TOGGLED, [enabled]);\r\n            });\r\n            this.$twoUpButton.onPressed(function () {\r\n                var enabled = true;\r\n                _this.updateSettings({ pagingEnabled: enabled });\r\n                $.publish(Commands_1.Commands.PAGING_TOGGLED, [enabled]);\r\n            });\r\n            this.$galleryButton.onPressed(function () {\r\n                $.publish(BaseCommands_1.BaseCommands.TOGGLE_EXPAND_LEFT_PANEL);\r\n            });\r\n            this.setTitles();\r\n            this.setTotal();\r\n            var viewingDirection = this.extension.helper.getViewingDirection();\r\n            // check if the book has more than one page, otherwise hide prev/next options.\r\n            if (this.extension.helper.getTotalCanvases() === 1) {\r\n                this.$centerOptions.hide();\r\n            }\r\n            // ui event handlers.\r\n            this.$firstButton.onPressed(function () {\r\n                switch (viewingDirection.toString()) {\r\n                    case manifesto.ViewingDirection.leftToRight().toString():\r\n                    case manifesto.ViewingDirection.topToBottom().toString():\r\n                    case manifesto.ViewingDirection.bottomToTop().toString():\r\n                        $.publish(Commands_1.Commands.FIRST);\r\n                        break;\r\n                    case manifesto.ViewingDirection.rightToLeft().toString():\r\n                        $.publish(Commands_1.Commands.LAST);\r\n                        break;\r\n                }\r\n            });\r\n            this.$prevButton.onPressed(function () {\r\n                switch (viewingDirection.toString()) {\r\n                    case manifesto.ViewingDirection.leftToRight().toString():\r\n                    case manifesto.ViewingDirection.bottomToTop().toString():\r\n                    case manifesto.ViewingDirection.topToBottom().toString():\r\n                        $.publish(Commands_1.Commands.PREV);\r\n                        break;\r\n                    case manifesto.ViewingDirection.rightToLeft().toString():\r\n                        $.publish(Commands_1.Commands.NEXT);\r\n                        break;\r\n                }\r\n            });\r\n            this.$nextButton.onPressed(function () {\r\n                switch (viewingDirection.toString()) {\r\n                    case manifesto.ViewingDirection.leftToRight().toString():\r\n                    case manifesto.ViewingDirection.bottomToTop().toString():\r\n                    case manifesto.ViewingDirection.topToBottom().toString():\r\n                        $.publish(Commands_1.Commands.NEXT);\r\n                        break;\r\n                    case manifesto.ViewingDirection.rightToLeft().toString():\r\n                        $.publish(Commands_1.Commands.PREV);\r\n                        break;\r\n                }\r\n            });\r\n            this.$lastButton.onPressed(function () {\r\n                switch (viewingDirection.toString()) {\r\n                    case manifesto.ViewingDirection.leftToRight().toString():\r\n                    case manifesto.ViewingDirection.topToBottom().toString():\r\n                    case manifesto.ViewingDirection.bottomToTop().toString():\r\n                        $.publish(Commands_1.Commands.LAST);\r\n                        break;\r\n                    case manifesto.ViewingDirection.rightToLeft().toString():\r\n                        $.publish(Commands_1.Commands.FIRST);\r\n                        break;\r\n                }\r\n            });\r\n            // If page mode is disabled, we don't need to show radio buttons since\r\n            // there is only one option:\r\n            if (!this.config.options.pageModeEnabled) {\r\n                this.$imageModeOption.hide();\r\n                this.$pageModeLabel.hide();\r\n                this.$pageModeOption.hide();\r\n            }\r\n            else {\r\n                // Only activate click actions for mode buttons when controls are\r\n                // visible, since otherwise, clicking on the \"Image\" label can\r\n                // trigger unexpected/undesired side effects.\r\n                this.$imageModeOption.on('click', function (e) {\r\n                    $.publish(Commands_1.Commands.MODE_CHANGED, [Mode_1.Mode.image.toString()]);\r\n                });\r\n                this.$pageModeOption.on('click', function (e) {\r\n                    $.publish(Commands_1.Commands.MODE_CHANGED, [Mode_1.Mode.page.toString()]);\r\n                });\r\n            }\r\n            this.$searchText.onEnter(function () {\r\n                _this.$searchText.blur();\r\n                _this.search(_this.$searchText.val());\r\n            });\r\n            this.$searchText.click(function () {\r\n                $(this).select();\r\n            });\r\n            this.$searchButton.onPressed(function () {\r\n                if (_this.options.autoCompleteBoxEnabled) {\r\n                    _this.search(_this.$autoCompleteBox.val());\r\n                }\r\n                else {\r\n                    _this.search(_this.$searchText.val());\r\n                }\r\n            });\r\n            if (this.options.modeOptionsEnabled === false) {\r\n                this.$modeOptions.hide();\r\n                this.$centerOptions.addClass('modeOptionsDisabled');\r\n            }\r\n            // Search is shown as default\r\n            if (this.options.imageSelectionBoxEnabled === true && this.options.autoCompleteBoxEnabled !== true) {\r\n                this.$search.hide();\r\n            }\r\n            if (this.options.helpEnabled === false) {\r\n                this.$helpButton.hide();\r\n            }\r\n            // todo: discuss on community call\r\n            // Get visible element in centerOptions with greatest tabIndex\r\n            // var $elementWithGreatestTabIndex: JQuery = this.$centerOptions.getVisibleElementWithGreatestTabIndex();\r\n            // // cycle focus back to start.\r\n            // if ($elementWithGreatestTabIndex) {\r\n            //     $elementWithGreatestTabIndex.blur(() => {\r\n            //         if (this.extension.tabbing && !this.extension.shifted) {\r\n            //             this.$nextButton.focus();\r\n            //         }\r\n            //     });\r\n            // }\r\n            // this.$nextButton.blur(() => {\r\n            //     if (this.extension.tabbing && this.extension.shifted) {\r\n            //         setTimeout(() => {\r\n            //             $elementWithGreatestTabIndex.focus();\r\n            //         }, 100);\r\n            //     }\r\n            // });\r\n            if (!Utils.Bools.getBool(this.options.pagingToggleEnabled, true)) {\r\n                this.$pagingToggleButtons.hide();\r\n            }\r\n        };\r\n        PagingHeaderPanel.prototype.openGallery = function () {\r\n            this.$oneUpButton.removeClass('on');\r\n            this.$twoUpButton.removeClass('on');\r\n            this.$galleryButton.addClass('on');\r\n        };\r\n        PagingHeaderPanel.prototype.closeGallery = function () {\r\n            this.updatePagingToggle();\r\n            this.$galleryButton.removeClass('on');\r\n        };\r\n        PagingHeaderPanel.prototype.isPageModeEnabled = function () {\r\n            return this.config.options.pageModeEnabled && this.extension.getMode().toString() === Mode_1.Mode.page.toString();\r\n        };\r\n        PagingHeaderPanel.prototype.setTitles = function () {\r\n            if (this.isPageModeEnabled()) {\r\n                this.$firstButton.prop('title', this.content.firstPage);\r\n                this.$prevButton.prop('title', this.content.previousPage);\r\n                this.$nextButton.prop('title', this.content.nextPage);\r\n                this.$lastButton.prop('title', this.content.lastPage);\r\n            }\r\n            else {\r\n                this.$firstButton.prop('title', this.content.firstImage);\r\n                this.$prevButton.prop('title', this.content.previousImage);\r\n                this.$nextButton.prop('title', this.content.nextImage);\r\n                this.$lastButton.prop('title', this.content.lastImage);\r\n            }\r\n            this.$searchButton.prop('title', this.content.go);\r\n        };\r\n        PagingHeaderPanel.prototype.updatePagingToggle = function () {\r\n            if (!this.pagingToggleIsVisible()) {\r\n                this.$pagingToggleButtons.hide();\r\n                return;\r\n            }\r\n            if (this.extension.isPagingSettingEnabled()) {\r\n                this.$oneUpButton.removeClass('on');\r\n                this.$twoUpButton.addClass('on');\r\n            }\r\n            else {\r\n                this.$twoUpButton.removeClass('on');\r\n                this.$oneUpButton.addClass('on');\r\n            }\r\n        };\r\n        PagingHeaderPanel.prototype.pagingToggleIsVisible = function () {\r\n            return Utils.Bools.getBool(this.options.pagingToggleEnabled, true) && this.extension.helper.isPagingAvailable();\r\n        };\r\n        PagingHeaderPanel.prototype.updateGalleryButton = function () {\r\n            if (!this.galleryIsVisible()) {\r\n                this.$galleryButton.hide();\r\n            }\r\n        };\r\n        PagingHeaderPanel.prototype.galleryIsVisible = function () {\r\n            return Utils.Bools.getBool(this.options.galleryButtonEnabled, true) && this.extension.isLeftPanelEnabled();\r\n        };\r\n        PagingHeaderPanel.prototype.setTotal = function () {\r\n            var of = this.content.of;\r\n            if (this.isPageModeEnabled()) {\r\n                this.$total.html(String.format(of, this.extension.helper.getLastCanvasLabel(true)));\r\n            }\r\n            else {\r\n                this.$total.html(String.format(of, this.extension.helper.getTotalCanvases()));\r\n            }\r\n        };\r\n        PagingHeaderPanel.prototype.setSearchFieldValue = function (index) {\r\n            var canvas = this.extension.helper.getCanvasByIndex(index);\r\n            var value;\r\n            if (this.isPageModeEnabled()) {\r\n                var orderLabel = Manifesto.TranslationCollection.getValue(canvas.getLabel());\r\n                if (orderLabel === \"-\") {\r\n                    value = \"\";\r\n                }\r\n                else {\r\n                    value = orderLabel;\r\n                }\r\n            }\r\n            else {\r\n                index += 1;\r\n                value = index;\r\n            }\r\n            if (this.options.autoCompleteBoxEnabled) {\r\n                this.$autoCompleteBox.val(value);\r\n            }\r\n            else {\r\n                this.$searchText.val(value);\r\n            }\r\n        };\r\n        PagingHeaderPanel.prototype.search = function (value) {\r\n            if (!value) {\r\n                this.extension.showMessage(this.content.emptyValue);\r\n                $.publish(BaseCommands_1.BaseCommands.CANVAS_INDEX_CHANGE_FAILED);\r\n                return;\r\n            }\r\n            if (this.isPageModeEnabled()) {\r\n                $.publish(Commands_1.Commands.PAGE_SEARCH, [value]);\r\n            }\r\n            else {\r\n                var index;\r\n                if (this.options.autoCompleteBoxEnabled) {\r\n                    index = parseInt(this.$autoCompleteBox.val(), 10);\r\n                }\r\n                else {\r\n                    index = parseInt(this.$searchText.val(), 10);\r\n                }\r\n                index -= 1;\r\n                if (isNaN(index)) {\r\n                    this.extension.showMessage(this.extension.config.modules.genericDialogue.content.invalidNumber);\r\n                    $.publish(BaseCommands_1.BaseCommands.CANVAS_INDEX_CHANGE_FAILED);\r\n                    return;\r\n                }\r\n                var asset = this.extension.helper.getCanvasByIndex(index);\r\n                if (!asset) {\r\n                    this.extension.showMessage(this.extension.config.modules.genericDialogue.content.pageNotFound);\r\n                    $.publish(BaseCommands_1.BaseCommands.CANVAS_INDEX_CHANGE_FAILED);\r\n                    return;\r\n                }\r\n                $.publish(Commands_1.Commands.IMAGE_SEARCH, [index]);\r\n            }\r\n        };\r\n        PagingHeaderPanel.prototype.canvasIndexChanged = function (index) {\r\n            this.setSearchFieldValue(index);\r\n            if (this.options.imageSelectionBoxEnabled === true && this.options.autoCompleteBoxEnabled !== true) {\r\n                this.$imageSelectionBox.val(index);\r\n            }\r\n            var viewingDirection = this.extension.helper.getViewingDirection();\r\n            if (viewingDirection.toString() === manifesto.ViewingDirection.rightToLeft().toString()) {\r\n                if (this.extension.helper.isFirstCanvas()) {\r\n                    this.disableLastButton();\r\n                    this.disableNextButton();\r\n                }\r\n                else {\r\n                    this.enableLastButton();\r\n                    this.enableNextButton();\r\n                }\r\n                if (this.extension.helper.isLastCanvas()) {\r\n                    this.disableFirstButton();\r\n                    this.disablePrevButton();\r\n                }\r\n                else {\r\n                    this.enableFirstButton();\r\n                    this.enablePrevButton();\r\n                }\r\n            }\r\n            else {\r\n                if (this.extension.helper.isFirstCanvas()) {\r\n                    this.disableFirstButton();\r\n                    this.disablePrevButton();\r\n                }\r\n                else {\r\n                    this.enableFirstButton();\r\n                    this.enablePrevButton();\r\n                }\r\n                if (this.extension.helper.isLastCanvas()) {\r\n                    this.disableLastButton();\r\n                    this.disableNextButton();\r\n                }\r\n                else {\r\n                    this.enableLastButton();\r\n                    this.enableNextButton();\r\n                }\r\n            }\r\n        };\r\n        PagingHeaderPanel.prototype.disableFirstButton = function () {\r\n            this.firstButtonEnabled = false;\r\n            this.$firstButton.disable();\r\n        };\r\n        PagingHeaderPanel.prototype.enableFirstButton = function () {\r\n            this.firstButtonEnabled = true;\r\n            this.$firstButton.enable();\r\n        };\r\n        PagingHeaderPanel.prototype.disableLastButton = function () {\r\n            this.lastButtonEnabled = false;\r\n            this.$lastButton.disable();\r\n        };\r\n        PagingHeaderPanel.prototype.enableLastButton = function () {\r\n            this.lastButtonEnabled = true;\r\n            this.$lastButton.enable();\r\n        };\r\n        PagingHeaderPanel.prototype.disablePrevButton = function () {\r\n            this.prevButtonEnabled = false;\r\n            this.$prevButton.disable();\r\n        };\r\n        PagingHeaderPanel.prototype.enablePrevButton = function () {\r\n            this.prevButtonEnabled = true;\r\n            this.$prevButton.enable();\r\n        };\r\n        PagingHeaderPanel.prototype.disableNextButton = function () {\r\n            this.nextButtonEnabled = false;\r\n            this.$nextButton.disable();\r\n        };\r\n        PagingHeaderPanel.prototype.enableNextButton = function () {\r\n            this.nextButtonEnabled = true;\r\n            this.$nextButton.enable();\r\n        };\r\n        PagingHeaderPanel.prototype.modeChanged = function () {\r\n            this.setSearchFieldValue(this.extension.helper.canvasIndex);\r\n            this.setTitles();\r\n            this.setTotal();\r\n        };\r\n        PagingHeaderPanel.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n            // hide toggle buttons below minimum width\r\n            if (this.extension.width() < this.extension.config.options.minWidthBreakPoint) {\r\n                if (this.pagingToggleIsVisible())\r\n                    this.$pagingToggleButtons.hide();\r\n                if (this.galleryIsVisible())\r\n                    this.$galleryButton.hide();\r\n            }\r\n            else {\r\n                if (this.pagingToggleIsVisible())\r\n                    this.$pagingToggleButtons.show();\r\n                if (this.galleryIsVisible())\r\n                    this.$galleryButton.show();\r\n            }\r\n        };\r\n        return PagingHeaderPanel;\r\n    }(HeaderPanel_1.HeaderPanel));\r\n    exports.PagingHeaderPanel = PagingHeaderPanel;\r\n});\r\n//# sourceMappingURL=PagingHeaderPanel.js.map;\n",
    "define('extensions/uv-seadragon-extension/Bounds',[\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    var Bounds = (function () {\r\n        function Bounds(x, y, w, h) {\r\n            this.x = x;\r\n            this.y = y;\r\n            this.w = w;\r\n            this.h = h;\r\n        }\r\n        Bounds.prototype.toString = function () {\r\n            return this.x + \",\" + this.y + \",\" + this.w + \",\" + this.h;\r\n        };\r\n        Bounds.fromString = function (bounds) {\r\n            var boundsArr = bounds.split(',');\r\n            return new Bounds(Number(boundsArr[0]), Number(boundsArr[1]), Number(boundsArr[2]), Number(boundsArr[3]));\r\n        };\r\n        return Bounds;\r\n    }());\r\n    exports.Bounds = Bounds;\r\n});\r\n//# sourceMappingURL=Bounds.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-shared-module/CenterPanel',[\"require\", \"exports\", \"./Shell\", \"./BaseView\"], function (require, exports, Shell_1, BaseView_1) {\r\n    \"use strict\";\r\n    var CenterPanel = (function (_super) {\r\n        __extends(CenterPanel, _super);\r\n        function CenterPanel($element) {\r\n            return _super.call(this, $element, false, true) || this;\r\n        }\r\n        CenterPanel.prototype.create = function () {\r\n            var _this = this;\r\n            _super.prototype.create.call(this);\r\n            this.$title = $('<div class=\"title\"></div>');\r\n            this.$element.append(this.$title);\r\n            this.$content = $('<div id=\"content\" class=\"content\"></div>');\r\n            this.$element.append(this.$content);\r\n            this.$attribution = $('<div class=\"attribution\">\\\r\n                                   <div class=\"header\">\\\r\n                                       <div class=\"title\"></div>\\\r\n                                       <div class=\"close\"></div>\\\r\n                                   </div>\\\r\n                                   <div class=\"main\">\\\r\n                                       <div class=\"attribution-text\"></div>\\\r\n                                       <div class=\"license\"></div>\\\r\n                                       <div class=\"logo\"></div>\\\r\n                                   </div>\\\r\n                              </div>');\r\n            this.$attribution.find('.header .title').text(this.content.attribution);\r\n            this.$content.append(this.$attribution);\r\n            this.$attribution.hide();\r\n            this.$closeAttributionButton = this.$attribution.find('.header .close');\r\n            this.$closeAttributionButton.on('click', function (e) {\r\n                e.preventDefault();\r\n                _this.$attribution.hide();\r\n            });\r\n            if (!Utils.Bools.getBool(this.options.titleEnabled, true)) {\r\n                this.$title.hide();\r\n            }\r\n        };\r\n        CenterPanel.prototype.updateAttribution = function () {\r\n            var _this = this;\r\n            var attribution = this.extension.helper.getAttribution();\r\n            //var license = this.provider.getLicense();\r\n            //var logo = this.provider.getLogo();\r\n            var enabled = Utils.Bools.getBool(this.options.attributionEnabled, true);\r\n            if (!attribution || !enabled) {\r\n                return;\r\n            }\r\n            this.$attribution.show();\r\n            var $attribution = this.$attribution.find('.attribution-text');\r\n            var $license = this.$attribution.find('.license');\r\n            var $logo = this.$attribution.find('.logo');\r\n            $attribution.html(this.extension.sanitize(attribution));\r\n            $attribution.find('img').one(\"load\", function () {\r\n                _this.resize();\r\n            }).each(function () {\r\n                if (this.complete)\r\n                    $(this).load();\r\n            });\r\n            $attribution.targetBlank();\r\n            $attribution.toggleExpandText(this.options.trimAttributionCount, function () {\r\n                _this.resize();\r\n            });\r\n            //if (license){\r\n            //    $license.append('<a href=\"' + license + '\">' + license + '</a>');\r\n            //} else {\r\n            $license.hide();\r\n            //}\r\n            //\r\n            //if (logo){\r\n            //    $logo.append('<img src=\"' + logo + '\"/>');\r\n            //} else {\r\n            $logo.hide();\r\n            //}\r\n        };\r\n        CenterPanel.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n            var leftPanelWidth = Shell_1.Shell.$leftPanel.is(':visible') ? Math.floor(Shell_1.Shell.$leftPanel.width()) : 0;\r\n            var rightPanelWidth = Shell_1.Shell.$rightPanel.is(':visible') ? Math.floor(Shell_1.Shell.$rightPanel.width()) : 0;\r\n            var width = Math.floor(this.$element.parent().width() - leftPanelWidth - rightPanelWidth);\r\n            this.$element.css({\r\n                'left': leftPanelWidth,\r\n                'width': width\r\n            });\r\n            var titleHeight;\r\n            if (this.options && this.options.titleEnabled === false) {\r\n                titleHeight = 0;\r\n            }\r\n            else {\r\n                titleHeight = this.$title.height();\r\n            }\r\n            this.$content.height(this.$element.height() - titleHeight);\r\n            this.$content.width(this.$element.width());\r\n            if (this.$attribution && this.$attribution.is(':visible')) {\r\n                this.$attribution.css('top', this.$content.height() - this.$attribution.outerHeight() - this.$attribution.verticalMargins());\r\n            }\r\n        };\r\n        return CenterPanel;\r\n    }(BaseView_1.BaseView));\r\n    exports.CenterPanel = CenterPanel;\r\n});\r\n//# sourceMappingURL=CenterPanel.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-seadragoncenterpanel-module/SeadragonCenterPanel',[\"require\", \"exports\", \"../uv-shared-module/BaseCommands\", \"../../extensions/uv-seadragon-extension/Bounds\", \"../uv-shared-module/CenterPanel\", \"../../extensions/uv-seadragon-extension/Commands\", \"../uv-shared-module/Metrics\", \"../../Params\"], function (require, exports, BaseCommands_1, Bounds_1, CenterPanel_1, Commands_1, Metrics_1, Params_1) {\r\n    \"use strict\";\r\n    var SeadragonCenterPanel = (function (_super) {\r\n        __extends(SeadragonCenterPanel, _super);\r\n        function SeadragonCenterPanel($element) {\r\n            var _this = _super.call(this, $element) || this;\r\n            _this.controlsVisible = false;\r\n            _this.isCreated = false;\r\n            _this.isFirstLoad = true;\r\n            _this.nextButtonEnabled = false;\r\n            _this.prevButtonEnabled = false;\r\n            return _this;\r\n        }\r\n        SeadragonCenterPanel.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('seadragonCenterPanel');\r\n            _super.prototype.create.call(this);\r\n            this.$viewer = $('<div id=\"viewer\"></div>');\r\n            this.$content.prepend(this.$viewer);\r\n            $.subscribe(BaseCommands_1.BaseCommands.SETTINGS_CHANGED, function (e, args) {\r\n                _this.viewer.gestureSettingsMouse.clickToZoom = args.clickToZoomEnabled;\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.OPEN_EXTERNAL_RESOURCE, function (e, resources) {\r\n                _this.whenResized(function () {\r\n                    if (!_this.isCreated)\r\n                        _this.createUI();\r\n                    _this.openMedia(resources);\r\n                });\r\n            });\r\n            $.subscribe(Commands_1.Commands.CLEAR_SEARCH, function () {\r\n                _this.whenCreated(function () {\r\n                    _this.extension.currentSearchResultRect = null;\r\n                    _this.clearSearchResults();\r\n                });\r\n            });\r\n            $.subscribe(Commands_1.Commands.VIEW_PAGE, function () {\r\n                _this.extension.previousSearchResultRect = null;\r\n                _this.extension.currentSearchResultRect = null;\r\n            });\r\n            $.subscribe(Commands_1.Commands.NEXT_SEARCH_RESULT, function () {\r\n                _this.whenCreated(function () {\r\n                    _this.nextSearchResult();\r\n                });\r\n            });\r\n            $.subscribe(Commands_1.Commands.PREV_SEARCH_RESULT, function () {\r\n                _this.whenCreated(function () {\r\n                    _this.prevSearchResult();\r\n                });\r\n            });\r\n            $.subscribe(Commands_1.Commands.ZOOM_IN, function () {\r\n                _this.whenCreated(function () {\r\n                    _this.zoomIn();\r\n                });\r\n            });\r\n            $.subscribe(Commands_1.Commands.ZOOM_OUT, function () {\r\n                _this.whenCreated(function () {\r\n                    _this.zoomOut();\r\n                });\r\n            });\r\n            $.subscribe(Commands_1.Commands.ROTATE, function () {\r\n                _this.whenCreated(function () {\r\n                    _this.rotateRight();\r\n                });\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.METRIC_CHANGED, function () {\r\n                _this.whenCreated(function () {\r\n                    _this.updateResponsiveView();\r\n                });\r\n            });\r\n        };\r\n        SeadragonCenterPanel.prototype.whenResized = function (cb) {\r\n            var _this = this;\r\n            Utils.Async.waitFor(function () {\r\n                return _this.isResized;\r\n            }, cb);\r\n        };\r\n        SeadragonCenterPanel.prototype.whenCreated = function (cb) {\r\n            var _this = this;\r\n            Utils.Async.waitFor(function () {\r\n                return _this.isCreated;\r\n            }, cb);\r\n        };\r\n        SeadragonCenterPanel.prototype.zoomIn = function () {\r\n            this.viewer.viewport.zoomTo(this.viewer.viewport.getZoom(true) * 2);\r\n        };\r\n        SeadragonCenterPanel.prototype.zoomOut = function () {\r\n            this.viewer.viewport.zoomTo(this.viewer.viewport.getZoom(true) * 0.5);\r\n        };\r\n        SeadragonCenterPanel.prototype.rotateRight = function () {\r\n            this.viewer.viewport.setRotation(this.viewer.viewport.getRotation() + 90);\r\n        };\r\n        SeadragonCenterPanel.prototype.updateResponsiveView = function () {\r\n            this.setNavigatorVisible();\r\n            if (this.extension.metric === Metrics_1.Metrics.MOBILE_LANDSCAPE) {\r\n                this.viewer.autoHideControls = false;\r\n                this.$viewportNavButtons.hide();\r\n            }\r\n            else {\r\n                this.viewer.autoHideControls = true;\r\n                this.$viewportNavButtons.show();\r\n            }\r\n        };\r\n        SeadragonCenterPanel.prototype.createUI = function () {\r\n            var _this = this;\r\n            var that = this;\r\n            this.$spinner = $('<div class=\"spinner\"></div>');\r\n            this.$content.append(this.$spinner);\r\n            this.updateAttribution();\r\n            // todo: use compiler flag (when available)\r\n            var prefixUrl = 'themes/' + this.extension.config.options.theme + '/img/uv-seadragoncenterpanel-module/';\r\n            // add to window object for testing automation purposes.\r\n            window.openSeadragonViewer = this.viewer = OpenSeadragon({\r\n                id: \"viewer\",\r\n                ajaxWithCredentials: false,\r\n                showNavigationControl: true,\r\n                showNavigator: true,\r\n                showRotationControl: true,\r\n                showHomeControl: Utils.Bools.getBool(this.config.options.showHomeControl, false),\r\n                showFullPageControl: false,\r\n                defaultZoomLevel: this.config.options.defaultZoomLevel || 0,\r\n                maxZoomPixelRatio: this.config.options.maxZoomPixelRatio || 2,\r\n                controlsFadeDelay: this.config.options.controlsFadeDelay || 250,\r\n                controlsFadeLength: this.config.options.controlsFadeLength || 250,\r\n                navigatorPosition: this.config.options.navigatorPosition || \"BOTTOM_RIGHT\",\r\n                animationTime: this.config.options.animationTime || 1.2,\r\n                visibilityRatio: this.config.options.visibilityRatio || 0.5,\r\n                constrainDuringPan: Utils.Bools.getBool(this.config.options.constrainDuringPan, false),\r\n                immediateRender: Utils.Bools.getBool(this.config.options.immediateRender, false),\r\n                blendTime: this.config.options.blendTime || 0,\r\n                autoHideControls: Utils.Bools.getBool(this.config.options.autoHideControls, true),\r\n                prefixUrl: prefixUrl,\r\n                gestureSettingsMouse: {\r\n                    clickToZoom: !!this.extension.config.options.clickToZoomEnabled\r\n                },\r\n                navImages: {\r\n                    zoomIn: {\r\n                        REST: 'zoom_in.png',\r\n                        GROUP: 'zoom_in.png',\r\n                        HOVER: 'zoom_in.png',\r\n                        DOWN: 'zoom_in.png'\r\n                    },\r\n                    zoomOut: {\r\n                        REST: 'zoom_out.png',\r\n                        GROUP: 'zoom_out.png',\r\n                        HOVER: 'zoom_out.png',\r\n                        DOWN: 'zoom_out.png'\r\n                    },\r\n                    home: {\r\n                        REST: 'home.png',\r\n                        GROUP: 'home.png',\r\n                        HOVER: 'home.png',\r\n                        DOWN: 'home.png'\r\n                    },\r\n                    rotateright: {\r\n                        REST: 'rotate_right.png',\r\n                        GROUP: 'rotate_right.png',\r\n                        HOVER: 'rotate_right.png',\r\n                        DOWN: 'rotate_right.png'\r\n                    },\r\n                    rotateleft: {\r\n                        REST: 'pixel.gif',\r\n                        GROUP: 'pixel.gif',\r\n                        HOVER: 'pixel.gif',\r\n                        DOWN: 'pixel.gif'\r\n                    },\r\n                    next: {\r\n                        REST: 'pixel.gif',\r\n                        GROUP: 'pixel.gif',\r\n                        HOVER: 'pixel.gif',\r\n                        DOWN: 'pixel.gif'\r\n                    },\r\n                    previous: {\r\n                        REST: 'pixel.gif',\r\n                        GROUP: 'pixel.gif',\r\n                        HOVER: 'pixel.gif',\r\n                        DOWN: 'pixel.gif'\r\n                    }\r\n                }\r\n            });\r\n            this.$zoomInButton = this.$viewer.find('div[title=\"Zoom in\"]');\r\n            this.$zoomInButton.attr('tabindex', 0);\r\n            this.$zoomInButton.prop('title', this.content.zoomIn);\r\n            this.$zoomInButton.addClass('zoomIn viewportNavButton');\r\n            this.$zoomOutButton = this.$viewer.find('div[title=\"Zoom out\"]');\r\n            this.$zoomOutButton.attr('tabindex', 0);\r\n            this.$zoomOutButton.prop('title', this.content.zoomOut);\r\n            this.$zoomOutButton.addClass('zoomOut viewportNavButton');\r\n            this.$goHomeButton = this.$viewer.find('div[title=\"Go home\"]');\r\n            this.$goHomeButton.attr('tabindex', 0);\r\n            this.$goHomeButton.prop('title', this.content.goHome);\r\n            this.$goHomeButton.addClass('goHome viewportNavButton');\r\n            this.$rotateButton = this.$viewer.find('div[title=\"Rotate right\"]');\r\n            this.$rotateButton.attr('tabindex', 0);\r\n            this.$rotateButton.prop('title', this.content.rotateRight);\r\n            this.$rotateButton.addClass('rotate viewportNavButton');\r\n            this.$viewportNavButtonsContainer = this.$viewer.find('.openseadragon-container > div:not(.openseadragon-canvas):first');\r\n            this.$viewportNavButtons = this.$viewportNavButtonsContainer.find('.viewportNavButton');\r\n            this.$canvas = $(this.viewer.canvas);\r\n            this.$canvas.on('contextmenu', function (e) { return false; });\r\n            this.$navigator = this.$viewer.find(\".navigator\");\r\n            this.setNavigatorVisible();\r\n            // events\r\n            this.$element.on('mousemove', function (e) {\r\n                if (_this.controlsVisible)\r\n                    return;\r\n                _this.controlsVisible = true;\r\n                _this.viewer.setControlsEnabled(true);\r\n            });\r\n            this.$element.on('mouseleave', function (e) {\r\n                if (!_this.controlsVisible)\r\n                    return;\r\n                _this.controlsVisible = false;\r\n                _this.viewer.setControlsEnabled(false);\r\n            });\r\n            // when mouse move stopped\r\n            this.$element.on('mousemove', function (e) {\r\n                // if over element, hide controls.\r\n                if (!_this.$viewer.find('.navigator').ismouseover()) {\r\n                    if (!_this.controlsVisible)\r\n                        return;\r\n                    _this.controlsVisible = false;\r\n                    _this.viewer.setControlsEnabled(false);\r\n                }\r\n            }, this.config.options.controlsFadeAfterInactive);\r\n            this.viewer.addHandler('tile-drawn', function () {\r\n                _this.$spinner.hide();\r\n            });\r\n            //this.viewer.addHandler(\"open-failed\", () => {\r\n            //});\r\n            this.viewer.addHandler('resize', function (viewer) {\r\n                $.publish(Commands_1.Commands.SEADRAGON_RESIZE, [viewer]);\r\n                _this.viewerResize(viewer);\r\n            });\r\n            this.viewer.addHandler('animation-start', function (viewer) {\r\n                $.publish(Commands_1.Commands.SEADRAGON_ANIMATION_START, [viewer]);\r\n            });\r\n            this.viewer.addHandler('animation', function (viewer) {\r\n                $.publish(Commands_1.Commands.SEADRAGON_ANIMATION, [viewer]);\r\n            });\r\n            this.viewer.addHandler('animation-finish', function (viewer) {\r\n                _this.currentBounds = _this.getViewportBounds();\r\n                _this.updateVisibleSearchResultRects();\r\n                $.publish(Commands_1.Commands.SEADRAGON_ANIMATION_FINISH, [viewer]);\r\n            });\r\n            this.viewer.addHandler('rotate', function (args) {\r\n                $.publish(Commands_1.Commands.SEADRAGON_ROTATION, [args.degrees]);\r\n            });\r\n            this.title = this.extension.helper.getLabel();\r\n            this.createNavigationButtons();\r\n            this.hidePrevButton();\r\n            this.hideNextButton();\r\n            this.isCreated = true;\r\n            this.resize();\r\n        };\r\n        SeadragonCenterPanel.prototype.createNavigationButtons = function () {\r\n            var viewingDirection = this.extension.helper.getViewingDirection();\r\n            this.$prevButton = $('<div class=\"paging btn prev\" tabindex=\"0\"></div>');\r\n            this.$prevButton.prop('title', this.content.previous);\r\n            this.$nextButton = $('<div class=\"paging btn next\" tabindex=\"0\"></div>');\r\n            this.$nextButton.prop('title', this.content.next);\r\n            this.viewer.addControl(this.$prevButton[0], { anchor: OpenSeadragon.ControlAnchor.TOP_LEFT });\r\n            this.viewer.addControl(this.$nextButton[0], { anchor: OpenSeadragon.ControlAnchor.TOP_RIGHT });\r\n            switch (viewingDirection.toString()) {\r\n                case manifesto.ViewingDirection.bottomToTop().toString():\r\n                case manifesto.ViewingDirection.topToBottom().toString():\r\n                    this.$prevButton.addClass('vertical');\r\n                    this.$nextButton.addClass('vertical');\r\n                    ;\r\n                    break;\r\n            }\r\n            var that = this;\r\n            this.$prevButton.onPressed(function (e) {\r\n                e.preventDefault();\r\n                OpenSeadragon.cancelEvent(e);\r\n                if (!that.prevButtonEnabled)\r\n                    return;\r\n                switch (viewingDirection.toString()) {\r\n                    case manifesto.ViewingDirection.leftToRight().toString():\r\n                    case manifesto.ViewingDirection.bottomToTop().toString():\r\n                    case manifesto.ViewingDirection.topToBottom().toString():\r\n                        $.publish(Commands_1.Commands.PREV);\r\n                        break;\r\n                    case manifesto.ViewingDirection.rightToLeft().toString():\r\n                        $.publish(Commands_1.Commands.NEXT);\r\n                        break;\r\n                }\r\n            });\r\n            this.$nextButton.onPressed(function (e) {\r\n                e.preventDefault();\r\n                OpenSeadragon.cancelEvent(e);\r\n                if (!that.nextButtonEnabled)\r\n                    return;\r\n                switch (viewingDirection.toString()) {\r\n                    case manifesto.ViewingDirection.leftToRight().toString():\r\n                    case manifesto.ViewingDirection.bottomToTop().toString():\r\n                    case manifesto.ViewingDirection.topToBottom().toString():\r\n                        $.publish(Commands_1.Commands.NEXT);\r\n                        break;\r\n                    case manifesto.ViewingDirection.rightToLeft().toString():\r\n                        $.publish(Commands_1.Commands.PREV);\r\n                        break;\r\n                }\r\n            });\r\n        };\r\n        SeadragonCenterPanel.prototype.openMedia = function (resources) {\r\n            var _this = this;\r\n            this.$spinner.show();\r\n            this.items = [];\r\n            // todo: this should be a more specific Manifold.IImageResource\r\n            this.extension.getExternalResources(resources).then(function (resources) {\r\n                // OSD can open an array info.json objects\r\n                //this.viewer.open(resources);\r\n                _this.viewer.close();\r\n                resources = _this.getPagePositions(resources);\r\n                for (var i = 0; i < resources.length; i++) {\r\n                    var resource = resources[i];\r\n                    _this.viewer.addTiledImage({\r\n                        tileSource: resource,\r\n                        x: resource.x,\r\n                        y: resource.y,\r\n                        width: resource.width,\r\n                        success: function (item) {\r\n                            _this.items.push(item);\r\n                            if (_this.items.length === resources.length) {\r\n                                _this.openPagesHandler();\r\n                            }\r\n                            _this.resize();\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        };\r\n        SeadragonCenterPanel.prototype.getPagePositions = function (resources) {\r\n            var leftPage;\r\n            var rightPage;\r\n            var topPage;\r\n            var bottomPage;\r\n            var page;\r\n            var nextPage;\r\n            // if there's more than one image, determine alignment strategy\r\n            if (resources.length > 1) {\r\n                if (resources.length === 2) {\r\n                    // recto verso\r\n                    if (this.extension.helper.isVerticallyAligned()) {\r\n                        // vertical alignment\r\n                        topPage = resources[0];\r\n                        topPage.y = 0;\r\n                        bottomPage = resources[1];\r\n                        bottomPage.y = topPage.height + this.config.options.pageGap;\r\n                    }\r\n                    else {\r\n                        // horizontal alignment\r\n                        leftPage = resources[0];\r\n                        leftPage.x = 0;\r\n                        rightPage = resources[1];\r\n                        rightPage.x = leftPage.width + this.config.options.pageGap;\r\n                    }\r\n                }\r\n                else {\r\n                    // scroll\r\n                    if (this.extension.helper.isVerticallyAligned()) {\r\n                        // vertical alignment\r\n                        if (this.extension.helper.isTopToBottom()) {\r\n                            // top to bottom\r\n                            for (var i = 0; i < resources.length - 1; i++) {\r\n                                page = resources[i];\r\n                                nextPage = resources[i + 1];\r\n                                nextPage.y = (page.y || 0) + page.height;\r\n                                ;\r\n                            }\r\n                        }\r\n                        else {\r\n                            // bottom to top\r\n                            for (var i = resources.length; i > 0; i--) {\r\n                                page = resources[i];\r\n                                nextPage = resources[i - 1];\r\n                                nextPage.y = (page.y || 0) - page.height;\r\n                            }\r\n                        }\r\n                    }\r\n                    else {\r\n                        // horizontal alignment\r\n                        if (this.extension.helper.isLeftToRight()) {\r\n                            // left to right\r\n                            for (var i = 0; i < resources.length - 1; i++) {\r\n                                page = resources[i];\r\n                                nextPage = resources[i + 1];\r\n                                nextPage.x = (page.x || 0) + page.width;\r\n                            }\r\n                        }\r\n                        else {\r\n                            // right to left\r\n                            for (var i = resources.length - 1; i > 0; i--) {\r\n                                page = resources[i];\r\n                                nextPage = resources[i - 1];\r\n                                nextPage.x = (page.x || 0) - page.width;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return resources;\r\n        };\r\n        SeadragonCenterPanel.prototype.openPagesHandler = function () {\r\n            $.publish(Commands_1.Commands.SEADRAGON_OPEN);\r\n            if (this.extension.helper.isMultiCanvas() && !this.extension.helper.isContinuous()) {\r\n                this.showPrevButton();\r\n                this.showNextButton();\r\n                $('.navigator').addClass('extraMargin');\r\n                var viewingDirection = this.extension.helper.getViewingDirection();\r\n                if (viewingDirection.toString() === manifesto.ViewingDirection.rightToLeft().toString()) {\r\n                    if (this.extension.helper.isFirstCanvas()) {\r\n                        this.disableNextButton();\r\n                    }\r\n                    else {\r\n                        this.enableNextButton();\r\n                    }\r\n                    if (this.extension.helper.isLastCanvas()) {\r\n                        this.disablePrevButton();\r\n                    }\r\n                    else {\r\n                        this.enablePrevButton();\r\n                    }\r\n                }\r\n                else {\r\n                    if (this.extension.helper.isFirstCanvas()) {\r\n                        this.disablePrevButton();\r\n                    }\r\n                    else {\r\n                        this.enablePrevButton();\r\n                    }\r\n                    if (this.extension.helper.isLastCanvas()) {\r\n                        this.disableNextButton();\r\n                    }\r\n                    else {\r\n                        this.enableNextButton();\r\n                    }\r\n                }\r\n            }\r\n            this.setNavigatorVisible();\r\n            this.overlaySearchResults();\r\n            this.updateBounds();\r\n            var searchResultRect = this.getInitialSearchResultRect();\r\n            this.extension.previousSearchResultRect = null;\r\n            this.extension.currentSearchResultRect = null;\r\n            if (searchResultRect && this.isZoomToSearchResultEnabled()) {\r\n                this.zoomToSearchResult(searchResultRect);\r\n            }\r\n            this.isFirstLoad = false;\r\n        };\r\n        SeadragonCenterPanel.prototype.updateBounds = function () {\r\n            var settings = this.extension.getSettings();\r\n            // if this is the first load and there are initial bounds, fit to those.\r\n            if (this.isFirstLoad) {\r\n                this.initialRotation = this.extension.getParam(Params_1.Params.rotation);\r\n                if (this.initialRotation) {\r\n                    this.viewer.viewport.setRotation(parseInt(this.initialRotation));\r\n                }\r\n                this.initialBounds = this.extension.getParam(Params_1.Params.xywh);\r\n                if (this.initialBounds) {\r\n                    this.initialBounds = Bounds_1.Bounds.fromString(this.initialBounds);\r\n                    this.currentBounds = this.initialBounds;\r\n                    this.fitToBounds(this.currentBounds);\r\n                }\r\n            }\r\n            else if (settings.preserveViewport) {\r\n                this.fitToBounds(this.currentBounds);\r\n            }\r\n            else {\r\n                this.goHome();\r\n            }\r\n        };\r\n        SeadragonCenterPanel.prototype.goHome = function () {\r\n            this.viewer.viewport.goHome(true);\r\n        };\r\n        SeadragonCenterPanel.prototype.disablePrevButton = function () {\r\n            this.prevButtonEnabled = false;\r\n            this.$prevButton.addClass('disabled');\r\n        };\r\n        SeadragonCenterPanel.prototype.enablePrevButton = function () {\r\n            this.prevButtonEnabled = true;\r\n            this.$prevButton.removeClass('disabled');\r\n        };\r\n        SeadragonCenterPanel.prototype.hidePrevButton = function () {\r\n            this.disablePrevButton();\r\n            this.$prevButton.hide();\r\n        };\r\n        SeadragonCenterPanel.prototype.showPrevButton = function () {\r\n            this.enablePrevButton();\r\n            this.$prevButton.show();\r\n        };\r\n        SeadragonCenterPanel.prototype.disableNextButton = function () {\r\n            this.nextButtonEnabled = false;\r\n            this.$nextButton.addClass('disabled');\r\n        };\r\n        SeadragonCenterPanel.prototype.enableNextButton = function () {\r\n            this.nextButtonEnabled = true;\r\n            this.$nextButton.removeClass('disabled');\r\n        };\r\n        SeadragonCenterPanel.prototype.hideNextButton = function () {\r\n            this.disableNextButton();\r\n            this.$nextButton.hide();\r\n        };\r\n        SeadragonCenterPanel.prototype.showNextButton = function () {\r\n            this.enableNextButton();\r\n            this.$nextButton.show();\r\n        };\r\n        SeadragonCenterPanel.prototype.serialiseBounds = function (bounds) {\r\n            return bounds.x + ',' + bounds.y + ',' + bounds.width + ',' + bounds.height;\r\n        };\r\n        SeadragonCenterPanel.prototype.fitToBounds = function (bounds, immediate) {\r\n            if (immediate === void 0) { immediate = true; }\r\n            var rect = new OpenSeadragon.Rect();\r\n            rect.x = Number(bounds.x);\r\n            rect.y = Number(bounds.y);\r\n            rect.width = Number(bounds.w);\r\n            rect.height = Number(bounds.h);\r\n            this.viewer.viewport.fitBoundsWithConstraints(rect, immediate);\r\n        };\r\n        SeadragonCenterPanel.prototype.getCroppedImageBounds = function () {\r\n            if (!this.viewer || !this.viewer.viewport)\r\n                return null;\r\n            var canvas = this.extension.helper.getCurrentCanvas();\r\n            var dimensions = this.extension.getCroppedImageDimensions(canvas, this.viewer);\r\n            var bounds = new Bounds_1.Bounds(dimensions.regionPos.x, dimensions.regionPos.y, dimensions.region.width, dimensions.region.height);\r\n            return bounds.toString();\r\n        };\r\n        SeadragonCenterPanel.prototype.getViewportBounds = function () {\r\n            if (!this.viewer || !this.viewer.viewport)\r\n                return null;\r\n            var b = this.viewer.viewport.getBounds(true);\r\n            var bounds = new Bounds_1.Bounds(Math.floor(b.x), Math.floor(b.y), Math.floor(b.width), Math.floor(b.height));\r\n            return bounds;\r\n        };\r\n        SeadragonCenterPanel.prototype.viewerResize = function (viewer) {\r\n            if (!viewer.viewport)\r\n                return;\r\n            var center = viewer.viewport.getCenter(true);\r\n            if (!center)\r\n                return;\r\n            // postpone pan for a millisecond - fixes iPad image stretching/squashing issue.\r\n            setTimeout(function () {\r\n                viewer.viewport.panTo(center, true);\r\n            }, 1);\r\n        };\r\n        SeadragonCenterPanel.prototype.clearSearchResults = function () {\r\n            this.$canvas.find('.searchOverlay').hide();\r\n        };\r\n        SeadragonCenterPanel.prototype.overlaySearchResults = function () {\r\n            var searchResults = this.getSearchResultsForCurrentImages();\r\n            for (var i = 0; i < searchResults.length; i++) {\r\n                var searchResult = searchResults[i];\r\n                var overlayRects = this.getSearchOverlayRects(searchResult);\r\n                for (var k = 0; k < overlayRects.length; k++) {\r\n                    var overlayRect = overlayRects[k];\r\n                    var div = document.createElement('div');\r\n                    div.id = 'searchResult-' + overlayRect.canvasIndex + '-' + overlayRect.resultIndex;\r\n                    div.className = 'searchOverlay';\r\n                    div.title = this.extension.sanitize(overlayRect.chars);\r\n                    this.viewer.addOverlay(div, overlayRect);\r\n                }\r\n            }\r\n        };\r\n        SeadragonCenterPanel.prototype.getSearchResultsForCurrentImages = function () {\r\n            var searchResultsForCurrentImages = [];\r\n            var searchResults = this.extension.searchResults;\r\n            if (!searchResults.length)\r\n                return searchResultsForCurrentImages;\r\n            var indices = this.extension.getPagedIndices();\r\n            for (var i = 0; i < indices.length; i++) {\r\n                var canvasIndex = indices[i];\r\n                for (var j = 0; j < searchResults.length; j++) {\r\n                    if (searchResults[j].canvasIndex === canvasIndex) {\r\n                        searchResultsForCurrentImages.push(searchResults[j]);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return searchResultsForCurrentImages;\r\n        };\r\n        SeadragonCenterPanel.prototype.getSearchResultRectsForCurrentImages = function () {\r\n            var searchResults = this.getSearchResultsForCurrentImages();\r\n            return searchResults.en().selectMany(function (x) { return x.rects; }).toArray();\r\n        };\r\n        SeadragonCenterPanel.prototype.updateVisibleSearchResultRects = function () {\r\n            // after animating, loop through all search result rects and flag their visibility based on whether they are inside the current viewport.\r\n            var searchResultRects = this.getSearchResultRectsForCurrentImages();\r\n            for (var i = 0; i < searchResultRects.length; i++) {\r\n                var rect = searchResultRects[i];\r\n                var viewportBounds = this.viewer.viewport.getBounds();\r\n                rect.isVisible = Utils.Measurements.Dimensions.hitRect(viewportBounds.x, viewportBounds.y, viewportBounds.width, viewportBounds.height, rect.viewportX, rect.viewportY);\r\n            }\r\n        };\r\n        SeadragonCenterPanel.prototype.getSearchResultRectIndex = function (searchResultRect) {\r\n            var searchResultRects = this.getSearchResultRectsForCurrentImages();\r\n            return searchResultRects.indexOf(searchResultRect);\r\n        };\r\n        SeadragonCenterPanel.prototype.isZoomToSearchResultEnabled = function () {\r\n            return Utils.Bools.getBool(this.extension.config.options.zoomToSearchResultEnabled, true);\r\n        };\r\n        SeadragonCenterPanel.prototype.nextSearchResult = function () {\r\n            var searchResultRects = this.getSearchResultRectsForCurrentImages();\r\n            var currentSearchResultRectIndex = this.getSearchResultRectIndex(this.extension.currentSearchResultRect);\r\n            var foundRect;\r\n            for (var i = currentSearchResultRectIndex + 1; i < searchResultRects.length; i++) {\r\n                var rect = searchResultRects[i];\r\n                // this was removed as users found it confusing.\r\n                // find the next visible or non-visible rect.\r\n                //if (rect.isVisible) {\r\n                //    continue;\r\n                //} else {\r\n                foundRect = rect;\r\n                break;\r\n            }\r\n            if (foundRect && this.isZoomToSearchResultEnabled()) {\r\n                // if the rect's canvasIndex is greater than the current canvasIndex\r\n                if (rect.canvasIndex > this.extension.helper.canvasIndex) {\r\n                    this.extension.currentSearchResultRect = rect;\r\n                    $.publish(Commands_1.Commands.SEARCH_RESULT_CANVAS_CHANGED, [rect]);\r\n                }\r\n                else {\r\n                    this.zoomToSearchResult(rect);\r\n                }\r\n            }\r\n            else {\r\n                $.publish(Commands_1.Commands.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE);\r\n            }\r\n        };\r\n        SeadragonCenterPanel.prototype.prevSearchResult = function () {\r\n            var searchResultRects = this.getSearchResultRectsForCurrentImages();\r\n            var currentSearchResultRectIndex = this.getSearchResultRectIndex(this.extension.currentSearchResultRect);\r\n            var foundRect;\r\n            for (var i = currentSearchResultRectIndex - 1; i >= 0; i--) {\r\n                var rect = searchResultRects[i];\r\n                // this was removed as users found it confusing.\r\n                // find the prev visible or non-visible rect.\r\n                //if (rect.isVisible) {\r\n                //    continue;\r\n                //} else {\r\n                foundRect = rect;\r\n                break;\r\n            }\r\n            if (foundRect && this.isZoomToSearchResultEnabled()) {\r\n                // if the rect's canvasIndex is less than the current canvasIndex\r\n                if (rect.canvasIndex < this.extension.helper.canvasIndex) {\r\n                    this.extension.currentSearchResultRect = rect;\r\n                    $.publish(Commands_1.Commands.SEARCH_RESULT_CANVAS_CHANGED, [rect]);\r\n                }\r\n                else {\r\n                    this.zoomToSearchResult(rect);\r\n                }\r\n            }\r\n            else {\r\n                $.publish(Commands_1.Commands.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE);\r\n            }\r\n        };\r\n        SeadragonCenterPanel.prototype.getSearchResultRectByIndex = function (index) {\r\n            var searchResultRects = this.getSearchResultRectsForCurrentImages();\r\n            if (!searchResultRects.length)\r\n                return null;\r\n            return searchResultRects[index];\r\n        };\r\n        SeadragonCenterPanel.prototype.getInitialSearchResultRect = function () {\r\n            var _this = this;\r\n            var searchResultRects = this.getSearchResultRectsForCurrentImages();\r\n            if (!searchResultRects.length)\r\n                return null;\r\n            // if the previous SearchResultRect had a canvasIndex higher than the current canvasIndex\r\n            if (this.extension.previousSearchResultRect && this.extension.previousSearchResultRect.canvasIndex > this.extension.helper.canvasIndex) {\r\n                return searchResultRects.en().where(function (x) { return x.canvasIndex === _this.extension.helper.canvasIndex; }).last();\r\n            }\r\n            // get the first rect with the current canvasindex.\r\n            return searchResultRects.en().where(function (x) { return x.canvasIndex === _this.extension.helper.canvasIndex; }).first();\r\n        };\r\n        SeadragonCenterPanel.prototype.zoomToSearchResult = function (searchResultRect) {\r\n            this.extension.previousSearchResultRect = this.extension.currentSearchResultRect || searchResultRect;\r\n            this.extension.currentSearchResultRect = searchResultRect;\r\n            this.fitToBounds(new Bounds_1.Bounds(searchResultRect.viewportX, searchResultRect.viewportY, searchResultRect.width, searchResultRect.height), false);\r\n            this.highlightSearchResultRect(searchResultRect);\r\n            $.publish(Commands_1.Commands.SEARCH_RESULT_RECT_CHANGED);\r\n        };\r\n        SeadragonCenterPanel.prototype.highlightSearchResultRect = function (searchResultRect) {\r\n            var $rect = $('#searchResult-' + searchResultRect.canvasIndex + '-' + searchResultRect.index);\r\n            $rect.addClass('current');\r\n            $('.searchOverlay').not($rect).removeClass('current');\r\n        };\r\n        SeadragonCenterPanel.prototype.getSearchOverlayRects = function (searchResult) {\r\n            var newRects = [];\r\n            var resource = this.extension.resources.en().where(function (x) { return x.index === searchResult.canvasIndex; }).first();\r\n            var index = this.extension.resources.indexOf(resource);\r\n            var width = this.extension.resources[index].width;\r\n            var offsetX = 0;\r\n            if (index > 0) {\r\n                offsetX = this.extension.resources[index - 1].width;\r\n            }\r\n            for (var i = 0; i < searchResult.rects.length; i++) {\r\n                var searchRect = searchResult.rects[i];\r\n                var x = (searchRect.x + offsetX) + ((index > 0) ? this.config.options.pageGap : 0);\r\n                var y = searchRect.y;\r\n                var w = searchRect.width;\r\n                var h = searchRect.height;\r\n                var rect = new OpenSeadragon.Rect(x, y, w, h);\r\n                searchRect.viewportX = x;\r\n                searchRect.viewportY = y;\r\n                rect.canvasIndex = searchRect.canvasIndex;\r\n                rect.resultIndex = searchRect.index;\r\n                rect.chars = searchRect.chars;\r\n                newRects.push(rect);\r\n            }\r\n            return newRects;\r\n        };\r\n        SeadragonCenterPanel.prototype.resize = function () {\r\n            var _this = this;\r\n            _super.prototype.resize.call(this);\r\n            this.$viewer.height(this.$content.height() - this.$viewer.verticalMargins());\r\n            this.$viewer.width(this.$content.width() - this.$viewer.horizontalMargins());\r\n            if (!this.isCreated)\r\n                return;\r\n            this.$title.ellipsisFill(this.extension.sanitize(this.title));\r\n            this.$spinner.css('top', (this.$content.height() / 2) - (this.$spinner.height() / 2));\r\n            this.$spinner.css('left', (this.$content.width() / 2) - (this.$spinner.width() / 2));\r\n            var viewingDirection = this.extension.helper.getViewingDirection();\r\n            if (this.extension.helper.isMultiCanvas() && this.$prevButton && this.$nextButton) {\r\n                var verticalButtonPos = Math.floor(this.$content.width() / 2);\r\n                switch (viewingDirection.toString()) {\r\n                    case manifesto.ViewingDirection.bottomToTop().toString():\r\n                        this.$prevButton.addClass('down');\r\n                        this.$nextButton.addClass('up');\r\n                        this.$prevButton.css('left', verticalButtonPos - (this.$prevButton.outerWidth() / 2));\r\n                        this.$prevButton.css('top', (this.$content.height() - this.$prevButton.height()));\r\n                        this.$nextButton.css('left', (verticalButtonPos * -1) - (this.$nextButton.outerWidth() / 2));\r\n                        break;\r\n                    case manifesto.ViewingDirection.topToBottom().toString():\r\n                        this.$prevButton.css('left', verticalButtonPos - (this.$prevButton.outerWidth() / 2));\r\n                        this.$nextButton.css('left', (verticalButtonPos * -1) - (this.$nextButton.outerWidth() / 2));\r\n                        this.$nextButton.css('top', (this.$content.height() - this.$nextButton.height()));\r\n                        break;\r\n                    default:\r\n                        this.$prevButton.css('top', (this.$content.height() - this.$prevButton.height()) / 2);\r\n                        this.$nextButton.css('top', (this.$content.height() - this.$nextButton.height()) / 2);\r\n                        break;\r\n                }\r\n            }\r\n            // stretch navigator, allowing time for OSD to resize\r\n            setTimeout(function () {\r\n                if (_this.extension.helper.isContinuous()) {\r\n                    if (_this.extension.helper.isHorizontallyAligned()) {\r\n                        var width = _this.$viewer.width() - _this.$viewer.rightMargin();\r\n                        _this.$navigator.width(width);\r\n                    }\r\n                    else {\r\n                        _this.$navigator.height(_this.$viewer.height());\r\n                    }\r\n                }\r\n            }, 100);\r\n        };\r\n        SeadragonCenterPanel.prototype.setFocus = function () {\r\n            if (!this.$canvas.is(\":focus\")) {\r\n                if (this.extension.config.options.allowStealFocus) {\r\n                    this.$canvas.focus();\r\n                }\r\n            }\r\n        };\r\n        SeadragonCenterPanel.prototype.setNavigatorVisible = function () {\r\n            var navigatorEnabled = Utils.Bools.getBool(this.extension.getSettings().navigatorEnabled, true) && this.extension.metric !== Metrics_1.Metrics.MOBILE_LANDSCAPE;\r\n            this.viewer.navigator.setVisible(navigatorEnabled);\r\n            if (navigatorEnabled) {\r\n                this.$navigator.show();\r\n            }\r\n            else {\r\n                this.$navigator.hide();\r\n            }\r\n        };\r\n        return SeadragonCenterPanel;\r\n    }(CenterPanel_1.CenterPanel));\r\n    exports.SeadragonCenterPanel = SeadragonCenterPanel;\r\n});\r\n//# sourceMappingURL=SeadragonCenterPanel.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-dialogues-module/SettingsDialogue',[\"require\", \"exports\", \"../uv-shared-module/BaseCommands\", \"../uv-shared-module/Dialogue\"], function (require, exports, BaseCommands_1, Dialogue_1) {\r\n    \"use strict\";\r\n    var SettingsDialogue = (function (_super) {\r\n        __extends(SettingsDialogue, _super);\r\n        function SettingsDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        SettingsDialogue.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('settingsDialogue');\r\n            _super.prototype.create.call(this);\r\n            this.openCommand = BaseCommands_1.BaseCommands.SHOW_SETTINGS_DIALOGUE;\r\n            this.closeCommand = BaseCommands_1.BaseCommands.HIDE_SETTINGS_DIALOGUE;\r\n            $.subscribe(this.openCommand, function (e, params) {\r\n                _this.open();\r\n            });\r\n            $.subscribe(this.closeCommand, function (e) {\r\n                _this.close();\r\n            });\r\n            this.$title = $('<h1></h1>');\r\n            this.$content.append(this.$title);\r\n            this.$scroll = $('<div class=\"scroll\"></div>');\r\n            this.$content.append(this.$scroll);\r\n            this.$version = $('<div class=\"version\"></div>');\r\n            this.$content.append(this.$version);\r\n            this.$website = $('<div class=\"website\"></div>');\r\n            this.$content.append(this.$website);\r\n            this.$locale = $('<div class=\"setting locale\"></div>');\r\n            this.$scroll.append(this.$locale);\r\n            this.$localeLabel = $('<label for=\"locale\">' + this.content.locale + '</label>');\r\n            this.$locale.append(this.$localeLabel);\r\n            this.$localeDropDown = $('<select id=\"locale\"></select>');\r\n            this.$locale.append(this.$localeDropDown);\r\n            // initialise ui.\r\n            this.$title.text(this.content.title);\r\n            this.$website.html(this.content.website);\r\n            this.$website.targetBlank();\r\n            var locales = this.extension.getLocales();\r\n            for (var i = 0; i < locales.length; i++) {\r\n                var locale = locales[i];\r\n                this.$localeDropDown.append('<option value=\"' + locale.name + '\">' + locale.label + '</option>');\r\n            }\r\n            this.$localeDropDown.val(this.extension.locale);\r\n            this.$localeDropDown.change(function () {\r\n                _this.extension.changeLocale(_this.$localeDropDown.val());\r\n            });\r\n            if (this.extension.getLocales().length < 2) {\r\n                this.$locale.hide();\r\n            }\r\n            this.$element.hide();\r\n        };\r\n        SettingsDialogue.prototype.getSettings = function () {\r\n            return this.extension.getSettings();\r\n        };\r\n        SettingsDialogue.prototype.updateSettings = function (settings) {\r\n            this.extension.updateSettings(settings);\r\n            $.publish(BaseCommands_1.BaseCommands.UPDATE_SETTINGS, [settings]);\r\n        };\r\n        SettingsDialogue.prototype.open = function () {\r\n            var _this = this;\r\n            _super.prototype.open.call(this);\r\n            $.getJSON(\"package.json\", function (pjson) {\r\n                _this.$version.text(\"v\" + pjson.version);\r\n            });\r\n        };\r\n        SettingsDialogue.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n        };\r\n        return SettingsDialogue;\r\n    }(Dialogue_1.Dialogue));\r\n    exports.SettingsDialogue = SettingsDialogue;\r\n});\r\n//# sourceMappingURL=SettingsDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('extensions/uv-seadragon-extension/SettingsDialogue',[\"require\", \"exports\", \"../../modules/uv-dialogues-module/SettingsDialogue\"], function (require, exports, SettingsDialogue_1) {\r\n    \"use strict\";\r\n    var SettingsDialogue = (function (_super) {\r\n        __extends(SettingsDialogue, _super);\r\n        function SettingsDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        SettingsDialogue.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('settingsDialogue');\r\n            _super.prototype.create.call(this);\r\n            this.$navigatorEnabled = $('<div class=\"setting navigatorEnabled\"></div>');\r\n            this.$scroll.append(this.$navigatorEnabled);\r\n            // todo: use .checkboxButton jquery extension\r\n            this.$navigatorEnabledCheckbox = $('<input id=\"navigatorEnabled\" type=\"checkbox\" tabindex=\"0\" />');\r\n            this.$navigatorEnabled.append(this.$navigatorEnabledCheckbox);\r\n            this.$navigatorEnabledLabel = $('<label for=\"navigatorEnabled\">' + this.content.navigatorEnabled + '</label>');\r\n            this.$navigatorEnabled.append(this.$navigatorEnabledLabel);\r\n            this.$pagingEnabled = $('<div class=\"setting pagingEnabled\"></div>');\r\n            this.$scroll.append(this.$pagingEnabled);\r\n            this.$pagingEnabledCheckbox = $('<input id=\"pagingEnabled\" type=\"checkbox\" tabindex=\"0\" />');\r\n            this.$pagingEnabled.append(this.$pagingEnabledCheckbox);\r\n            this.$pagingEnabledLabel = $('<label for=\"pagingEnabled\">' + this.content.pagingEnabled + '</label>');\r\n            this.$pagingEnabled.append(this.$pagingEnabledLabel);\r\n            this.$clickToZoomEnabled = $('<div class=\"setting clickToZoom\"></div>');\r\n            this.$scroll.append(this.$clickToZoomEnabled);\r\n            this.$clickToZoomEnabledCheckbox = $('<input id=\"clickToZoomEnabled\" type=\"checkbox\" />');\r\n            this.$clickToZoomEnabled.append(this.$clickToZoomEnabledCheckbox);\r\n            this.$clickToZoomEnabledLabel = $('<label for=\"clickToZoomEnabled\">' + this.content.clickToZoomEnabled + '</label>');\r\n            this.$clickToZoomEnabled.append(this.$clickToZoomEnabledLabel);\r\n            this.$preserveViewport = $('<div class=\"setting preserveViewport\"></div>');\r\n            this.$scroll.append(this.$preserveViewport);\r\n            this.$preserveViewportCheckbox = $('<input id=\"preserveViewport\" type=\"checkbox\" tabindex=\"0\" />');\r\n            this.$preserveViewport.append(this.$preserveViewportCheckbox);\r\n            this.$preserveViewportLabel = $('<label for=\"preserveViewport\">' + this.content.preserveViewport + '</label>');\r\n            this.$preserveViewport.append(this.$preserveViewportLabel);\r\n            this.$navigatorEnabledCheckbox.change(function () {\r\n                var settings = {};\r\n                if (_this.$navigatorEnabledCheckbox.is(\":checked\")) {\r\n                    settings.navigatorEnabled = true;\r\n                }\r\n                else {\r\n                    settings.navigatorEnabled = false;\r\n                }\r\n                _this.updateSettings(settings);\r\n            });\r\n            this.$clickToZoomEnabledCheckbox.change(function () {\r\n                var settings = {};\r\n                if (_this.$clickToZoomEnabledCheckbox.is(\":checked\")) {\r\n                    settings.clickToZoomEnabled = true;\r\n                }\r\n                else {\r\n                    settings.clickToZoomEnabled = false;\r\n                }\r\n                _this.updateSettings(settings);\r\n            });\r\n            this.$pagingEnabledCheckbox.change(function () {\r\n                var settings = {};\r\n                if (_this.$pagingEnabledCheckbox.is(\":checked\")) {\r\n                    settings.pagingEnabled = true;\r\n                }\r\n                else {\r\n                    settings.pagingEnabled = false;\r\n                }\r\n                _this.updateSettings(settings);\r\n            });\r\n            this.$preserveViewportCheckbox.change(function () {\r\n                var settings = {};\r\n                if (_this.$preserveViewportCheckbox.is(\":checked\")) {\r\n                    settings.preserveViewport = true;\r\n                }\r\n                else {\r\n                    settings.preserveViewport = false;\r\n                }\r\n                _this.updateSettings(settings);\r\n            });\r\n        };\r\n        SettingsDialogue.prototype.open = function () {\r\n            _super.prototype.open.call(this);\r\n            var settings = this.getSettings();\r\n            if (settings.navigatorEnabled) {\r\n                this.$navigatorEnabledCheckbox.prop(\"checked\", true);\r\n            }\r\n            else {\r\n                this.$navigatorEnabledCheckbox.removeAttr(\"checked\");\r\n            }\r\n            if (settings.clickToZoomEnabled) {\r\n                this.$clickToZoomEnabledCheckbox.prop(\"checked\", true);\r\n            }\r\n            else {\r\n                this.$clickToZoomEnabledCheckbox.removeAttr(\"checked\");\r\n            }\r\n            if (!this.extension.helper.isPagingAvailable()) {\r\n                this.$pagingEnabled.hide();\r\n            }\r\n            else {\r\n                if (settings.pagingEnabled) {\r\n                    this.$pagingEnabledCheckbox.prop(\"checked\", true);\r\n                }\r\n                else {\r\n                    this.$pagingEnabledCheckbox.removeAttr(\"checked\");\r\n                }\r\n            }\r\n            if (settings.preserveViewport) {\r\n                this.$preserveViewportCheckbox.prop(\"checked\", true);\r\n            }\r\n            else {\r\n                this.$preserveViewportCheckbox.removeAttr(\"checked\");\r\n            }\r\n        };\r\n        return SettingsDialogue;\r\n    }(SettingsDialogue_1.SettingsDialogue));\r\n    exports.SettingsDialogue = SettingsDialogue;\r\n});\r\n//# sourceMappingURL=SettingsDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-dialogues-module/ShareDialogue',[\"require\", \"exports\", \"../uv-shared-module/BaseCommands\", \"../uv-shared-module/Dialogue\"], function (require, exports, BaseCommands_1, Dialogue_1) {\r\n    \"use strict\";\r\n    var ShareDialogue = (function (_super) {\r\n        __extends(ShareDialogue, _super);\r\n        function ShareDialogue($element) {\r\n            var _this = _super.call(this, $element) || this;\r\n            _this.aspectRatio = .75;\r\n            _this.isEmbedViewVisible = false;\r\n            _this.isShareViewVisible = false;\r\n            _this.maxHeight = _this.maxWidth * _this.aspectRatio;\r\n            _this.maxWidth = 8000;\r\n            _this.minHeight = _this.minWidth * _this.aspectRatio;\r\n            _this.minWidth = 200;\r\n            return _this;\r\n        }\r\n        ShareDialogue.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('shareDialogue');\r\n            _super.prototype.create.call(this);\r\n            this.openCommand = BaseCommands_1.BaseCommands.SHOW_SHARE_DIALOGUE;\r\n            this.closeCommand = BaseCommands_1.BaseCommands.HIDE_SHARE_DIALOGUE;\r\n            $.subscribe(this.openCommand, function (e, $triggerButton) {\r\n                _this.open($triggerButton);\r\n                if (_this.isShareAvailable()) {\r\n                    _this.openShareView();\r\n                }\r\n                else {\r\n                    _this.openEmbedView();\r\n                }\r\n            });\r\n            $.subscribe(this.closeCommand, function (e) {\r\n                _this.close();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.SHOW_EMBED_DIALOGUE, function (e, $triggerButton) {\r\n                _this.open($triggerButton);\r\n                _this.openEmbedView();\r\n            });\r\n            this.$tabs = $('<div class=\"tabs\"></div>');\r\n            this.$content.append(this.$tabs);\r\n            this.$shareButton = $('<a class=\"share tab default\" tabindex=\"0\">' + this.content.share + '</a>');\r\n            this.$shareButton.prop('title', this.content.share);\r\n            this.$tabs.append(this.$shareButton);\r\n            this.$embedButton = $('<a class=\"embed tab\" tabindex=\"0\">' + this.content.embed + '</a>');\r\n            this.$embedButton.prop('title', this.content.embed);\r\n            this.$tabs.append(this.$embedButton);\r\n            this.$tabsContent = $('<div class=\"tabsContent\"></div>');\r\n            this.$content.append(this.$tabsContent);\r\n            this.$footer = $('<div class=\"footer\"></div>');\r\n            this.$content.append(this.$footer);\r\n            this.$shareView = $('<div class=\"shareView view\"></div>');\r\n            this.$tabsContent.append(this.$shareView);\r\n            this.$shareHeader = $('<div class=\"header\"></div>');\r\n            this.$shareView.append(this.$shareHeader);\r\n            this.$shareLink = $('<a class=\"shareLink\" onclick=\"return false;\"></a>');\r\n            this.$shareView.append(this.$shareLink);\r\n            this.$shareInput = $('<input class=\"shareInput\" type=\"text\" readonly=\"true\" />');\r\n            this.$shareView.append(this.$shareInput);\r\n            this.$shareFrame = $('<iframe class=\"shareFrame\"></iframe>');\r\n            this.$shareView.append(this.$shareFrame);\r\n            this.$embedView = $('<div class=\"embedView view\"></div>');\r\n            this.$tabsContent.append(this.$embedView);\r\n            this.$embedHeader = $('<div class=\"header\"></div>');\r\n            this.$embedView.append(this.$embedHeader);\r\n            // this.$link = $('<a target=\"_blank\"></a>');\r\n            // this.$embedView.find('.leftCol').append(this.$link);\r\n            // this.$image = $('<img class=\"share\" />');\r\n            // this.$embedView.append(this.$image);\r\n            this.$code = $('<input class=\"code\" type=\"text\" readonly=\"true\" />');\r\n            this.$embedView.append(this.$code);\r\n            this.$customSize = $('<div class=\"customSize\"></div>');\r\n            this.$embedView.append(this.$customSize);\r\n            this.$size = $('<span class=\"size\">' + this.content.size + '</span>');\r\n            this.$customSize.append(this.$size);\r\n            this.$customSizeDropDown = $('<select id=\"size\"></select>');\r\n            this.$customSize.append(this.$customSizeDropDown);\r\n            this.$customSizeDropDown.append('<option value=\"small\" data-width=\"560\" data-height=\"420\">560 x 420</option>');\r\n            this.$customSizeDropDown.append('<option value=\"medium\" data-width=\"640\" data-height=\"480\">640 x 480</option>');\r\n            this.$customSizeDropDown.append('<option value=\"large\" data-width=\"800\" data-height=\"600\">800 x 600</option>');\r\n            this.$customSizeDropDown.append('<option value=\"custom\">' + this.content.customSize + '</option>');\r\n            this.$widthInput = $('<input class=\"width\" type=\"text\" maxlength=\"10\" />');\r\n            this.$customSize.append(this.$widthInput);\r\n            this.$x = $('<span class=\"x\">x</span>');\r\n            this.$customSize.append(this.$x);\r\n            this.$heightInput = $('<input class=\"height\" type=\"text\" maxlength=\"10\" />');\r\n            this.$customSize.append(this.$heightInput);\r\n            var iiifUrl = this.extension.getIIIFShareUrl();\r\n            this.$iiifButton = $('<a class=\"imageBtn iiif\" href=\"' + iiifUrl + '\" title=\"' + this.content.iiif + '\" target=\"_blank\"></a>');\r\n            this.$footer.append(this.$iiifButton);\r\n            this.$termsOfUseButton = $('<a href=\"#\">' + this.extension.config.content.termsOfUse + '</a>');\r\n            this.$footer.append(this.$termsOfUseButton);\r\n            this.$widthInput.on('keydown', function (e) {\r\n                return Utils.Numbers.numericalInput(e);\r\n            });\r\n            this.$heightInput.on('keydown', function (e) {\r\n                return Utils.Numbers.numericalInput(e);\r\n            });\r\n            this.$shareInput.focus(function () {\r\n                $(this).select();\r\n            });\r\n            this.$code.focus(function () {\r\n                $(this).select();\r\n            });\r\n            this.$shareButton.onPressed(function () {\r\n                _this.openShareView();\r\n            });\r\n            this.$embedButton.onPressed(function () {\r\n                _this.openEmbedView();\r\n            });\r\n            this.$customSizeDropDown.change(function () {\r\n                _this.update();\r\n            });\r\n            this.$widthInput.change(function () {\r\n                _this.updateHeightRatio();\r\n                _this.update();\r\n            });\r\n            this.$heightInput.change(function () {\r\n                _this.updateWidthRatio();\r\n                _this.update();\r\n            });\r\n            this.$termsOfUseButton.onPressed(function () {\r\n                $.publish(BaseCommands_1.BaseCommands.SHOW_TERMS_OF_USE);\r\n            });\r\n            this.$element.hide();\r\n            this.update();\r\n        };\r\n        ShareDialogue.prototype.open = function ($triggerButton) {\r\n            _super.prototype.open.call(this, $triggerButton);\r\n            this.update();\r\n        };\r\n        ShareDialogue.prototype.getShareUrl = function () {\r\n            return this.extension.getShareUrl();\r\n        };\r\n        ShareDialogue.prototype.isShareAvailable = function () {\r\n            return !!this.getShareUrl();\r\n        };\r\n        ShareDialogue.prototype.update = function () {\r\n            if (this.isShareAvailable()) {\r\n                this.$shareButton.show();\r\n            }\r\n            else {\r\n                this.$shareButton.hide();\r\n            }\r\n            var $selected = this.getSelectedSize();\r\n            if ($selected.val() === 'custom') {\r\n                this.$widthInput.show();\r\n                this.$x.show();\r\n                this.$heightInput.show();\r\n            }\r\n            else {\r\n                this.$widthInput.hide();\r\n                this.$x.hide();\r\n                this.$heightInput.hide();\r\n                this.currentWidth = Number($selected.data('width'));\r\n                this.currentHeight = Number($selected.data('height'));\r\n                this.$widthInput.val(String(this.currentWidth));\r\n                this.$heightInput.val(String(this.currentHeight));\r\n            }\r\n            this.updateInstructions();\r\n            this.updateShareOptions();\r\n            this.updateShareFrame();\r\n            this.updateTermsOfUseButton();\r\n        };\r\n        ShareDialogue.prototype.updateShareOptions = function () {\r\n            this.$shareInput.val(this.getShareUrl());\r\n            this.$shareLink.prop('href', this.getShareUrl());\r\n            this.$shareLink.text(this.getShareUrl());\r\n            if ($.browser.mobile) {\r\n                this.$shareInput.hide();\r\n                this.$shareLink.show();\r\n            }\r\n            else {\r\n                this.$shareInput.show();\r\n                this.$shareLink.hide();\r\n            }\r\n        };\r\n        ShareDialogue.prototype.updateInstructions = function () {\r\n            if (Utils.Bools.getBool(this.options.instructionsEnabled, false)) {\r\n                this.$shareHeader.show();\r\n                this.$embedHeader.show();\r\n                this.$shareHeader.text(this.content.shareInstructions);\r\n                this.$embedHeader.text(this.content.embedInstructions);\r\n            }\r\n            else {\r\n                this.$shareHeader.hide();\r\n                this.$embedHeader.hide();\r\n            }\r\n        };\r\n        // updateThumbnail(): void {\r\n        //     var canvas: Manifesto.ICanvas = this.extension.helper.getCurrentCanvas();\r\n        //     if (!canvas) return;\r\n        //     var thumbnail = canvas.getProperty('thumbnail');\r\n        //     if (!thumbnail || !_.isString(thumbnail)){\r\n        //         thumbnail = canvas.getCanonicalImageUri(this.extension.config.options.bookmarkThumbWidth);\r\n        //     }\r\n        //     this.$link.attr('href', thumbnail);\r\n        //     this.$image.attr('src', thumbnail);\r\n        // }\r\n        ShareDialogue.prototype.getSelectedSize = function () {\r\n            return this.$customSizeDropDown.find(':selected');\r\n        };\r\n        ShareDialogue.prototype.updateWidthRatio = function () {\r\n            this.currentHeight = Number(this.$heightInput.val());\r\n            if (this.currentHeight < this.minHeight) {\r\n                this.currentHeight = this.minHeight;\r\n                this.$heightInput.val(String(this.currentHeight));\r\n            }\r\n            else if (this.currentHeight > this.maxHeight) {\r\n                this.currentHeight = this.maxHeight;\r\n                this.$heightInput.val(String(this.currentHeight));\r\n            }\r\n            this.currentWidth = Math.floor(this.currentHeight / this.aspectRatio);\r\n            this.$widthInput.val(String(this.currentWidth));\r\n        };\r\n        ShareDialogue.prototype.updateHeightRatio = function () {\r\n            this.currentWidth = Number(this.$widthInput.val());\r\n            if (this.currentWidth < this.minWidth) {\r\n                this.currentWidth = this.minWidth;\r\n                this.$widthInput.val(String(this.currentWidth));\r\n            }\r\n            else if (this.currentWidth > this.maxWidth) {\r\n                this.currentWidth = this.maxWidth;\r\n                this.$widthInput.val(String(this.currentWidth));\r\n            }\r\n            this.currentHeight = Math.floor(this.currentWidth * this.aspectRatio);\r\n            this.$heightInput.val(String(this.currentHeight));\r\n        };\r\n        ShareDialogue.prototype.updateShareFrame = function () {\r\n            var shareUrl = this.extension.helper.getShareServiceUrl();\r\n            if (Utils.Bools.getBool(this.config.options.shareFrameEnabled, true) && shareUrl) {\r\n                this.$shareFrame.prop('src', shareUrl);\r\n                this.$shareFrame.show();\r\n            }\r\n            else {\r\n                this.$shareFrame.hide();\r\n            }\r\n        };\r\n        ShareDialogue.prototype.updateTermsOfUseButton = function () {\r\n            var attribution = this.extension.helper.getAttribution(); // todo: this should eventually use a suitable IIIF 'terms' field.\r\n            if (Utils.Bools.getBool(this.extension.config.options.termsOfUseEnabled, false) && attribution) {\r\n                this.$termsOfUseButton.show();\r\n            }\r\n            else {\r\n                this.$termsOfUseButton.hide();\r\n            }\r\n        };\r\n        ShareDialogue.prototype.openShareView = function () {\r\n            this.isShareViewVisible = true;\r\n            this.isEmbedViewVisible = false;\r\n            this.$embedView.hide();\r\n            this.$shareView.show();\r\n            this.$shareButton.addClass('on default');\r\n            this.$embedButton.removeClass('on default');\r\n            this.resize();\r\n        };\r\n        ShareDialogue.prototype.openEmbedView = function () {\r\n            this.isShareViewVisible = false;\r\n            this.isEmbedViewVisible = true;\r\n            this.$embedView.show();\r\n            this.$shareView.hide();\r\n            this.$shareButton.removeClass('on default');\r\n            this.$embedButton.addClass('on default');\r\n            this.resize();\r\n        };\r\n        ShareDialogue.prototype.close = function () {\r\n            _super.prototype.close.call(this);\r\n        };\r\n        ShareDialogue.prototype.getViews = function () {\r\n            return this.$tabsContent.find('.view');\r\n        };\r\n        ShareDialogue.prototype.equaliseViewHeights = function () {\r\n            this.getViews().equaliseHeight(true);\r\n        };\r\n        ShareDialogue.prototype.resize = function () {\r\n            this.equaliseViewHeights();\r\n            this.setDockedPosition();\r\n        };\r\n        return ShareDialogue;\r\n    }(Dialogue_1.Dialogue));\r\n    exports.ShareDialogue = ShareDialogue;\r\n});\r\n//# sourceMappingURL=ShareDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('extensions/uv-seadragon-extension/ShareDialogue',[\"require\", \"exports\", \"../../modules/uv-dialogues-module/ShareDialogue\", \"./Commands\"], function (require, exports, ShareDialogue_1, Commands_1) {\r\n    \"use strict\";\r\n    var ShareDialogue = (function (_super) {\r\n        __extends(ShareDialogue, _super);\r\n        function ShareDialogue($element) {\r\n            var _this = _super.call(this, $element) || this;\r\n            $.subscribe(Commands_1.Commands.SEADRAGON_OPEN, function () {\r\n                _this.update();\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEADRAGON_ANIMATION_FINISH, function () {\r\n                _this.update();\r\n            });\r\n            return _this;\r\n        }\r\n        ShareDialogue.prototype.create = function () {\r\n            this.setConfig('shareDialogue');\r\n            _super.prototype.create.call(this);\r\n        };\r\n        ShareDialogue.prototype.update = function () {\r\n            _super.prototype.update.call(this);\r\n            var xywh = this.extension.getViewportBounds();\r\n            var rotation = this.extension.getViewerRotation();\r\n            this.code = this.extension.getEmbedScript(this.options.embedTemplate, this.currentWidth, this.currentHeight, xywh, rotation);\r\n            this.$code.val(this.code);\r\n        };\r\n        ShareDialogue.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n        };\r\n        return ShareDialogue;\r\n    }(ShareDialogue_1.ShareDialogue));\r\n    exports.ShareDialogue = ShareDialogue;\r\n});\r\n//# sourceMappingURL=ShareDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('extensions/uv-seadragon-extension/Extension',[\"require\", \"exports\", \"../../modules/uv-shared-module/BaseCommands\", \"../../modules/uv-shared-module/BaseExtension\", \"../../modules/uv-shared-module/Bookmark\", \"./Commands\", \"../../modules/uv-contentleftpanel-module/ContentLeftPanel\", \"./CroppedImageDimensions\", \"./DownloadDialogue\", \"../../modules/uv-dialogues-module/ExternalContentDialogue\", \"../../modules/uv-osdmobilefooterpanel-module/MobileFooter\", \"../../modules/uv-searchfooterpanel-module/FooterPanel\", \"../../modules/uv-dialogues-module/HelpDialogue\", \"../../modules/uv-shared-module/Metrics\", \"./Mode\", \"../../modules/uv-dialogues-module/MoreInfoDialogue\", \"../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel\", \"../../modules/uv-multiselectdialogue-module/MultiSelectDialogue\", \"./MultiSelectionArgs\", \"../../modules/uv-pagingheaderpanel-module/PagingHeaderPanel\", \"../../Params\", \"../../modules/uv-shared-module/Point\", \"../../modules/uv-seadragoncenterpanel-module/SeadragonCenterPanel\", \"./SettingsDialogue\", \"./ShareDialogue\", \"../../modules/uv-shared-module/Shell\"], function (require, exports, BaseCommands_1, BaseExtension_1, Bookmark_1, Commands_1, ContentLeftPanel_1, CroppedImageDimensions_1, DownloadDialogue_1, ExternalContentDialogue_1, MobileFooter_1, FooterPanel_1, HelpDialogue_1, Metrics_1, Mode_1, MoreInfoDialogue_1, MoreInfoRightPanel_1, MultiSelectDialogue_1, MultiSelectionArgs_1, PagingHeaderPanel_1, Params_1, Point_1, SeadragonCenterPanel_1, SettingsDialogue_1, ShareDialogue_1, Shell_1) {\r\n    \"use strict\";\r\n    var SearchResult = Manifold.SearchResult;\r\n    var Size = Utils.Measurements.Size;\r\n    var Extension = (function (_super) {\r\n        __extends(Extension, _super);\r\n        function Extension(bootstrapper) {\r\n            var _this = _super.call(this, bootstrapper) || this;\r\n            _this.currentRotation = 0;\r\n            _this.isSearching = false;\r\n            _this.searchResults = [];\r\n            return _this;\r\n        }\r\n        Extension.prototype.create = function () {\r\n            var _this = this;\r\n            _super.prototype.create.call(this);\r\n            var that = this;\r\n            $.subscribe(BaseCommands_1.BaseCommands.METRIC_CHANGED, function () {\r\n                if (_this.metric === Metrics_1.Metrics.MOBILE_LANDSCAPE) {\r\n                    var settings = {};\r\n                    settings.pagingEnabled = false;\r\n                    _this.updateSettings(settings);\r\n                    $.publish(BaseCommands_1.BaseCommands.UPDATE_SETTINGS);\r\n                    Shell_1.Shell.$rightPanel.hide();\r\n                }\r\n                else {\r\n                    Shell_1.Shell.$rightPanel.show();\r\n                }\r\n            });\r\n            $.subscribe(Commands_1.Commands.CLEAR_SEARCH, function (e) {\r\n                _this.searchResults = null;\r\n                $.publish(Commands_1.Commands.SEARCH_RESULTS_CLEARED);\r\n                _this.triggerSocket(Commands_1.Commands.CLEAR_SEARCH);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.DOWN_ARROW, function (e) {\r\n                if (!_this.useArrowKeysToNavigate()) {\r\n                    _this.centerPanel.setFocus();\r\n                }\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.END, function (e) {\r\n                _this.viewPage(_this.helper.getLastPageIndex());\r\n            });\r\n            $.subscribe(Commands_1.Commands.FIRST, function (e) {\r\n                _this.triggerSocket(Commands_1.Commands.FIRST);\r\n                _this.viewPage(_this.helper.getFirstPageIndex());\r\n            });\r\n            $.subscribe(Commands_1.Commands.GALLERY_DECREASE_SIZE, function (e) {\r\n                _this.triggerSocket(Commands_1.Commands.GALLERY_DECREASE_SIZE);\r\n            });\r\n            $.subscribe(Commands_1.Commands.GALLERY_INCREASE_SIZE, function (e) {\r\n                _this.triggerSocket(Commands_1.Commands.GALLERY_INCREASE_SIZE);\r\n            });\r\n            $.subscribe(Commands_1.Commands.GALLERY_THUMB_SELECTED, function (e) {\r\n                _this.triggerSocket(Commands_1.Commands.GALLERY_THUMB_SELECTED);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.HOME, function (e) {\r\n                _this.viewPage(_this.helper.getFirstPageIndex());\r\n            });\r\n            $.subscribe(Commands_1.Commands.IMAGE_SEARCH, function (e, index) {\r\n                _this.triggerSocket(Commands_1.Commands.IMAGE_SEARCH, index);\r\n                _this.viewPage(index);\r\n            });\r\n            $.subscribe(Commands_1.Commands.LAST, function (e) {\r\n                _this.triggerSocket(Commands_1.Commands.LAST);\r\n                _this.viewPage(_this.helper.getLastPageIndex());\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LEFT_ARROW, function (e) {\r\n                if (_this.useArrowKeysToNavigate()) {\r\n                    _this.viewPage(_this.getPrevPageIndex());\r\n                }\r\n                else {\r\n                    _this.centerPanel.setFocus();\r\n                }\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LEFTPANEL_COLLAPSE_FULL_START, function (e) {\r\n                if (_this.metric !== Metrics_1.Metrics.MOBILE_LANDSCAPE) {\r\n                    Shell_1.Shell.$rightPanel.show();\r\n                }\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LEFTPANEL_COLLAPSE_FULL_FINISH, function (e) {\r\n                Shell_1.Shell.$centerPanel.show();\r\n                _this.resize();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LEFTPANEL_EXPAND_FULL_START, function (e) {\r\n                Shell_1.Shell.$centerPanel.hide();\r\n                Shell_1.Shell.$rightPanel.hide();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.MINUS, function (e) {\r\n                _this.centerPanel.setFocus();\r\n            });\r\n            $.subscribe(Commands_1.Commands.MODE_CHANGED, function (e, mode) {\r\n                _this.triggerSocket(Commands_1.Commands.MODE_CHANGED, mode);\r\n                _this.mode = new Mode_1.Mode(mode);\r\n                var settings = _this.getSettings();\r\n                $.publish(BaseCommands_1.BaseCommands.SETTINGS_CHANGED, [settings]);\r\n            });\r\n            $.subscribe(Commands_1.Commands.MULTISELECTION_MADE, function (e, ids) {\r\n                var args = new MultiSelectionArgs_1.MultiSelectionArgs();\r\n                args.manifestUri = _this.helper.iiifResourceUri;\r\n                args.allCanvases = ids.length === _this.helper.getCanvases().length;\r\n                args.canvases = ids;\r\n                args.format = _this.config.options.multiSelectionMimeType;\r\n                args.sequence = _this.helper.getCurrentSequence().id;\r\n                _this.triggerSocket(Commands_1.Commands.MULTISELECTION_MADE, args);\r\n            });\r\n            $.subscribe(Commands_1.Commands.NEXT, function (e) {\r\n                _this.triggerSocket(Commands_1.Commands.NEXT);\r\n                _this.viewPage(_this.getNextPageIndex());\r\n            });\r\n            $.subscribe(Commands_1.Commands.NEXT_SEARCH_RESULT, function () {\r\n                _this.triggerSocket(Commands_1.Commands.NEXT_SEARCH_RESULT);\r\n            });\r\n            $.subscribe(Commands_1.Commands.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE, function () {\r\n                _this.triggerSocket(Commands_1.Commands.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE);\r\n                _this.nextSearchResult();\r\n            });\r\n            $.subscribe(Commands_1.Commands.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE, function () {\r\n                _this.triggerSocket(Commands_1.Commands.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE);\r\n                _this.prevSearchResult();\r\n            });\r\n            $.subscribe(Commands_1.Commands.OPEN_THUMBS_VIEW, function (e) {\r\n                _this.triggerSocket(Commands_1.Commands.OPEN_THUMBS_VIEW);\r\n            });\r\n            $.subscribe(Commands_1.Commands.OPEN_TREE_VIEW, function (e) {\r\n                _this.triggerSocket(Commands_1.Commands.OPEN_TREE_VIEW);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.PAGE_DOWN, function (e) {\r\n                _this.viewPage(_this.getNextPageIndex());\r\n            });\r\n            $.subscribe(Commands_1.Commands.PAGE_SEARCH, function (e, value) {\r\n                _this.triggerSocket(Commands_1.Commands.PAGE_SEARCH, value);\r\n                _this.viewLabel(value);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.PAGE_UP, function (e) {\r\n                _this.viewPage(_this.getPrevPageIndex());\r\n            });\r\n            $.subscribe(Commands_1.Commands.PAGING_TOGGLED, function (e, obj) {\r\n                _this.triggerSocket(Commands_1.Commands.PAGING_TOGGLED, obj);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.PLUS, function (e) {\r\n                _this.centerPanel.setFocus();\r\n            });\r\n            $.subscribe(Commands_1.Commands.PREV, function (e) {\r\n                _this.triggerSocket(Commands_1.Commands.PREV);\r\n                _this.viewPage(_this.getPrevPageIndex());\r\n            });\r\n            $.subscribe(Commands_1.Commands.PREV_SEARCH_RESULT, function () {\r\n                _this.triggerSocket(Commands_1.Commands.PREV_SEARCH_RESULT);\r\n            });\r\n            $.subscribe(Commands_1.Commands.PRINT, function () {\r\n                _this.print();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.RIGHT_ARROW, function (e) {\r\n                if (_this.useArrowKeysToNavigate()) {\r\n                    _this.viewPage(_this.getNextPageIndex());\r\n                }\r\n                else {\r\n                    _this.centerPanel.setFocus();\r\n                }\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEADRAGON_ANIMATION, function () {\r\n                _this.triggerSocket(Commands_1.Commands.SEADRAGON_ANIMATION);\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEADRAGON_ANIMATION_FINISH, function (e, viewer) {\r\n                if (_this.centerPanel && _this.centerPanel.currentBounds) {\r\n                    _this.setParam(Params_1.Params.xywh, _this.centerPanel.getViewportBounds().toString());\r\n                }\r\n                var canvas = _this.helper.getCurrentCanvas();\r\n                _this.triggerSocket(Commands_1.Commands.CURRENT_VIEW_URI, {\r\n                    cropUri: _this.getCroppedImageUri(canvas, _this.getViewer()),\r\n                    fullUri: _this.getConfinedImageUri(canvas, canvas.getWidth())\r\n                });\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEADRAGON_ANIMATION_START, function () {\r\n                _this.triggerSocket(Commands_1.Commands.SEADRAGON_ANIMATION_START);\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEADRAGON_OPEN, function () {\r\n                if (!_this.useArrowKeysToNavigate()) {\r\n                    _this.centerPanel.setFocus();\r\n                }\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEADRAGON_RESIZE, function () {\r\n                _this.triggerSocket(Commands_1.Commands.SEADRAGON_RESIZE);\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEADRAGON_ROTATION, function (e, rotation) {\r\n                _this.triggerSocket(Commands_1.Commands.SEADRAGON_ROTATION);\r\n                _this.currentRotation = rotation;\r\n                _this.setParam(Params_1.Params.rotation, rotation);\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEARCH, function (e, terms) {\r\n                _this.triggerSocket(Commands_1.Commands.SEARCH, terms);\r\n                _this.searchWithin(terms);\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEARCH_PREVIEW_FINISH, function (e) {\r\n                _this.triggerSocket(Commands_1.Commands.SEARCH_PREVIEW_FINISH);\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEARCH_PREVIEW_START, function (e) {\r\n                _this.triggerSocket(Commands_1.Commands.SEARCH_PREVIEW_START);\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEARCH_RESULTS, function (e, obj) {\r\n                _this.triggerSocket(Commands_1.Commands.SEARCH_RESULTS, obj);\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEARCH_RESULT_CANVAS_CHANGED, function (e, rect) {\r\n                _this.viewPage(rect.canvasIndex);\r\n            });\r\n            $.subscribe(Commands_1.Commands.SEARCH_RESULTS_EMPTY, function (e) {\r\n                _this.triggerSocket(Commands_1.Commands.SEARCH_RESULTS_EMPTY);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.THUMB_SELECTED, function (e, thumb) {\r\n                _this.viewPage(thumb.index);\r\n            });\r\n            $.subscribe(Commands_1.Commands.TREE_NODE_SELECTED, function (e, node) {\r\n                _this.triggerSocket(Commands_1.Commands.TREE_NODE_SELECTED, node.data.path);\r\n                _this.treeNodeSelected(node);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.UP_ARROW, function (e) {\r\n                if (!_this.useArrowKeysToNavigate()) {\r\n                    _this.centerPanel.setFocus();\r\n                }\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.UPDATE_SETTINGS, function (e) {\r\n                _this.viewPage(_this.helper.canvasIndex, true);\r\n                var settings = _this.getSettings();\r\n                $.publish(BaseCommands_1.BaseCommands.SETTINGS_CHANGED, [settings]);\r\n            });\r\n            $.subscribe(Commands_1.Commands.VIEW_PAGE, function (e, index) {\r\n                _this.triggerSocket(Commands_1.Commands.VIEW_PAGE, index);\r\n                _this.viewPage(index);\r\n            });\r\n            Utils.Async.waitFor(function () {\r\n                return _this.centerPanel && _this.centerPanel.isCreated;\r\n            }, function () {\r\n                _this.checkForSearchParam();\r\n                _this.checkForRotationParam();\r\n            });\r\n        };\r\n        Extension.prototype.createModules = function () {\r\n            _super.prototype.createModules.call(this);\r\n            if (this.isHeaderPanelEnabled()) {\r\n                this.headerPanel = new PagingHeaderPanel_1.PagingHeaderPanel(Shell_1.Shell.$headerPanel);\r\n            }\r\n            else {\r\n                Shell_1.Shell.$headerPanel.hide();\r\n            }\r\n            if (this.isLeftPanelEnabled()) {\r\n                this.leftPanel = new ContentLeftPanel_1.ContentLeftPanel(Shell_1.Shell.$leftPanel);\r\n            }\r\n            else {\r\n                Shell_1.Shell.$leftPanel.hide();\r\n            }\r\n            this.centerPanel = new SeadragonCenterPanel_1.SeadragonCenterPanel(Shell_1.Shell.$centerPanel);\r\n            if (this.isRightPanelEnabled()) {\r\n                this.rightPanel = new MoreInfoRightPanel_1.MoreInfoRightPanel(Shell_1.Shell.$rightPanel);\r\n            }\r\n            else {\r\n                Shell_1.Shell.$rightPanel.hide();\r\n            }\r\n            if (this.isFooterPanelEnabled()) {\r\n                this.footerPanel = new FooterPanel_1.FooterPanel(Shell_1.Shell.$footerPanel);\r\n                this.mobileFooterPanel = new MobileFooter_1.FooterPanel(Shell_1.Shell.$mobileFooterPanel);\r\n            }\r\n            else {\r\n                Shell_1.Shell.$footerPanel.hide();\r\n            }\r\n            this.$helpDialogue = $('<div class=\"overlay help\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$helpDialogue);\r\n            this.helpDialogue = new HelpDialogue_1.HelpDialogue(this.$helpDialogue);\r\n            this.$moreInfoDialogue = $('<div class=\"overlay moreInfo\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$moreInfoDialogue);\r\n            this.moreInfoDialogue = new MoreInfoDialogue_1.MoreInfoDialogue(this.$moreInfoDialogue);\r\n            this.$multiSelectDialogue = $('<div class=\"overlay multiSelect\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$multiSelectDialogue);\r\n            this.multiSelectDialogue = new MultiSelectDialogue_1.MultiSelectDialogue(this.$multiSelectDialogue);\r\n            this.$shareDialogue = $('<div class=\"overlay share\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$shareDialogue);\r\n            this.shareDialogue = new ShareDialogue_1.ShareDialogue(this.$shareDialogue);\r\n            this.$downloadDialogue = $('<div class=\"overlay download\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$downloadDialogue);\r\n            this.downloadDialogue = new DownloadDialogue_1.DownloadDialogue(this.$downloadDialogue);\r\n            this.$settingsDialogue = $('<div class=\"overlay settings\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$settingsDialogue);\r\n            this.settingsDialogue = new SettingsDialogue_1.SettingsDialogue(this.$settingsDialogue);\r\n            this.$externalContentDialogue = $('<div class=\"overlay externalContent\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$externalContentDialogue);\r\n            this.externalContentDialogue = new ExternalContentDialogue_1.ExternalContentDialogue(this.$externalContentDialogue);\r\n            if (this.isHeaderPanelEnabled()) {\r\n                this.headerPanel.init();\r\n            }\r\n            if (this.isLeftPanelEnabled()) {\r\n                this.leftPanel.init();\r\n            }\r\n            if (this.isRightPanelEnabled()) {\r\n                this.rightPanel.init();\r\n            }\r\n            if (this.isFooterPanelEnabled()) {\r\n                this.footerPanel.init();\r\n            }\r\n        };\r\n        Extension.prototype.checkForSearchParam = function () {\r\n            // if a h value is in the hash params, do a search.\r\n            if (this.isDeepLinkingEnabled()) {\r\n                // if a highlight param is set, use it to search.\r\n                var highlight = this.getParam(Params_1.Params.highlight);\r\n                if (highlight) {\r\n                    highlight.replace(/\\+/g, \" \").replace(/\"/g, \"\");\r\n                    $.publish(Commands_1.Commands.SEARCH, [highlight]);\r\n                }\r\n            }\r\n        };\r\n        Extension.prototype.checkForRotationParam = function () {\r\n            // if a rotation value is in the hash params, set currentRotation\r\n            if (this.isDeepLinkingEnabled()) {\r\n                var rotation = Number(this.getParam(Params_1.Params.rotation));\r\n                if (rotation) {\r\n                    $.publish(Commands_1.Commands.SEADRAGON_ROTATION, [rotation]);\r\n                }\r\n            }\r\n        };\r\n        Extension.prototype.viewPage = function (canvasIndex, isReload) {\r\n            // if it's a valid canvas index.\r\n            if (canvasIndex === -1)\r\n                return;\r\n            if (this.helper.isCanvasIndexOutOfRange(canvasIndex)) {\r\n                this.showMessage(this.config.content.canvasIndexOutOfRange);\r\n                canvasIndex = 0;\r\n            }\r\n            if (this.isPagingSettingEnabled() && !isReload) {\r\n                var indices = this.getPagedIndices(canvasIndex);\r\n                // if the page is already displayed, only advance canvasIndex.\r\n                if (indices.contains(this.helper.canvasIndex)) {\r\n                    this.viewCanvas(canvasIndex);\r\n                    return;\r\n                }\r\n            }\r\n            this.viewCanvas(canvasIndex);\r\n        };\r\n        Extension.prototype.getViewer = function () {\r\n            return this.centerPanel.viewer;\r\n        };\r\n        Extension.prototype.getMode = function () {\r\n            if (this.mode)\r\n                return this.mode;\r\n            switch (this.helper.getManifestType().toString()) {\r\n                case manifesto.ManifestType.monograph().toString():\r\n                    return Mode_1.Mode.page;\r\n                case manifesto.ManifestType.manuscript().toString():\r\n                    return Mode_1.Mode.page;\r\n                default:\r\n                    return Mode_1.Mode.image;\r\n            }\r\n        };\r\n        Extension.prototype.getViewportBounds = function () {\r\n            if (!this.centerPanel)\r\n                return null;\r\n            var bounds = this.centerPanel.getViewportBounds();\r\n            if (bounds) {\r\n                return bounds.toString();\r\n            }\r\n            return null;\r\n        };\r\n        Extension.prototype.getViewerRotation = function () {\r\n            if (!this.centerPanel)\r\n                return null;\r\n            return this.currentRotation;\r\n        };\r\n        Extension.prototype.viewRange = function (path) {\r\n            //this.currentRangePath = path;\r\n            var range = this.helper.getRangeByPath(path);\r\n            if (!range)\r\n                return;\r\n            var canvasId = range.getCanvasIds()[0];\r\n            var index = this.helper.getCanvasIndexById(canvasId);\r\n            this.viewPage(index);\r\n        };\r\n        Extension.prototype.viewLabel = function (label) {\r\n            if (!label) {\r\n                this.showMessage(this.config.modules.genericDialogue.content.emptyValue);\r\n                $.publish(BaseCommands_1.BaseCommands.CANVAS_INDEX_CHANGE_FAILED);\r\n                return;\r\n            }\r\n            var index = this.helper.getCanvasIndexByLabel(label);\r\n            if (index != -1) {\r\n                this.viewPage(index);\r\n            }\r\n            else {\r\n                this.showMessage(this.config.modules.genericDialogue.content.pageNotFound);\r\n                $.publish(BaseCommands_1.BaseCommands.CANVAS_INDEX_CHANGE_FAILED);\r\n            }\r\n        };\r\n        Extension.prototype.treeNodeSelected = function (node) {\r\n            var data = node.data;\r\n            if (!data.type)\r\n                return;\r\n            switch (data.type) {\r\n                case manifesto.IIIFResourceType.manifest().toString():\r\n                    this.viewManifest(data);\r\n                    break;\r\n                case manifesto.IIIFResourceType.collection().toString():\r\n                    // note: this won't get called as the tree component now has branchNodesSelectable = false\r\n                    // useful to keep around for reference\r\n                    this.viewCollection(data);\r\n                    break;\r\n                default:\r\n                    this.viewRange(data.path);\r\n                    break;\r\n            }\r\n        };\r\n        Extension.prototype.clearSearch = function () {\r\n            this.searchResults = [];\r\n            // reload current index as it may contain results.\r\n            this.viewPage(this.helper.canvasIndex);\r\n        };\r\n        Extension.prototype.prevSearchResult = function () {\r\n            var foundResult;\r\n            // get the first result with a canvasIndex less than the current index.\r\n            for (var i = this.searchResults.length - 1; i >= 0; i--) {\r\n                var result = this.searchResults[i];\r\n                if (result.canvasIndex <= this.getPrevPageIndex()) {\r\n                    foundResult = result;\r\n                    this.viewPage(foundResult.canvasIndex);\r\n                    break;\r\n                }\r\n            }\r\n        };\r\n        Extension.prototype.nextSearchResult = function () {\r\n            var foundResult;\r\n            // get the first result with an index greater than the current index.\r\n            for (var i = 0; i < this.searchResults.length; i++) {\r\n                var result = this.searchResults[i];\r\n                if (result.canvasIndex >= this.getNextPageIndex()) {\r\n                    foundResult = result;\r\n                    this.viewPage(result.canvasIndex);\r\n                    break;\r\n                }\r\n            }\r\n        };\r\n        Extension.prototype.bookmark = function () {\r\n            _super.prototype.bookmark.call(this);\r\n            var canvas = this.helper.getCurrentCanvas();\r\n            var bookmark = new Bookmark_1.Bookmark();\r\n            bookmark.index = this.helper.canvasIndex;\r\n            bookmark.label = Manifesto.TranslationCollection.getValue(canvas.getLabel());\r\n            bookmark.path = this.getCroppedImageUri(canvas, this.getViewer());\r\n            bookmark.thumb = canvas.getCanonicalImageUri(this.config.options.bookmarkThumbWidth);\r\n            bookmark.title = this.helper.getLabel();\r\n            bookmark.trackingLabel = window.trackingLabel;\r\n            bookmark.type = manifesto.ElementType.image().toString();\r\n            this.triggerSocket(BaseCommands_1.BaseCommands.BOOKMARK, bookmark);\r\n        };\r\n        Extension.prototype.print = function () {\r\n            // var args: MultiSelectionArgs = new MultiSelectionArgs();\r\n            // args.manifestUri = this.helper.iiifResourceUri;\r\n            // args.allCanvases = true;\r\n            // args.format = this.config.options.printMimeType;\r\n            // args.sequence = this.helper.getCurrentSequence().id;\r\n            window.print();\r\n            this.triggerSocket(Commands_1.Commands.PRINT);\r\n        };\r\n        Extension.prototype.getCroppedImageDimensions = function (canvas, viewer) {\r\n            if (!viewer)\r\n                return null;\r\n            if (!viewer.viewport)\r\n                return null;\r\n            if (!canvas.getHeight() || !canvas.getWidth()) {\r\n                return null;\r\n            }\r\n            var bounds = viewer.viewport.getBounds(true);\r\n            var dimensions = new CroppedImageDimensions_1.CroppedImageDimensions();\r\n            var width = Math.floor(bounds.width);\r\n            var height = Math.floor(bounds.height);\r\n            var x = Math.floor(bounds.x);\r\n            var y = Math.floor(bounds.y);\r\n            // constrain to image bounds\r\n            if (x + width > canvas.getWidth()) {\r\n                width = canvas.getWidth() - x;\r\n            }\r\n            else if (x < 0) {\r\n                width = width + x;\r\n                x = 0;\r\n            }\r\n            if (y + height > canvas.getHeight()) {\r\n                height = canvas.getHeight() - y;\r\n            }\r\n            else if (y < 0) {\r\n                height = height + y;\r\n                y = 0;\r\n            }\r\n            width = Math.min(width, canvas.getWidth());\r\n            height = Math.min(height, canvas.getHeight());\r\n            var regionWidth = width;\r\n            var regionHeight = height;\r\n            if (canvas.externalResource.data && canvas.externalResource.data.profile && canvas.externalResource.data.profile[1]) {\r\n                var maxSize = new Size(canvas.externalResource.data.profile[1].maxWidth, canvas.externalResource.data.profile[1].maxHeight);\r\n                if (!_.isUndefined(maxSize.width) && !_.isUndefined(maxSize.height)) {\r\n                    if (width > maxSize.width) {\r\n                        var newWidth = maxSize.width;\r\n                        height = Math.round(newWidth * (height / width));\r\n                        width = newWidth;\r\n                    }\r\n                    if (height > maxSize.height) {\r\n                        var newHeight = maxSize.height;\r\n                        width = Math.round((width / height) * newHeight);\r\n                        height = newHeight;\r\n                    }\r\n                }\r\n            }\r\n            dimensions.region = new Size(regionWidth, regionHeight);\r\n            dimensions.regionPos = new Point_1.Point(x, y);\r\n            dimensions.size = new Size(width, height);\r\n            return dimensions;\r\n        };\r\n        // keep this around for reference\r\n        // getOnScreenCroppedImageDimensions(canvas: Manifesto.ICanvas, viewer: any): CroppedImageDimensions {\r\n        //     if (!viewer) return null;\r\n        //     if (!viewer.viewport) return null;\r\n        //     if (!canvas.getHeight() || !canvas.getWidth()){\r\n        //         return null;\r\n        //     }\r\n        //     var bounds = viewer.viewport.getBounds(true);\r\n        //     var containerSize = viewer.viewport.getContainerSize();\r\n        //     var zoom = viewer.viewport.getZoom(true);\r\n        //     var top = Math.max(0, bounds.y);\r\n        //     var left = Math.max(0, bounds.x);\r\n        //     // change top to be normalised value proportional to height of image, not width (as per OSD).\r\n        //     top = 1 / (canvas.getHeight() / parseInt(String(canvas.getWidth() * top)));\r\n        //     // get on-screen pixel sizes.\r\n        //     var viewportWidthPx = containerSize.x;\r\n        //     var viewportHeightPx = containerSize.y;\r\n        //     var imageWidthPx = parseInt(String(viewportWidthPx * zoom));\r\n        //     var ratio = canvas.getWidth() / imageWidthPx;\r\n        //     var imageHeightPx = parseInt(String(canvas.getHeight() / ratio));\r\n        //     var viewportLeftPx = parseInt(String(left * imageWidthPx));\r\n        //     var viewportTopPx = parseInt(String(top * imageHeightPx));\r\n        //     var rect1Left = 0;\r\n        //     var rect1Right = imageWidthPx;\r\n        //     var rect1Top = 0;\r\n        //     var rect1Bottom = imageHeightPx;\r\n        //     var rect2Left = viewportLeftPx;\r\n        //     var rect2Right = viewportLeftPx + viewportWidthPx;\r\n        //     var rect2Top = viewportTopPx;\r\n        //     var rect2Bottom = viewportTopPx + viewportHeightPx;\r\n        //     var sizeWidth = Math.max(0, Math.min(rect1Right, rect2Right) - Math.max(rect1Left, rect2Left));\r\n        //     var sizeHeight = Math.max(0, Math.min(rect1Bottom, rect2Bottom) - Math.max(rect1Top, rect2Top));\r\n        //     // get original image pixel sizes.\r\n        //     var ratio2 = canvas.getWidth() / imageWidthPx;\r\n        //     var regionWidth = parseInt(String(sizeWidth * ratio2));\r\n        //     var regionHeight = parseInt(String(sizeHeight * ratio2));\r\n        //     var regionTop = parseInt(String(canvas.getHeight() * top));\r\n        //     var regionLeft = parseInt(String(canvas.getWidth() * left));\r\n        //     if (regionTop < 0) regionTop = 0;\r\n        //     if (regionLeft < 0) regionLeft = 0;\r\n        //     var dimensions: CroppedImageDimensions = new CroppedImageDimensions();\r\n        //     dimensions.region = new Size(regionWidth, regionHeight);\r\n        //     dimensions.regionPos = new Point(regionLeft, regionTop);\r\n        //     dimensions.size = new Size(sizeWidth, sizeHeight);\r\n        //     return dimensions;\r\n        // }\r\n        Extension.prototype.getCroppedImageUri = function (canvas, viewer) {\r\n            if (!viewer)\r\n                return null;\r\n            if (!viewer.viewport)\r\n                return null;\r\n            var dimensions = this.getCroppedImageDimensions(canvas, viewer);\r\n            // construct uri\r\n            // {baseuri}/{id}/{region}/{size}/{rotation}/{quality}.jpg\r\n            var baseUri = this.getImageBaseUri(canvas);\r\n            var id = this.getImageId(canvas);\r\n            var region = dimensions.regionPos.x + \",\" + dimensions.regionPos.y + \",\" + dimensions.region.width + \",\" + dimensions.region.height;\r\n            var size = dimensions.size.width + ',' + dimensions.size.height;\r\n            var rotation = this.getViewerRotation();\r\n            var quality = 'default';\r\n            return baseUri + \"/\" + id + \"/\" + region + \"/\" + size + \"/\" + rotation + \"/\" + quality + \".jpg\";\r\n        };\r\n        Extension.prototype.getConfinedImageDimensions = function (canvas, width) {\r\n            var dimensions = new Size(0, 0);\r\n            dimensions.width = width;\r\n            var normWidth = Math.normalise(width, 0, canvas.getWidth());\r\n            dimensions.height = Math.floor(canvas.getHeight() * normWidth);\r\n            return dimensions;\r\n        };\r\n        Extension.prototype.getConfinedImageUri = function (canvas, width) {\r\n            var baseUri = this.getImageBaseUri(canvas);\r\n            // {baseuri}/{id}/{region}/{size}/{rotation}/{quality}.jpg\r\n            var id = this.getImageId(canvas);\r\n            var region = 'full';\r\n            var dimensions = this.getConfinedImageDimensions(canvas, width);\r\n            var size = dimensions.width + ',' + dimensions.height;\r\n            var rotation = this.getViewerRotation();\r\n            var quality = 'default';\r\n            return baseUri + \"/\" + id + \"/\" + region + \"/\" + size + \"/\" + rotation + \"/\" + quality + \".jpg\";\r\n        };\r\n        Extension.prototype.getImageId = function (canvas) {\r\n            var id = this.getInfoUri(canvas);\r\n            // First trim off info.json, then extract ID:\r\n            id = id.substr(0, id.lastIndexOf(\"/\"));\r\n            return id.substr(id.lastIndexOf(\"/\") + 1);\r\n        };\r\n        Extension.prototype.getImageBaseUri = function (canvas) {\r\n            var uri = this.getInfoUri(canvas);\r\n            // First trim off info.json, then trim off ID....\r\n            uri = uri.substr(0, uri.lastIndexOf(\"/\"));\r\n            return uri.substr(0, uri.lastIndexOf(\"/\"));\r\n        };\r\n        Extension.prototype.getInfoUri = function (canvas) {\r\n            var infoUri;\r\n            var images = canvas.getImages();\r\n            if (images && images.length) {\r\n                var firstImage = images[0];\r\n                var resource = firstImage.getResource();\r\n                var services = resource.getServices();\r\n                for (var i = 0; i < services.length; i++) {\r\n                    var service = services[i];\r\n                    var id = service.id;\r\n                    if (!_.endsWith(id, '/')) {\r\n                        id += '/';\r\n                    }\r\n                    if (manifesto.Utils.isImageProfile(service.getProfile())) {\r\n                        infoUri = id + 'info.json';\r\n                    }\r\n                }\r\n            }\r\n            if (!infoUri) {\r\n                // todo: use compiler flag (when available)\r\n                infoUri = 'lib/imageunavailable.json';\r\n            }\r\n            return infoUri;\r\n        };\r\n        Extension.prototype.getEmbedScript = function (template, width, height, zoom, rotation) {\r\n            var configUri = this.config.uri || '';\r\n            var script = String.format(template, this.getSerializedLocales(), configUri, this.helper.iiifResourceUri, this.helper.collectionIndex, this.helper.manifestIndex, this.helper.sequenceIndex, this.helper.canvasIndex, zoom, rotation, width, height, this.embedScriptUri);\r\n            return script;\r\n        };\r\n        Extension.prototype.getPrevPageIndex = function (canvasIndex) {\r\n            if (_.isUndefined(canvasIndex))\r\n                canvasIndex = this.helper.canvasIndex;\r\n            var index;\r\n            if (this.isPagingSettingEnabled()) {\r\n                var indices = this.getPagedIndices(canvasIndex);\r\n                if (this.helper.isRightToLeft()) {\r\n                    index = indices.last() - 1;\r\n                }\r\n                else {\r\n                    index = indices[0] - 1;\r\n                }\r\n            }\r\n            else {\r\n                index = canvasIndex - 1;\r\n            }\r\n            return index;\r\n        };\r\n        Extension.prototype.isSearchWithinEnabled = function () {\r\n            if (!Utils.Bools.getBool(this.config.options.searchWithinEnabled, false)) {\r\n                return false;\r\n            }\r\n            if (!this.helper.getSearchWithinService()) {\r\n                return false;\r\n            }\r\n            return true;\r\n        };\r\n        Extension.prototype.isPagingSettingEnabled = function () {\r\n            if (this.helper.isPagingAvailable()) {\r\n                return this.getSettings().pagingEnabled;\r\n            }\r\n            return false;\r\n        };\r\n        Extension.prototype.getNextPageIndex = function (canvasIndex) {\r\n            if (_.isUndefined(canvasIndex))\r\n                canvasIndex = this.helper.canvasIndex;\r\n            var index;\r\n            if (this.isPagingSettingEnabled()) {\r\n                var indices = this.getPagedIndices(canvasIndex);\r\n                if (this.helper.isRightToLeft()) {\r\n                    index = indices[0] + 1;\r\n                }\r\n                else {\r\n                    index = indices.last() + 1;\r\n                }\r\n            }\r\n            else {\r\n                index = canvasIndex + 1;\r\n            }\r\n            if (index > this.helper.getTotalCanvases() - 1) {\r\n                return -1;\r\n            }\r\n            return index;\r\n        };\r\n        Extension.prototype.getAutoCompleteService = function () {\r\n            var service = this.helper.getSearchWithinService();\r\n            if (!service)\r\n                return null;\r\n            return service.getService(manifesto.ServiceProfile.autoComplete());\r\n        };\r\n        Extension.prototype.getAutoCompleteUri = function () {\r\n            var service = this.getAutoCompleteService();\r\n            if (!service)\r\n                return null;\r\n            return service.id + '?q={0}';\r\n        };\r\n        Extension.prototype.getSearchWithinServiceUri = function () {\r\n            var service = this.helper.getSearchWithinService();\r\n            if (!service)\r\n                return null;\r\n            var uri = service.id;\r\n            uri = uri + \"?q={0}\";\r\n            return uri;\r\n        };\r\n        Extension.prototype.searchWithin = function (terms) {\r\n            var _this = this;\r\n            if (this.isSearching)\r\n                return;\r\n            this.isSearching = true;\r\n            // clear search results\r\n            this.searchResults = [];\r\n            var that = this;\r\n            var searchUri = this.getSearchWithinServiceUri();\r\n            searchUri = String.format(searchUri, terms);\r\n            this.getSearchResults(searchUri, terms, this.searchResults, function (results) {\r\n                _this.isSearching = false;\r\n                if (results.length) {\r\n                    _this.searchResults = results.sort(function (a, b) {\r\n                        return a.canvasIndex - b.canvasIndex;\r\n                    });\r\n                    $.publish(Commands_1.Commands.SEARCH_RESULTS, [{ terms: terms, results: results }]);\r\n                    // reload current index as it may contain results.\r\n                    that.viewPage(that.helper.canvasIndex, true);\r\n                }\r\n                else {\r\n                    that.showMessage(that.config.modules.genericDialogue.content.noMatches, function () {\r\n                        $.publish(Commands_1.Commands.SEARCH_RESULTS_EMPTY);\r\n                    });\r\n                }\r\n            });\r\n        };\r\n        Extension.prototype.getSearchResults = function (searchUri, terms, searchResults, cb) {\r\n            var _this = this;\r\n            $.getJSON(searchUri, function (results) {\r\n                if (results.resources && results.resources.length) {\r\n                    searchResults = searchResults.concat(_this.parseSearchJson(results, searchResults));\r\n                }\r\n                if (results.next) {\r\n                    _this.getSearchResults(results.next, terms, searchResults, cb);\r\n                }\r\n                else {\r\n                    cb(searchResults);\r\n                }\r\n            });\r\n        };\r\n        Extension.prototype.parseSearchJson = function (resultsToParse, searchResults) {\r\n            var parsedResults = [];\r\n            for (var i = 0; i < resultsToParse.resources.length; i++) {\r\n                var resource = resultsToParse.resources[i];\r\n                var canvasIndex = this.helper.getCanvasIndexById(resource.on.match(/(.*)#/)[1]);\r\n                var searchResult = new SearchResult(resource, canvasIndex);\r\n                var match = parsedResults.en().where(function (x) { return x.canvasIndex === searchResult.canvasIndex; }).first();\r\n                // if there's already a SearchResult for the canvas index, add a rect to it, otherwise create a new SearchResult\r\n                if (match) {\r\n                    match.addRect(resource);\r\n                }\r\n                else {\r\n                    parsedResults.push(searchResult);\r\n                }\r\n            }\r\n            // sort by canvasIndex\r\n            parsedResults.sort(function (a, b) {\r\n                return a.canvasIndex - b.canvasIndex;\r\n            });\r\n            return parsedResults;\r\n        };\r\n        Extension.prototype.getSearchResultRects = function () {\r\n            return this.searchResults.en().selectMany(function (x) { return x.rects; }).toArray();\r\n        };\r\n        Extension.prototype.getCurrentSearchResultRectIndex = function () {\r\n            var searchResultRects = this.getSearchResultRects();\r\n            return searchResultRects.indexOf(this.currentSearchResultRect);\r\n        };\r\n        Extension.prototype.getTotalSearchResultRects = function () {\r\n            var searchResultRects = this.getSearchResultRects();\r\n            return searchResultRects.length;\r\n        };\r\n        Extension.prototype.isFirstSearchResultRect = function () {\r\n            return this.getCurrentSearchResultRectIndex() === 0;\r\n        };\r\n        Extension.prototype.getLastSearchResultRectIndex = function () {\r\n            return this.getTotalSearchResultRects() - 1;\r\n        };\r\n        Extension.prototype.getPagedIndices = function (canvasIndex) {\r\n            if (_.isUndefined(canvasIndex))\r\n                canvasIndex = this.helper.canvasIndex;\r\n            var indices = [];\r\n            // if it's a continuous manifest, get all resources.\r\n            if (this.helper.isContinuous()) {\r\n                indices = $.map(this.helper.getCanvases(), function (c, index) {\r\n                    return index;\r\n                });\r\n            }\r\n            else {\r\n                if (!this.isPagingSettingEnabled()) {\r\n                    indices.push(this.helper.canvasIndex);\r\n                }\r\n                else {\r\n                    if (this.helper.isFirstCanvas(canvasIndex) || (this.helper.isLastCanvas(canvasIndex) && this.helper.isTotalCanvasesEven())) {\r\n                        indices = [canvasIndex];\r\n                    }\r\n                    else if (canvasIndex % 2) {\r\n                        indices = [canvasIndex, canvasIndex + 1];\r\n                    }\r\n                    else {\r\n                        indices = [canvasIndex - 1, canvasIndex];\r\n                    }\r\n                    if (this.helper.isRightToLeft()) {\r\n                        indices = indices.reverse();\r\n                    }\r\n                }\r\n            }\r\n            return indices;\r\n        };\r\n        return Extension;\r\n    }(BaseExtension_1.BaseExtension));\r\n    exports.Extension = Extension;\r\n});\r\n//# sourceMappingURL=Extension.js.map;\n",
    "define('extensions/uv-mediaelement-extension/Commands',[\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    var Commands = (function () {\r\n        function Commands() {\r\n        }\r\n        return Commands;\r\n    }());\r\n    Commands.namespace = 'mediaelementExtension.';\r\n    Commands.MEDIA_ENDED = Commands.namespace + 'onMediaEnded';\r\n    Commands.MEDIA_PAUSED = Commands.namespace + 'onMediaPaused';\r\n    Commands.MEDIA_PLAYED = Commands.namespace + 'onMediaPlayed';\r\n    exports.Commands = Commands;\r\n});\r\n//# sourceMappingURL=Commands.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('extensions/uv-mediaelement-extension/DownloadDialogue',[\"require\", \"exports\", \"../../modules/uv-dialogues-module/DownloadDialogue\"], function (require, exports, DownloadDialogue_1) {\r\n    \"use strict\";\r\n    var DownloadDialogue = (function (_super) {\r\n        __extends(DownloadDialogue, _super);\r\n        function DownloadDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        DownloadDialogue.prototype.create = function () {\r\n            this.setConfig('downloadDialogue');\r\n            _super.prototype.create.call(this);\r\n        };\r\n        DownloadDialogue.prototype.open = function ($triggerButton) {\r\n            _super.prototype.open.call(this, $triggerButton);\r\n            this.addEntireFileDownloadOptions();\r\n            this.updateNoneAvailable();\r\n            this.resize();\r\n        };\r\n        DownloadDialogue.prototype.isDownloadOptionAvailable = function (option) {\r\n            return _super.prototype.isDownloadOptionAvailable.call(this, option);\r\n        };\r\n        return DownloadDialogue;\r\n    }(DownloadDialogue_1.DownloadDialogue));\r\n    exports.DownloadDialogue = DownloadDialogue;\r\n});\r\n//# sourceMappingURL=DownloadDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('extensions/uv-mediaelement-extension/ShareDialogue',[\"require\", \"exports\", \"../../modules/uv-dialogues-module/ShareDialogue\"], function (require, exports, ShareDialogue_1) {\r\n    \"use strict\";\r\n    var ShareDialogue = (function (_super) {\r\n        __extends(ShareDialogue, _super);\r\n        function ShareDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        ShareDialogue.prototype.create = function () {\r\n            this.setConfig('shareDialogue');\r\n            _super.prototype.create.call(this);\r\n        };\r\n        ShareDialogue.prototype.update = function () {\r\n            _super.prototype.update.call(this);\r\n            this.code = this.extension.getEmbedScript(this.options.embedTemplate, this.currentWidth, this.currentHeight);\r\n            this.$code.val(this.code);\r\n        };\r\n        ShareDialogue.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n        };\r\n        return ShareDialogue;\r\n    }(ShareDialogue_1.ShareDialogue));\r\n    exports.ShareDialogue = ShareDialogue;\r\n});\r\n//# sourceMappingURL=ShareDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-mediaelementcenterpanel-module/MediaElementCenterPanel',[\"require\", \"exports\", \"../uv-shared-module/BaseCommands\", \"../../extensions/uv-mediaelement-extension/Commands\", \"../uv-shared-module/CenterPanel\"], function (require, exports, BaseCommands_1, Commands_1, CenterPanel_1) {\r\n    \"use strict\";\r\n    var MediaElementCenterPanel = (function (_super) {\r\n        __extends(MediaElementCenterPanel, _super);\r\n        function MediaElementCenterPanel($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        MediaElementCenterPanel.prototype.create = function () {\r\n            this.setConfig('mediaelementCenterPanel');\r\n            _super.prototype.create.call(this);\r\n            var that = this;\r\n            // events.\r\n            // only full screen video\r\n            if (this.extension.isVideo()) {\r\n                $.subscribe(BaseCommands_1.BaseCommands.TOGGLE_FULLSCREEN, function (e) {\r\n                    if (that.bootstrapper.isFullScreen) {\r\n                        that.$container.css('backgroundColor', '#000');\r\n                        that.player.enterFullScreen(false);\r\n                    }\r\n                    else {\r\n                        that.$container.css('backgroundColor', 'transparent');\r\n                        that.player.exitFullScreen(false);\r\n                    }\r\n                });\r\n            }\r\n            $.subscribe(BaseCommands_1.BaseCommands.OPEN_EXTERNAL_RESOURCE, function (e, resources) {\r\n                that.openMedia(resources);\r\n            });\r\n            this.$container = $('<div class=\"container\"></div>');\r\n            this.$content.append(this.$container);\r\n            this.title = this.extension.helper.getLabel();\r\n        };\r\n        MediaElementCenterPanel.prototype.openMedia = function (resources) {\r\n            var _this = this;\r\n            var that = this;\r\n            this.extension.getExternalResources(resources).then(function () {\r\n                _this.$container.empty();\r\n                var canvas = _this.extension.helper.getCurrentCanvas();\r\n                _this.mediaHeight = _this.config.defaultHeight;\r\n                _this.mediaWidth = _this.config.defaultWidth;\r\n                _this.$container.height(_this.mediaHeight);\r\n                _this.$container.width(_this.mediaWidth);\r\n                var id = Utils.Dates.getTimeStamp();\r\n                var poster = _this.extension.getPosterImageUri();\r\n                var posterAttr = poster ? ' poster=\"' + poster + '\"' : '';\r\n                var sources = [];\r\n                $.each(canvas.getRenderings(), function (index, rendering) {\r\n                    sources.push({\r\n                        type: rendering.getFormat().toString(),\r\n                        src: rendering.id\r\n                    });\r\n                });\r\n                if (_this.extension.isVideo()) {\r\n                    _this.media = _this.$container.append('<video id=\"' + id + '\" type=\"video/mp4\" class=\"mejs-uv\" controls=\"controls\" preload=\"none\"' + posterAttr + '></video>');\r\n                    _this.player = new MediaElementPlayer(\"#\" + id, {\r\n                        type: ['video/mp4', 'video/webm', 'video/flv'],\r\n                        plugins: ['flash'],\r\n                        alwaysShowControls: false,\r\n                        autosizeProgress: false,\r\n                        success: function (media) {\r\n                            media.addEventListener('canplay', function (e) {\r\n                                that.resize();\r\n                            });\r\n                            media.addEventListener('play', function (e) {\r\n                                $.publish(Commands_1.Commands.MEDIA_PLAYED, [Math.floor(that.player.media.currentTime)]);\r\n                            });\r\n                            media.addEventListener('pause', function (e) {\r\n                                // mediaelement creates a pause event before the ended event. ignore this.\r\n                                if (Math.floor(that.player.media.currentTime) != Math.floor(that.player.media.duration)) {\r\n                                    $.publish(Commands_1.Commands.MEDIA_PAUSED, [Math.floor(that.player.media.currentTime)]);\r\n                                }\r\n                            });\r\n                            media.addEventListener('ended', function (e) {\r\n                                $.publish(Commands_1.Commands.MEDIA_ENDED, [Math.floor(that.player.media.duration)]);\r\n                            });\r\n                            media.setSrc(sources);\r\n                            try {\r\n                                media.load();\r\n                            }\r\n                            catch (e) {\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                else {\r\n                    // Try to find an MP3, since this is most likely to work:\r\n                    var preferredSource = 0;\r\n                    for (var i in sources) {\r\n                        if (sources[i].type === \"audio/mp3\") {\r\n                            preferredSource = i;\r\n                            break;\r\n                        }\r\n                    }\r\n                    _this.media = _this.$container.append('<audio id=\"' + id + '\" type=\"' + sources[preferredSource].type + '\" src=\"' + sources[preferredSource].src + '\" class=\"mejs-uv\" controls=\"controls\" preload=\"none\"' + posterAttr + '></audio>');\r\n                    _this.player = new MediaElementPlayer(\"#\" + id, {\r\n                        plugins: ['flash'],\r\n                        alwaysShowControls: false,\r\n                        autosizeProgress: false,\r\n                        defaultVideoWidth: that.mediaWidth,\r\n                        defaultVideoHeight: that.mediaHeight,\r\n                        success: function (media) {\r\n                            media.addEventListener('canplay', function (e) {\r\n                                that.resize();\r\n                            });\r\n                            media.addEventListener('play', function (e) {\r\n                                $.publish(Commands_1.Commands.MEDIA_PLAYED, [Math.floor(that.player.media.currentTime)]);\r\n                            });\r\n                            media.addEventListener('pause', function (e) {\r\n                                // mediaelement creates a pause event before the ended event. ignore this.\r\n                                if (Math.floor(that.player.media.currentTime) != Math.floor(that.player.media.duration)) {\r\n                                    $.publish(Commands_1.Commands.MEDIA_PAUSED, [Math.floor(that.player.media.currentTime)]);\r\n                                }\r\n                            });\r\n                            media.addEventListener('ended', function (e) {\r\n                                $.publish(Commands_1.Commands.MEDIA_ENDED, [Math.floor(that.player.media.duration)]);\r\n                            });\r\n                            //media.setSrc(sources);\r\n                            try {\r\n                                media.load();\r\n                            }\r\n                            catch (e) {\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                _this.resize();\r\n            });\r\n        };\r\n        MediaElementCenterPanel.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n            // if in Firefox < v13 don't resize the media container.\r\n            if (window.browserDetect.browser === 'Firefox' && window.browserDetect.version < 13) {\r\n                this.$container.width(this.mediaWidth);\r\n                this.$container.height(this.mediaHeight);\r\n            }\r\n            else {\r\n                // fit media to available space.\r\n                var size = Utils.Measurements.Dimensions.fitRect(this.mediaWidth, this.mediaHeight, this.$content.width(), this.$content.height());\r\n                this.$container.height(size.height);\r\n                this.$container.width(size.width);\r\n            }\r\n            if (this.player && !this.extension.isFullScreen()) {\r\n                this.player.resize();\r\n            }\r\n            var left = Math.floor((this.$content.width() - this.$container.width()) / 2);\r\n            var top = Math.floor((this.$content.height() - this.$container.height()) / 2);\r\n            this.$container.css({\r\n                'left': left,\r\n                'top': top\r\n            });\r\n            this.$title.ellipsisFill(this.title);\r\n        };\r\n        return MediaElementCenterPanel;\r\n    }(CenterPanel_1.CenterPanel));\r\n    exports.MediaElementCenterPanel = MediaElementCenterPanel;\r\n});\r\n//# sourceMappingURL=MediaElementCenterPanel.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-resourcesleftpanel-module/ThumbsView',[\"require\", \"exports\", \"../uv-shared-module/ThumbsView\"], function (require, exports, ThumbsView_1) {\r\n    \"use strict\";\r\n    var ThumbsView = (function (_super) {\r\n        __extends(ThumbsView, _super);\r\n        function ThumbsView() {\r\n            return _super !== null && _super.apply(this, arguments) || this;\r\n        }\r\n        ThumbsView.prototype.create = function () {\r\n            this.setConfig('resourcesLeftPanel');\r\n            _super.prototype.create.call(this);\r\n        };\r\n        return ThumbsView;\r\n    }(ThumbsView_1.ThumbsView));\r\n    exports.ThumbsView = ThumbsView;\r\n});\r\n//# sourceMappingURL=ThumbsView.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-resourcesleftpanel-module/ResourcesLeftPanel',[\"require\", \"exports\", \"../uv-shared-module/BaseCommands\", \"../uv-shared-module/LeftPanel\", \"./ThumbsView\"], function (require, exports, BaseCommands_1, LeftPanel_1, ThumbsView_1) {\r\n    \"use strict\";\r\n    var ResourcesLeftPanel = (function (_super) {\r\n        __extends(ResourcesLeftPanel, _super);\r\n        function ResourcesLeftPanel($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        ResourcesLeftPanel.prototype.create = function () {\r\n            this.setConfig('resourcesLeftPanel');\r\n            _super.prototype.create.call(this);\r\n            this.setTitle(this.content.title);\r\n            /*\r\n             TODO: make tabs work\r\n            this.$tabs = $('<div class=\"tabs\"></div>');\r\n            this.$main.append(this.$tabs);\r\n    \r\n            this.$thumbsButton = $('<a class=\"thumbs tab\">' + this.content.thumbnails + '</a>');\r\n            this.$thumbsButton.prop('title', this.content.thumbnails);\r\n            this.$tabs.append(this.$thumbsButton);\r\n    \r\n            this.$resourcesButton = $('<a class=\"resources tab\">' + this.content.resources+ '</a>');\r\n            this.$resourcesButton.prop('title', this.content.resources);\r\n            this.$tabs.append(this.$resourcesButton);\r\n             */\r\n            this.$tabsContent = $('<div class=\"tabsContent\"></div>');\r\n            this.$main.append(this.$tabsContent);\r\n            this.$views = $('<div class=\"views\"></div>');\r\n            this.$tabsContent.append(this.$views);\r\n            this.$thumbsView = $('<div class=\"thumbsView\"></div>');\r\n            this.$views.append(this.$thumbsView);\r\n            this.$resourcesView = $('<div class=\"resourcesView\"></div>');\r\n            this.$resources = $('<ul></ul>');\r\n            this.$resourcesView.append(this.$resources);\r\n            this.$views.append(this.$resourcesView);\r\n            this.thumbsView = new ThumbsView_1.ThumbsView(this.$thumbsView);\r\n            this.dataBind();\r\n        };\r\n        ResourcesLeftPanel.prototype.dataBind = function () {\r\n            this.dataBindThumbsView();\r\n            var annotations = this.extension.helper.getResources();\r\n            if (annotations.length === 0) {\r\n                this.$resourcesView.hide();\r\n            }\r\n            for (var i = 0; i < annotations.length; i++) {\r\n                var annotation = annotations[i];\r\n                var resource = annotation.getResource();\r\n                var $listItem = $('<li><a href=\"' + resource.id + '\" target=\"_blank\">' + Manifesto.TranslationCollection.getValue(resource.getLabel()) + ' (' + Utils.Files.simplifyMimeType(resource.getFormat().toString()) + ')' + '</li>');\r\n                this.$resources.append($listItem);\r\n            }\r\n        };\r\n        ResourcesLeftPanel.prototype.dataBindThumbsView = function () {\r\n            if (!this.thumbsView)\r\n                return;\r\n            var width, height;\r\n            var viewingDirection = this.extension.helper.getViewingDirection().toString();\r\n            if (viewingDirection === manifesto.ViewingDirection.topToBottom().toString() || viewingDirection === manifesto.ViewingDirection.bottomToTop().toString()) {\r\n                width = this.config.options.oneColThumbWidth;\r\n                height = this.config.options.oneColThumbHeight;\r\n            }\r\n            else {\r\n                width = this.config.options.twoColThumbWidth;\r\n                height = this.config.options.twoColThumbHeight;\r\n            }\r\n            if (typeof width === \"undefined\") {\r\n                width = 100;\r\n            }\r\n            if (typeof height === \"undefined\") {\r\n                height = 100;\r\n            }\r\n            this.thumbsView.thumbs = this.extension.helper.getThumbs(width, height);\r\n            // hide thumb selector for single-part manifests\r\n            if (this.thumbsView.thumbs.length < 2) {\r\n                this.$thumbsView.hide();\r\n            }\r\n            this.thumbsView.databind();\r\n        };\r\n        ResourcesLeftPanel.prototype.expandFullStart = function () {\r\n            _super.prototype.expandFullStart.call(this);\r\n            $.publish(BaseCommands_1.BaseCommands.LEFTPANEL_EXPAND_FULL_START);\r\n        };\r\n        ResourcesLeftPanel.prototype.expandFullFinish = function () {\r\n            _super.prototype.expandFullFinish.call(this);\r\n            $.publish(BaseCommands_1.BaseCommands.LEFTPANEL_EXPAND_FULL_FINISH);\r\n        };\r\n        ResourcesLeftPanel.prototype.collapseFullStart = function () {\r\n            _super.prototype.collapseFullStart.call(this);\r\n            $.publish(BaseCommands_1.BaseCommands.LEFTPANEL_COLLAPSE_FULL_START);\r\n        };\r\n        ResourcesLeftPanel.prototype.collapseFullFinish = function () {\r\n            _super.prototype.collapseFullFinish.call(this);\r\n            $.publish(BaseCommands_1.BaseCommands.LEFTPANEL_COLLAPSE_FULL_FINISH);\r\n        };\r\n        ResourcesLeftPanel.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n            this.$views.height(this.$main.height());\r\n            this.$resources.height(this.$main.height());\r\n        };\r\n        return ResourcesLeftPanel;\r\n    }(LeftPanel_1.LeftPanel));\r\n    exports.ResourcesLeftPanel = ResourcesLeftPanel;\r\n});\r\n//# sourceMappingURL=ResourcesLeftPanel.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('extensions/uv-mediaelement-extension/SettingsDialogue',[\"require\", \"exports\", \"../../modules/uv-dialogues-module/SettingsDialogue\"], function (require, exports, SettingsDialogue_1) {\r\n    \"use strict\";\r\n    var SettingsDialogue = (function (_super) {\r\n        __extends(SettingsDialogue, _super);\r\n        function SettingsDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        SettingsDialogue.prototype.create = function () {\r\n            this.setConfig('settingsDialogue');\r\n            _super.prototype.create.call(this);\r\n        };\r\n        return SettingsDialogue;\r\n    }(SettingsDialogue_1.SettingsDialogue));\r\n    exports.SettingsDialogue = SettingsDialogue;\r\n});\r\n//# sourceMappingURL=SettingsDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('extensions/uv-mediaelement-extension/Extension',[\"require\", \"exports\", \"../../modules/uv-shared-module/BaseCommands\", \"../../modules/uv-shared-module/BaseExtension\", \"../../modules/uv-shared-module/Bookmark\", \"./Commands\", \"./DownloadDialogue\", \"./ShareDialogue\", \"../../modules/uv-shared-module/FooterPanel\", \"../../modules/uv-shared-module/HeaderPanel\", \"../../modules/uv-dialogues-module/HelpDialogue\", \"../../modules/uv-mediaelementcenterpanel-module/MediaElementCenterPanel\", \"../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel\", \"../../modules/uv-resourcesleftpanel-module/ResourcesLeftPanel\", \"./SettingsDialogue\", \"../../modules/uv-shared-module/Shell\"], function (require, exports, BaseCommands_1, BaseExtension_1, Bookmark_1, Commands_1, DownloadDialogue_1, ShareDialogue_1, FooterPanel_1, HeaderPanel_1, HelpDialogue_1, MediaElementCenterPanel_1, MoreInfoRightPanel_1, ResourcesLeftPanel_1, SettingsDialogue_1, Shell_1) {\r\n    \"use strict\";\r\n    var Extension = (function (_super) {\r\n        __extends(Extension, _super);\r\n        function Extension(bootstrapper) {\r\n            return _super.call(this, bootstrapper) || this;\r\n        }\r\n        Extension.prototype.create = function () {\r\n            var _this = this;\r\n            _super.prototype.create.call(this);\r\n            // listen for mediaelement enter/exit fullscreen events.\r\n            $(window).bind('enterfullscreen', function () {\r\n                $.publish(BaseCommands_1.BaseCommands.TOGGLE_FULLSCREEN);\r\n            });\r\n            $(window).bind('exitfullscreen', function () {\r\n                $.publish(BaseCommands_1.BaseCommands.TOGGLE_FULLSCREEN);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.THUMB_SELECTED, function (e, canvasIndex) {\r\n                _this.viewCanvas(canvasIndex);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LEFTPANEL_EXPAND_FULL_START, function (e) {\r\n                Shell_1.Shell.$centerPanel.hide();\r\n                Shell_1.Shell.$rightPanel.hide();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LEFTPANEL_COLLAPSE_FULL_FINISH, function (e) {\r\n                Shell_1.Shell.$centerPanel.show();\r\n                Shell_1.Shell.$rightPanel.show();\r\n                _this.resize();\r\n            });\r\n            $.subscribe(Commands_1.Commands.MEDIA_ENDED, function (e) {\r\n                _this.triggerSocket(Commands_1.Commands.MEDIA_ENDED);\r\n            });\r\n            $.subscribe(Commands_1.Commands.MEDIA_PAUSED, function (e) {\r\n                _this.triggerSocket(Commands_1.Commands.MEDIA_PAUSED);\r\n            });\r\n            $.subscribe(Commands_1.Commands.MEDIA_PLAYED, function (e) {\r\n                _this.triggerSocket(Commands_1.Commands.MEDIA_PLAYED);\r\n            });\r\n        };\r\n        Extension.prototype.createModules = function () {\r\n            _super.prototype.createModules.call(this);\r\n            if (this.isHeaderPanelEnabled()) {\r\n                this.headerPanel = new HeaderPanel_1.HeaderPanel(Shell_1.Shell.$headerPanel);\r\n            }\r\n            else {\r\n                Shell_1.Shell.$headerPanel.hide();\r\n            }\r\n            if (this.isLeftPanelEnabled()) {\r\n                this.leftPanel = new ResourcesLeftPanel_1.ResourcesLeftPanel(Shell_1.Shell.$leftPanel);\r\n            }\r\n            this.centerPanel = new MediaElementCenterPanel_1.MediaElementCenterPanel(Shell_1.Shell.$centerPanel);\r\n            if (this.isRightPanelEnabled()) {\r\n                this.rightPanel = new MoreInfoRightPanel_1.MoreInfoRightPanel(Shell_1.Shell.$rightPanel);\r\n            }\r\n            if (this.isFooterPanelEnabled()) {\r\n                this.footerPanel = new FooterPanel_1.FooterPanel(Shell_1.Shell.$footerPanel);\r\n            }\r\n            else {\r\n                Shell_1.Shell.$footerPanel.hide();\r\n            }\r\n            this.$helpDialogue = $('<div class=\"overlay help\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$helpDialogue);\r\n            this.helpDialogue = new HelpDialogue_1.HelpDialogue(this.$helpDialogue);\r\n            this.$downloadDialogue = $('<div class=\"overlay download\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$downloadDialogue);\r\n            this.downloadDialogue = new DownloadDialogue_1.DownloadDialogue(this.$downloadDialogue);\r\n            this.$shareDialogue = $('<div class=\"overlay share\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$shareDialogue);\r\n            this.shareDialogue = new ShareDialogue_1.ShareDialogue(this.$shareDialogue);\r\n            this.$settingsDialogue = $('<div class=\"overlay settings\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$settingsDialogue);\r\n            this.settingsDialogue = new SettingsDialogue_1.SettingsDialogue(this.$settingsDialogue);\r\n            if (this.isLeftPanelEnabled()) {\r\n                this.leftPanel.init();\r\n            }\r\n            if (this.isRightPanelEnabled()) {\r\n                this.rightPanel.init();\r\n            }\r\n        };\r\n        Extension.prototype.isLeftPanelEnabled = function () {\r\n            return Utils.Bools.getBool(this.config.options.leftPanelEnabled, true)\r\n                && ((this.helper.isMultiCanvas() || this.helper.isMultiSequence()) || this.helper.hasResources());\r\n        };\r\n        Extension.prototype.bookmark = function () {\r\n            _super.prototype.bookmark.call(this);\r\n            var canvas = this.extensions.helper.getCurrentCanvas();\r\n            var bookmark = new Bookmark_1.Bookmark();\r\n            bookmark.index = this.helper.canvasIndex;\r\n            bookmark.label = Manifesto.TranslationCollection.getValue(canvas.getLabel());\r\n            bookmark.path = this.getBookmarkUri();\r\n            bookmark.thumb = canvas.getProperty('thumbnail');\r\n            bookmark.title = this.helper.getLabel();\r\n            bookmark.trackingLabel = window.trackingLabel;\r\n            if (this.isVideo()) {\r\n                bookmark.type = manifesto.ElementType.movingimage().toString();\r\n            }\r\n            else {\r\n                bookmark.type = manifesto.ElementType.sound().toString();\r\n            }\r\n            this.triggerSocket(BaseCommands_1.BaseCommands.BOOKMARK, bookmark);\r\n        };\r\n        Extension.prototype.getEmbedScript = function (template, width, height) {\r\n            var configUri = this.config.uri || '';\r\n            var script = String.format(template, this.getSerializedLocales(), configUri, this.helper.iiifResourceUri, this.helper.collectionIndex, this.helper.manifestIndex, this.helper.sequenceIndex, this.helper.canvasIndex, width, height, this.embedScriptUri);\r\n            return script;\r\n        };\r\n        // todo: use canvas.getThumbnail()\r\n        Extension.prototype.getPosterImageUri = function () {\r\n            return this.helper.getCurrentCanvas().getProperty('thumbnail');\r\n        };\r\n        Extension.prototype.isVideo = function () {\r\n            var elementType = this.helper.getElementType();\r\n            return elementType.toString() === manifesto.ElementType.movingimage().toString();\r\n        };\r\n        return Extension;\r\n    }(BaseExtension_1.BaseExtension));\r\n    exports.Extension = Extension;\r\n});\r\n//# sourceMappingURL=Extension.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('extensions/uv-pdf-extension/DownloadDialogue',[\"require\", \"exports\", \"../../modules/uv-dialogues-module/DownloadDialogue\"], function (require, exports, DownloadDialogue_1) {\r\n    \"use strict\";\r\n    var DownloadDialogue = (function (_super) {\r\n        __extends(DownloadDialogue, _super);\r\n        function DownloadDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        DownloadDialogue.prototype.create = function () {\r\n            this.setConfig('downloadDialogue');\r\n            _super.prototype.create.call(this);\r\n        };\r\n        DownloadDialogue.prototype.open = function ($triggerButton) {\r\n            _super.prototype.open.call(this, $triggerButton);\r\n            this.addEntireFileDownloadOptions();\r\n            if (!this.$downloadOptions.find('li:visible').length) {\r\n                this.$noneAvailable.show();\r\n            }\r\n            else {\r\n                // select first option.\r\n                this.$noneAvailable.hide();\r\n            }\r\n            this.resize();\r\n        };\r\n        DownloadDialogue.prototype.isDownloadOptionAvailable = function (option) {\r\n            return _super.prototype.isDownloadOptionAvailable.call(this, option);\r\n        };\r\n        return DownloadDialogue;\r\n    }(DownloadDialogue_1.DownloadDialogue));\r\n    exports.DownloadDialogue = DownloadDialogue;\r\n});\r\n//# sourceMappingURL=DownloadDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('extensions/uv-pdf-extension/ShareDialogue',[\"require\", \"exports\", \"../../modules/uv-dialogues-module/ShareDialogue\"], function (require, exports, ShareDialogue_1) {\r\n    \"use strict\";\r\n    var ShareDialogue = (function (_super) {\r\n        __extends(ShareDialogue, _super);\r\n        function ShareDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        ShareDialogue.prototype.create = function () {\r\n            this.setConfig('shareDialogue');\r\n            _super.prototype.create.call(this);\r\n        };\r\n        ShareDialogue.prototype.update = function () {\r\n            _super.prototype.update.call(this);\r\n            this.code = this.extension.getEmbedScript(this.options.embedTemplate, this.currentWidth, this.currentHeight);\r\n            this.$code.val(this.code);\r\n        };\r\n        ShareDialogue.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n        };\r\n        return ShareDialogue;\r\n    }(ShareDialogue_1.ShareDialogue));\r\n    exports.ShareDialogue = ShareDialogue;\r\n});\r\n//# sourceMappingURL=ShareDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-pdfcenterpanel-module/PDFCenterPanel',[\"require\", \"exports\", \"../uv-shared-module/BaseCommands\", \"../uv-shared-module/CenterPanel\", \"../../Params\"], function (require, exports, BaseCommands_1, CenterPanel_1, Params_1) {\r\n    \"use strict\";\r\n    var PDFCenterPanel = (function (_super) {\r\n        __extends(PDFCenterPanel, _super);\r\n        function PDFCenterPanel($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        PDFCenterPanel.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('pdfCenterPanel');\r\n            _super.prototype.create.call(this);\r\n            $.subscribe(BaseCommands_1.BaseCommands.OPEN_EXTERNAL_RESOURCE, function (e, resources) {\r\n                _this.openMedia(resources);\r\n            });\r\n        };\r\n        PDFCenterPanel.prototype.openMedia = function (resources) {\r\n            var _this = this;\r\n            var that = this;\r\n            this.extension.getExternalResources(resources).then(function () {\r\n                var canvas = _this.extension.helper.getCurrentCanvas();\r\n                var pdfUri = canvas.id;\r\n                var browser = window.browserDetect.browser;\r\n                var version = window.browserDetect.version;\r\n                if ((browser === 'Explorer' && version < 10) || !_this.config.options.usePdfJs) {\r\n                    // create pdf object\r\n                    new PDFObject({\r\n                        url: pdfUri,\r\n                        id: \"PDF\"\r\n                    }).embed('content');\r\n                }\r\n                else {\r\n                    var viewerPath = 'html/uv-pdfcenterpanel-module/viewer.html';\r\n                    // load viewer.html\r\n                    _this.$content.load(viewerPath, function () {\r\n                        PDFJS.workerSrc = 'lib/pdf.worker.min.js';\r\n                        PDFJS.DEFAULT_URL = pdfUri;\r\n                        var anchorIndex = (1 + parseInt(that.extension.getParam(Params_1.Params.anchor))) || 0;\r\n                        PDFView.initialBookmark = \"page=\" + anchorIndex;\r\n                        window.webViewerLoad();\r\n                        _this.resize();\r\n                    });\r\n                }\r\n            });\r\n        };\r\n        PDFCenterPanel.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n        };\r\n        return PDFCenterPanel;\r\n    }(CenterPanel_1.CenterPanel));\r\n    exports.PDFCenterPanel = PDFCenterPanel;\r\n});\r\n//# sourceMappingURL=PDFCenterPanel.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('extensions/uv-pdf-extension/SettingsDialogue',[\"require\", \"exports\", \"../../modules/uv-dialogues-module/SettingsDialogue\"], function (require, exports, SettingsDialogue_1) {\r\n    \"use strict\";\r\n    var SettingsDialogue = (function (_super) {\r\n        __extends(SettingsDialogue, _super);\r\n        function SettingsDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        SettingsDialogue.prototype.create = function () {\r\n            this.setConfig('settingsDialogue');\r\n            _super.prototype.create.call(this);\r\n        };\r\n        return SettingsDialogue;\r\n    }(SettingsDialogue_1.SettingsDialogue));\r\n    exports.SettingsDialogue = SettingsDialogue;\r\n});\r\n//# sourceMappingURL=SettingsDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('extensions/uv-pdf-extension/Extension',[\"require\", \"exports\", \"../../modules/uv-shared-module/BaseCommands\", \"../../modules/uv-shared-module/BaseExtension\", \"../../modules/uv-shared-module/Bookmark\", \"./DownloadDialogue\", \"./ShareDialogue\", \"../../modules/uv-shared-module/FooterPanel\", \"../../modules/uv-shared-module/HeaderPanel\", \"../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel\", \"../../modules/uv-pdfcenterpanel-module/PDFCenterPanel\", \"../../modules/uv-resourcesleftpanel-module/ResourcesLeftPanel\", \"./SettingsDialogue\", \"../../modules/uv-shared-module/Shell\"], function (require, exports, BaseCommands_1, BaseExtension_1, Bookmark_1, DownloadDialogue_1, ShareDialogue_1, FooterPanel_1, HeaderPanel_1, MoreInfoRightPanel_1, PDFCenterPanel_1, ResourcesLeftPanel_1, SettingsDialogue_1, Shell_1) {\r\n    \"use strict\";\r\n    var Extension = (function (_super) {\r\n        __extends(Extension, _super);\r\n        function Extension(bootstrapper) {\r\n            return _super.call(this, bootstrapper) || this;\r\n        }\r\n        Extension.prototype.create = function () {\r\n            var _this = this;\r\n            _super.prototype.create.call(this);\r\n            $.subscribe(BaseCommands_1.BaseCommands.THUMB_SELECTED, function (e, thumb) {\r\n                _this.viewCanvas(thumb.index);\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LEFTPANEL_EXPAND_FULL_START, function (e) {\r\n                Shell_1.Shell.$centerPanel.hide();\r\n                Shell_1.Shell.$rightPanel.hide();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.LEFTPANEL_COLLAPSE_FULL_FINISH, function (e) {\r\n                Shell_1.Shell.$centerPanel.show();\r\n                Shell_1.Shell.$rightPanel.show();\r\n                _this.resize();\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.SHOW_OVERLAY, function (e, params) {\r\n                if (_this.IsOldIE()) {\r\n                    _this.centerPanel.$element.hide();\r\n                }\r\n            });\r\n            $.subscribe(BaseCommands_1.BaseCommands.HIDE_OVERLAY, function (e, params) {\r\n                if (_this.IsOldIE()) {\r\n                    _this.centerPanel.$element.show();\r\n                }\r\n            });\r\n        };\r\n        Extension.prototype.IsOldIE = function () {\r\n            var browser = window.browserDetect.browser;\r\n            var version = window.browserDetect.version;\r\n            if (browser === 'Explorer' && version <= 9)\r\n                return true;\r\n            return false;\r\n        };\r\n        Extension.prototype.createModules = function () {\r\n            _super.prototype.createModules.call(this);\r\n            if (this.isHeaderPanelEnabled()) {\r\n                this.headerPanel = new HeaderPanel_1.HeaderPanel(Shell_1.Shell.$headerPanel);\r\n            }\r\n            else {\r\n                Shell_1.Shell.$headerPanel.hide();\r\n            }\r\n            if (this.isLeftPanelEnabled()) {\r\n                this.leftPanel = new ResourcesLeftPanel_1.ResourcesLeftPanel(Shell_1.Shell.$leftPanel);\r\n            }\r\n            this.centerPanel = new PDFCenterPanel_1.PDFCenterPanel(Shell_1.Shell.$centerPanel);\r\n            if (this.isRightPanelEnabled()) {\r\n                this.rightPanel = new MoreInfoRightPanel_1.MoreInfoRightPanel(Shell_1.Shell.$rightPanel);\r\n            }\r\n            if (this.isFooterPanelEnabled()) {\r\n                this.footerPanel = new FooterPanel_1.FooterPanel(Shell_1.Shell.$footerPanel);\r\n            }\r\n            else {\r\n                Shell_1.Shell.$footerPanel.hide();\r\n            }\r\n            this.$downloadDialogue = $('<div class=\"overlay download\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$downloadDialogue);\r\n            this.downloadDialogue = new DownloadDialogue_1.DownloadDialogue(this.$downloadDialogue);\r\n            this.$shareDialogue = $('<div class=\"overlay share\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$shareDialogue);\r\n            this.shareDialogue = new ShareDialogue_1.ShareDialogue(this.$shareDialogue);\r\n            this.$settingsDialogue = $('<div class=\"overlay settings\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$settingsDialogue);\r\n            this.settingsDialogue = new SettingsDialogue_1.SettingsDialogue(this.$settingsDialogue);\r\n            if (this.isLeftPanelEnabled()) {\r\n                this.leftPanel.init();\r\n            }\r\n            if (this.isRightPanelEnabled()) {\r\n                this.rightPanel.init();\r\n            }\r\n        };\r\n        Extension.prototype.bookmark = function () {\r\n            _super.prototype.bookmark.call(this);\r\n            var canvas = this.helper.getCurrentCanvas();\r\n            var bookmark = new Bookmark_1.Bookmark();\r\n            bookmark.index = this.helper.canvasIndex;\r\n            bookmark.label = Manifesto.TranslationCollection.getValue(canvas.getLabel());\r\n            bookmark.path = this.getBookmarkUri();\r\n            bookmark.thumb = canvas.getProperty('thumbnail');\r\n            bookmark.title = this.helper.getLabel();\r\n            bookmark.trackingLabel = window.trackingLabel;\r\n            bookmark.type = manifesto.ElementType.document().toString();\r\n            this.triggerSocket(BaseCommands_1.BaseCommands.BOOKMARK, bookmark);\r\n        };\r\n        Extension.prototype.getEmbedScript = function (template, width, height) {\r\n            var configUri = this.config.uri || '';\r\n            var script = String.format(template, this.getSerializedLocales(), configUri, this.helper.iiifResourceUri, this.helper.collectionIndex, this.helper.manifestIndex, this.helper.sequenceIndex, this.helper.canvasIndex, width, height, this.embedScriptUri);\r\n            return script;\r\n        };\r\n        return Extension;\r\n    }(BaseExtension_1.BaseExtension));\r\n    exports.Extension = Extension;\r\n});\r\n//# sourceMappingURL=Extension.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('extensions/uv-virtex-extension/DownloadDialogue',[\"require\", \"exports\", \"../../modules/uv-dialogues-module/DownloadDialogue\"], function (require, exports, DownloadDialogue_1) {\r\n    \"use strict\";\r\n    var DownloadDialogue = (function (_super) {\r\n        __extends(DownloadDialogue, _super);\r\n        function DownloadDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        DownloadDialogue.prototype.create = function () {\r\n            this.setConfig('downloadDialogue');\r\n            _super.prototype.create.call(this);\r\n        };\r\n        DownloadDialogue.prototype.open = function ($triggerButton) {\r\n            _super.prototype.open.call(this, $triggerButton);\r\n            this.addEntireFileDownloadOptions();\r\n            this.updateNoneAvailable();\r\n            this.resize();\r\n        };\r\n        DownloadDialogue.prototype.isDownloadOptionAvailable = function (option) {\r\n            return _super.prototype.isDownloadOptionAvailable.call(this, option);\r\n        };\r\n        return DownloadDialogue;\r\n    }(DownloadDialogue_1.DownloadDialogue));\r\n    exports.DownloadDialogue = DownloadDialogue;\r\n});\r\n//# sourceMappingURL=DownloadDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('extensions/uv-virtex-extension/ShareDialogue',[\"require\", \"exports\", \"../../modules/uv-dialogues-module/ShareDialogue\"], function (require, exports, ShareDialogue_1) {\r\n    \"use strict\";\r\n    var ShareDialogue = (function (_super) {\r\n        __extends(ShareDialogue, _super);\r\n        function ShareDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        ShareDialogue.prototype.create = function () {\r\n            this.setConfig('shareDialogue');\r\n            _super.prototype.create.call(this);\r\n        };\r\n        ShareDialogue.prototype.update = function () {\r\n            _super.prototype.update.call(this);\r\n            this.code = this.extension.getEmbedScript(this.options.embedTemplate, this.currentWidth, this.currentHeight);\r\n            this.$code.val(this.code);\r\n        };\r\n        ShareDialogue.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n        };\r\n        return ShareDialogue;\r\n    }(ShareDialogue_1.ShareDialogue));\r\n    exports.ShareDialogue = ShareDialogue;\r\n});\r\n//# sourceMappingURL=ShareDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('extensions/uv-virtex-extension/SettingsDialogue',[\"require\", \"exports\", \"../../modules/uv-dialogues-module/SettingsDialogue\"], function (require, exports, SettingsDialogue_1) {\r\n    \"use strict\";\r\n    var SettingsDialogue = (function (_super) {\r\n        __extends(SettingsDialogue, _super);\r\n        function SettingsDialogue($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        SettingsDialogue.prototype.create = function () {\r\n            this.setConfig('settingsDialogue');\r\n            _super.prototype.create.call(this);\r\n        };\r\n        return SettingsDialogue;\r\n    }(SettingsDialogue_1.SettingsDialogue));\r\n    exports.SettingsDialogue = SettingsDialogue;\r\n});\r\n//# sourceMappingURL=SettingsDialogue.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('modules/uv-virtexcenterpanel-module/VirtexCenterPanel',[\"require\", \"exports\", \"../uv-shared-module/BaseCommands\", \"../uv-shared-module/CenterPanel\"], function (require, exports, BaseCommands_1, CenterPanel_1) {\r\n    \"use strict\";\r\n    var VirtexCenterPanel = (function (_super) {\r\n        __extends(VirtexCenterPanel, _super);\r\n        function VirtexCenterPanel($element) {\r\n            return _super.call(this, $element) || this;\r\n        }\r\n        VirtexCenterPanel.prototype.create = function () {\r\n            var _this = this;\r\n            this.setConfig('virtexCenterPanel');\r\n            _super.prototype.create.call(this);\r\n            var that = this;\r\n            $.subscribe(BaseCommands_1.BaseCommands.OPEN_EXTERNAL_RESOURCE, function (e, resources) {\r\n                that.openMedia(resources);\r\n            });\r\n            this.$navigation = $('<div class=\"navigation\"></div>');\r\n            this.$content.prepend(this.$navigation);\r\n            this.$zoomInButton = $('<a class=\"imageBtn zoomIn\" title=\"' + this.content.zoomIn + '\"></a>');\r\n            this.$navigation.append(this.$zoomInButton);\r\n            this.$zoomOutButton = $('<a class=\"imageBtn zoomOut\" title=\"' + this.content.zoomOut + '\"></a>');\r\n            this.$navigation.append(this.$zoomOutButton);\r\n            this.$viewport = $('<div class=\"virtex\"></div>');\r\n            this.$content.prepend(this.$viewport);\r\n            this.title = this.extension.helper.getLabel();\r\n            this.updateAttribution();\r\n            this.$zoomInButton.on('click', function (e) {\r\n                e.preventDefault();\r\n                _this.viewport.zoomIn();\r\n            });\r\n            this.$zoomOutButton.on('click', function (e) {\r\n                e.preventDefault();\r\n                _this.viewport.zoomOut();\r\n            });\r\n        };\r\n        VirtexCenterPanel.prototype.openMedia = function (resources) {\r\n            var _this = this;\r\n            this.extension.getExternalResources(resources).then(function () {\r\n                _this.$viewport.empty();\r\n                var canvas = _this.extension.helper.getCurrentCanvas();\r\n                _this.viewport = virtex.create({\r\n                    element: \"#content .virtex\",\r\n                    object: canvas.id,\r\n                    showStats: _this.options.showStats\r\n                });\r\n                _this.resize();\r\n            });\r\n        };\r\n        VirtexCenterPanel.prototype.resize = function () {\r\n            _super.prototype.resize.call(this);\r\n            this.$title.ellipsisFill(this.title);\r\n            this.$viewport.width(this.$content.width());\r\n            this.$viewport.height(this.$content.height());\r\n        };\r\n        return VirtexCenterPanel;\r\n    }(CenterPanel_1.CenterPanel));\r\n    exports.VirtexCenterPanel = VirtexCenterPanel;\r\n});\r\n//# sourceMappingURL=VirtexCenterPanel.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('extensions/uv-virtex-extension/Extension',[\"require\", \"exports\", \"../../modules/uv-shared-module/BaseCommands\", \"../../modules/uv-shared-module/BaseExtension\", \"../../modules/uv-shared-module/Bookmark\", \"../../modules/uv-contentleftpanel-module/ContentLeftPanel\", \"./DownloadDialogue\", \"./ShareDialogue\", \"../../modules/uv-shared-module/FooterPanel\", \"../../modules/uv-shared-module/HeaderPanel\", \"../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel\", \"./SettingsDialogue\", \"../../modules/uv-shared-module/Shell\", \"../../modules/uv-virtexcenterpanel-module/VirtexCenterPanel\"], function (require, exports, BaseCommands_1, BaseExtension_1, Bookmark_1, ContentLeftPanel_1, DownloadDialogue_1, ShareDialogue_1, FooterPanel_1, HeaderPanel_1, MoreInfoRightPanel_1, SettingsDialogue_1, Shell_1, VirtexCenterPanel_1) {\r\n    \"use strict\";\r\n    var Extension = (function (_super) {\r\n        __extends(Extension, _super);\r\n        function Extension(bootstrapper) {\r\n            return _super.call(this, bootstrapper) || this;\r\n        }\r\n        Extension.prototype.create = function () {\r\n            var _this = this;\r\n            _super.prototype.create.call(this);\r\n            $.subscribe(BaseCommands_1.BaseCommands.THUMB_SELECTED, function (e, canvasIndex) {\r\n                _this.viewCanvas(canvasIndex);\r\n            });\r\n        };\r\n        Extension.prototype.createModules = function () {\r\n            _super.prototype.createModules.call(this);\r\n            if (this.isHeaderPanelEnabled()) {\r\n                this.headerPanel = new HeaderPanel_1.HeaderPanel(Shell_1.Shell.$headerPanel);\r\n            }\r\n            else {\r\n                Shell_1.Shell.$headerPanel.hide();\r\n            }\r\n            if (this.isLeftPanelEnabled()) {\r\n                this.leftPanel = new ContentLeftPanel_1.ContentLeftPanel(Shell_1.Shell.$leftPanel);\r\n            }\r\n            this.centerPanel = new VirtexCenterPanel_1.VirtexCenterPanel(Shell_1.Shell.$centerPanel);\r\n            if (this.isRightPanelEnabled()) {\r\n                this.rightPanel = new MoreInfoRightPanel_1.MoreInfoRightPanel(Shell_1.Shell.$rightPanel);\r\n            }\r\n            if (this.isFooterPanelEnabled()) {\r\n                this.footerPanel = new FooterPanel_1.FooterPanel(Shell_1.Shell.$footerPanel);\r\n            }\r\n            else {\r\n                Shell_1.Shell.$footerPanel.hide();\r\n            }\r\n            this.$downloadDialogue = $('<div class=\"overlay download\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$downloadDialogue);\r\n            this.downloadDialogue = new DownloadDialogue_1.DownloadDialogue(this.$downloadDialogue);\r\n            this.$shareDialogue = $('<div class=\"overlay share\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$shareDialogue);\r\n            this.shareDialogue = new ShareDialogue_1.ShareDialogue(this.$shareDialogue);\r\n            this.$settingsDialogue = $('<div class=\"overlay settings\"></div>');\r\n            Shell_1.Shell.$overlays.append(this.$settingsDialogue);\r\n            this.settingsDialogue = new SettingsDialogue_1.SettingsDialogue(this.$settingsDialogue);\r\n            if (this.isLeftPanelEnabled()) {\r\n                this.leftPanel.init();\r\n            }\r\n            else {\r\n                Shell_1.Shell.$leftPanel.hide();\r\n            }\r\n            if (this.isRightPanelEnabled()) {\r\n                this.rightPanel.init();\r\n            }\r\n            else {\r\n                Shell_1.Shell.$rightPanel.hide();\r\n            }\r\n        };\r\n        Extension.prototype.isLeftPanelEnabled = function () {\r\n            return Utils.Bools.getBool(this.config.options.leftPanelEnabled, true)\r\n                && (this.helper.isMultiCanvas() || this.helper.isMultiSequence());\r\n        };\r\n        Extension.prototype.bookmark = function () {\r\n            _super.prototype.bookmark.call(this);\r\n            var canvas = this.helper.getCurrentCanvas();\r\n            var bookmark = new Bookmark_1.Bookmark();\r\n            bookmark.index = this.helper.canvasIndex;\r\n            bookmark.label = Manifesto.TranslationCollection.getValue(canvas.getLabel());\r\n            bookmark.path = this.getBookmarkUri();\r\n            bookmark.thumb = canvas.getProperty('thumbnail');\r\n            bookmark.title = this.helper.getLabel();\r\n            bookmark.trackingLabel = window.trackingLabel;\r\n            bookmark.type = manifesto.ElementType.physicalobject().toString();\r\n            this.triggerSocket(BaseCommands_1.BaseCommands.BOOKMARK, bookmark);\r\n        };\r\n        Extension.prototype.getEmbedScript = function (template, width, height) {\r\n            var configUri = this.config.uri || '';\r\n            var script = String.format(template, this.getSerializedLocales(), configUri, this.helper.iiifResourceUri, this.helper.collectionIndex, this.helper.manifestIndex, this.helper.sequenceIndex, this.helper.canvasIndex, width, height, this.embedScriptUri);\r\n            return script;\r\n        };\r\n        return Extension;\r\n    }(BaseExtension_1.BaseExtension));\r\n    exports.Extension = Extension;\r\n});\r\n//# sourceMappingURL=Extension.js.map;\n",
    "var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\ndefine('UV',[\"require\", \"exports\", \"./Bootstrapper\", \"./extensions/uv-seadragon-extension/Extension\", \"./extensions/uv-mediaelement-extension/Extension\", \"./extensions/uv-pdf-extension/Extension\", \"./extensions/uv-virtex-extension/Extension\"], function (require, exports, Bootstrapper_1, Extension_1, Extension_2, Extension_3, Extension_4) {\r\n    \"use strict\";\r\n    var UV = (function (_super) {\r\n        __extends(UV, _super);\r\n        function UV(options) {\r\n            var _this = _super.call(this, options) || this;\r\n            _this._init();\r\n            _this._resize();\r\n            return _this;\r\n        }\r\n        UV.prototype.message = function () {\r\n            //this.fire(UV.Events.MESSAGE, this.options.data.message);\r\n        };\r\n        UV.prototype._init = function () {\r\n            var success = _super.prototype._init.call(this);\r\n            if (!success) {\r\n                console.error(\"UV failed to initialise\");\r\n            }\r\n            var extensions = {};\r\n            extensions[manifesto.ElementType.canvas().toString()] = {\r\n                type: Extension_1.Extension,\r\n                name: 'uv-seadragon-extension'\r\n            };\r\n            extensions[manifesto.ElementType.movingimage().toString()] = {\r\n                type: Extension_2.Extension,\r\n                name: 'uv-mediaelement-extension'\r\n            };\r\n            extensions[manifesto.ElementType.physicalobject().toString()] = {\r\n                type: Extension_4.Extension,\r\n                name: 'uv-virtex-extension'\r\n            };\r\n            extensions[manifesto.ElementType.sound().toString()] = {\r\n                type: Extension_2.Extension,\r\n                name: 'uv-mediaelement-extension'\r\n            };\r\n            extensions[manifesto.RenderingFormat.pdf().toString()] = {\r\n                type: Extension_3.Extension,\r\n                name: 'uv-pdf-extension'\r\n            };\r\n            var bootstrapper = new Bootstrapper_1.Bootstrapper(extensions);\r\n            bootstrapper.bootstrap();\r\n            return success;\r\n        };\r\n        UV.prototype.data = function () {\r\n            return {};\r\n        };\r\n        UV.prototype._resize = function () {\r\n        };\r\n        return UV;\r\n    }(_Components.BaseComponent));\r\n    exports.__esModule = true;\r\n    exports[\"default\"] = UV;\r\n});\r\n// namespace UV {\r\n//     export class Events {\r\n//         static MESSAGE: string = 'message';\r\n//     }\r\n// } \r\n//# sourceMappingURL=UV.js.map;\n",
    "if (typeof jQuery === \"function\") {\r\n    define('jquery', [], function () {\r\n        return jQuery;\r\n    });\r\n}\r\nvar uvReady = new Event('uvReady');\r\nrequire([\r\n    'UV'\r\n], function (UV) {\r\n    if (!window.UV) {\r\n        window.UV = UV[\"default\"];\r\n        window.dispatchEvent(uvReady);\r\n    }\r\n});\r\n//# sourceMappingURL=app.js.map;\ndefine(\"app\", function(){});\n\n"
  ]
}