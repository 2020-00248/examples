/*! Built with http://stenciljs.com */
amiviewer.loadBundle("vukdfon6",["exports"],function(e){var t,r=window.amiviewer.h,i=function(e){return new Promise(function(t,r){var i=new XMLHttpRequest;i.open("GET",e,!0),i.onload=function(){var e,r=JSON.parse(i.responseText);e=r.baseurl,r=r.series.map(function(t){return e.endsWith("/")||(e+="/"),""+e+t}),t(r)},i.onerror=function(){r()},i.send()})},n=function(){function e(){}return e.prototype.watchHandler=function(){this.reset()},e.prototype.componentDidLoad=function(){this.reset()},e.prototype.reset=function(){var e=this;console.log("setting up ami-mesh-viewer"),this._createRenderer(),this._scene=new THREE.Scene,this._scene.add(new THREE.AmbientLight(15066597));var t=new THREE.DirectionalLight(16777215,1);t.position.set(1,1,1).normalize(),this._scene.add(t),this._createCamera(),this._createControls(),this._animate(),i(this.series).then(function(t){(new THREE.STLLoader).load(t[0],function(t){var r=new THREE.MeshPhongMaterial({color:16007990,specular:1118481,shininess:200}),i=new THREE.Mesh(t,r),n=new THREE.Matrix4;n.set(-1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1),i.applyMatrix(n),e._scene.add(i),e.onViewerLoaded.emit({stackHelper:i})})})},e.prototype._createRenderer=function(){this._renderer=new THREE.WebGLRenderer({alpha:!0}),this._renderer.setSize(this._container.offsetWidth,this._container.offsetHeight),this._renderer.setClearColor(0,1),this._renderer.setPixelRatio(window.devicePixelRatio),this._container.appendChild(this._renderer.domElement),this._renderer.domElement.addEventListener("wheel",this._onWheel.bind(this))},e.prototype._onWheel=function(){},e.prototype._createCamera=function(){this._camera=new THREE.PerspectiveCamera(45,this._container.offsetWidth/this._container.offsetHeight,.1,999999),this._camera.position.x=150,this._camera.position.y=150,this._camera.position.z=100},e.prototype._createControls=function(){this._controls=new AMI.TrackballControl(this._camera,this._container),this._controls.addEventListener("change",this._onControlsChange.bind(this)),this._controls.addEventListener("start",this._onControlsStart.bind(this)),this._controls.addEventListener("end",this._onControlsEnd.bind(this))},e.prototype._onControlsChange=function(){},e.prototype._onControlsStart=function(){},e.prototype._onControlsEnd=function(){},e.prototype._animate=function(){var e=this;this._controls.update(),this._render3D(),requestAnimationFrame(function(){e._animate()})},e.prototype._render3D=function(){this._renderer.render(this._scene,this._camera)},e.prototype.resize=function(){this._camera.aspect=this._container.offsetWidth/this._container.offsetHeight,this._camera.updateProjectionMatrix(),this._renderer.setSize(this._container.offsetWidth,this._container.offsetHeight)},e.prototype.render=function(){var e=this;return r("div",{id:"container",ref:function(t){return e._container=t}})},Object.defineProperty(e,"is",{get:function(){return"ami-mesh-viewer"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{reset:{method:!0},resize:{method:!0},series:{type:String,attr:"series",watchCallbacks:["watchHandler"]}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"events",{get:function(){return[{name:"onViewerLoaded",method:"onViewerLoaded",bubbles:!0,cancelable:!0,composed:!0}]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return"#container.sc-ami-mesh-viewer{background-color:#000;left:0;right:0;top:0;bottom:0;position:absolute;width:100%;height:100%;overflow:hidden}"},enumerable:!0,configurable:!0}),e}(),o=function(){function e(){}return e.prototype.watchHandler=function(){this.reset()},e.prototype.componentDidLoad=function(){this.reset()},e.prototype.reset=function(){var e=this;console.log("setting up ami-slices-viewer"),this._createRenderer(),this._scene=new THREE.Scene,this._createCamera(),this._createControls(),i(this.series).then(function(t){var r=new AMI.VolumeLoader(e._container);r.load(t).then(function(){var t=r.data[0].mergeSeries(r.data)[0].stack[0];r.free(),e._stackHelper=new AMI.StackHelper(t),e._stackHelper.bbox.color=16711680,e._stackHelper.border.color=255,e._scene.add(e._stackHelper),e.onViewerLoaded.emit({stackHelper:e._stackHelper});var i=e._stackHelper.stack.worldCenter();e._camera.lookAt(i.x,i.y,i.z),e._camera.updateProjectionMatrix(),e._controls.target.set(i.x,i.y,i.z)}).catch(function(e){console.log("DICOM load error"),console.error(e)}),e._animate()})},e.prototype._createRenderer=function(){this._renderer=new THREE.WebGLRenderer({antialias:!0}),this._renderer.setSize(this._container.offsetWidth,this._container.offsetHeight),this._renderer.setClearColor(0,1),this._renderer.setPixelRatio(window.devicePixelRatio),this._container.appendChild(this._renderer.domElement),this._renderer.domElement.addEventListener("wheel",this._onWheel.bind(this))},e.prototype._onWheel=function(){},e.prototype._createCamera=function(){this._camera=new THREE.PerspectiveCamera(45,this._container.offsetWidth/this._container.offsetHeight,.1,999999),this._camera.position.x=150,this._camera.position.y=150,this._camera.position.z=100},e.prototype._createControls=function(){this._controls=new AMI.TrackballControl(this._camera,this._container)},e.prototype._animate=function(){var e=this;this._controls.update(),this._render3D(),requestAnimationFrame(function(){e._animate()})},e.prototype._render3D=function(){this._renderer.render(this._scene,this._camera)},e.prototype.resize=function(){this._camera.aspect=this._container.offsetWidth/this._container.offsetHeight,this._camera.updateProjectionMatrix(),this._renderer.setSize(this._container.offsetWidth,this._container.offsetHeight)},e.prototype.render=function(){var e=this;return r("div",{id:"container",ref:function(t){return e._container=t}})},Object.defineProperty(e,"is",{get:function(){return"ami-slices-viewer"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{reset:{method:!0},resize:{method:!0},series:{type:String,attr:"series",watchCallbacks:["watchHandler"]}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"events",{get:function(){return[{name:"onViewerLoaded",method:"onViewerLoaded",bubbles:!0,cancelable:!0,composed:!0}]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return"#container.sc-ami-slices-viewer{background-color:#000;left:0;right:0;top:0;bottom:0;position:absolute;width:100%;height:100%;overflow:hidden}"},enumerable:!0,configurable:!0}),e}();!function(e){e.SLICES="slices",e.VOLUME="volume",e.MESH="mesh"}(t||(t={}));var s=function(){function e(){this.mode=t.SLICES}return e.prototype.watchSeries=function(){this.reset()},e.prototype.watchMode=function(){this.reset()},e.prototype.componentDidLoad=function(){this.reset()},e.prototype.reset=function(){var e=this;console.log("setting up ami-viewer"),window.addEventListener("resize",function(){e.resize()},!1)},e.prototype.resize=function(){this._viewer.resize()},e.prototype._renderViewer=function(){var e=this;switch(this.mode){case t.SLICES:return r("ami-slices-viewer",{ref:function(t){return e._viewer=t},series:this.series});case t.VOLUME:return r("ami-volume-viewer",{ref:function(t){return e._viewer=t},series:this.series});case t.MESH:return r("ami-mesh-viewer",{ref:function(t){return e._viewer=t},series:this.series})}},e.prototype.render=function(){return console.log("render"),this._renderViewer()},e.prototype.loaded=function(e){var r=e.detail;switch(this.mode){case t.SLICES:this.onSlicesLoaded.emit(r);break;case t.VOLUME:this.onVolumeLoaded.emit(r);break;case t.MESH:this.onMeshLoaded.emit()}},Object.defineProperty(e,"is",{get:function(){return"ami-viewer"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{mode:{type:String,attr:"mode",watchCallbacks:["watchMode"]},reset:{method:!0},resize:{method:!0},series:{type:String,attr:"series",watchCallbacks:["watchSeries"]}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"events",{get:function(){return[{name:"onSlicesLoaded",method:"onSlicesLoaded",bubbles:!0,cancelable:!0,composed:!0},{name:"onVolumeLoaded",method:"onVolumeLoaded",bubbles:!0,cancelable:!0,composed:!0},{name:"onMeshLoaded",method:"onMeshLoaded",bubbles:!0,cancelable:!0,composed:!0}]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"listeners",{get:function(){return[{name:"onViewerLoaded",method:"loaded"}]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return""},enumerable:!0,configurable:!0}),e}(),a=function(){function e(){this._ready=!1,this._modified=!1}return e.prototype.watchHandler=function(){this.reset()},e.prototype.componentDidLoad=function(){this.reset()},e.prototype.reset=function(){var e=this;console.log("setting up ami-volume-viewer"),this._createRenderer(),this._scene=new THREE.Scene,this._createCamera(),this._createControls(),this._animate(),i(this.series).then(function(t){var r=new AMI.VolumeLoader(e._container);r.load(t).then(function(){var t=r.data[0].mergeSeries(r.data)[0].stack[0];r.free(),e._stackHelper=new AMI.VolumeRenderingHelper(t),e._scene.add(e._stackHelper),e._lut=new AMI.LutHelper(e._lutCanvases),e._lut.luts=AMI.LutHelper.presetLuts(),e._lut.lutsO=AMI.LutHelper.presetLutsO(),e._stackHelper.uniforms.uTextureLUT.value=e._lut.texture,e._stackHelper.uniforms.uLut.value=1;var i=t.worldCenter();e._camera.lookAt(i.x,i.y,i.z),e._camera.updateProjectionMatrix(),e._controls.target.set(i.x,i.y,i.z),e.onViewerLoaded.emit({stackHelper:e._stackHelper,lut:e._lut,modifiedCallback:function(){e._modified=!0}}),e._ready=!0,e._modified=!0,e._render3D()}).catch(function(e){return window.console.log(e)})})},e.prototype._createRenderer=function(){this._renderer=new THREE.WebGLRenderer({alpha:!0}),this._renderer.setSize(this._container.offsetWidth,this._container.offsetHeight),this._renderer.setClearColor(0,1),this._renderer.setPixelRatio(window.devicePixelRatio),this._container.appendChild(this._renderer.domElement),this._renderer.domElement.addEventListener("wheel",this._onWheel.bind(this))},e.prototype._onWheel=function(){var e=this;this._wheel||(this._renderer.setPixelRatio(.1*window.devicePixelRatio),this._renderer.setSize(this._container.offsetWidth,this._container.offsetHeight),this._wheel=Date.now()),Date.now()-this._wheel<300&&(clearTimeout(this._wheelTO),this._wheelTO=setTimeout(function(){e._renderer.setPixelRatio(.5*window.devicePixelRatio),e._renderer.setSize(e._container.offsetWidth,e._container.offsetHeight),e._modified=!0,setTimeout(function(){e._renderer.setPixelRatio(window.devicePixelRatio),e._renderer.setSize(e._container.offsetWidth,e._container.offsetHeight),e._wheel=null,e._modified=!0},100)},300)),this._modified=!0},e.prototype._createCamera=function(){this._camera=new THREE.PerspectiveCamera(45,this._container.offsetWidth/this._container.offsetHeight,.1,1e5),this._camera.position.x=166,this._camera.position.y=-471,this._camera.position.z=153,this._camera.up.set(-.42,.86,.26)},e.prototype._createControls=function(){this._controls=new AMI.TrackballControl(this._camera,this._container),this._controls.rotateSpeed=5.5,this._controls.zoomSpeed=1.2,this._controls.panSpeed=.8,this._controls.staticMoving=!0,this._controls.dynamicDampingFactor=.3,this._controls.addEventListener("change",this._onControlsChange.bind(this)),this._controls.addEventListener("start",this._onControlsStart.bind(this)),this._controls.addEventListener("end",this._onControlsEnd.bind(this))},e.prototype._onControlsChange=function(){this._modified=!0},e.prototype._onControlsStart=function(){this._stackHelper&&this._stackHelper.uniforms&&!this._wheel&&(this._renderer.setPixelRatio(.1*window.devicePixelRatio),this._renderer.setSize(this._container.offsetWidth,this._container.offsetHeight),this._modified=!0)},e.prototype._onControlsEnd=function(){var e=this;this._stackHelper&&this._stackHelper.uniforms&&!this._wheel&&(this._renderer.setPixelRatio(.5*window.devicePixelRatio),this._renderer.setSize(this._container.offsetWidth,this._container.offsetHeight),this._modified=!0,setTimeout(function(){e._renderer.setPixelRatio(window.devicePixelRatio),e._renderer.setSize(e._container.offsetWidth,e._container.offsetHeight),e._modified=!0},100))},e.prototype._animate=function(){var e=this;this._controls.update(),this._render3D(),requestAnimationFrame(function(){e._animate()})},e.prototype._render3D=function(){this._ready&&this._modified&&(this._renderer.render(this._scene,this._camera),this._modified=!1)},e.prototype.resize=function(){this._camera.aspect=this._container.offsetWidth/this._container.offsetHeight,this._camera.updateProjectionMatrix(),this._renderer.setSize(this._container.offsetWidth,this._container.offsetHeight),this._modified=!0},e.prototype.render=function(){var e=this;return r("div",null,r("div",{id:"my-lut-container"},r("div",{id:"my-lut-min"},"0.0"),r("div",{id:"my-lut-canvases",ref:function(t){return e._lutCanvases=t}}),r("div",{id:"my-lut-max"},"1.0")),r("div",{id:"container",ref:function(t){return e._container=t}}))},Object.defineProperty(e,"is",{get:function(){return"ami-volume-viewer"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{reset:{method:!0},resize:{method:!0},series:{type:String,attr:"series",watchCallbacks:["watchHandler"]}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"events",{get:function(){return[{name:"onViewerLoaded",method:"onViewerLoaded",bubbles:!0,cancelable:!0,composed:!0}]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return"#container.sc-ami-volume-viewer{background-color:#000;left:0;right:0;top:0;bottom:0;position:absolute;width:100%;height:100%;overflow:hidden}"},enumerable:!0,configurable:!0}),e}();e.AmiMeshViewer=n,e.AmiSlicesViewer=o,e.AmiViewer=s,e.AmiVolumeViewer=a,Object.defineProperty(e,"__esModule",{value:!0})});