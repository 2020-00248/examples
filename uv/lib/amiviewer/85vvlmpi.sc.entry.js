const e=window.amiviewer.h;var t;!function(e){e.NULL="NULL",e.ERROR="ERROR",e.APP_SET_SRC="APP_SET_SRC",e.APP_SET_SRC_LOADED="APP_SET_SRC_LOADED",e.APP_SET_DISPLAY="APP_SET_DISPLAY",e.APP_SET_ORIENTATION="APP_SET_ORIENTATION",e.APP_SET_TOOLS_VISIBLE="APP_SET_TOOLS_VISIBLE",e.APP_SET_TOOLS_ENABLED="APP_SET_TOOLS_ENABLED",e.APP_SET_TOOL_TYPE="APP_SET_TOOL_TYPE",e.APP_SET_OPTIONS_VISIBLE="APP_SET_OPTIONS_VISIBLE",e.APP_SET_OPTIONS_ENABLED="APP_SET_OPTIONS_ENABLED",e.APP_SET_BOUNDINGBOX_VISIBLE="APP_SET_BOUNDINGBOX_VISIBLE",e.APP_SET_THREEJS_SCENE_NEEDS_UPDATE="APP_SET_THREEJS_SCENE_NEEDS_UPDATE",e.APP_SET_SLICES_INDEX="APP_SET_SLICES_INDEX",e.APP_SET_SLICES_WINDOW_WIDTH="APP_SET_SLICES_WINDOW_WIDTH",e.APP_SET_SLICES_WINDOW_CENTER="APP_SET_SLICES_WINDOW_CENTER",e.APP_SET_VOLUME_STEPS="APP_SET_VOLUME_STEPS",e.APP_SET_VOLUME_WINDOW_WIDTH="APP_SET_VOLUME_WINDOW_WIDTH",e.APP_SET_VOLUME_WINDOW_CENTER="APP_SET_VOLUME_WINDOW_CENTER",e.APP_SET_ANGLE_TOOL_ENABLED="APP_SET_ANGLE_TOOL_ENABLED",e.APP_SET_ANNOTATION_TOOL_ENABLED="APP_SET_ANNOTATION_TOOL_ENABLED",e.APP_SET_RULER_TOOL_ENABLED="APP_SET_RULER_TOOL_ENABLED"}(t||(t={}));const s=e=>async(s,i)=>s({type:t.APP_SET_SRC,payload:e}),i=e=>async(s,i)=>s({type:t.APP_SET_SRC_LOADED,payload:e}),n=e=>async(s,i)=>s({type:t.APP_SET_DISPLAY,payload:e}),a=e=>async(s,i)=>s({type:t.APP_SET_ORIENTATION,payload:e}),o=e=>async(s,i)=>s({type:t.APP_SET_TOOLS_VISIBLE,payload:e}),r=e=>async(s,i)=>s({type:t.APP_SET_TOOLS_ENABLED,payload:e}),l=e=>async(s,i)=>s({type:t.APP_SET_TOOL_TYPE,payload:e}),h=e=>async(s,i)=>s({type:t.APP_SET_OPTIONS_VISIBLE,payload:e}),d=e=>async(s,i)=>s({type:t.APP_SET_OPTIONS_ENABLED,payload:e}),c=e=>async(s,i)=>s({type:t.APP_SET_BOUNDINGBOX_VISIBLE,payload:e}),_=e=>async(s,i)=>s({type:t.APP_SET_THREEJS_SCENE_NEEDS_UPDATE,payload:e}),u=e=>async(s,i)=>s({type:t.APP_SET_SLICES_INDEX,payload:e}),p=e=>async(s,i)=>s({type:t.APP_SET_SLICES_WINDOW_WIDTH,payload:e}),m=e=>async(s,i)=>s({type:t.APP_SET_SLICES_WINDOW_CENTER,payload:e}),E=e=>async(s,i)=>s({type:t.APP_SET_VOLUME_STEPS,payload:e}),g=e=>async(s,i)=>s({type:t.APP_SET_VOLUME_WINDOW_WIDTH,payload:e}),y=e=>async(s,i)=>s({type:t.APP_SET_VOLUME_WINDOW_CENTER,payload:e}),f=e=>async(s,i)=>s({type:t.APP_SET_ANGLE_TOOL_ENABLED,payload:e}),v=e=>async(s,i)=>s({type:t.APP_SET_ANNOTATION_TOOL_ENABLED,payload:e}),b=e=>async(s,i)=>s({type:t.APP_SET_RULER_TOOL_ENABLED,payload:e});var S=function(e){var t,s=("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()).Symbol;return"function"==typeof s?s.observable?t=s.observable:(t=s("observable"),s.observable=t):t="@@observable",t}(),T=function(){return Math.random().toString(36).substring(7).split("").join(".")},w={INIT:"@@redux/INIT"+T(),REPLACE:"@@redux/REPLACE"+T(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+T()}};function P(e,t,s){var i;if("function"==typeof t&&"function"==typeof s||"function"==typeof s&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function");if("function"==typeof t&&void 0===s&&(s=t,t=void 0),void 0!==s){if("function"!=typeof s)throw new Error("Expected the enhancer to be a function.");return s(P)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var n=e,a=t,o=[],r=o,l=!1;function h(){r===o&&(r=o.slice())}function d(){if(l)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return a}function c(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(l)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return h(),r.push(e),function(){if(t){if(l)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,h();var s=r.indexOf(e);r.splice(s,1)}}}function _(e){if(!function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(l)throw new Error("Reducers may not dispatch actions.");try{l=!0,a=n(a,e)}finally{l=!1}for(var t=o=r,s=0;s<t.length;s++)(0,t[s])();return e}return _({type:w.INIT}),(i={dispatch:_,subscribe:c,getState:d,replaceReducer:function(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");n=e,_({type:w.REPLACE})}})[S]=function(){var e,t=c;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function s(){e.next&&e.next(d())}return s(),{unsubscribe:t(s)}}})[S]=function(){return this},e},i}function O(e,t){var s=t&&t.type;return"Given "+(s&&'action "'+String(s)+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function L(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function D(e){return function(t){var s=t.dispatch,i=t.getState;return function(t){return function(n){return"function"==typeof n?n(s,i,e):t(n)}}}}var M,x,C,H=D();H.withExtraArgument=D,function(e){e.SLICES="slices",e.VOLUME="volume",e.MESH="mesh"}(M||(M={})),function(e){e.CORONAL="coronal",e.SAGGITAL="saggital",e.AXIAL="axial"}(x||(x={})),function(e){e.NONE="none",e.RULER="ruler",e.ANGLE="angle",e.ANNOTATION="annotation",e.HANDLE="handle"}(C||(C={}));const A=function(e){for(var t=Object.keys(e),s={},i=0;i<t.length;i++){var n=t[i];"function"==typeof e[n]&&(s[n]=e[n])}var a,o=Object.keys(s);try{!function(e){Object.keys(e).forEach(function(t){var s=e[t];if(void 0===s(void 0,{type:w.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===s(void 0,{type:w.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+w.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')})}(s)}catch(e){a=e}return function(e,t){if(void 0===e&&(e={}),a)throw a;for(var i=!1,n={},r=0;r<o.length;r++){var l=o[r],h=e[l],d=(0,s[l])(h,t);if(void 0===d){var c=O(l,t);throw new Error(c)}n[l]=d,i=i||d!==h}return i?n:e}}({app:(e=(()=>({src:null,srcLoaded:!1,display:M.MESH,orientation:x.CORONAL,toolsVisible:!1,toolsEnabled:!1,toolType:C.NONE,optionsVisible:!1,optionsEnabled:!1,boundingBoxVisible:!1,THREEJSSceneNeedsUpdate:!1,slicesIndex:void 0,slicesWindowWidth:void 0,slicesWindowCenter:void 0,volumeSteps:void 0,volumeWindowWidth:void 0,volumeWindowCenter:void 0,angleToolEnabled:!0,annotationToolEnabled:!0,rulerToolEnabled:!0}))(),s)=>{switch(s.type){case t.APP_SET_SRC:return Object.assign({},e,{src:s.payload,srcLoaded:!1});case t.APP_SET_SRC_LOADED:return Object.assign({},e,{THREEJSSceneNeedsUpdate:!0,srcLoaded:s.payload});case t.APP_SET_DISPLAY:return Object.assign({},e,{boundingBoxVisible:s.payload===M.SLICES,display:s.payload});case t.APP_SET_ORIENTATION:return Object.assign({},e,{THREEJSSceneNeedsUpdate:!0,slicesIndex:void 0,orientation:s.payload});case t.APP_SET_TOOLS_VISIBLE:return Object.assign({},e,{toolsVisible:s.payload});case t.APP_SET_TOOLS_ENABLED:return Object.assign({},e,{toolsEnabled:s.payload});case t.APP_SET_TOOL_TYPE:return Object.assign({},e,{toolType:s.payload});case t.APP_SET_OPTIONS_VISIBLE:return Object.assign({},e,{optionsVisible:s.payload});case t.APP_SET_OPTIONS_ENABLED:return Object.assign({},e,{optionsEnabled:s.payload});case t.APP_SET_BOUNDINGBOX_VISIBLE:return Object.assign({},e,{THREEJSSceneNeedsUpdate:!0,boundingBoxVisible:s.payload});case t.APP_SET_THREEJS_SCENE_NEEDS_UPDATE:return Object.assign({},e,{THREEJSSceneNeedsUpdate:s.payload});case t.APP_SET_SLICES_INDEX:return Object.assign({},e,{THREEJSSceneNeedsUpdate:!0,slicesIndex:s.payload});case t.APP_SET_SLICES_WINDOW_WIDTH:return Object.assign({},e,{THREEJSSceneNeedsUpdate:!0,slicesWindowWidth:s.payload});case t.APP_SET_SLICES_WINDOW_CENTER:return Object.assign({},e,{THREEJSSceneNeedsUpdate:!0,slicesWindowCenter:s.payload});case t.APP_SET_VOLUME_STEPS:return Object.assign({},e,{THREEJSSceneNeedsUpdate:!0,volumeSteps:s.payload});case t.APP_SET_VOLUME_WINDOW_WIDTH:return Object.assign({},e,{THREEJSSceneNeedsUpdate:!0,volumeWindowWidth:s.payload});case t.APP_SET_VOLUME_WINDOW_CENTER:return Object.assign({},e,{THREEJSSceneNeedsUpdate:!0,volumeWindowCenter:s.payload});case t.APP_SET_ANGLE_TOOL_ENABLED:return Object.assign({},e,{THREEJSSceneNeedsUpdate:!0,angleToolEnabled:s.payload});case t.APP_SET_ANNOTATION_TOOL_ENABLED:return Object.assign({},e,{THREEJSSceneNeedsUpdate:!0,annotationToolEnabled:s.payload});case t.APP_SET_RULER_TOOL_ENABLED:return Object.assign({},e,{THREEJSSceneNeedsUpdate:!0,rulerToolEnabled:s.payload})}return e}}),N=e=>P(A,e,function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return function(e){return function(){var s=e.apply(void 0,arguments),i=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},n={getState:s.getState,dispatch:function(){return i.apply(void 0,arguments)}},a=t.map(function(e){return e(n)});return function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{},i=Object.keys(s);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(s).filter(function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable}))),i.forEach(function(t){L(e,t,s[t])})}return e}({},s,{dispatch:i=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}.apply(void 0,a)(s.dispatch)})}}}(H)),R=(e,t,s,i,n,a)=>{let o=+t.x,r=+t.y,l=+t.z,h=+s.x,d=+s.y,c=+s.z,_=Math.sqrt(h*h+d*d+c*c);if(0===_)throw new Error("Can't raycast along a zero vector");return((e,t,s,i,n,a,o,r,l,h)=>{let d=0,c=Math.floor,_=0|c(t),u=0|c(s),p=0|c(i),m=n>0?1:-1,E=a>0?1:-1,g=o>0?1:-1,y=Math.abs(1/n),f=Math.abs(1/a),v=Math.abs(1/o),b=y<1/0?y*(m>0?_+1-t:t-_):1/0,S=f<1/0?f*(E>0?u+1-s:s-u):1/0,T=v<1/0?v*(g>0?p+1-i:i-p):1/0,w=e.windowCenter-.5*e.windowWidth,P=-1;for(;d<=r;){let r,c=new THREE.Vector3(_,u,p),O=AMI.UtilsCore.worldToData(e.stack.lps2IJK,c),L=AMI.UtilsCore.getPixelData(e.stack,O);if(r=null!==L&&L>w?1:0)return l&&(l.x=t+d*n,l.y=s+d*a,l.z=i+d*o),h&&(h.x=h.y=h.z=0,0===P&&(h.x=-m),1===P&&(h.y=-E),2===P&&(h.z=-g)),r;b<S?b<T?(_+=m,d=b,b+=y,P=0):(p+=g,d=T,T+=v,P=2):S<T?(u+=E,d=S,S+=f,P=1):(p+=g,d=T,T+=v,P=2)}return l&&(l.x=t+d*n,l.y=s+d*a,l.z=i+d*o),h&&(h.x=h.y=h.z=0),0})(e,o,r,l,h/=_,d/=_,c/=_,i=void 0===i?64:+i,n,a)};class I{}I.WIDGET_SIZE=200,I.colorValues={red:16056407,blue:45311,black:0,white:16777215,yellow:16771899,green:7798531,lightRed:16217975},I.lightValues={ambientLightColor:13684944,ambientLightIntensity:1,directionalLight1Color:16777215,directionalLight1Intensity:.75,directionalLight2Color:10584,directionalLight2Intensity:.5},I.cameraValues={near:.05,far:1e4,fov:45},I.stlValues={color:16007990,specular:1118481,shininess:200};class W extends THREE.Object3D{get worldNormal(){return this._worldNormal}set worldNormal(e){this._worldNormal=e}get mesh(){return this._mesh}set mesh(e){this._mesh=e}get widgetType(){return this._widgetType}get worldPosition(){return this._worldPosition}set worldPosition(e){this._worldPosition.copy(e),this.update()}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.update()}get selected(){return this._selected}set selected(e){this._selected=e,this.update()}get displayed(){return this._displayed}set displayed(e){this._displayed=e,this.update()}get active(){return this._active}set active(e){this._active=e,this.update()}get dragged(){return this._dragged}set dragged(e){this._dragged=e,this.update()}get hovered(){return this._hovered}set hovered(e){this._hovered=e,this.update()}get color(){return this._color}set color(e){this._color=e,this.update()}constructor(e,t,s,i,n,a=null){if(super(),this._instanceData={line:null,label:null,moving:!1},this._doesSnap=i,this._maxDistance=n,this._colors={default:I.colorValues.blue,active:I.colorValues.yellow,hover:I.colorValues.red,select:I.colorValues.green,text:I.colorValues.white,error:I.colorValues.lightRed},this._color=this._colors.default,this._controls=e,this._camera=e.object,this._container=t,this._toolParams=s.toolParams,this._enabled=!0,this._displayed=!0,this._selected=!1,this._active=!0,this._dragged=!1,this._hovered=!0,this._initialized=!1,this._dom=null,this._handles=[],this._material=null,this._geometry=null,this._mesh=null,this._toolParams.hideMesh&&(this.visible=!1),null===document.getElementById("ami-widgets")){const e=document.createElement("style");e.id="ami-widgets",e.innerHTML=AMI.WidgetsCss.code,document.head.appendChild(e)}this._worldPosition=new THREE.Vector3,this._widgetType=s.toolType,s.worldPosition&&this._worldPosition.copy(s.worldPosition),this._worldNormal=new THREE.Vector3,this._widgetType=s.toolType,s.worldNormal&&this._worldNormal.copy(s.worldNormal),this._boundingScale=j.getBoundingMag(this._toolParams.boundingBoxGeometry)/I.WIDGET_SIZE,this._initialize(s,a),this.create()}flushState(){(this._widgetType===C.NONE||C.HANDLE)&&(this._handles.forEach(e=>{e.flushState()}),this._enabled=!0,this._displayed=!0,this._selected=!1,this._active=!1,this._dragged=!1,this._hovered=!1,this.update())}updateMeshColor(){this._material&&this._material.color.set(this._color)}updateColor(){this._color=this._active?this._colors.active:this._hovered?this._colors.hover:this._selected?this._colors.select:this._colors.default}updateLabelTransform(e,t,s){let i=Math.round(t.x-(s?0:e.offsetWidth/2)),n=Math.round(t.y-(s?0:e.offsetHeight/2))-this._container.offsetHeight;return i<0?i=i>-e.offsetWidth?0:i+e.offsetWidth:i>this._container.offsetWidth-e.offsetWidth&&(i=i<this._container.offsetWidth?this._container.offsetWidth-e.offsetWidth:i-e.offsetWidth),n<-this._container.offsetHeight?n=n>-this._container.offsetHeight-e.offsetHeight?-this._container.offsetHeight:n+e.offsetHeight:n>-e.offsetHeight&&(n=n<0?-e.offsetHeight:n-e.offsetHeight),new THREE.Vector2(i,n)}updateDOMColor(){(this._widgetType===C.NONE||C.HANDLE)&&(this._instanceData.label.style.borderColor=this._color,this._instanceData.line.style.backgroundColor=this._color),this._updateDOMColor()}updateDOM(){this.updateDOMColor(),this._updateDOM()}updateMeshPosition(){this._geometry&&(this._geometry.verticesNeedUpdate=!0),this._updateMeshPosition()}update(){this.updateColor(),this._update(),(this._widgetType!==C.HANDLE||C.NONE)&&this._handles.forEach(e=>{e.update()}),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOM()}create(){this.createMesh(),this.createDOM(),this._createScreenOffsets(),this._createEventBindings(),this._createEventListeners()}_createScreenOffsets(){const e=this._container.getBoundingClientRect(),t=document.body,s=document.documentElement,i=window.pageYOffset||s.scrollTop||t.scrollTop,n=window.pageXOffset||s.scrollLeft||t.scrollLeft,a=s.clientLeft||t.clientLeft||0;this._screenOffsets={top:Math.round(e.top+i-(s.clientTop||t.clientTop||0)),left:Math.round(e.left+n-a)}}_createEventBindings(){this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this._createUniqueBindings()}_createEventListeners(){window.addEventListener("resize",this.onResize),this._container.addEventListener("wheel",this.onMove),this._createUniqueListeners()}createMesh(){this._createMesh()}_createMeshAsLine(){this._material=new THREE.LineBasicMaterial,this._toolParams.displayMode!==M.VOLUME&&(this._material.depthTest=!1),this.updateMeshColor(),this._geometry=new THREE.Geometry,this._geometry.vertices.push(this._handles[0].worldPosition),this._geometry.vertices.push(this._handles[1].worldPosition),this.mesh=new THREE.Line(this._geometry,this._material),this.mesh.visible=!0,this.mesh.renderOrder=999,this.add(this.mesh)}createDOM(){(this._widgetType===C.NONE||C.HANDLE)&&(this._instanceData.line=j.createDOMLine(this._container),this._instanceData.label=j.createDOMLabel(this._container)),this._createDOM(),this.updateDOMColor()}showDOM(){this._dom.style.display="",(this._widgetType===C.NONE||C.HANDLE)&&(this._handles.forEach(e=>e.showDOM()),this._instanceData.line.style.display="",this._instanceData.label.style.display=""),this._showDOM()}hideDOM(){this._dom.style.display="none",(this._widgetType===C.NONE||C.HANDLE)&&(this._handles.forEach(e=>e.hideDOM()),this._instanceData.line.style.display="none",this._instanceData.label.style.display="none"),this._hideDOM()}hideMesh(){this.visible=!1}showMesh(){!0!==this._toolParams.hideMesh&&(this.visible=!0)}show(){this.showDOM(),this.showMesh(),this.update(),this._displayed=!0}hide(){this.hideDOM(),this.hideMesh(),this._displayed=!1}hoverDom(e){this._domHovered="mouseenter"===e.type}onResize(){this._createScreenOffsets()}onMove(e){this._active?this._dragged=!0:this.onHover(null),(this._widgetType!==C.HANDLE||C.NONE)&&this._handles.forEach(t=>{t.onMove(e)}),this.update()}getMousePosition(e,t){return{x:(e.clientX-this._screenOffsets.left)/t.offsetWidth*2-1,y:-(e.clientY-this._screenOffsets.top)/t.offsetHeight*2+1,screenX:e.clientX-this._screenOffsets.left,screenY:e.clientY-this._screenOffsets.top}}setDefaultColor(e){this._colors.default=e,this._handles&&this._handles.forEach(t=>t._colors.default=e),this.update()}free(){this._camera=null,this._container=null,this._controls=null,this._toolParams=null}}class V extends W{get raycaster(){return this._raycaster}set raycaster(e){this._raycaster=e}get screenPosition(){return this._screenPosition}set screenPosition(e){this._screenPosition=e}get tracking(){return this._tracking}set tracking(e){this._tracking=e,this.update()}_updateDOM(){this._dom&&(this._dom.style.transform=`translate3D(${this._screenPosition.x}px,\n        ${this._screenPosition.y-this._container.offsetHeight}px, 0)`)}_updateDOMColor(){this._dom.style.borderColor=this._color}_update(){this._dragged&&this._active||this._surfaceLockHandle(null),this._screenPosition=j.worldToScreen(this._worldPosition,this._camera,this._container)}_updateMeshPosition(){this.mesh&&this.mesh.position.copy(this._worldPosition)}_createPlane(){this._raycaster.setFromCamera(this._mouse,this._camera),this._raycaster.ray.position=this._raycaster.ray.origin,this._active=!0,this._controls.enabled=!1,this._plane.position.copy(this._worldPosition),this._plane.direction.copy(this._camera.getWorldDirection(this._plane.direction));let e=AMI.IntersectionsCore.rayPlane(this._raycaster.ray,this._plane);null!==e&&this._offset.copy(e).sub(this._plane.position)}_createUniqueBindings(){this.onResize=this.onResize.bind(this)}_createUniqueListeners(){window.addEventListener("resize",this.onResize),this._dom.addEventListener("mouseenter",this.onHover),this._dom.addEventListener("mouseleave",this.onHover)}_createDOM(){this._dom=document.createElement("div"),this._dom.className="widgets-handle",this._dom.style.transform=`translate3D(\n      ${this._screenPosition.x}px,\n      ${this._screenPosition.y-this._container.offsetHeight}px, 0)`,this._container.appendChild(this._dom)}_createMesh(){this._geometry=new THREE.SphereGeometry(1*this._boundingScale,16,16),this._material=new THREE.MeshBasicMaterial({wireframe:!0,wireframeLinewidth:2}),this._toolParams.displayMode!==M.VOLUME&&(this._material.depthTest=!1),this.updateMeshColor(),this.mesh=new THREE.Mesh(this._geometry,this._material),this.mesh.position.copy(this._worldPosition),this.mesh.visible=!0,this.mesh.renderOrder=999,this.add(this.mesh)}_hideDOM(){}_showDOM(){}hoverMesh(){let e=this._raycaster.intersectObject(this.mesh);this._meshHovered=e.length>0}onHover(e){e&&this.hoverDom(e),this.hoverMesh(),this._hovered=this._meshHovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}onMove(e){const t=this.getMousePosition(e,this._container);if(this._mouse.set(t.x,t.y),this._active){if(this._dragged=!0,!this._surfaceLockHandle(e)){if(this._raycaster.setFromCamera(this._mouse,this._camera),this._raycaster.ray.position=this._raycaster.ray.origin,0===this._plane.direction.length()){let e=new THREE.Vector3;this._camera.getWorldDirection(e),this._plane.position.copy(this._worldPosition),this._plane.direction.copy(e)}let e=AMI.IntersectionsCore.rayPlane(this._raycaster.ray,this._plane);null!==e&&this._worldPosition.copy(e.sub(this._offset))}}else this.onHover(null);this.update()}onStart(e){const t=this.getMousePosition(e,this._container);this._mouse.set(t.x,t.y),this._hovered&&(this._toolParams.displayMode===M.VOLUME&&(this._locked=!0),this._createPlane(),this.update())}onEnd(){!0!==this._tracking&&(!this._dragged&&this._active&&this._initialized&&(this._selected=!this._selected),this._initialized=!0,this._active=!1,this._dragged=!1,this._controls.enabled=!0,this._toolParams.displayMode===M.VOLUME&&(this._locked=!0),this.update())}_surfaceLockHandle(e){if(this._doesSnap&&!this._locked){let t=null;if(e){const s=j.getScreenspaceOffsets(this._container);let i={x:(e.clientX-s.left)/this._container.offsetWidth*2-1,y:-(e.clientY-s.top)/this._container.offsetHeight*2+1};this._raycaster.far=1e4,this._raycaster.setFromCamera(i,this._camera),t=this._camera}else this._raycaster.far=this._maxDistance,this._raycaster.set(this._worldPosition,this.worldNormal.negate());let s=j.castRay(this._raycaster,this._toolParams.displayMode,this._sceneCenter,t,this._toolParams.stackHelper,this._toolParams.loadedDataParent);return!(!s||(s.hitNormal&&this.worldNormal.copy(s.hitNormal),!s.hitPosition)||(this._worldPosition.copy(s.hitPosition),0))}}_initialize(e,t){this._locked=!1,this._raycaster=new THREE.Raycaster,this._mouse=new THREE.Vector2,this._plane={position:new THREE.Vector3,direction:new THREE.Vector3},this._offset=new THREE.Vector3,this._sceneCenter=j.getGeometryCenter(this._toolParams.boundingBoxGeometry),this._screenPosition=j.worldToScreen(this._worldPosition,this._camera,this._container)}_removeEventListeners(){window.removeEventListener("resize",this.onResize),this._dom.removeEventListener("mouseenter",this.onHover),this._dom.removeEventListener("mouseleave",this.onHover),this._container.removeEventListener("wheel",this.onMove)}free(){this._removeEventListeners(),this._container.removeChild(this._dom),this.remove(this.mesh),this.mesh.geometry.dispose(),this.mesh.geometry=null,this.mesh.material.dispose(),this.mesh.material=null,this.mesh=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,super.free()}}class k extends W{set worldPosition(e){this._handles[0].worldPosition.copy(e),this._handles[1].worldPosition.copy(e),this._handles[2].worldPosition.copy(e),this._worldPosition.copy(e),this.update()}get angle(){return this._serials.angle}_updateDOMColor(){this._line2.style.backgroundColor=this._color}_updateMeshPosition(){}_update(){this._serials.angle=180*this._handles[1].worldPosition.clone().sub(this._handles[0].worldPosition).angleTo(this._handles[1].worldPosition.clone().sub(this._handles[2].worldPosition))/Math.PI||0}_updateDOM(){const e=j.getLineData(this._handles[1].screenPosition,this._handles[0].screenPosition,this._container);this._instanceData.line.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0)\n            rotate(${e.transformAngle}rad)`,this._instanceData.line.style.width=e.length+"px";const t=j.getLineData(this._handles[1].screenPosition,this._handles[2].screenPosition,this._container);this._line2.style.transform=`translate3D(${t.transformX}px, ${t.transformY}px, 0)\n            rotate(${t.transformAngle}rad)`,this._line2.style.width=t.length+"px",this._instanceData.label.innerHTML=`${this._serials.angle.toFixed(2)}&deg;`;let s=e.line.clone().add(t.line).normalize().negate(),i=s.angleTo(new THREE.Vector3(1,0,0));i>Math.PI/2&&(i=Math.PI-i);const n=Math.tan(i)<this._instanceData.label.offsetHeight/this._instanceData.label.offsetWidth?this._instanceData.label.offsetWidth/2/Math.cos(i)+15:this._instanceData.label.offsetHeight/2/Math.cos(Math.PI/2-i)+15,a=this._handles[1].screenPosition.clone().add(s.multiplyScalar(n)),o=this.updateLabelTransform(this._instanceData.label,a);this._instanceData.label.style.transform=`translate3D(${o.x}px, ${o.y}px, 0)`}_createUniqueBindings(){}_createUniqueListeners(){}_createDOM(){this._line2=j.createDOMLine(this._container)}_createMesh(){this._geometry=new THREE.Geometry,this._geometry.vertices=[this._handles[0].worldPosition,this._handles[1].worldPosition,this._handles[1].worldPosition,this._handles[2].worldPosition],this._material=new THREE.LineBasicMaterial,this._toolParams.displayMode!==M.VOLUME&&(this._material.depthTest=!1),this.updateMeshColor(),this.mesh=new THREE.LineSegments(this._geometry,this._material),this.mesh.visible=!0,this.mesh.renderOrder=999,this.add(this.mesh)}_hideDOM(){this._line2.style.display="none"}_showDOM(){this._line2.style.display=""}onHover(e){e&&this.hoverDom(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._handles[2].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}onStart(e){this._handles[0].onStart(e),this._handles[1].onStart(e),this._handles[2].onStart(e),this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active||this._domHovered,!this._domHovered||this._handles[1].tracking||this._handles[2].tracking||(this._instanceData.moving=!0,this._controls.enabled=!1),this.update()}onMove(e){this._active?this._dragged=!0:this.onHover(null),this._handles[0].onMove(e),this._handles[1].onMove(e),this._handles[2].onMove(e),this.update()}onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||!this._handles[1].tracking&&this._handles[2].tracking&&this._handles[1].screenPosition.distanceTo(this._handles[2].screenPosition)<10||(this._dragged||!this._active||this._handles[2].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._handles[1].active?this._handles[2].onEnd():this._dragged||!this._handles[2].tracking?(this._handles[2].tracking=!1,this._handles[2].onEnd()):this._handles[2].tracking=!1,this._handles[2].selected=this._selected,this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active,this._dragged=this._handles[2].tracking,this._instanceData.moving=!1,this.update())}_initialize(e,t){this._serials=t||{angle:0};let s=e;s.toolType=C.HANDLE;for(let e=0;e<3;e++){let e=new V(this._controls,this._container,s,!0,this._maxDistance);this.add(e),this._handles.push(e)}this._handles[1].active=!0,this._handles[1].tracking=!0,this._handles[2].active=!0,this._handles[2].tracking=!0}_removeEventListeners(){this._container.removeEventListener("wheel",this.onMove)}free(){this._removeEventListeners(),this._handles.forEach(e=>{this.remove(e),e.free()}),this._handles=[],this._container.removeChild(this._instanceData.line),this._container.removeChild(this._line2),this._container.removeChild(this._instanceData.label),this.remove(this.mesh),this.mesh.geometry.dispose(),this.mesh.geometry=null,this.mesh.material.dispose(),this.mesh.material=null,this.mesh=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,super.free()}}class B extends W{set worldPosition(e){this._handles[0].worldPosition.copy(e),this._handles[1].worldPosition.copy(e),this._worldPosition.copy(e),this.update()}_updateDOM(){this.updateDOMColor();const e=j.getLineData(this._handles[0].screenPosition,this._handles[1].screenPosition,this._container);this._instanceData.line.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0)\n        rotate(${e.transformAngle}rad)`,this._instanceData.line.style.width=e.length+"px";const t=e.line.multiplyScalar(.5),s=this._handles[1].screenPosition.clone().sub(this._labelMoved?this._labelOffset:t),i=this.updateLabelTransform(this._instanceData.label,s);this._instanceData.label.style.transform=`translate3D(${i.x}px, ${i.y}px, 0)`,this._manuallabeldisplay&&this._displaylabel();let n=j.getLineData(this._handles[0].screenPosition,s,this._container),a=j.getLineData(e.center,s,this._container),o=j.getLineData(this._handles[1].screenPosition,s,this._container);n.length>a.length&&(n=a),n.length>o.length&&(n=o),this._dashLine.style.transform=`translate3D(${n.transformX}px, ${n.transformY}px, 0)\n        rotate(${n.transformAngle}rad)`,this._dashLine.style.width=n.length+"px"}_updateDOMColor(){this._dashLine.style.borderTop="1.5px dashed "+this._color}_update(){}_updateMeshPosition(){this._worldPosition=this._handles[0].worldPosition,this._cone&&(this._cone.position.copy(this._handles[0].worldPosition),this._cone.lookAt(this._handles[1].worldPosition))}_createUniqueBindings(){this.onResize=this.onResize.bind(this),this.notonHover=this.notonHover.bind(this),this._changelabeltext=this._changelabeltext.bind(this)}_createUniqueListeners(){this._instanceData.label.addEventListener("mouseenter",this.onHover),this._instanceData.label.addEventListener("mouseleave",this.notonHover),this._instanceData.label.addEventListener("dblclick",this._changelabeltext)}_createDOM(){this._dashLine=document.createElement("div"),this._dashLine.className="widgets-dashline",this._dashLine.style.display="none",this._container.appendChild(this._dashLine),this._instanceData.label.style.display="none"}_createMesh(){this._createMeshAsLine(),this._coneGeometry=new THREE.CylinderGeometry(0,2*this._boundingScale,10*this._boundingScale),this._coneGeometry.translate(0,-5*this._boundingScale,0),this._coneGeometry.rotateX(-Math.PI/2),this._cone=new THREE.Mesh(this._coneGeometry,this._material),this._cone.visible=!0,this.mesh.renderOrder=999,this.add(this._cone)}_displaylabel(){this._instanceData.label.innerHTML="string"==typeof this._serials.labelText&&this._serials.labelText.length>0?this._serials.labelText:"",this._instanceData.label.style.display="",this._dashLine.style.display="",this._instanceData.label.style.transform=`translate3D(\n        ${this._handles[1].screenPosition.x-this._labelOffset.x-this._instanceData.label.offsetWidth/2}px,\n        ${this._handles[1].screenPosition.y-this._labelOffset.y-this._instanceData.label.offsetHeight/2-this._container.offsetHeight}px, 0)`}_hideDOM(){this._dashLine.style.display="none"}_showDOM(){this._dashLine.style.display=""}notonHover(){this._labelHovered=!1,this._container.style.cursor="default"}onHover(){this._labelHovered=!0,this._container.style.cursor="pointer"}onStart(e){if(this._labelHovered){const t=this.getMousePosition(e,this._container),s=this._handles[1].screenPosition.clone().sub(this._labelOffset);this._mouseLabelOffset=new THREE.Vector3(t.screenX-s.x,t.screenY-s.y,0),this._instanceData.moving=!0,this._labelMoved=!0}this._handles[0].onStart(e),this._handles[1].onStart(e),this._active=this._handles[0].active||this._handles[1].active||this._labelHovered,this.update()}onMove(e){if(this._instanceData.moving){const t=this.getMousePosition(e,this._container);this._labelOffset=new THREE.Vector3(this._handles[1].screenPosition.x-t.screenX+this._mouseLabelOffset.x,this._handles[1].screenPosition.y-t.screenY+this._mouseLabelOffset.y,0),this._controls.enabled=!1}this._active&&(this._dragged=!0),this._handles[0].onMove(e),this._handles[1].onMove(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._labelHovered,this.update()}onEnd(){this._handles[0].onEnd(),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,!this._dragged&&this._active&&this._initialized&&(this._selected=!this._selected,this._handles[0].selected=this._selected,this._handles[1].selected=this._selected),this._initialized||(this._labelOffset=this._handles[1].screenPosition.clone().sub(this._handles[0].screenPosition).multiplyScalar(.5),this._setlabeltext(),this._initialized=!0),this._active=this._handles[0].active||this._handles[1].active,this._dragged=!1,this._instanceData.moving=!1,this.update()}_setlabeltext(){for(;!this._serials.labelText;)this._serials.labelText=prompt("Please enter the annotation text","");let e;e=this._camera.getWorldPosition(e);let t=this._handles[0].worldPosition.clone().sub(e).normalize().negate();this._handles[1].worldPosition.add(t.multiplyScalar(18*this._boundingScale)),this._handles[1].screenPosition=j.worldToScreen(this._handles[1].worldPosition,this._camera,this._container),this._displaylabel()}_changelabeltext(){this._serials.labelText=prompt("Please enter a new annotation text",this._instanceData.label.innerHTML),this._displaylabel()}_initialize(e,t){this._serials=t||{labelText:""};let s=e;s.toolType=C.HANDLE;let i=new V(this._controls,this._container,s,!0,this._maxDistance);this.add(i),this._handles.push(i);let n=new V(this._controls,this._container,s,!1,this._maxDistance);this.add(n),this._handles.push(n),this._handles[1].active=!0}_removeEventListeners(){window.removeEventListener("resize",this.onResize),this._instanceData.label.removeEventListener("mouseenter",this.onHover),this._instanceData.label.removeEventListener("mouseleave",this.notonHover),this._instanceData.label.removeEventListener("dblclick",this._changelabeltext),this._container.removeEventListener("wheel",this.onMove)}free(){this._removeEventListeners(),this._handles.forEach(e=>{this.remove(e),e.free()}),this._handles=[],this._container.removeChild(this._instanceData.line),this._container.removeChild(this._dashLine),this._container.removeChild(this._instanceData.label),this.remove(this.mesh),this.mesh.material.dispose(),this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,this.mesh.material=null,this.mesh=null,this.remove(this._cone),this._cone.geometry.dispose(),this._cone.geometry=null,this._cone.material.dispose(),this._cone.material=null,this._cone=null,this._coneGeometry.dispose(),this._coneGeometry=null,super.free()}}class U extends W{get calibrationFactor(){return this._serials.calibrationFactor}set calibrationFactor(e){this._serials.calibrationFactor=e,this._serials.units="mm",this.update()}set worldPosition(e){this._handles[0].worldPosition.copy(e),this._handles[1].worldPosition.copy(e),this._worldPosition.copy(e),this.update()}_updateDOM(){const e=j.getLineData(this._handles[0].screenPosition,this._handles[1].screenPosition,this._container);this._instanceData.line.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0)\n      rotate(${e.transformAngle}rad)`,this._instanceData.line.style.width=e.length+"px","units"!==this._serials.units||this._instanceData.label.hasAttribute("title")?"units"!==this._serials.units&&this._instanceData.label.hasAttribute("title")&&(this._instanceData.label.removeAttribute("title"),this._instanceData.label.style.color=this._colors.text):(this._instanceData.label.setAttribute("title","Calibration is required to display the distance in mm"),this._instanceData.label.style.color=this._colors.error),this._instanceData.label.innerHTML=`${this._serials.distance.toFixed(2)} ${this._serials.units}`;let t=Math.abs(e.transformAngle);t>Math.PI/2&&(t=Math.PI-t);const s=Math.tan(t)<this._instanceData.label.offsetHeight/this._instanceData.label.offsetWidth?this._instanceData.label.offsetWidth/2/Math.cos(t)+15:this._instanceData.label.offsetHeight/2/Math.cos(Math.PI/2-t)+15,i=e.line.normalize().multiplyScalar(s),n=e.length>2*s?this._handles[1].screenPosition.clone().sub(i):this._handles[1].screenPosition.clone().add(i),a=this.updateLabelTransform(this._instanceData.label,n);this._instanceData.label.style.transform=`translate3D(${a.x}px, ${a.y}px, 0)`}_update(){const e=j.getDistanceData(this._handles[0].worldPosition,this._handles[1].worldPosition,this._serials.calibrationFactor);this._serials.distance=e.distance,e.units&&(this._serials.units=e.units)}_updateMeshPosition(){}_updateDOMColor(){}_createUniqueBindings(){}_createUniqueListeners(){}_createDOM(){}_createMesh(){this._createMeshAsLine()}_hideDOM(){}_showDOM(){}onHover(e){e&&this.hoverDom(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}onStart(e){this._handles[0].onStart(e),this._handles[1].onStart(e),this._active=this._handles[0].active||this._handles[1].active||this._domHovered,this._domHovered&&!this._handles[1].tracking&&(this._instanceData.moving=!0,this._controls.enabled=!1),this.update()}onMove(e){this._active?this._dragged=!0:this.onHover(null),this._handles[0].onMove(e),this._handles[1].onMove(e),this.update()}onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||(this._dragged||!this._active||this._handles[1].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active,this._dragged=!1,this._instanceData.moving=!1,this.update())}getMeasurements(){return{distance:this._serials.distance,units:this._serials.units}}_initialize(e,t){this._serials=t||{calibrationFactor:1,units:"mm",distance:0},this._widgetType=C.RULER;let s=e;s.toolType=C.HANDLE;for(let e=0;e<2;e++){let t=new V(this._controls,this._container,s,!0,this._maxDistance);t.name=String(e),this.add(t),this._handles.push(t)}this._handles[1].active=!0,this._handles[1].tracking=!0,s.toolParams.hideMesh=!0}_removeEventListeners(){this._container.removeEventListener("wheel",this.onMove)}free(){this._removeEventListeners(),this._handles.forEach(e=>{this.remove(e),e.free()}),this._handles=[],this._container.removeChild(this._instanceData.line),this._container.removeChild(this._instanceData.label),this.remove(this.mesh),this.mesh.geometry.dispose(),this.mesh.geometry=null,this.mesh.material.dispose(),this.mesh.material=null,this.mesh=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,super.free()}}class j{static createDOMLine(e){let t=document.createElement("div");return t.className="widgets-line",e.appendChild(t),t}static createDOMLabel(e){let t=document.createElement("div");return t.className="widgets-label",e.appendChild(t),t}static worldToScreen(e,t,s){const i=e.clone();return i.project(t),i.x=Math.round((i.x+1)*s.offsetWidth/2),i.y=Math.round((1-i.y)*s.offsetHeight/2),i.z=0,i}static getRectData(e,t,s){const i=t.clone().sub(e),n=i.clone().projectOnVector(new THREE.Vector3(0,1,0)),a=e.clone().min(t);return{width:i.clone().projectOnVector(new THREE.Vector3(1,0,0)).length(),height:n.length(),transformX:a.x,transformY:a.y-s.offsetHeight,paddingVector:n.clone().normalize()}}static getLineData(e,t,s){const i=t.clone().sub(e),n=t.clone().add(e).multiplyScalar(.5),a=i.length(),o=i.angleTo(new THREE.Vector3(1,0,0));return{line:i,length:a,transformX:n.x-a/2,transformY:n.y-s.offsetHeight,transformAngle:e.y<t.y?o:-o,center:n}}static getDistanceData(e,t,s){let i=null;return{distance:i=s?e.distanceTo(t)*s:e.distanceTo(t),units:null}}static getArea(e){let t=0,s=e.length-1;for(let i=0;i<e.length;i++)t+=(e[s].x+e[i].x)*(e[s].y-e[i].y),s=i;return Math.abs(t/2)}static getBoundingBoxHelper(e,t,s){let i;switch(e){case M.MESH:i=t;break;case M.VOLUME:i=s._mesh;break;case M.SLICES:i=s._bBox}return new THREE.BoxHelper(i,new THREE.Color(I.colorValues.red))}static getScreenspaceOffsets(e){const t=e.getBoundingClientRect(),s=document.body,i=document.documentElement,n=window.pageYOffset||i.scrollTop||s.scrollTop,a=window.pageXOffset||i.scrollLeft||s.scrollLeft,o=t.left+a-(i.clientLeft||s.clientLeft||0);return{top:Math.round(t.top+n-(i.clientTop||s.clientTop||0)),left:Math.round(o)}}static castRay(e,t,s,i,n=null,a=null){switch(t){case M.MESH:{let t=e.intersectObjects(a.children);if(t.length<=0)return null;let s=null;return i&&(s=t[0].point.clone().sub(i.position.clone()).normalize()),{hitPosition:t[0].point,hitNormal:s}}case M.SLICES:{let t=e.intersectObject(n.slice.mesh);if(t.length<=0)return null;let s=null;return i&&(s=t[0].face.normal),{hitPosition:t[0].point,hitNormal:s}}case M.VOLUME:{let t=new THREE.Vector3(0,0,0),i=new THREE.Vector3(0,0,0);return 0===R(n,e.ray.origin,e.ray.direction,I.cameraValues.far,t,i)?null:{hitPosition:t,hitNormal:i=s.sub(t).normalize()}}}return null}static getGeometryCenter(e){let t;return(t=e instanceof THREE.BufferGeometry?(new THREE.Geometry).fromBufferGeometry(e):e).computeBoundingSphere(),t.boundingSphere.center}static getBoundingBox(e){return(new THREE.Box3).setFromObject(e)}static getBoundingMag(e){let t;return(t=e instanceof THREE.BufferGeometry?(new THREE.Geometry).fromBufferGeometry(e):e).computeBoundingSphere(),2*t.boundingSphere.radius}static getCameraZ(e,t){return j.getBoundingMag(e)*t}static createWidget(e,t,s,i,n=null){switch(s.toolType){case C.RULER:return{widget:new U(e,t,s,!1,i,n),activeHandles:2};case C.ANGLE:return{widget:new k(e,t,s,!1,i,n),activeHandles:3};case C.ANNOTATION:return{widget:new B(e,t,s,!1,i,n),activeHandles:1};default:return null}}static initialiseCameraFromScene(e,t,s){e.computeBoundingBox();const i=e.boundingBox.max.z-e.boundingBox.min.z,n=2*Math.max(Math.max(e.boundingBox.max.x-e.boundingBox.min.x,e.boundingBox.max.y-e.boundingBox.min.y),i)/Math.tan(t.fov*Math.PI/180),a=j.getGeometryCenter(e),o={x:a.x,y:a.y,z:a.z+n};return s.target.set(a.x,a.y,a.z),t.position.set(o.x,o.y,o.z),t.lookAt(a.x,a.y,a.z),a}static createPerspectiveCamera(e){return new THREE.PerspectiveCamera(I.cameraValues.fov,e.offsetWidth/e.offsetHeight,I.cameraValues.near,I.cameraValues.far)}static createSceneLights(){const e=new THREE.Object3D,t=new THREE.DirectionalLight(I.lightValues.directionalLight1Color,I.lightValues.directionalLight1Intensity);t.position.set(1,1,1),e.add(t);const s=new THREE.DirectionalLight(I.lightValues.directionalLight2Color,I.lightValues.directionalLight2Intensity);s.position.set(-1,-1,-1),e.add(s);const i=new THREE.AmbientLight(I.lightValues.ambientLightColor,I.lightValues.ambientLightIntensity);return e.add(i),e}}var z;!function(e){e.GLTF="gltf",e.STL="stl"}(z||(z={}));class G{static setup(e,t,s){const i=t.scene||t.scenes[0];let n;i instanceof THREE.Mesh?n=i:i.children.forEach(e=>{e instanceof THREE.Mesh&&(n=e)});let a=n.geometry;a instanceof THREE.BufferGeometry&&(a=(new THREE.Geometry).fromBufferGeometry(n.geometry));let o=a.vertices.reduce((e,t)=>new THREE.Vector3(Math.min(e.length(),t.length()),0,0)).x;return s.gammaOutput=!0,e.add(n),o}}class J{static setup(e,t,s){null===t.boundingSphere&&t.computeBoundingSphere();const i=new THREE.MeshPhongMaterial(s),n=new THREE.Mesh(t,i);let a=n.geometry;a instanceof THREE.BufferGeometry&&(a=(new THREE.Geometry).fromBufferGeometry(n.geometry));let o=a.vertices.reduce((e,t)=>new THREE.Vector3(Math.min(e.length(),t.length()),0,0)).x;const r=new THREE.Matrix4;return r.set(-1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1),n.applyMatrix(r),e.add(n),o}}class F{static setupMesh(e,t,s){switch(F.FILE_EXTENSION){case z.GLTF:return G.setup(e,t,s);case z.STL:return J.setup(e,t,{color:I.stlValues.color,specular:I.stlValues.specular,shininess:I.stlValues.shininess});default:throw new Error("When setting 'src' to a mesh file you must set 'display' to 'mesh'")}}static srcLoader(e){return new Promise((t,s)=>{const i=new XMLHttpRequest;i.open("GET",e,!0),i.onload=(()=>{let e=JSON.parse(i.responseText);e=F.mapfiles(e.baseurl,e.series),t(e)}),i.onerror=(()=>{s()}),i.send()})}static mapfiles(e,t){return t.map(t=>(e.endsWith("/")||(e+="/"),`${e}${t}`))}static loadSrc(e,t,s){return new Promise(i=>{let n={obj:null,stack:null};F.srcLoader(e).then(e=>{F.loadObject(e,t,s).then(e=>{switch(t){case M.MESH:n.obj=e;break;default:n.stack=e}i(n)})})})}static loadObject(e,t,s){const i=e[0];if(F.FILE_EXTENSION=i.substring(i.lastIndexOf(".")+1),Object.values(z).includes(F.FILE_EXTENSION)){if(t!==M.MESH)throw new Error("When setting 'src' to a mesh file you must set 'display' to 'mesh'");return F.loadMesh(i)}return F.loadSeries(e,s)}static loadSeries(e,t){return new Promise(s=>{const i=new AMI.VolumeLoader(t);i.load(e).then(()=>{const e=i.data[0].mergeSeries(i.data)[0].stack[0];i.free(),s(e)}).catch(e=>{console.log("DICOM load error"),console.error(e)})})}static loadMesh(e){return new Promise(t=>{let s;switch(F.FILE_EXTENSION){case z.GLTF:s=new THREE.GLTFLoader,THREE.DRACOLoader.setDecoderPath(F.DRACO_DECODER_PATH),s.setDRACOLoader(new THREE.DRACOLoader);break;case z.STL:s=new THREE.STLLoader;break;default:throw new Error('Unrecognised mesh format. You may need to set display to "slices" or "volume"')}s.setCrossOrigin&&s.setCrossOrigin("anonymous"),s.load(e,e=>{t(e)},e=>{e.lengthComputable&&console.log("loading: ",e.loaded/e.total+"%")},e=>{console.error(e)})})}}F.FILE_EXTENSION=null,F.DRACO_DECODER_PATH=null;class X{constructor(){this._renderQuality=1,this._activeWidgets=0,this._deltaTime=0,this._displayChanged=!0,this._widgets=[],this.srcLoaded=!1}_reduceActive(){this._activeWidgets>0&&(this._activeWidgets-=1),this._flushWidgets(),this.display===M.VOLUME&&this._flushWidgets()}_setActive(e){0===this._activeWidgets&&(this._activeWidgets=e)}watchSrcLoaded(){this._resetWidgets()}watchDisplay(){this._displayChanged=!0,this._resetWidgets()}watchOrientation(){this._resetWidgets()}async setSrc(e){this.appSetSrc(e)}async setToolsVisible(e){this.appSetToolsVisible(e)}async setOptionsVisible(e){this.appSetOptionsVisible(e)}async setDisplay(e){this.appSetDisplay(e)}async setBoundingBoxVisible(e){this.appSetBoundingBoxVisible(e)}async setAngleToolEnabled(e){this.appSetAngleToolEnabled(e)}async setAnnotationToolEnabled(e){this.appSetAnnotationToolEnabled(e)}async setRulerToolEnabled(e){this.appSetRulerToolEnabled(e)}componentWillLoad(){this._widgetRaycaster=new THREE.Raycaster,this.store.setStore(N({})),this.store.mapStateToProps(this,e=>{const{app:{src:t,srcLoaded:s,display:i,orientation:n,toolsVisible:a,toolsEnabled:o,toolType:r,optionsVisible:l,optionsEnabled:h,boundingBoxVisible:d,THREEJSSceneNeedsUpdate:c,slicesIndex:_,slicesWindowWidth:u,slicesWindowCenter:p,volumeSteps:m,volumeWindowWidth:E,volumeWindowCenter:g,angleToolEnabled:y,annotationToolEnabled:f,rulerToolEnabled:v}}=e;return{src:t,srcLoaded:s,display:i,orientation:n,toolsVisible:a,toolsEnabled:o,toolType:r,optionsVisible:l,optionsEnabled:h,boundingBoxVisible:d,THREEJSSceneNeedsUpdate:c,slicesIndex:_,slicesWindowWidth:u,slicesWindowCenter:p,volumeSteps:m,volumeWindowWidth:E,volumeWindowCenter:g,angleToolEnabled:y,annotationToolEnabled:f,rulerToolEnabled:v}}),this.store.mapDispatchToProps(this,{appSetSrc:s,appSetSrcLoaded:i,appSetDisplay:n,appSetOrientation:a,appSetToolsVisible:o,appSetToolsEnabled:r,appSetToolType:l,appSetOptionsVisible:h,appSetOptionsEnabled:d,appSetBoundingBoxVisible:c,appSetTHREEJSSceneNeedsUpdate:_,appSetSlicesIndex:u,appSetSlicesWindowWidth:p,appSetSlicesWindowCenter:m,appSetVolumeSteps:E,appSetVolumeWindowWidth:g,appSetVolumeWindowCenter:y,appSetAngleToolEnabled:f,appSetAnnotationToolEnabled:v,appSetRulerToolEnabled:b}),F.DRACO_DECODER_PATH=this.dracoDecoderPath}componentDidLoad(){window.addEventListener("resize",()=>{this.resize()},!1),this.src&&F.loadSrc(this.src,this.display,this._canvasContainer).then(e=>{this._meshObject=e.obj,this._stack=e.stack,this.appSetSrcLoaded(!0)})}componentWillUpdate(){if(this.srcLoaded&&this._displayChanged)switch(this._lut=new AMI.LutHelper(this._lutCanvases),this._lut.luts=AMI.LutHelper.presetLuts(),this._lut.lutsO=AMI.LutHelper.presetLutsO(),this.display){case M.VOLUME:if(this._stackhelper&&this._stackhelper instanceof AMI.VolumeRenderingHelper)break;this._stackhelper=new AMI.VolumeRenderingHelper(this._stack),this._stackhelper.uniforms.uTextureLUT.value=this._lut.texture,this._stackhelper.uniforms.uLut.value=1;break;case M.SLICES:if(this._stackhelper&&this._stackhelper instanceof AMI.StackHelper)break;this._stackhelper=new AMI.StackHelper(this._stack),this._stackhelper.bbox.visible=!1,this._stackhelper.border.color=I.colorValues.blue}}renderContainer(){return e("div",null,e("div",{id:"lut-container"},e("div",{id:"lut-min"},"0.0"),e("div",{id:"lut-canvases",ref:e=>this._lutCanvases=e}),e("div",{id:"lut-max"},"1.0")),e("div",{id:"container",ref:e=>this._canvasContainer=e}))}renderDisplayToggle(){return this.display!==M.MESH?e("ion-item",{id:"mode"},e("ion-icon",{name:"eye"}),e("ion-select",{id:"modeSelect",interface:"popover",value:this.display,"ok-text":"OK","cancel-text":"Cancel",onIonChange:e=>this.appSetDisplay(e.detail.value)},e("ion-select-option",{value:"slices"},"Slices"),e("ion-select-option",{value:"volume"},"Volume"))):null}renderToolsToggle(){return this.toolsVisible?e("ion-item",null,e("ion-icon",{name:"create"}),e("ion-toggle",{onIonChange:e=>this.appSetToolsEnabled(e.detail.checked)})):null}renderTools(){return this.toolsVisible&&this.toolsEnabled?e("ion-item",null,e("ion-label",null,"Tool Type"),e("ion-select",{value:this.toolType,interface:"popover",placeholder:"None","ok-text":"OK","cancel-text":"Cancel",onIonChange:e=>this.appSetToolType(e.detail.value)},this.angleToolEnabled?e("ion-select-option",{value:"angle"},"Angle"):null,this.annotationToolEnabled?e("ion-select-option",{value:"annotation"},"Annotation"):null,this.rulerToolEnabled?e("ion-select-option",{value:"ruler"},"Ruler"):null)):null}renderOptionsToggle(){if(this.optionsVisible)return e("ion-item",null,e("ion-icon",{name:"options"}),e("ion-toggle",{onIonChange:e=>this.appSetOptionsEnabled(e.detail.checked)}))}renderBoundingBoxEnabled(){return e("ion-item",null,e("ion-label",null,"Bounding box"),e("ion-toggle",{checked:this.boundingBoxVisible,onIonChange:e=>this.appSetBoundingBoxVisible(e.detail.checked)}))}renderOptions(){switch(this.display){case M.SLICES:{const t=Object.keys(x).indexOf(this.orientation.toUpperCase()),s=this._stack.zCosine;let i;i=1===Math.round(s.x)?1:1===Math.round(s.y)?2:0;const n=Math.round((t+i)%3),a=Math.round((t+i+2)%3),o=this._stack.dimensionsIJK[Object.keys(this._stack.dimensionsIJK)[a]]-1;let r;r=void 0===this.slicesIndex?Math.floor(o/2):this.slicesIndex;const l=1,h=this._stack.minMax[1]-this._stack.minMax[0];let d;d=void 0===this.slicesWindowWidth?h/2:this.slicesWindowWidth;const c=this._stack.minMax[0],_=this._stack.minMax[1];let u;return u=void 0===this.slicesWindowCenter?_/2:this.slicesWindowCenter,this._stackhelper.orientation=n,this._stackhelper.index=r,this._stackhelper.slice.windowWidth=d,this._stackhelper.slice.windowCenter=u,this.optionsVisible&&this.optionsEnabled?e("div",null,this.renderBoundingBoxEnabled(),e("ion-item",null,e("ion-label",null,"Index"),e("ion-range",{pin:"true",min:"0",max:o,value:r,onIonChange:this._slicesIndexChanged.bind(this)})),e("ion-item",null,e("ion-label",null,"Orientation"),e("ion-select",{id:"slicesOrientationSelect",interface:"popover",value:this.orientation,"ok-text":"OK","cancel-text":"Cancel",onIonChange:e=>this.appSetOrientation(e.detail.value)},e("ion-select-option",{value:"coronal"},"Coronal (x)"),e("ion-select-option",{value:"saggital"},"Saggital (y)"),e("ion-select-option",{value:"axial"},"Axial (z)"))),e("ion-item",null,e("ion-icon",{name:"sunny"}),e("ion-range",{pin:"true",min:c,max:_,value:u,onIonChange:this._slicesWindowCenterChanged.bind(this)})),e("ion-item",null,e("ion-icon",{name:"contrast"}),e("ion-range",{pin:"true",min:l,max:h,value:d,onIonChange:this._slicesWindowWidthChanged.bind(this)}))):null}case M.VOLUME:{const t=1,s=128;let i;const n=1,a=this._stack.minMax[1]-this._stack.minMax[0];let o;o=void 0===this.volumeWindowWidth?a/2:this.volumeWindowWidth;const r=this._stack.minMax[0],l=this._stack.minMax[1];let h;if(h=void 0===this.volumeWindowCenter?l/2:this.volumeWindowCenter,this._stackhelper.uniforms.uSteps.value=i=void 0===this.volumeSteps?16:this.volumeSteps,this._stackhelper.windowWidth=o,this._stackhelper.windowCenter=h,this.optionsVisible&&this.optionsEnabled)return e("div",null,this.renderBoundingBoxEnabled(),e("ion-item",null,e("ion-label",null,"Steps"),e("ion-range",{min:t,max:s,value:i,pin:"true",onMouseUp:this._volumeStepsChanged.bind(this)})),e("ion-item",null,e("ion-icon",{name:"sunny"}),e("ion-range",{min:r,max:l,value:h,pin:"true",onMouseUp:this._volumeWindowCenterChanged.bind(this)})),e("ion-item",null,e("ion-icon",{name:"contrast"}),e("ion-range",{min:n,max:a,value:o,pin:"true",onMouseUp:this._volumeWindowWidthChanged.bind(this)})))}case M.MESH:if(this.optionsVisible&&this.optionsEnabled)return e("div",null,this.renderBoundingBoxEnabled())}}_slicesIndexChanged(e){this.appSetSlicesIndex(e.srcElement.value)}_slicesWindowCenterChanged(e){this.appSetSlicesWindowCenter(e.srcElement.value)}_slicesWindowWidthChanged(e){this.appSetSlicesWindowWidth(e.srcElement.value)}_volumeStepsChanged(e){this.appSetVolumeSteps(e.srcElement.value)}_volumeWindowCenterChanged(e){this.appSetVolumeWindowCenter(e.srcElement.value)}_volumeWindowWidthChanged(e){this.appSetVolumeWindowWidth(e.srcElement.value)}renderControlPanel(){return this.srcLoaded?e("div",{id:"control-panel"},e("ion-app",null,this.renderDisplayToggle(),this.renderToolsToggle(),this.renderTools(),this.renderOptionsToggle(),this.renderOptions())):null}renderLoading(){if(this.src&&!this.srcLoaded)return e("div",{id:"spinner"},e("div",{class:"square"}))}render(){return e("div",null,this.renderContainer(),this.renderControlPanel(),this.renderLoading())}componentDidUpdate(){this.srcLoaded?this._displayChanged?(this._displayChanged=!1,cancelAnimationFrame(this._requestAnimationFrame),this._canvasContainer.innerHTML="",this._createRenderer(),this._scene=new THREE.Scene,this._loadedDataParent=new THREE.Object3D,this._scene.add(this._loadedDataParent),this._stackhelper&&this._scene.add(this._stackhelper),this._maxEdgeDistance=this.display===M.MESH?F.setupMesh(this._loadedDataParent,this._meshObject,this._renderer):null,this._boundingBoxHelper=j.getBoundingBoxHelper(this.display,this._loadedDataParent,this._stackhelper),this._scene.add(this._boundingBoxHelper),this._boundingBoxHelper.visible=!1,this._sceneCenter=j.getGeometryCenter(this._boundingBoxHelper.geometry),this._maxEdgeDistance||(this._maxEdgeDistance=j.getBoundingMag(this._boundingBoxHelper.geometry)/2),this._scene.add(j.createSceneLights()),this._camera=j.createPerspectiveCamera(this._canvasContainer),this._createControls(),j.initialiseCameraFromScene(this._boundingBoxHelper.geometry,this._camera,this._controls),this._animate(),this.resize(),this.onLoaded.emit(this._stackhelper),this.appSetTHREEJSSceneNeedsUpdate(!0)):this._boundingBoxHelper.visible=this.boundingBoxVisible:F.loadSrc(this.src,this.display,this._canvasContainer).then(e=>{this._meshObject=e.obj,this._stack=e.stack,this.appSetSrcLoaded(!0)})}_createWidgetFromRay(e){const t=j.getScreenspaceOffsets(this._canvasContainer);this._widgetRaycaster.setFromCamera({x:(e.clientX-t.left)/this._canvasContainer.offsetWidth*2-1,y:-(e.clientY-t.top)/this._canvasContainer.offsetHeight*2+1},this._camera);let s=null;const i=j.castRay(this._widgetRaycaster,this.display,this._sceneCenter,this._camera,this._stackhelper,this._loadedDataParent);return i&&(s=j.createWidget(this._controls,this._controls.domElement,{toolParams:{scene:this._scene,displayMode:this.display,stackHelper:this._stackhelper,boundingBoxGeometry:this._boundingBoxHelper.geometry,orientation:this.orientation,loadedDataParent:this._loadedDataParent,hideMesh:!1},toolType:this.toolType,worldPosition:i.hitPosition,worldNormal:i.hitNormal},this._maxEdgeDistance))?(this._widgets.push(s.widget),this._scene.add(s.widget),s.activeHandles):-1}_resetWidgets(){this._canvasContainer&&(this._canvasContainer.removeEventListener("mouseup",this._widgetMouseUpHandler),this._canvasContainer.removeEventListener("mousemove",this._widgetMouseMoveHandler),this._canvasContainer.removeEventListener("mousedown",this._widgetMouseDownHandler),this._widgets.forEach(e=>{e.free()}),this._widgets=[],this._widgetMouseUpHandler=this._widgetMouseUp.bind(this),this._widgetMouseMoveHandler=this._widgetMouseMove.bind(this),this._widgetMouseDownHandler=this._widgetMouseDown.bind(this),this._canvasContainer.addEventListener("mouseup",this._widgetMouseUpHandler,!1),this._canvasContainer.addEventListener("mousemove",this._widgetMouseMoveHandler,!1),this._canvasContainer.addEventListener("mousedown",this._widgetMouseDownHandler,!1))}_widgetMouseUp(){if(this.display===M.VOLUME&&this._resetPixelDensity(),this.toolsEnabled){for(let e of this._widgets)if(e.active)return e.onEnd(),void this._reduceActive();this._controls.enabled=!0,this.appSetTHREEJSSceneNeedsUpdate(!0)}}_widgetMouseMove(e){if(this.toolsEnabled){this._activeWidgets>0&&this.display===M.VOLUME&&this._reducePixelDensity();let t="default";for(let s of this._widgets)s.onMove(e),s.hovered&&(t="pointer");this._canvasContainer.style.cursor=t,this.appSetTHREEJSSceneNeedsUpdate(!0)}}_widgetMouseDown(e){if(this.display===M.VOLUME&&this._reducePixelDensity(),this.toolsEnabled){for(let t of this._widgets)if(t.hovered)return t.onStart(e),void this._setActive(1);let t=this._createWidgetFromRay(e);-1!==t&&(this._controls.enabled=!1,this._setActive(t),this.appSetTHREEJSSceneNeedsUpdate(!0)),this._canvasContainer.style.cursor="default"}}_flushWidgets(){0===this._activeWidgets&&this._widgets.forEach(e=>{e.flushState(),this.appSetTHREEJSSceneNeedsUpdate(!0)})}_createRenderer(){this._renderer=new THREE.WebGLRenderer({alpha:!0}),this._renderer.setSize(this._canvasContainer.offsetWidth,this._canvasContainer.offsetHeight),this._renderer.setClearColor(I.colorValues.black,1),this._renderer.setPixelRatio(window.devicePixelRatio),this._canvasContainer.appendChild(this._renderer.domElement)}_createControls(){this._controls=new THREE.OrbitControls(this._camera,this._canvasContainer),this._controls.addEventListener("change",this._onControlsChange.bind(this)),this._controls.addEventListener("start",this._onControlsStart.bind(this)),this._controls.addEventListener("end",this._onControlsEnd.bind(this)),this._controls.maxPolarAngle=Math.PI/1.1,this._controls.screenSpacePanning=!0,this._controls.rotateSpeed=.75,this._controls.zoomSpeed=1.2,this._controls.enableDamping=!0,this._controls.dampingFactor=.25}_onControlsChange(){this.appSetTHREEJSSceneNeedsUpdate(!0)}_onControlsStart(){this.display===M.VOLUME&&this._stackhelper.uniforms&&this._reducePixelDensity()}_onControlsEnd(){this.display===M.VOLUME&&this._stackhelper.uniforms&&this._resetPixelDensity()}_resetPixelDensity(){setTimeout(()=>{this._renderer.setPixelRatio(window.devicePixelRatio*this._renderQuality),this._renderer.setSize(this._canvasContainer.offsetWidth,this._canvasContainer.offsetHeight),this.appSetTHREEJSSceneNeedsUpdate(!0)},100)}_reducePixelDensity(){this._renderer.setPixelRatio(.1*window.devicePixelRatio*this._renderQuality),this._renderer.setSize(this._canvasContainer.offsetWidth,this._canvasContainer.offsetHeight),this.appSetTHREEJSSceneNeedsUpdate(!0)}_updateWidgets(){for(let e of this._widgets)e.update()}_animate(){const e=(new Date).getTime();this._deltaTime=e-this._lastTime||0,this._lastTime=e,this._controls.update(),this._updateWidgets(),this.display===M.VOLUME?this.THREEJSSceneNeedsUpdate&&(this._renderer.render(this._scene,this._camera),setTimeout(()=>{this.appSetTHREEJSSceneNeedsUpdate(!1),this._renderer.render(this._scene,this._camera)},3*this._deltaTime)):this._renderer.render(this._scene,this._camera),this._requestAnimationFrame=requestAnimationFrame(()=>{this._animate()})}resize(){this.srcLoaded&&(this._camera.aspect=this._canvasContainer.offsetWidth/this._canvasContainer.offsetHeight,this._camera.updateProjectionMatrix(),this._renderer.setSize(this._canvasContainer.offsetWidth,this._canvasContainer.offsetHeight),this._resizeWidgets())}_resizeWidgets(){this._updateWidgets(),this.appSetTHREEJSSceneNeedsUpdate(!0)}static get is(){return"ami-viewer"}static get encapsulation(){return"shadow"}static get properties(){return{angleToolEnabled:{state:!0},annotationToolEnabled:{state:!0},boundingBoxVisible:{state:!0},display:{state:!0,watchCallbacks:["watchDisplay"]},dracoDecoderPath:{type:String,attr:"draco-decoder-path"},optionsEnabled:{state:!0},optionsVisible:{state:!0},orientation:{state:!0,watchCallbacks:["watchOrientation"]},resize:{method:!0},rulerToolEnabled:{state:!0},setAngleToolEnabled:{method:!0},setAnnotationToolEnabled:{method:!0},setBoundingBoxVisible:{method:!0},setDisplay:{method:!0},setOptionsVisible:{method:!0},setRulerToolEnabled:{method:!0},setSrc:{method:!0},setToolsVisible:{method:!0},slicesIndex:{state:!0},slicesWindowCenter:{state:!0},slicesWindowWidth:{state:!0},src:{state:!0},srcLoaded:{state:!0,watchCallbacks:["watchSrcLoaded"]},store:{context:"store"},THREEJSSceneNeedsUpdate:{state:!0},toolsEnabled:{state:!0},toolsVisible:{state:!0},toolType:{state:!0},volumeSteps:{state:!0},volumeWindowCenter:{state:!0},volumeWindowWidth:{state:!0}}}static get events(){return[{name:"onLoaded",method:"onLoaded",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return"ami-viewer.sc-ami-viewer{background-color:#000}#container.sc-ami-viewer{left:0;right:0;top:0;bottom:0;position:absolute;width:100%;height:100%;overflow:hidden}#control-panel.sc-ami-viewer{width:100%}\@media only screen and (min-width:500px){#control-panel.sc-ami-viewer{max-width:300px}}#debug.sc-ami-viewer{position:fixed;top:0;right:0}#lut-container.sc-ami-viewer{display:none}.widgets-handle.sc-ami-viewer{position:absolute;border:1px solid #fff;border-radius:50%;width:10px;height:10px;margin:-6px;z-index:0}.widgets-line.sc-ami-viewer{width:1px;height:1px}.widgets-dashline.sc-ami-viewer, .widgets-line.sc-ami-viewer{position:absolute;margin-top:-.5px}.widgets-dashline.sc-ami-viewer{border-top:1px dashed #fff}.widgets-dashline.sc-ami-viewer:before, .widgets-line.sc-ami-viewer:before{content:\" \";position:absolute;height:12px;left:0;right:0;margin-top:-6px}.widgets-rectangle.sc-ami-viewer{position:absolute;border:1px solid;margin:-1px}.widgets-rectangle-helper.sc-ami-viewer{position:absolute;border:1px dashed;margin:-1px}.widgets-ellipse.sc-ami-viewer{position:absolute;border:1px solid;border-radius:50%;margin:-1px;z-index:0}.widgets-label.sc-ami-viewer{position:absolute;border:1px solid;background-color:rgba(0,0,0,.7);color:#fff;padding:4px;z-index:0}.progress.container.sc-ami-viewer{position:absolute;top:auto!important;bottom:0!important}.progress.container.sc-ami-viewer   .load.progress.sc-ami-viewer, .progress.container.sc-ami-viewer   .parse.progress.sc-ami-viewer{border:none!important;height:4px!important;background-color:#fff!important}#spinner.sc-ami-viewer{position:absolute;left:50%;top:50%}#spinner.sc-ami-viewer   .square.sc-ami-viewer{margin:0 0 0 -15px;background-color:#fff;width:30px;height:30px;-webkit-animation:sk-rotateplane 1.2s ease-in-out infinite;-moz-animation:sk-rotateplane 1.2s infinite ease-in-out;animation:sk-rotateplane 1.2s ease-in-out infinite}\@-webkit-keyframes sk-rotateplane{0%{-webkit-transform:perspective(120px)}50%{-webkit-transform:perspective(120px) rotateY(180deg)}to{-webkit-transform:perspective(120px) rotateY(180deg) rotateX(180deg)}}\@keyframes sk-rotateplane{0%{transform:perspective(120px) rotateX(0deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)}to{transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)}}"}}export{X as AmiViewer};