import{r as t,c as i,h as e,d as s,H as n,e as h}from"./p-27ac83a5.js";const o="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik05NiAyMzVoMzIwdjQySDk2eiI+PC9wYXRoPjwvc3ZnPgo=",a=class{constructor(e){t(this,e),this.deleteAngle=i(this,"deleteAngle",7)}render(){if(this.angle){const[t]=this.angle;return e("form",{onSubmit:t=>t.preventDefault()},e("ion-button",{size:"small",onClick:()=>{this.deleteAngle.emit(t),this.angle=null}},e("ion-icon",{src:o})))}return null}static get style(){return""}},r={update:"Update"},c=class{constructor(e){t(this,e),this._contentStrings=r,this.tabSize=2,this.graphSubmitted=i(this,"graphSubmitted",7)}render(){return e("form",{onSubmit:t=>t.preventDefault()},e("ion-item",null,e("ion-textarea",{id:"graph",value:JSON.stringify(JSON.parse(this.graph),void 0,this.tabSize),rows:"10",required:!0,onIonChange:t=>this.graph=t.detail.value,maxlength:"5000",ref:t=>this._graph=t})),e("ion-item",null,e("ion-button",{size:"small",type:"submit",onClick:()=>{this.graph&&this.graphSubmitted.emit(this._graph.value)}},e("ion-icon",{src:"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0xOTIgMTI4bDEyOCAxMjgtMTI4IDEyOHoiPjwvcGF0aD48L3N2Zz4K"})," ",this._contentStrings.update)))}static get style(){return"#graph{--background:var(--al-textarea-background-color);--color:var(--al-textarea-color);--padding-bottom:var(--al-textarea-padding-bottom);--padding-end:var(--al-textarea-padding-end);--padding-start:var(--al-textarea-padding-start);--padding-top:var(--al-textarea-padding-top);font-size:var(--al-console-font-size)}"}};var l,u,d,M,g,y,E,T;!function(t){t.NODE="node",t.EDGE="edge",t.ANGLE="angle"}(l||(l={})),function(t){t.ORBIT="orbit",t.TRACKBALL="trackball"}(u||(u={})),function(t){t.SLICES="slices",t.VOLUME="volume",t.MESH="mesh"}(d||(d={})),function(t){t.DEFAULT="default",t.CLAY="clay",t.XRAY="xray",t.NORMALS="normals",t.WIREFRAME="wireframe"}(M||(M={})),function(t){t.GLTF="gltf",t.GLB="glb"}(g||(g={})),function(t){t.CORONAL="coronal",t.SAGGITAL="saggital",t.AXIAL="axial"}(y||(y={})),function(t){t.LOCK="LOCK",t.MESH="MESH"}(E||(E={})),function(t){t.METERS="m",t.MILLIMETERS="mm"}(T||(T={}));const N=(t,i)=>e("div",{style:{"overflow-y":"auto",width:"100%","min-height":"0","max-height":"100%",height:t.height}},i),p={console:"console",graph:"graph",settings:"settings",src:"src"},w=class{constructor(i){t(this,i),this._contentStrings=p,this.angles=null,this.consoleTabEnabled=!0,this.displayMode=d.MESH,this.edges=null,this.graphTabEnabled=!0,this.nodes=null,this.selected=null,this.settingsTabEnabled=!0,this.srcTabEnabled=!0,this.tabContentHeight=null,this.url=null,this.urls=null}_getGraphJson(){if(this.nodes&&this.edges&&this.angles){const t={nodes:Array.from(this.nodes),edges:Array.from(this.edges),angles:Array.from(this.angles)};return JSON.stringify(t)}return""}_getSelectedNode(){if(this.selected&&this.nodes){const t=this.nodes.get(this.selected);if(t)return[this.selected,t]}return null}_getSelectedEdge(){if(this.selected&&this.edges){const t=this.edges.get(this.selected);if(t)return[this.selected,t]}return null}_getSelectedAngle(){if(this.selected&&this.angles){const t=this.angles.get(this.selected);if(t)return[this.selected,t]}return null}render(){const t=this.tabContentHeight||this.el.parentElement.clientHeight+"px";return e("ion-app",null,e("al-tabs",null,e("ion-tab-bar",null,this.srcTabEnabled?e("ion-tab-button",{tab:"src"},e("ion-label",null,this._contentStrings.src)):null,this.settingsTabEnabled?e("ion-tab-button",{tab:"settings"},e("ion-label",null,this._contentStrings.settings)):null,this.graphTabEnabled?e("ion-tab-button",{tab:"graph"},e("ion-label",null,this._contentStrings.graph)):null,this.consoleTabEnabled?e("ion-tab-button",{tab:"console"},e("ion-label",null,this._contentStrings.console)):null),this.srcTabEnabled?e("ion-tab",{tab:"src"},e("al-url-picker",{urls:this.urls,url:this.url})):null,this.settingsTabEnabled?e("ion-tab",{tab:"settings"},e(N,{height:t},e("al-settings",{"display-mode":this.displayMode,stackhelper:this.stackhelper}))):null,this.graphTabEnabled?e("ion-tab",{tab:"graph"},e(N,{height:t},e("al-node-list",{nodes:this.nodes,selected:this.selected}),e("ion-item-divider",null),e("al-node-editor",{node:this._getSelectedNode()}),e("al-edge-editor",{edge:this._getSelectedEdge()}),e("al-angle-editor",{angle:this._getSelectedAngle()}))):null,this.consoleTabEnabled?e("ion-tab",{tab:"console"},e(N,{height:t},e("al-console",{graph:this._getGraphJson()}))):null))}selectedChangedHandler(t){this.selected=t.detail}get el(){return s(this)}static get style(){return""}},m=class{constructor(e){t(this,e),this.deleteEdge=i(this,"deleteEdge",7)}render(){if(this.edge){const[t]=this.edge;return e("form",{onSubmit:t=>t.preventDefault()},e("ion-button",{size:"small",onClick:()=>{this.deleteEdge.emit(t),this.edge=null}},e("ion-icon",{src:o})))}return null}static get style(){return""}},I={delete:"Delete",description:"Description",title:"Title",update:"Update"},j=class{constructor(e){t(this,e),this._contentStrings=I,this.deleteNode=i(this,"deleteNode",7),this.saveNode=i(this,"saveNode",7)}render(){if(this.node){const[t,i]=this.node;return e("form",{onSubmit:t=>t.preventDefault()},e("ion-item",null,e("ion-input",{id:"title",value:i.title,placeholder:this._contentStrings.title,required:!0,onIonChange:t=>i.title=t.detail.value,maxlength:"30"})),e("ion-item",null,e("ion-textarea",{id:"description",value:i.description,placeholder:this._contentStrings.description,rows:"5",onIonChange:t=>i.description=t.detail.value,maxlength:"280"})),e("ion-item",null,e("ion-button",{size:"small",onClick:()=>{this.deleteNode.emit(t),this.node=null}},e("ion-icon",{src:o})," ",this._contentStrings.delete),e("ion-button",{size:"small",type:"submit",onClick:()=>{i.title&&this.saveNode.emit([t,i])}},e("ion-icon",{src:"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0xODYuMzAxIDMzOS44OTNMOTYgMjQ5LjQ2MWwtMzIgMzAuNTA3TDE4Ni4zMDEgNDAyIDQ0OCAxNDAuNTA2IDQxNiAxMTB6Ij48L3BhdGg+PC9zdmc+Cg=="})," ",this._contentStrings.update)))}return null}static get style(){return"#title{--background:var(--al-input-background-color);--color:var(--al-input-color);--padding-bottom:var(--al-input-padding-bottom);--padding-end:var(--al-input-padding-end);--padding-start:var(--al-input-padding-start);--padding-top:var(--al-input-padding-top);font-size:var(--al-input-font-size)}#description{--background:var(--al-textarea-background-color);--color:var(--al-textarea-color);--padding-bottom:var(--al-textarea-padding-bottom);--padding-end:var(--al-textarea-padding-end);--padding-start:var(--al-textarea-padding-start);--padding-top:var(--al-textarea-padding-top);font-size:var(--al-textarea-font-size)}"}},L={noneExist:"No nodes exist"},D=class{constructor(e){t(this,e),this._contentStrings=L,this.nodes=null,this.selected=null,this.selectedChanged=i(this,"selectedChanged",7)}render(){return this.nodes&&this.nodes.size?e("ion-list",null,Array.from(this.nodes).map(([t,i])=>e("ion-item",{selected:this.selected===t,onClick:()=>this.selectedChanged.emit(t)},i.title))):e("p",null,this._contentStrings.noneExist)}static get style(){return"ion-item{--color:var(--al-item-color);--border-color:var(--al-item-border-color)}ion-item[selected]{--color:var(--al-item-selected-color)}"}},A="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNzcuMyAzMmgtNDIuN3Y2NGg0Mi43VjMyem0xMjkuMSA0My43TDM2OCAxMTQuMWwyOS45IDI5LjkgMzguNC0zOC40LTI5LjktMjkuOXptLTMwMC44IDBsLTI5LjkgMjkuOSAzOC40IDM4LjQgMjkuOS0yOS45LTM4LjQtMzguNHpNMjU2IDEyOGMtNzAuNCAwLTEyOCA1Ny42LTEyOCAxMjhzNTcuNiAxMjggMTI4IDEyOCAxMjgtNTcuNiAxMjgtMTI4LTU3LjYtMTI4LTEyOC0xMjh6bTIyNCAxMDYuN2gtNjR2NDIuN2g2NHYtNDIuN3ptLTM4NCAwSDMydjQyLjdoNjR2LTQyLjd6TTM5Ny45IDM2OEwzNjggMzk3LjlsMzguNCAzOC40IDI5LjktMjkuOS0zOC40LTM4LjR6bS0yODMuOCAwbC0zOC40IDM4LjQgMjkuOSAyOS45IDM4LjQtMzguNC0yOS45LTI5Ljl6bTE2My4yIDQ4aC00Mi43djY0aDQyLjd2LTY0eiI+PC9wYXRoPjwvc3ZnPgo=",b="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNTYgNDhDMTQxLjEgNDggNDggMTQxLjEgNDggMjU2czkzLjEgMjA4IDIwOCAyMDggMjA4LTkzLjEgMjA4LTIwOFMzNzAuOSA0OCAyNTYgNDh6bTExMy4xIDMyMS4xQzMzOC45IDM5OS40IDI5OC43IDQxNiAyNTYgNDE2Vjk2YzQyLjcgMCA4Mi45IDE2LjYgMTEzLjEgNDYuOUMzOTkuNCAxNzMuMSA0MTYgMjEzLjMgNDE2IDI1NnMtMTYuNiA4Mi45LTQ2LjkgMTEzLjF6Ij48L3BhdGg+PC9zdmc+Cg==",C="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0xMzEuMyAyMzEuMUwzMiAzMzAuNmw5OS4zIDk5LjR2LTc0LjZoMTc0LjV2LTQ5LjdIMTMxLjN2LTc0LjZ6TTQ4MCAxODEuNEwzODAuNyA4MnY3NC42SDIwNi4ydjQ5LjdoMTc0LjV2NzQuNmw5OS4zLTk5LjV6Ij48L3BhdGg+PC9zdmc+Cg==";class f{}f.controllerName="-controller",f.edgeSize=.005,f.fontSizeLarge=1.6,f.fontSizeMedium=.7,f.fontSizeSmall=.5,f.maxAnimationSteps=50,f.minLoadingMS=500,f.movedEventName="-moved",f.nodeSizeRatio=100,f.stackSpaceMultiplier={x:10,y:10,z:10},f.stepsIncrement=8,f.stepsMax=512,f.stepsMin=1,f.titleIdName="-title",f.topLayerRenderOrder=999,f.unitsDecimalPlaces=2,f.zoomFactor=2.5,f.frustrumScaleFactor=.7,f.textPadding={width:.03,height:.03},f.minFrameMS=15,f.minTimeForThrottle=5*f.minFrameMS,f.buttonColors={active:"#f50057",hover:"#f50057",up:"#00b0ff"},f.colorValues={red:"#f50057",blue:"#00b0ff",black:"#000000",grey:"#222222",white:"#ffffff",yellow:"#ffeb3b",green:"#76ff03",lightRed:"#f77777"},f.lightValues={ambientLightColor:13684944,ambientLightIntensity:1,directionalLight1Color:16777215,directionalLight1Intensity:.75,directionalLight2Color:10584,directionalLight2Intensity:.5},f.cameraValues={near:.05,far:1e4,fov:45,maxPolarAngle:175,rotateSpeed:.5,zoomSpeed:1,panSpeed:.9,dampingFactor:.25,minDistance:0};const O={axial:"Axial",boundingBoxEnabled:"Bounding Box Enabled",brightness:"Brightness",clay:"Clay",contrast:"Contrast",controlsType:"Controls Type",coronal:"Coronal",default:"Default",displayMode:"Display Mode",graphEnabled:"Graph Enabled",material:"Material",meters:"Meters",millimeters:"Millimeters",normals:"Normals",orbit:"Orbit",orientation:"Orientation",recenter:"Recenter",renderSteps:"Render Steps",saggital:"Saggital",sliceIndex:"Slice Index",slices:"Slices",trackball:"Trackball",units:"Units",volume:"Volume",wireframe:"Wireframe",xray:"XRay"},v=class{constructor(e){t(this,e),this._contentStrings=O,this.boundingBoxEnabled=!1,this.controlsType=u.ORBIT,this.displayMode=d.MESH,this.material=M.DEFAULT,this.orientation=y.CORONAL,this.graphEnabled=!1,this.units=T.METERS,this.boundingBoxEnabledChanged=i(this,"boundingBoxEnabledChanged",7),this.controlsTypeChanged=i(this,"controlsTypeChanged",7),this.displayModeChanged=i(this,"displayModeChanged",7),this.materialChanged=i(this,"materialChanged",7),this.orientationChanged=i(this,"orientationChanged",7),this.recenter=i(this,"recenter",7),this.slicesIndexChanged=i(this,"slicesIndexChanged",7),this.slicesWindowCenterChanged=i(this,"slicesWindowCenterChanged",7),this.slicesWindowWidthChanged=i(this,"slicesWindowWidthChanged",7),this.unitsChanged=i(this,"unitsChanged",7),this.graphEnabledChanged=i(this,"graphEnabledChanged",7),this.volumeStepsChanged=i(this,"volumeStepsChanged",7),this.volumeWindowCenterChanged=i(this,"volumeWindowCenterChanged",7),this.volumeWindowWidthChanged=i(this,"volumeWindowWidthChanged",7)}watchStackhelper(){this.slicesIndex=void 0,this.slicesWindowCenter=void 0,this.slicesWindowWidth=void 0,this.volumeSteps=void 0,this.volumeWindowCenter=void 0,this.volumeWindowWidth=void 0}_boundingBoxEnabled(t){this.boundingBoxEnabled=t,this.boundingBoxEnabledChanged.emit(t)}_controlsType(t){this.controlsType=t,this.controlsTypeChanged.emit(t)}_displayMode(t){this.displayMode=t,this.displayModeChanged.emit(t)}_graphEnabled(t){this.graphEnabled=t,this.graphEnabledChanged.emit(t)}_material(t){this.material=t,this.materialChanged.emit(t)}_orientation(t){this.orientation=t,this.orientationChanged.emit(t)}_slicesIndex(t){this.slicesIndex=t,this.slicesIndexChanged.emit(t)}_slicesWindowCenter(t){this.slicesWindowCenter=t,this.slicesWindowCenterChanged.emit(t)}_slicesWindowWidth(t){this.slicesWindowWidth=t,this.slicesWindowWidthChanged.emit(t)}_units(t){this.units=t,this.unitsChanged.emit(t)}_volumeSteps(t){this.volumeSteps=t,this.volumeStepsChanged.emit(t)}_volumeWindowCenter(t){this.volumeWindowCenter=t,this.volumeWindowCenterChanged.emit(t)}_volumeWindowWidth(t){this.volumeWindowWidth=t,this.volumeWindowWidthChanged.emit(t)}renderDisplayModeToggle(){return this.displayMode!==d.MESH?e("ion-item",{style:{display:"var(--display-mode-display, block)"}},e("ion-icon",{src:"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNTYgMTA1Yy0xMDEuOCAwLTE4OC40IDYyLjQtMjI0IDE1MSAzNS42IDg4LjYgMTIyLjIgMTUxIDIyNCAxNTFzMTg4LjQtNjIuNCAyMjQtMTUxYy0zNS42LTg4LjYtMTIyLjItMTUxLTIyNC0xNTF6bTAgMjUxLjdjLTU2IDAtMTAxLjgtNDUuMy0xMDEuOC0xMDAuN1MyMDAgMTU1LjMgMjU2IDE1NS4zIDM1Ny44IDIwMC42IDM1Ny44IDI1NiAzMTIgMzU2LjcgMjU2IDM1Ni43em0wLTE2MS4xYy0zMy42IDAtNjEuMSAyNy4yLTYxLjEgNjAuNHMyNy41IDYwLjQgNjEuMSA2MC40IDYxLjEtMjcuMiA2MS4xLTYwLjQtMjcuNS02MC40LTYxLjEtNjAuNHoiPjwvcGF0aD48L3N2Zz4K",slot:"start",title:this._contentStrings.displayMode}),e("select",{slot:"end",onChange:t=>this._displayMode(t.srcElement.value)},e("option",{selected:this.displayMode===d.SLICES,value:d.SLICES},this._contentStrings.slices),e("option",{selected:this.displayMode===d.VOLUME,value:d.VOLUME},this._contentStrings.volume))):null}renderGraphEnabled(){return e("ion-item",{style:{display:"var(--graph-enabled-display, block)"}},e("ion-icon",{src:"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNTYgNDhDMTQxLjEyNSA0OCA0OCAxNDEuMTI1IDQ4IDI1NnM5My4xMjUgMjA4IDIwOCAyMDggMjA4LTkzLjEyNSAyMDgtMjA4UzM3MC44NzUgNDggMjU2IDQ4em0xMDcgMjI5aC04NnY4NmgtNDJ2LTg2aC04NnYtNDJoODZ2LTg2aDQydjg2aDg2djQyeiI+PC9wYXRoPjwvc3ZnPgo=",slot:"start",title:this._contentStrings.graphEnabled}),e("ion-toggle",{slot:"end",checked:this.graphEnabled,onIonChange:t=>this._graphEnabled(t.detail.checked)}))}renderBoundingBoxEnabled(){return e("ion-item",{style:{display:"var(--bounding-box-enabled-display, block)"}},e("ion-icon",{src:"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik00NjcuMyAxNjguMWMtMS44IDAtMy41LjMtNS4xIDFsLTE3Ny42IDkyLjFoLS4xYy03LjYgNC43LTEyLjUgMTIuNS0xMi41IDIxLjR2MTg1LjljMCA2LjQgNS42IDExLjUgMTIuNyAxMS41IDIuMiAwIDQuMy0uNSA2LjEtMS40LjItLjEuNC0uMi41LS4zTDQ2NiAzODUuNmwuMy0uMWM4LjItNC41IDEzLjctMTIuNyAxMy43LTIyLjFWMTc5LjZjMC02LjQtNS43LTExLjUtMTIuNy0xMS41ek00NTQuMyAxMTguNUwyNzIuNiAzNi44UzI2MS45IDMyIDI1NiAzMmMtNS45IDAtMTYuNSA0LjgtMTYuNSA0LjhMNTcuNiAxMTguNXMtOCAzLjMtOCA5LjVjMCA2LjYgOC4zIDExLjUgOC4zIDExLjVsMTg1LjUgOTcuOGMzLjggMS43IDguMSAyLjYgMTIuNiAyLjYgNC42IDAgOC45LTEgMTIuNy0yLjdsMTg1LjQtOTcuOXM3LjUtNCA3LjUtMTEuNWMuMS02LjMtNy4zLTkuMy03LjMtOS4zek0yMjcuNSAyNjEuMkw0OS44IDE2OWMtMS41LS42LTMuMy0xLTUuMS0xLTcgMC0xMi43IDUuMS0xMi43IDExLjV2MTgzLjhjMCA5LjQgNS41IDE3LjYgMTMuNyAyMi4xbC4yLjEgMTc0LjcgOTIuN2MxLjkgMS4xIDQuMiAxLjcgNi42IDEuNyA3IDAgMTIuNy01LjIgMTIuNy0xMS41VjI4Mi42Yy4xLTguOS00LjktMTYuOC0xMi40LTIxLjR6Ij48L3BhdGg+PC9zdmc+Cg==",slot:"start",title:this._contentStrings.boundingBoxEnabled}),e("ion-toggle",{slot:"end",checked:this.boundingBoxEnabled,onIonChange:t=>this._boundingBoxEnabled(t.detail.checked)}))}renderControlsTypeSelect(){return e("ion-item",{style:{display:"var(--controls-type-display, block)"}},e("ion-icon",{src:"data:image/svg+xml;base64,PHN2ZwogICB2aWV3Qm94PSIwIDAgNTEyIDUxMiIKICAgY2xhc3M9InMtaW9uLWljb24iPgogIDxwYXRoCiAgICAgZD0ibSAyNDEuMTA0ODIsMzQuNzUwNzA3IGMgLTEwLjQ4NzE4LDIuMjcyMzkyIC0yMS42MjIyOSw4LjU0MzQxNyAtMjkuODQxNywxNi43NTgyMTYgLTMyLjMyNjk4LDMyLjMyNjk3OCAtMTkuMzU0NTQsODYuMjgwODQ3IDI0LjMyNTA1LDEwMS42MzIwODcgbCA1LjYyMzA5LDEuOTQ4NDUgMC4zMjM5NiwxMC43MDQ2NyAwLjMyMzk3LDEwLjcwNDY4IC00LjY1MTE5LDIuMjcyMzkgYyAtMTMuOTM5NzEsNi45MDk2OSAtMTY2LjQ5ODk1NSw5Ni4wMDQ0MSAtMTcwLjgyMTU1OSw5OS43ODU1IC0zLjQ1NzE1NSwyLjkyMDMyIC02LjQ4ODUzMyw3LjEzNjQ4IC05LjE5MTMxNSwxMi43NTk1OCBsIC00LjEwOTcxNCw4LjIxNDgxIC0wLjMyMzk2OCwyOS40MDY2NSBjIC0wLjMyMzk2MiwyNy41NjkzIC0wLjIxNzUxNCwyOS43MzUyNCAxLjk0Mzc4NiwzNi4xMTI3MiAyLjU5NjMzOSw3LjU2Njg3IDYuNTk0OTgxLDEzLjk0ODkyIDEyLjExMTYyMiwxOS4wMzA1NiAzLjQ2MTc4OCwzLjM1MDcgMTYyLjYxMTM3OCw5NS42ODUwNCAxNzIuNTU3MDY4LDEwMC4yMjUxOSA3LjEzNjQ4LDMuMjQ0MjUgMjMuNDY0MjYsMy4zNTA3MSAzMC41OTYxLDAuMTExMTEgMi43MDI3OSwtMS4yOTU5IDQxLjg0MjIxLC0yMy41NzA3MSA4Ny4wMzUxOCwtNDkuNjI2NjcgNTIuNzY0NDcsLTMwLjM4MzIxIDgzLjY4NDUzLC00OC44Njc2NyA4Ni43MTEyOSwtNTEuNzg3OTMgMi41OTYzMywtMi40ODUzIDYuMzc3NDIsLTguMDAxOTUgOC42NDk4MiwtMTIuNDM1NTkgbCAzLjk5ODYzLC04LjEwODM1IHYgLTMxLjQ2MTUyIC0zMS40NjE1MyBsIC00LjEwOTcxLC04LjIxNDggYyAtMi43MDI3OCwtNS42MjMxIC01LjcyOTUsLTkuNzMyODEgLTkuMTkxMjksLTEyLjc1OTU4IC00LjMyMjYyLC0zLjc4NTcyIC0xNTYuODgxODUsLTkyLjg3NTgxIC0xNzAuODI2MiwtOTkuNzk0NzUgbCAtNC42NTExOCwtMi4yNzIzOSAwLjMyMzk4LC0xMC44MTExNCAwLjMyMzk0LC0xMC43MDQ2NiA0LjQzMzcsLTEuMjk1ODYgYyAxNS4xMzgzMiwtNC40MzM3IDI5LjczMDYsLTE2Ljk3NTc1IDM3LjA4NDU3LC0zMS44OTY1OSAyMi43MTQ1MSwtNDYuMjc1OTM2IC0xOC4xNTU4MywtOTguMDYzOTE3IC02OC42NDc5MywtODcuMDM1MjUzIHogbSA0LjQzMzY2LDEyLjU0MjA0OSBjIDguNzU2MjcsMi40ODUyNDYgMTYuNzU4MjIsMTMuNDA3NDU1IDE2Ljc1ODIyLDIzLjEzNTY0IDAsMTIuODY1OTg1IC0xMS40NTkxLDI0LjMyNTA4OSAtMjQuMzI1MDgsMjQuMzI1MDg5IC02LjQ4ODUzLDAgLTExLjg5NDEsLTIuMzc4ODM2IC0xNi44NjQ2MywtNy40NjA0MTYgLTkuODM5MjUsLTkuNzMyODEyIC0xMC4wNTY3NiwtMjMuMzUzMTc5IC0wLjY0Nzk0LC0zMy4zMDM1MjggNi44MDc4OSwtNy4xMzE4MDMgMTUuMjQwMiwtOS40MDQxOTYgMjUuMDc5NDMsLTYuNjk2Nzg1IHogbSAtMy41NjgyMiwyMDcuMzY5MzA0IGMgMC4zMjM5NiwxNi40MzQyMiAwLjQzMDQxLDE3LjQwNjEzIDIuOTIwMzEsMjAuMDAyNDcgNS42MjMwOSw1Ljk0NzAzIDE0LjA1NTQzLDUuOTQ3MDMgMTkuNjc4NDcsMCAyLjQ4NTMsLTIuNTk2MzQgMi41OTYzOCwtMy41NjgyNSAyLjkyMDMxLC0yMC4wMDI0NyAwLjQzNTAyLC0xOS43ODQ5NCAtMC42NDc5MSwtMTguNDg5MSAxMi4xMTE2MiwtMTQuOTIwODUgMTcuMDgyMTQsNC42NDY1NiAzMi4wMDMwNSwxNS41Njg3NiAzOC40OTE1NSwyOC4wMDQzNiAyLjgxMzg2LDUuMjk5MTIgMy4xMzc4NCw3LjAzMDA0IDMuMTM3ODQsMTYuMjE2NjkgMCw5LjE5MTM1IC0wLjMyMzk4LDEwLjkxNzU5IC0zLjEzNzg0LDE2LjIxNjc0IC00LjY1MTE5LDguNzU2MjcgLTE0LjA1NTM4LDE3LjQwNjA5IC0yNC42NDkwMywyMi41OTg4MSAtMTMuNzMxNDQsNi44MTI0OSAtMjAuNDMyODYsOC4yMTk0MyAtMzguNzA0NDEsOC4yMTk0MyAtMTguMjcxNTgsMCAtMjQuOTc3NjMsLTEuNDA2OTQgLTM4LjcwNDQ0LC04LjIxOTQzIC0xMC41OTgyNCwtNS4xODgwOSAtMjAuMDAyNDYsLTEzLjgzNzkxIC0yNC42NTM2NiwtMjIuNTk4ODEgLTIuODA5MjMsLTUuMjk5MTUgLTMuMTMzMTksLTcuMDI1MzkgLTMuMTMzMTksLTE2LjIxNjc0IDAsLTkuMTkxMjggMC4zMjM5NiwtMTAuOTIyMiAzLjEzMzE5LC0xNi4yMTY2OSA2LjM3NzQ3LC0xMi4yMTgwNSAyMC41NDM5NCwtMjIuNzA1MjUgMzcuNDA4NTgsLTI3Ljc4NjgyIDEzLjgyODY0LC00LjEwOTcxIDEyLjc1MDI5LC01LjI5OTE2IDEzLjE4MDcsMTQuNzAzMzEgeiBtIC0xMDMuMjUxOTMsMTcuNjIzNjIgYyA5LjYyMTczLDQuNDMzNyAxMi4xMDcsMTMuNTEzOTUgNS43Mjk1MywyMC43NTY4NSAtNC41NDAxMSw1LjE5MjY1IC0xMS4xMzUwOSw3LjQ2MDQyIC0xOS42Nzg0OCw2LjkxODk0IC0xNS45OTkyLC0wLjk3MTkxIC0yNS40MDgwMzcsLTEzLjA4MzUyIC0xNy41MTcxOSwtMjIuNDg3NzEgNy4wMzAwMSwtOC4zMjEyNSAyMC4yMTk5NywtMTAuNDg3MTkgMzEuNDY2MTQsLTUuMTg4MDggeiIgLz4KPC9zdmc+Cg==",slot:"start",title:this._contentStrings.controlsType}),e("select",{slot:"end",onChange:t=>this._controlsType(t.srcElement.value)},e("option",{selected:this.controlsType===u.ORBIT,value:u.ORBIT},this._contentStrings.orbit),e("option",{selected:this.controlsType===u.TRACKBALL,value:u.TRACKBALL},this._contentStrings.trackball)))}renderRecenterButton(){return e("ion-item",{style:{display:"var(--recenter-display, block)"}},e("ion-icon",{src:"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNTYgNDhjLTQyLjkgMC04NC4yIDEzLTExOS4yIDM3LjUtMzQuMiAyNC02MC4yIDU3LjItNzUuMSA5Ni4xTDU4IDE5Mmg0NS43bDEuOS01YzguMi0xNy44IDE5LjQtMzMuOSAzMy41LTQ4IDMxLjItMzEuMiA3Mi43LTQ4LjQgMTE2LjktNDguNHM4NS43IDE3LjIgMTE2LjkgNDguNGMzMS4yIDMxLjIgNDguNCA3Mi43IDQ4LjQgMTE2LjkgMCA0NC4xLTE3LjIgODUuNy00OC40IDExNi45LTMxLjIgMzEuMi03Mi43IDQ4LjQtMTE2LjkgNDguNC00NC4xIDAtODUuNi0xNy4yLTExNi45LTQ4LjQtMTQtMTQtMjUuMy0zMC4xLTMzLjUtNDcuOWwtMS45LTVINThsMy42IDEwLjRjMTQuOSAzOC45IDQwLjkgNzIuMSA3NS4xIDk2LjFDMTcxLjggNDUxLjEgMjEzIDQ2NCAyNTYgNDY0YzExNC43IDAgMjA4LTkzLjMgMjA4LTIwOFMzNzAuNyA0OCAyNTYgNDh6Ij48L3BhdGg+PHBhdGggZD0iTTQ4IDI3Ny40aDE4OS43bC00My42IDQ0LjdMMjI0IDM1Mmw5Ni05Ni05Ni05Ni0zMSAyOS45IDQ0LjcgNDQuN0g0OHY0Mi44eiI+PC9wYXRoPjwvc3ZnPgo=",slot:"start",title:this._contentStrings.recenter}),e("ion-button",{slot:"end",size:"small",onClick:()=>{this.recenter.emit()}},this._contentStrings.recenter))}renderUnitsSelect(){return e("ion-item",{style:{display:"var(--units-display, block)"}},e("ion-icon",{src:"data:image/svg+xml;base64,PHN2ZwogICB2aWV3Qm94PSIwIDAgNTEyIDUxMiIKICAgY2xhc3M9InMtaW9uLWljb24iPgogIDxwYXRoCiAgICAgZD0iTSAzNzQuNDQxNzQsMTYyLjM0MTQ4IEMgMzIwLjYzNTAzLDExOC4xOTQ1IDI0Ni44MzkzMywxMDcuNTMwNTQgMTgzLjc4NTg3LDEzNC43NzA4IGMgLTI0LjMxODksMTAuNDk0NDIgLTQzLjcyOTY4LDI0LjQwMTUxIC02Mi42MzYxNSw0NC44MTIxNiAtMjkuNTcwNDQsMzEuOTAwNTkgLTQ1LjgwNzY1OSw2OS42MzA5MyAtNDguNzI0Njk5LDExMy4wMzAyMSBsIC0wLjgzNDcwMSwxMi40OTQxOCAtMTAuNzQyMjMzLDAuMDgyNSAtMTAuODI0ODA0LDFlLTUgNWUtNiw0Mi40ODE5OCAxLjVlLTUsNDIuNDgxOTcgMjA2LjU2MjcxNywtMC4wMTMxIDIwNi41NjcwNywxMGUtNiAtNmUtNSwtNDIuNDgxOTggNWUtNSwtNDIuNDgxOTkgLTEwLjQ5ODc4LDAuMDA0IGMgLTUuNjYwMjEsMS4zZS00IC0xMC42NjM5NCwtMC4zMzQ3NCAtMTEuMDc2OTQsLTAuNzQ3NzMgLTAuMzMwMzUsLTAuMzMwNDMgLTAuODMwMzUsLTUuNjY0NTcgLTEuMDgyNDgsLTExLjc0MjEyIC0xLjgzNDU3LC00Ny44MTE3OSAtMjcuNzM1ODksLTk4Ljg2NjY0IC02Ni4wNTMxMywtMTMwLjM0OTkyIHogbSAtMjUuNTcwOTEsODUuODY4MTkgYyA5LjI0Njc0LDE1LjU3NjQzIDE0LjU3MjIsMzIuOTAwNDkgMTUuNjU5MDUsNTAuMzA3MTQgbCAwLjQxNzM1LDYuNzQ3MDUgLTEwOC4zNjEyMywtMC4wNzgzIC0xMDguMzY1NTUsLTAuMDgyNiAwLjQxNzM2LC04LjU4MTYzIGMgMC45OTk4OCwtMTYuODI0MTEgNy42NTk5OSwtMzYuNjQ3ODUgMTcuNDkzNjEsLTUxLjQ3MjIgNi40MTY2MywtOS45MTE4OCAyMS4yNDA5NywtMjQuNzM2MjMgMzEuMjM1NDcsLTMxLjIzNTQ4IDI2LjczNTk5LC0xNy41NzE4NSA2Mi42MzYxLC0yMi4zMTkxMSA5My42MTk0NCwtMTIuMTU5NDQgNy44Mjk1MiwyLjY2NDg1IDIzLjA3MTIsMTAuNTc3MDIgMzAuNTcwMzMsMTYuMDc2MzggOC4zMjUxMiw2LjE2MDE1IDIxLjgxNDgzLDIxLjE1NDAxIDI3LjMxNDE3LDMwLjQ3OTAzIHoiCiAvPgo8L3N2Zz4K",slot:"start",title:this._contentStrings.units}),e("select",{slot:"end",onChange:t=>this._units(t.srcElement.value)},e("option",{selected:this.units===T.METERS,value:T.METERS},this._contentStrings.meters),e("option",{selected:this.units===T.MILLIMETERS,value:T.MILLIMETERS},this._contentStrings.millimeters)))}renderMaterialSelect(){return e("ion-item",{style:{display:"var(--material-display, block)"}},e("ion-icon",{src:"data:image/svg+xml;base64,PHN2ZwogICB2aWV3Qm94PSIwIDAgNTEyIDUxMiIKICAgY2xhc3M9InMtaW9uLWljb24iPgogIDxwYXRoCiAgICAgZD0iTSAyNTYuOTgwNDcgNDguODk2NDg0IEEgMjA2LjEzODU3IDIwNi4xMzg1NyAwIDAgMCA1MC44NDE3OTcgMjU1LjAzNTE2IEEgMjA2LjEzODU3IDIwNi4xMzg1NyAwIDAgMCAyNTYuOTgwNDcgNDYxLjE3MzgzIEEgMjA2LjEzODU3IDIwNi4xMzg1NyAwIDAgMCA0NjMuMTE5MTQgMjU1LjAzNTE2IEEgMjA2LjEzODU3IDIwNi4xMzg1NyAwIDAgMCAyNTYuOTgwNDcgNDguODk2NDg0IHogTSAyNTcuNjczODMgODcuNjc1NzgxIEEgMTY3Ljk4OTU1IDE2Ny45ODk1NSAwIDAgMSA0MjUuMzAwNzggMjQ1LjQ0NTMxIEMgNDEyLjg3ODY2IDI1Ni41Nzk3NCAzODguOTQyNjMgMjc0LjE5MDk2IDM1MS4zNjUyMyAyODYuNDUzMTIgQyAzMDAuMzIxODIgMzAzLjEwOTQ5IDI1Ny42NjYwMiAzMDEuODQ1NyAyNTcuNjY2MDIgMzAxLjg0NTcgTCAyNTguMjY3NTggNDIzLjYzMjgxIEEgMTY3Ljk4OTU1IDE2Ny45ODk1NSAwIDAgMSAyNTcuNjczODMgNDIzLjY1NDMgQSAxNjcuOTg5NTUgMTY3Ljk4OTU1IDAgMCAxIDg5LjY4MzU5NCAyNTUuNjY2MDIgQSAxNjcuOTg5NTUgMTY3Ljk4OTU1IDAgMCAxIDkwLjIxNjc5NyAyNDUgQyAxMDIuNDg2NzcgMjU2LjEwMzYxIDEyNi41NDYxNSAyNzQuMDIxNTkgMTY0LjY0MjU4IDI4Ni40NTMxMiBDIDIxNS42ODYgMzAzLjEwOTQ4IDI1Ny42NjYwMiAzMDEuODQ1NyAyNTcuNjY2MDIgMzAxLjg0NTcgTCAyNTcuNjczODMgODcuNjc1NzgxIHogIgogICAgIGlkPSJwYXRoODM2IiAvPgo8L3N2Zz4K",slot:"start",title:this._contentStrings.material}),e("select",{slot:"end",onChange:t=>this._material(t.srcElement.value)},e("option",{selected:this.material===M.DEFAULT,value:M.DEFAULT},this._contentStrings.default),e("option",{selected:this.material===M.CLAY,value:M.CLAY},this._contentStrings.clay),e("option",{selected:this.material===M.NORMALS,value:M.NORMALS},this._contentStrings.normals),e("option",{selected:this.material===M.WIREFRAME,value:M.WIREFRAME},this._contentStrings.wireframe),e("option",{selected:this.material===M.XRAY,value:M.XRAY},this._contentStrings.xray)))}renderGenericOptions(){return[this.renderBoundingBoxEnabled(),this.renderControlsTypeSelect(),this.renderRecenterButton(),this.renderUnitsSelect()]}_reverseNumber(t,i,e){return e+i-t}renderOptions(){switch(this.displayMode){case d.SLICES:{if(!this.stackhelper||this.stackhelper&&!this.stackhelper.slice)break;const t=Object.keys(y).indexOf(this.orientation.toUpperCase()),i=this.stackhelper.stack.zCosine;let s;s=1===Math.round(i.x)?1:1===Math.round(i.y)?2:0;const n=Math.round((t+s)%3),h=Math.round((t+s+2)%3),o=this.stackhelper.stack.dimensionsIJK[Object.keys(this.stackhelper.stack.dimensionsIJK)[h]]-1;let a;a=h!==this._lastStackOrientationIndex||void 0===this.slicesIndex?Math.floor(o/2):this.slicesIndex,this._lastStackOrientationIndex=h;const r=1,c=this.stackhelper.stack.minMax[1]-this.stackhelper.stack.minMax[0];let l;l=void 0===this.slicesWindowWidth?c/2:this.slicesWindowWidth;const u=this.stackhelper.stack.minMax[0],d=this.stackhelper.stack.minMax[1];let M;return M=void 0===this.slicesWindowCenter?d/2:this.slicesWindowCenter,this.stackhelper.orientation=n,this.stackhelper.index=a,this.stackhelper.slice.windowWidth=l,this.stackhelper.slice.windowCenter=M,e("div",null,this.renderGenericOptions(),e("ion-item",{style:{display:"var(--slices-index-display, block)"}},e("ion-icon",{src:C,slot:"start",title:this._contentStrings.sliceIndex}),e("ion-range",{slot:"end",min:"0",max:o,value:a,pin:!0,onIonChange:t=>this._slicesIndex(t.detail.value)})),e("ion-item",{style:{display:"var(--slices-orientation-display, block)"}},e("ion-icon",{src:"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNTYgMjMxLjM1OGMtMTMuNDQyIDAtMjQuNjQzIDExLjItMjQuNjQzIDI0LjY0MnMxMS4yIDI0LjY0MyAyNC42NDMgMjQuNjQzIDI0LjY0My0xMS4yIDI0LjY0My0yNC42NDMtMTEuMjAxLTI0LjY0Mi0yNC42NDMtMjQuNjQyek0yNTYgMzJDMTMyLjggMzIgMzIgMTMyLjggMzIgMjU2czEwMC44IDIyNCAyMjQgMjI0IDIyNC0xMDAuOCAyMjQtMjI0UzM3OS4yIDMyIDI1NiAzMnptNDkuMjg0IDI3My4yODRMMTIxLjYgMzkwLjRsODUuMTE2LTE4My42NzlMMzkwLjQgMTIxLjZsLTg1LjExNiAxODMuNjg0eiI+PC9wYXRoPjwvc3ZnPgo=",slot:"start",title:this._contentStrings.orientation}),e("select",{slot:"end",onChange:t=>this._orientation(t.srcElement.value)},e("option",{selected:this.orientation===y.CORONAL,value:y.CORONAL},this._contentStrings.coronal),e("option",{selected:this.orientation===y.SAGGITAL,value:y.SAGGITAL},this._contentStrings.saggital),e("option",{selected:this.orientation===y.AXIAL,value:y.AXIAL},this._contentStrings.axial))),e("ion-item",{style:{display:"var(--slices-window-center-display, block)"}},e("ion-icon",{src:A,slot:"start",title:this._contentStrings.brightness}),e("ion-range",{slot:"end",min:u,max:d,value:this._reverseNumber(M,u,d),onIonChange:t=>this._slicesWindowCenter(this._reverseNumber(t.detail.value,u,d))})),e("ion-item",{style:{display:"var(--slices-window-width-display, block)"}},e("ion-icon",{src:b,slot:"start",title:this._contentStrings.contrast}),e("ion-range",{slot:"end",min:r,max:c,value:this._reverseNumber(l,r,c),onIonChange:t=>this._slicesWindowWidth(this._reverseNumber(t.detail.value,r,c))})))}case d.VOLUME:{if(!this.stackhelper)break;let t;const i=1,s=this.stackhelper.stack.minMax[1]-this.stackhelper.stack.minMax[0];let n;n=void 0===this.volumeWindowWidth?s/2:this.volumeWindowWidth;const h=this.stackhelper.stack.minMax[0],o=this.stackhelper.stack.minMax[1];let a;return a=void 0===this.volumeWindowCenter?o/2:this.volumeWindowCenter,this.stackhelper.steps=t=void 0===this.volumeSteps?16:this.volumeSteps,this.stackhelper.windowWidth=n,this.stackhelper.windowCenter=a,e("div",null,this.renderGenericOptions(),e("ion-item",{style:{display:"var(--volume-steps-display, block)"}},e("ion-icon",{src:C,slot:"start",title:this._contentStrings.renderSteps}),e("ion-range",{slot:"end",min:f.stepsMin,max:f.stepsMax,value:t,step:f.stepsIncrement,pin:!0,onIonChange:t=>this._volumeSteps(t.detail.value)})),e("ion-item",{style:{display:"var(--volume-window-center-display, block)"}},e("ion-icon",{src:A,slot:"start",title:this._contentStrings.brightness}),e("ion-range",{slot:"end",min:h,max:o,value:this._reverseNumber(a,h,o),onIonChange:t=>{this._volumeWindowCenter(this._reverseNumber(t.detail.value,h,o))}})),e("ion-item",{style:{display:"var(--volume-window-width-display, block)"}},e("ion-icon",{src:b,slot:"start",title:this._contentStrings.contrast}),e("ion-range",{slot:"end",min:i,max:s,value:this._reverseNumber(n,i,s),onIonChange:t=>this._volumeWindowWidth(this._reverseNumber(t.detail.value,i,s))})))}case d.MESH:return this.renderGenericOptions();default:return}return null}render(){return[this.renderDisplayModeToggle(),this.renderGraphEnabled(),this.renderOptions()]}static get watchers(){return{stackhelper:["watchStackhelper"]}}static get style(){return"ion-item{--border-width:0 0 0 0;--inner-border-width:0 0 0 0}ion-item select{padding:5px;min-width:100px}"}},x=class{constructor(e){t(this,e),this.transitioning=!1,this.onTabClicked=t=>{const{tab:i}=t.detail;this.select(i)},this.ionNavWillLoad=i(this,"ionNavWillLoad",7),this.ionTabsWillChange=i(this,"ionTabsWillChange",3),this.ionTabsDidChange=i(this,"ionTabsDidChange",3)}async componentWillLoad(){const t=this.tabs;await this.select(t[0]),this.ionNavWillLoad.emit()}componentWillRender(){const t=this.el.querySelector("ion-tab-bar");t&&(t.selectedTab=this.selectedTab?this.selectedTab.tab:void 0)}async select(t){const i=await this.getTab(t);return!!this.shouldSwitch(i)&&(this.setActive(i),this.tabSwitch(),!0)}async getTab(t){const i="string"==typeof t?this.tabs.find(i=>i.tab===t):t;return i||console.error(`tab with id: "${i}" does not exist`),i}getSelected(){return Promise.resolve(this.selectedTab?this.selectedTab.tab:void 0)}setActive(t){return this.transitioning?Promise.reject("transitioning already happening"):(this.transitioning=!0,this.leavingTab=this.selectedTab,this.selectedTab=t,this.ionTabsWillChange.emit({tab:t.tab}),t.setActive(),!0)}tabSwitch(){const t=this.selectedTab,i=this.leavingTab;this.leavingTab=void 0,this.transitioning=!1,t&&i!==t&&(i&&(i.active=!1),this.ionTabsDidChange.emit({tab:t.tab}))}shouldSwitch(t){return void 0!==t&&t!==this.selectedTab&&!this.transitioning}get tabs(){return Array.from(this.el.querySelectorAll("ion-tab"))}render(){return e(n,{onIonTabButtonClick:this.onTabClicked},e("slot",{name:"top"}),e("div",{class:"tabs-inner"},e("slot",null)),e("slot",{name:"bottom"}))}get el(){return s(this)}static get style(){return":host{z-index:var(--z-index-page-container)}.tabs-inner{position:relative}"}},S=class{constructor(e){t(this,e),this.urls=null,this.url=null,this.urlChanged=i(this,"urlChanged",7)}render(){return this.urls?e("form",{onSubmit:t=>t.preventDefault()},e("ion-select",{value:this.url,interface:"popover",placeholder:"",onIonChange:t=>this.urlChanged.emit(t.detail.value)},Array.from(this.urls).map(([t,i])=>e("ion-select-option",{value:t},i))),e("ion-input",{type:"url",size:"100",placeholder:"src",required:!0,value:this.url,ref:t=>this._input=t}),e("ion-button",{size:"small",type:"submit",onClick:()=>this.urlChanged.emit(this._input.value)},e("ion-icon",{src:"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNTYgMzg4Yy03Mi41OTcgMC0xMzItNTkuNDA1LTEzMi0xMzIgMC03Mi42MDEgNTkuNDAzLTEzMiAxMzItMTMyIDM2LjMgMCA2OS4yOTkgMTUuNCA5Mi40MDYgMzkuNjAxTDI3OCAyMzRoMTU0VjgwbC01MS42OTggNTEuNzAyQzM0OC40MDYgOTkuNzk4IDMwNC40MDYgODAgMjU2IDgwYy05Ni43OTcgMC0xNzYgNzkuMjAzLTE3NiAxNzZzNzguMDk0IDE3NiAxNzYgMTc2YzgxLjA0NSAwIDE0OC4yODctNTQuMTM0IDE2OS40MDEtMTI4SDM3OC44NWMtMTguNzQ1IDQ5LjU2MS02Ny4xMzggODQtMTIyLjg1IDg0eiI+PC9wYXRoPjwvc3ZnPgo="})," Load")):null}static get style(){return""}};var z,k;!function(t){t[t.Backspace=8]="Backspace",t[t.Tab=9]="Tab",t[t.Enter=13]="Enter",t[t.Shift=16]="Shift",t[t.Ctrl=17]="Ctrl",t[t.Alt=18]="Alt",t[t.PauseBreak=19]="PauseBreak",t[t.CapsLock=20]="CapsLock",t[t.Escape=27]="Escape",t[t.Spacebar=32]="Spacebar",t[t.PageUp=33]="PageUp",t[t.PageDown=34]="PageDown",t[t.End=35]="End",t[t.Home=36]="Home",t[t.LeftArrow=37]="LeftArrow",t[t.UpArrow=38]="UpArrow",t[t.RightArrow=39]="RightArrow",t[t.DownArrow=40]="DownArrow",t[t.PrintScrn=44]="PrintScrn",t[t.Insert=45]="Insert",t[t.Delete=46]="Delete",t[t.Zero=48]="Zero",t[t.One=49]="One",t[t.Two=50]="Two",t[t.Three=51]="Three",t[t.Four=52]="Four",t[t.Five=53]="Five",t[t.Six=54]="Six",t[t.Seven=55]="Seven",t[t.Eight=56]="Eight",t[t.Nine=57]="Nine",t[t.a=65]="a",t[t.b=66]="b",t[t.c=67]="c",t[t.d=68]="d",t[t.e=69]="e",t[t.f=70]="f",t[t.g=71]="g",t[t.h=72]="h",t[t.i=73]="i",t[t.j=74]="j",t[t.k=75]="k",t[t.l=76]="l",t[t.m=77]="m",t[t.n=78]="n",t[t.o=79]="o",t[t.p=80]="p",t[t.q=81]="q",t[t.r=82]="r",t[t.s=83]="s",t[t.t=84]="t",t[t.u=85]="u",t[t.v=86]="v",t[t.w=87]="w",t[t.x=88]="x",t[t.y=89]="y",t[t.z=90]="z",t[t.LeftWindowKey=91]="LeftWindowKey",t[t.RightWindowKey=92]="RightWindowKey",t[t.SelectKey=93]="SelectKey",t[t.Numpad0=96]="Numpad0",t[t.Numpad1=97]="Numpad1",t[t.Numpad2=98]="Numpad2",t[t.Numpad3=99]="Numpad3",t[t.Numpad4=100]="Numpad4",t[t.Numpad5=101]="Numpad5",t[t.Numpad6=102]="Numpad6",t[t.Numpad7=103]="Numpad7",t[t.Numpad8=104]="Numpad8",t[t.Numpad9=105]="Numpad9",t[t.Multiply=106]="Multiply",t[t.NumpadPlus=107]="NumpadPlus",t[t.NumpadMinus=109]="NumpadMinus",t[t.DecimalPoint=110]="DecimalPoint",t[t.Divide=111]="Divide",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12",t[t.NumLock=144]="NumLock",t[t.ScrollLock=145]="ScrollLock",t[t.Semicolon=186]="Semicolon",t[t.Equals=187]="Equals",t[t.Comma=188]="Comma",t[t.LessThan=188]="LessThan",t[t.Dash=189]="Dash",t[t.Period=190]="Period",t[t.GreaterThan=190]="GreaterThan",t[t.ForwardSlash=191]="ForwardSlash",t[t.QuestionMark=191]="QuestionMark",t[t.GraveAccent=192]="GraveAccent",t[t.Tilde=192]="Tilde",t[t.OpenCurlyBracket=219]="OpenCurlyBracket",t[t.OpenSquareBracket=219]="OpenSquareBracket",t[t.BackSlash=220]="BackSlash",t[t.VerticalPipe=220]="VerticalPipe",t[t.CloseCurlyBracket=221]="CloseCurlyBracket",t[t.CloseSquareBracket=221]="CloseSquareBracket",t[t.Quote=222]="Quote",t[t.CommandFF=224]="CommandFF"}(z||(z={})),function(t){t[t.Backspace=8]="Backspace",t[t.Enter=13]="Enter",t[t.Spacebar=32]="Spacebar",t[t.Hash=35]="Hash",t[t.GraveAccent=39]="GraveAccent",t[t.DoubleQuote=34]="DoubleQuote",t[t.Asterisk=42]="Asterisk",t[t.Plus=43]="Plus",t[t.Comma=44]="Comma",t[t.Minus=45]="Minus",t[t.Period=46]="Period",t[t.ForwardSlash=47]="ForwardSlash",t[t.Zero=48]="Zero",t[t.One=49]="One",t[t.Two=50]="Two",t[t.Three=51]="Three",t[t.Four=52]="Four",t[t.Five=53]="Five",t[t.Six=54]="Six",t[t.Seven=55]="Seven",t[t.Eight=56]="Eight",t[t.Nine=57]="Nine",t[t.Colon=58]="Colon",t[t.Semicolon=59]="Semicolon",t[t.LessThan=60]="LessThan",t[t.Equals=61]="Equals",t[t.GreaterThan=62]="GreaterThan",t[t.QuestionMark=63]="QuestionMark",t[t.At=64]="At",t[t.OpenSquareBracket=91]="OpenSquareBracket",t[t.BackSlash=92]="BackSlash",t[t.CloseSquareBracket=93]="CloseSquareBracket",t[t.a=97]="a",t[t.b=98]="b",t[t.c=99]="c",t[t.d=100]="d",t[t.e=101]="e",t[t.f=102]="f",t[t.g=103]="g",t[t.h=104]="h",t[t.i=105]="i",t[t.j=106]="j",t[t.k=107]="k",t[t.l=108]="l",t[t.m=109]="m",t[t.n=110]="n",t[t.o=111]="o",t[t.p=112]="p",t[t.q=113]="q",t[t.r=114]="r",t[t.s=115]="s",t[t.t=116]="t",t[t.u=117]="u",t[t.v=118]="v",t[t.w=119]="w",t[t.x=120]="x",t[t.y=121]="y",t[t.z=122]="z",t[t.OpenCurlyBracket=123]="OpenCurlyBracket",t[t.VerticalPipe=124]="VerticalPipe",t[t.CloseCurlyBracket=125]="CloseCurlyBracket",t[t.Tilde=126]="Tilde"}(k||(k={}));class R{static isWebGL2Available(){try{const t=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!t.getContext("webgl2"))}catch(t){return!1}}static enableControls(t,i,e){t.setAttribute(e===u.TRACKBALL?"al-trackball-control":"al-orbit-control",`enabled: ${i}`)}static waitOneFrame(t){window.setTimeout(()=>{t()},f.minFrameMS)}static objectToVector3(t){const i=new THREE.Vector3;return i.x=t.x,i.y=t.y,i.z=t.z,i}static worldToScreen(t,i,e){const s=t.clone();return s.project(i),s.x=Math.round((s.x+1)*e.offsetWidth/2),s.y=Math.round((1-s.y)*e.offsetHeight/2),s.z=0,s}static vector3ToString(t){return t.toArray().join(" ")}static stringToVector3(t){const i=t.split(" "),e=new THREE.Vector3;return e.x=Number(i[0]),e.y=Number(i[1]),e.z=Number(i[2]),e}static slerp(t,i,e){const s=e,n=t,h=i;let o=n.angleTo(h);if(o){o=THREE.Math.clamp(o,-.99,.99);const t=Math.sin(1-s)*o,i=Math.sin(s*o),e=Math.sin(o),a=t/e,r=i/e,c=n.clone().multiplyScalar(a),l=h.clone().multiplyScalar(r);return c.add(l)}return null}static easeInOutCubic(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1}static getSlerpCameraPath(t,i,e,s){const n=[],h=t.position.clone().addScalar(Number.EPSILON),o=t.target.clone().addScalar(Number.EPSILON),a=i.position.clone().addScalar(Number.EPSILON),r=i.target.clone().addScalar(Number.EPSILON);for(let t=0;t<=f.maxAnimationSteps;t++){const i=this.easeInOutCubic(t/f.maxAnimationSteps);n.push({position:e?R.slerp(h.clone(),a.clone(),i):a,target:s?R.slerp(o.clone(),r.clone(),i):r})}return n}static getSlerp3Path(t,i){const e=[],s=t.clone().addScalar(Number.EPSILON),n=i.clone().addScalar(Number.EPSILON);for(let t=0;t<=f.maxAnimationSteps;t++){const i=this.easeInOutCubic(t/f.maxAnimationSteps);e.push(R.slerp(s.clone(),n.clone(),i))}return e}static lookToFrustrumSpace(t,i,e,s){const n=new THREE.Vector3;i.getWorldDirection(n);const h=s.distanceTo(new THREE.Vector3(0,0,0)),o=new THREE.Plane(n,h),a=new THREE.Vector3;o.projectPoint(e,a),t.lookAt(a)}static getFrustrumSpaceDistance(t,i,e){const s=new THREE.Vector3;t.getWorldDirection(s);const n=e.distanceTo(new THREE.Vector3(0,0,0)),h=new THREE.Plane(s,n),o=new THREE.Vector3;h.projectPoint(i,o);const a=new THREE.Ray(i);return a.lookAt(o),a.distanceToPlane(h)}}class _{static _traceDataRay(t,i,e,s,n,h,o,a,r,c){let l=0;const u=Math.floor;let d=0|u(i),M=0|u(e),g=0|u(s);const y=n>0?1:-1,E=h>0?1:-1,T=o>0?1:-1,N=Math.abs(1/n),p=Math.abs(1/h),w=Math.abs(1/o);let m=N<1/0?N*(y>0?d+1-i:i-d):1/0,I=p<1/0?p*(E>0?M+1-e:e-M):1/0,j=w<1/0?w*(T>0?g+1-s:s-g):1/0;const L=t.windowCenter-.5*t.windowWidth;let D=-1;for(;l<=a;){let a;const u=new THREE.Vector3(d,M,g),A=AMI.CoreUtils.worldToData(t.stack.lps2IJK,u),b=AMI.CoreUtils.getPixelData(t.stack,A);if(a=null!==b&&b>L?1:0)return r&&(r.x=i+l*n,r.y=e+l*h,r.z=s+l*o),c&&(c.x=c.y=c.z=0,0===D&&(c.x=-y),1===D&&(c.y=-E),2===D&&(c.z=-T)),a;m<I?m<j?(d+=y,l=m,m+=N,D=0):(g+=T,l=j,j+=w,D=2):I<j?(M+=E,l=I,I+=p,D=1):(g+=T,l=j,j+=w,D=2)}return r&&(r.x=i+l*n,r.y=e+l*h,r.z=s+l*o),c&&(c.x=c.y=c.z=0),0}static volumeRay(t,i,e,s,n,h){const o=+i.x,a=+i.y,r=+i.z;let c=+e.x,l=+e.y,u=+e.z;const d=Math.sqrt(c*c+l*l+u*u);if(0===d)throw new Error("Can't raycast along a zero vector");return this._traceDataRay(t,o,a,r,c/=d,l/=d,u/=d,s=void 0===s?64:+s,n,h)}static toAframeSpace(t){return t.divide(R.objectToVector3(f.stackSpaceMultiplier))}}class Y{static debounce(t,i){return i=i||100,function(){if(!t.debouncing){const i=Array.prototype.slice.apply(arguments);t.lastReturnVal=t.apply(this,i),t.debouncing=!0}return clearTimeout(t.debounceTimeout),t.debounceTimeout=setTimeout(()=>{t.debouncing=!1},i),t.lastReturnVal}}}class Q{static addCssUnits(t){return this.cssUnits.some(i=>t.includes(i))||(t+="px"),t}static getFileExtension(t){return t.substring(t.lastIndexOf(".")+1)}static getGeometryCenter(t){let i;return(i=t instanceof THREE.BufferGeometry?(new THREE.Geometry).fromBufferGeometry(t):t).computeBoundingSphere(),i.boundingSphere.center}static getCameraStateFromMesh(t){let i,e,s;if(t){const n=t.geometry;return i=this.getGeometryCenter(n),s=f.zoomFactor*n.boundingSphere.radius/Math.tan(f.cameraValues.fov*Math.PI/180),(e=new THREE.Vector3).copy(i),e.z+=s,{target:i,position:e}}return null}static getCameraPositionFromNode(t,i,e){if(!t)return null;const s=new THREE.Vector3;s.copy(R.stringToVector3(t.position));const n=s.clone().sub(e.clone()).normalize(),h=new THREE.Vector3;return h.copy(s),h.add(n.clone().multiplyScalar(i*f.zoomFactor)),h}static getBoundingBox(t){return(new THREE.Box3).setFromObject(t)}}Q.cssUnits=["%","ch","cm","em","ex","in","mm","pc","pt","px","rem","vh","vmax","vmin","vw"];class P{}P.SELECTED="al-graph-selected",P.POINTER_OVER="al-graph-pointer-over",P.POINTER_OUT="al-graph-pointer-out",P.DRAGGED="al-graph-dragged",P.POINTER_DOWN="al-graph-pointer-down",P.POINTER_UP="al-graph-pointer-up";class U{static getEntryWithHighestId(t){return t.size?Math.max.apply(Math,Array.from(t).map(([t])=>Number(t.split("-")[1]))):-1}static getNextId(t,i){return t+"-"+Number(this.getEntryWithHighestId(i)+1)}}const H="#define GLSLIFY 1\nvarying vec3 vNormal;\nuniform float r;\nuniform float g;\nuniform float b;\nuniform float a;\nuniform float c;\n\nvoid main()\n{\n    float intensity = pow( c - dot( vNormal, vec3( 0.0, 0.0, 1.0 ) ), 4.0 );\n    gl_FragColor = vec4(r, g, b, a) * intensity;\n}",W="#define GLSLIFY 1\nvarying vec3 vNormal;\n\nvoid main()\n{\n    vNormal = normalize( normalMatrix * normal );\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";class ${static getHaloMaterial(t=.5,i=.5,e=.5,s=.1,n=.5){return new THREE.ShaderMaterial({uniforms:{r:{value:t},g:{value:i},b:{value:e},a:{value:s},c:{value:n}},vertexShader:W,fragmentShader:H,side:THREE.BackSide,blending:THREE.AdditiveBlending,transparent:!0,depthTest:!1})}}AFRAME.registerComponent("al-angle",{schema:{selected:{type:"boolean"},edge0Pos:{type:"vec3"},edge1Pos:{type:"vec3"},position:{type:"vec3"},length:{type:"number"},radius:{type:"number"},angle:{type:"number"},scale:{type:"number"}},init(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,f.minFrameMS,this),this.bindMethods(),this.addEventListeners(),this.state={selected:!0,hovered:!1},this.createMesh()},bindMethods(){this.pointerDown=this.pointerDown.bind(this),this.pointerOver=this.pointerOver.bind(this),this.pointerOut=this.pointerOut.bind(this),this.createMesh=this.createMesh.bind(this),this.getMatrix=this.getMatrix.bind(this)},addEventListeners(){this.el.addEventListener("mousedown",this.pointerDown,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("raycaster-intersected",this.pointerOver,{capture:!0,once:!1,passive:!0}),this.el.addEventListener("raycaster-intersected-cleared",this.pointerOut,{capture:!1,once:!1,passive:!0})},removeEventListeners(){this.el.removeEventListener("mousedown",this.pointerDown),this.el.removeEventListener("raycaster-intersected",this.pointerOver),this.el.removeEventListener("raycaster-intersected-cleared",this.pointerOut)},pointerDown(t){this.el.sceneEl.emit(P.SELECTED,{type:l.ANGLE,id:this.el.id},!0)},pointerOver(t){this.state.hovered=!0,this.el.sceneEl.emit(P.POINTER_OVER,{id:this.el.id},!0)},pointerOut(t){this.state.hovered=!1,this.el.sceneEl.emit(P.POINTER_OUT,{},!0)},getMatrix(){const t=R.objectToVector3(this.data.edge0Pos),i=R.objectToVector3(this.data.edge1Pos),e=new THREE.Matrix4;e.makeScale(this.data.scale,this.data.scale,1);const s=new THREE.Matrix4;s.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1);const n=new THREE.Matrix4;return n.lookAt(t,i,(new THREE.Object3D).up),n.multiply(e),n.multiply(s),n},createMesh(){const t=new THREE.CylinderGeometry(this.data.radius,this.data.radius,this.data.length,6,4),i=new THREE.MeshBasicMaterial,e=new THREE.Mesh(t,i);e.applyMatrix(this.getMatrix()),e.position.copy(R.objectToVector3(this.data.position)),this.state.geometry=t,this.state.material=i,this.state.mesh=e;const s=new THREE.CylinderGeometry(this.data.radius,this.data.radius,this.data.length,6,4),n=$.getHaloMaterial(),h=new THREE.Mesh(s,n);this.state.outlineGeometry=s,this.state.outlineMaterialt=n,this.state.outlineMesh=h,e.add(h),this.el.setObject3D("mesh",e),this.el.object3D.renderOrder=f.topLayerRenderOrder-3},update(t){this.state.selected=this.data.selected,!t||t.angle===this.data.angle&&t.scale===this.data.scale||this.createMesh()},tickFunction(){const t=this.el,i=this.state;i.material.color=i.hovered?new THREE.Color(f.buttonColors.hover):i.selected?new THREE.Color(f.buttonColors.active):new THREE.Color(f.buttonColors.up);const e=t.firstChild;if(e){e.object3D.visible=!!i.hovered}},tick(){this.tickFunction()},remove(){this.removeEventListeners(),this.el.removeObject3D("mesh")}}),AFRAME.registerComponent("al-background",{schema:{text:{type:"string",default:""},boundingRadius:{type:"number",default:1},scale:{type:"number",default:8},frustrumDistance:{type:"number",default:1}},init(){this.state={hasUpdated:!1},this.bindMethods(),this.addEventListeners(),this.tickFunction=AFRAME.utils.throttle(this.tickFunction,f.minFrameMS,this)},bindMethods(){},addEventListeners(){},removeEventListeners(){},update(t){this.data.text!==t.text&&(this.state.hasUpdated=!1)},tickFunction(){if(!this.state.hasUpdated){const t=this.el.object3DMap.text;let i;if(t&&(i=t.geometry).attributes.position){i.computeBoundingBox();const t=new THREE.Vector3;i.boundingBox.getSize(t);const e=(.001*t.y+f.textPadding.height)*this.data.boundingRadius,s=new THREE.PlaneGeometry(1,1,1,1),n=new THREE.MeshStandardMaterial;n.color=new THREE.Color(f.colorValues.black),n.transparent=!0,n.opacity=.9,n.flatShading=!0,n.roughness=1,n.depthTest=!1;const h=new THREE.Mesh(s,n);h.scale.set((.001*t.x+f.textPadding.width)*this.data.boundingRadius,e,1),h.renderOrder=f.topLayerRenderOrder-1,h.position.add(new THREE.Vector3(0,e*(this.data.frustrumDistance/4),0)),this.el.object3D.add(h),this.state.hasUpdated=!0}}},tick(){this.tickFunction()},remove(){this.removeEventListeners()}}),AFRAME.registerComponent("al-billboard-baggins",{schema:{controlsType:{type:"string",default:u.ORBIT},cameraPosition:{type:"string"},worldPosition:{type:"string"}},init(){this.bindMethods(),this.addEventListeners(),this.tickFunction=AFRAME.utils.throttle(this.tickFunction,f.minFrameMS,this)},bindMethods(){},addEventListeners(){},removeEventListeners(){},update(t){const i=this.el.sceneEl.camera,e=this.el.object3D,s=R.stringToVector3(this.data.worldPosition),n=R.stringToVector3(this.data.cameraPosition);switch(this.data.controlsType!==t.controlsType&&this.el.object3D.up.copy(this.el.sceneEl.camera.up.clone()),this.data.controlsType){case u.TRACKBALL:R.lookToFrustrumSpace(e,i,s,n),e.up.copy(this.el.sceneEl.camera.up.clone());break;case u.ORBIT:default:R.lookToFrustrumSpace(e,i,s,n)}},tickFunction(){},tick(){this.tickFunction()},remove(){this.removeEventListeners()}}),AFRAME.registerComponent("al-bounding-box",{schema:{color:{type:"string",default:"#f50057"},scale:{type:"string"},opacity:{type:"number",default:1}},init(){this.bindMethods(),this.addEventListeners(),this.state={box:new THREE.Box3}},bindMethods(){},addEventListeners(){},removeEventListeners(){},update(){const t=this.el,i=this.state,e=R.stringToVector3(this.data.scale);i.box.setFromCenterAndSize(new THREE.Vector3(0,0,0),e);const s=new THREE.BoxGeometry(e.x,e.y,e.z),n=new THREE.MeshBasicMaterial({color:this.data.color,visible:!1}),h=new THREE.Mesh(s,n);t.setObject3D("mesh2",h),i.boundingBox=new THREE.Box3Helper(i.box,this.data.color);const o=i.boundingBox.material;o.opacity=this.data.opactiy,o.transparent=0===this.data.opacity,i.boundingBox.renderOrder=f.topLayerRenderOrder-5,t.setObject3D("mesh",i.boundingBox),i.geometry=s,i.material=n,i.mesh=h},remove(){this.removeEventListeners(),this.el.removeObject3D("mesh"),this.el.removeObject3D("mesh2")}});const F={DOWN:["mousedown","touchstart"],UP:["mouseup","touchend"]};var B,G,V,Z;AFRAME.registerComponent("al-cursor",{dependencies:["raycaster"],schema:{downEvents:{default:[]},fuse:{default:AFRAME.utils.device.isMobile()},fuseTimeout:{default:1500,min:0},mouseCursorStylesEnabled:{default:!0},upEvents:{default:[]},rayOrigin:{default:"entity",oneOf:["mouse","entity"]}},init:function(){var t=this;this.fuseTimeout=void 0,this.cursorDownEl=null,this.intersectedEl=null,this.canvasBounds=document.body.getBoundingClientRect(),this.isCursorDown=!1,this.updateCanvasBounds=AFRAME.utils.debounce(function(){t.canvasBounds=t.el.sceneEl.canvas.getBoundingClientRect()},500),this.eventDetail={},this.intersectedEventDetail={cursorEl:this.el},this.onCursorDown=AFRAME.utils.bind(this.onCursorDown,this),this.onCursorUp=AFRAME.utils.bind(this.onCursorUp,this),this.onIntersection=AFRAME.utils.bind(this.onIntersection,this),this.onIntersectionCleared=AFRAME.utils.bind(this.onIntersectionCleared,this),this.onMouseMove=AFRAME.utils.bind(this.onMouseMove,this)},update:function(t){this.data.rayOrigin!==t.rayOrigin&&this.updateMouseEventListeners()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){var t=this.el;t.removeState("cursor-hovering"),t.removeState("cursor-fusing"),clearTimeout(this.fuseTimeout),this.intersectedEl&&this.intersectedEl.removeState("cursor-hovered"),this.removeEventListeners()},addEventListeners:function(){var t,i=this.data,e=this.el,s=this;function n(){t=e.sceneEl.canvas,i.downEvents.length||i.upEvents.length||(F.DOWN.forEach(function(i){t.addEventListener(i,s.onCursorDown)}),F.UP.forEach(function(i){t.addEventListener(i,s.onCursorUp)}))}(t=e.sceneEl.canvas)?n():e.sceneEl.addEventListener("render-target-loaded",n),i.downEvents.forEach(function(t){e.addEventListener(t,s.onCursorDown)}),i.upEvents.forEach(function(t){e.addEventListener(t,s.onCursorUp)}),e.addEventListener("raycaster-intersection",this.onIntersection),e.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),e.sceneEl.addEventListener("rendererresize",this.updateCanvasBounds),window.addEventListener("resize",this.updateCanvasBounds),window.addEventListener("scroll",this.updateCanvasBounds),this.updateMouseEventListeners()},removeEventListeners:function(){var t,i=this.data,e=this.el,s=this;!(t=e.sceneEl.canvas)||i.downEvents.length||i.upEvents.length||(F.DOWN.forEach(function(i){t.removeEventListener(i,s.onCursorDown)}),F.UP.forEach(function(i){t.removeEventListener(i,s.onCursorUp)})),i.downEvents.forEach(function(t){e.removeEventListener(t,s.onCursorDown)}),i.upEvents.forEach(function(t){e.removeEventListener(t,s.onCursorUp)}),e.removeEventListener("raycaster-intersection",this.onIntersection),e.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),t.removeEventListener("mousemove",this.onMouseMove),t.removeEventListener("touchstart",this.onMouseMove),t.removeEventListener("touchmove",this.onMouseMove),e.sceneEl.removeEventListener("rendererresize",this.updateCanvasBounds),window.removeEventListener("resize",this.updateCanvasBounds),window.removeEventListener("scroll",this.updateCanvasBounds)},updateMouseEventListeners:function(){var t,i=this.el;(t=i.sceneEl.canvas).removeEventListener("mousemove",this.onMouseMove),t.removeEventListener("touchmove",this.onMouseMove),i.setAttribute("raycaster","useWorldCoordinates",!1),"mouse"===this.data.rayOrigin&&(t.addEventListener("mousemove",this.onMouseMove,!1),t.addEventListener("touchmove",this.onMouseMove,!1),i.setAttribute("raycaster","useWorldCoordinates",!0),this.updateCanvasBounds())},onMouseMove:(B=new THREE.Vector3,G=new THREE.Vector2,V=new THREE.Vector3,Z={origin:V,direction:B},function(t){var i,e,s=this.canvasBounds,n=this.el.sceneEl.camera;n.parent.updateMatrixWorld(),e=(i="touchmove"===t.type||"touchstart"===t.type?t.touches.item(0):t).clientY-s.top,G.x=(i.clientX-s.left)/s.width*2-1,G.y=-e/s.height*2+1,V.setFromMatrixPosition(n.matrixWorld),B.set(G.x,G.y,.5).unproject(n).sub(V).normalize(),this.el.setAttribute("raycaster",Z),"touchmove"===t.type&&t.preventDefault()}),onCursorDown:function(t){this.isCursorDown=!0,"mouse"===this.data.rayOrigin&&"touchstart"===t.type&&(this.onMouseMove(t),this.el.components.raycaster.checkIntersections(),t.preventDefault()),this.twoWayEmit("mousedown"),this.cursorDownEl=this.intersectedEl},onCursorUp:function(t){if(this.isCursorDown){this.isCursorDown=!1;var i=this.data;this.twoWayEmit("mouseup"),this.cursorDownEl&&this.cursorDownEl!==this.intersectedEl&&(this.intersectedEventDetail.intersection=null,this.cursorDownEl.emit("mouseup",this.intersectedEventDetail)),i.fuse&&"mouse"!==i.rayOrigin||!this.intersectedEl||this.cursorDownEl!==this.intersectedEl||this.twoWayEmit("click"),this.cursorDownEl=null,"touchend"===t.type&&t.preventDefault()}},onIntersection:function(t){var i,e,s,n;n=t.detail.intersections[e=t.detail.els[0]===this.el?1:0],(s=t.detail.els[e])&&this.intersectedEl!==s&&(this.intersectedEl&&(i=this.el.components.raycaster.getIntersection(this.intersectedEl))&&i.distance<=n.distance||(this.clearCurrentIntersection(!0),this.setIntersection(s,n)))},onIntersectionCleared:function(t){-1!==t.detail.clearedEls.indexOf(this.intersectedEl)&&this.clearCurrentIntersection()},setIntersection:function(t){var i=this.el,e=this.data,s=this;this.intersectedEl!==t&&(this.intersectedEl=t,i.addState("cursor-hovering"),t.addState("cursor-hovered"),this.twoWayEmit("mouseenter"),this.data.mouseCursorStylesEnabled&&"mouse"===this.data.rayOrigin&&this.el.sceneEl.canvas.classList.add("a-mouse-cursor-hover"),0!==e.fuseTimeout&&e.fuse&&(i.addState("cursor-fusing"),this.twoWayEmit("fusing"),this.fuseTimeout=setTimeout(function(){i.removeState("cursor-fusing"),s.twoWayEmit("click")},e.fuseTimeout)))},clearCurrentIntersection:function(t){var i,e,s=this.el;this.intersectedEl&&(this.intersectedEl.removeState("cursor-hovered"),s.removeState("cursor-hovering"),s.removeState("cursor-fusing"),this.twoWayEmit("mouseleave"),this.data.mouseCursorStylesEnabled&&"mouse"===this.data.rayOrigin&&this.el.sceneEl.canvas.classList.remove("a-mouse-cursor-hover"),this.intersectedEl=null,clearTimeout(this.fuseTimeout),!0!==t&&0!==(e=this.el.components.raycaster.intersections).length&&(i=e[e[0].object.el===s?1:0])&&this.setIntersection(i.object.el,i))},twoWayEmit:function(t){var i,e=this.el,s=this.intersectedEl;i=this.el.components.raycaster.getIntersection(s),this.eventDetail.intersectedEl=s,this.eventDetail.intersection=i,e.emit(t,this.eventDetail),s&&(this.intersectedEventDetail.intersection=i,s.emit(t,this.intersectedEventDetail))}}),AFRAME.registerComponent("al-edge",{schema:{selected:{type:"boolean"},node1:{type:"vec3"},node2:{type:"vec3"},length:{type:"number"},radius:{type:"number"},nodeScale:{type:"number"},scale:{type:"number"}},init(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,f.minFrameMS,this),this.bindMethods(),this.addEventListeners(),this.state={selected:!0,hovered:!1}},bindMethods(){this.pointerDown=this.pointerDown.bind(this),this.pointerOver=this.pointerOver.bind(this),this.pointerOut=this.pointerOut.bind(this),this.createMesh=this.createMesh.bind(this),this.getMatrix=this.getMatrix.bind(this)},addEventListeners(){this.el.sceneEl.addEventListener("mousedown",this.pointerDown,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("raycaster-intersected",this.pointerOver,{capture:!0,once:!1,passive:!0}),this.el.addEventListener("raycaster-intersected-cleared",this.pointerOut,{capture:!1,once:!1,passive:!0})},removeEventListeners(){this.el.sceneEl.removeEventListener("mousedown",this.pointerDown),this.el.removeEventListener("raycaster-intersected",this.pointerOver),this.el.removeEventListener("raycaster-intersected-cleared",this.pointerOut)},pointerDown(t){this.state.hovered&&this.el.sceneEl.emit(P.SELECTED,{type:l.EDGE,id:this.el.id},!1)},pointerOver(t){this.state.hovered=!0,this.el.sceneEl.emit(P.POINTER_OVER,{id:this.el.id},!1)},pointerOut(t){this.state.hovered=!1,this.el.sceneEl.emit(P.POINTER_OUT,{},!1)},getMatrix(){const t=R.objectToVector3(this.data.node1),i=R.objectToVector3(this.data.node2),e=new THREE.Matrix4;e.makeScale(this.data.scale,this.data.scale,1);const s=new THREE.Matrix4;s.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1);const n=new THREE.Matrix4;return n.lookAt(t,i,(new THREE.Object3D).up),n.multiply(e),n.multiply(s),n},createMesh(){const t=new THREE.CylinderGeometry(this.data.radius,this.data.radius,this.data.length,6,4),i=new THREE.MeshBasicMaterial,e=new THREE.Mesh(t,i);e.applyMatrix(this.getMatrix()),this.state.geometry=t,this.state.material=i,this.state.mesh=e;const s=new THREE.CylinderGeometry(this.data.radius,this.data.radius,this.data.length-2*this.data.nodeScale,6,4),n=$.getHaloMaterial(),h=new THREE.Mesh(s,n);this.state.outlineGeometry=s,this.state.outlineMaterialt=n,this.state.outlineMesh=h,e.add(h),this.el.setObject3D("mesh",e),this.el.object3D.renderOrder=f.topLayerRenderOrder-2},update(t){this.state.selected=this.data.selected,!t||t.radius===this.data.radius&&t.length===this.data.length&&t.scale===this.data.scale||this.createMesh()},tickFunction(){const t=this.el,i=this.state;i.material.color=i.hovered?new THREE.Color(f.buttonColors.hover):i.selected?new THREE.Color(f.buttonColors.active):new THREE.Color(f.buttonColors.up);const e=t.firstChild;if(e){e.object3D.visible=!!i.hovered}},tick(){this.tickFunction()},remove(){this.removeEventListeners(),this.el.removeObject3D("mesh")}}),AFRAME.registerComponent("al-fixed-to-orbit-camera",{schema:{distanceFromTarget:{type:"number",default:.1},target:{type:"vec3"}},init(){if(this.tickFunction=AFRAME.utils.throttle(this.tickFunction,f.minFrameMS/2,this),this.data.target){const t=R.objectToVector3(this.data.target);this.state={distanceFromTarget:this.data.distanceFromTarget,target:t}}else this.state={distanceFromTarget:this.data.distanceFromTarget,target:new THREE.Vector3(0,0,0)};this.bindMethods(),this.addEventListeners()},bindMethods(){},addEventListeners(){},removeEventListeners(){},update(){const t=R.objectToVector3(this.data.target);this.state={distanceFromTarget:this.data.distanceFromTarget,target:t}},tickFunction(){const t=this.el,i=this.state,e=t.sceneEl.camera.position,s=i.target.clone().sub(e.clone()).normalize();t.object3D.position.copy(s.multiplyScalar(i.distanceFromTarget)),t.object3D.lookAt(e)},tick(){this.tickFunction()},remove(){this.removeEventListeners()}});class X{}X.LOADED="al-model-loaded",X.ERROR="al-model-error",AFRAME.registerComponent("al-gltf-model",{schema:{src:{type:"model",default:""},dracoDecoderPath:{type:"string",default:""}},init(){this.bindMethods(),this.addEventListeners(),this.model=null;const t=THREE;this.loader=new t.GLTFLoader,t.DRACOLoader.setDecoderPath(this.data.dracoDecoderPath),this.loader.setDRACOLoader(new t.DRACOLoader)},bindMethods(){},addEventListeners(){},removeEventListeners(){},update(t){const i=this,e=this.el,s=this.data.src;t&&t.src!==s&&(this.remove(),this.loader.load(s,function(t){i.model=t.scene||t.scenes[0],i.model.animations=t.animations,e.setObject3D("mesh",i.model),e.sceneEl.emit(X.LOADED,{format:"gltf",model:i.model},!1)},void 0,function(t){console.warn(t&&t.message?t.message:"Failed to load glTF model"),e.sceneEl.emit(X.ERROR,{format:"gltf",src:s},!1)}))},remove(){this.model&&(this.removeEventListeners(),this.el.removeObject3D("mesh"))}}),AFRAME.registerComponent("al-node",{schema:{scale:{type:"number",default:1},selected:{type:"boolean"},graphEnabled:{type:"boolean"}},init(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,f.minFrameMS,this),this.bindMethods(),this.addEventListeners();const t=this.data,i=this.el,e=i.sceneEl.camera.el.object3DMap.camera,s=new THREE.SphereGeometry(t.scale,16,16),n=new THREE.MeshBasicMaterial,h=new THREE.Mesh(s,n),o=new THREE.SphereGeometry(t.scale,16,16),a=$.getHaloMaterial(),r=new THREE.Mesh(o,a);h.add(r),i.setObject3D("mesh",h),i.object3D.renderOrder=f.topLayerRenderOrder-1,this.state={selected:!0,hovered:!1,geometry:s,material:n,mesh:h,outlineGeometry:o,outlineMaterial:a,outlineMesh:r,camera:e,dragging:!1}},bindMethods(){this.pointerDown=this.pointerDown.bind(this),this.pointerUp=this.pointerUp.bind(this),this.pointerOver=this.pointerOver.bind(this),this.pointerOut=this.pointerOut.bind(this)},addEventListeners(){this.el.sceneEl.addEventListener("mousedown",this.pointerDown,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("mouseup",this.pointerUp,{capture:!1,once:!1,passive:!0}),this.el.sceneEl.addEventListener("mouseup",this.pointerUp,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("raycaster-intersected",this.pointerOver,{capture:!0,once:!1,passive:!0}),this.el.addEventListener("raycaster-intersected-cleared",this.pointerOut,{capture:!1,once:!1,passive:!0})},removeEventListeners(){this.el.sceneEl.removeEventListener("mousedown",this.pointerDown),this.el.sceneEl.removeEventListener("mouseup",this.pointerUp),this.el.removeEventListener("mouseup",this.pointerUp),this.el.removeEventListener("raycaster-intersected",this.pointerOver),this.el.removeEventListener("raycaster-intersected-cleared",this.pointerOut)},pointerDown(t){this.state.hovered&&(this.el.sceneEl.emit(P.SELECTED,{type:l.NODE,id:this.el.id},!0),this.data.graphEnabled)&&(this.state.mouseDown=!0,this.el.sceneEl.emit(P.POINTER_DOWN,{},!0))},pointerUp(t){const i=this.state;this.data.graphEnabled&&(i.dragging=!1,i.mouseDown=!1,this.el.sceneEl.emit(P.POINTER_UP,{},!0))},pointerOver(t){this.state.hovered=!0,this.el.sceneEl.emit(P.POINTER_OVER,{id:this.el.id},!0)},pointerOut(t){const i=this.state;i.hovered=!1,i.mouseDown&&i.selected&&(i.dragging=!0),this.el.sceneEl.emit(P.POINTER_OUT,{},!0)},update(){this.state.selected=this.data.selected},tickFunction(){const t=this.el,i=this.state;this.data.graphEnabled&&i.dragging&&this.el.sceneEl.emit(P.DRAGGED,{id:this.el.id},!0),i.material.color=i.hovered||i.dragging?new THREE.Color(f.buttonColors.hover):i.selected?new THREE.Color(f.buttonColors.active):new THREE.Color(f.buttonColors.up);const e=t.firstChild;if(e){e.object3D.visible=!(!i.hovered&&!i.dragging)}},tick(){this.tickFunction()},remove(){this.removeEventListeners(),this.el.removeObject3D("mesh")}});class J{}J.VALID_TARGET="al-valid-target",J.ADD_NODE="al-add-node",AFRAME.registerComponent("al-node-spawner",{schema:{graphEnabled:{type:"boolean"}},init(){this.bindMethods(),this.addEventListeners(),this.state={left:!1,intersecting:!1}},bindMethods(){this.canvasMouseDown=this.canvasMouseDown.bind(this),this.pointerOver=this.pointerOver.bind(this),this.pointerOut=this.pointerOut.bind(this),this.elClick=this.elClick.bind(this),this.canvasMouseUp=this.canvasMouseUp.bind(this),this.pointerDown=this.pointerDown.bind(this),this.pointerUp=this.pointerUp.bind(this)},addEventListeners(){this.el.sceneEl.canvas.addEventListener("mousedown",this.canvasMouseDown,{capture:!1,once:!1,passive:!0}),this.el.sceneEl.canvas.addEventListener("mouseup",this.canvasMouseUp,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("raycaster-intersected",this.pointerOver,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("raycaster-intersected-cleared",this.pointerOut,!1),this.el.addEventListener("click",this.elClick,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("mousedown",this.pointerDown,{capture:!1,once:!1,passive:!0}),this.el.addEventListener("mouseup",this.pointerUp,{capture:!1,once:!1,passive:!0})},removeEventListeners(){this.el.sceneEl.canvas.removeEventListener("mousedown",this.canvasMouseDown),this.el.sceneEl.canvas.removeEventListener("mouseup",this.canvasMouseUp),this.el.removeEventListener("raycaster-intersected",this.pointerOver),this.el.removeEventListener("raycaster-intersected-cleared",this.pointerOut),this.el.removeEventListener("click",this.elClick),this.el.removeEventListener("mousedown",this.pointerDown),this.el.removeEventListener("mouseup",this.pointerUp)},canvasMouseDown(t){this.state.left=0===t.button},canvasMouseUp(t){R.waitOneFrame(()=>{this.state.left=!1})},pointerOver(t){this.state.intersecting=!0,this.el.sceneEl.emit(J.VALID_TARGET,{valid:!0},!1)},pointerOut(t){this.state.intersecting=!1,this.el.sceneEl.emit(J.VALID_TARGET,{valid:!1},!1)},pointerDown(t){this.data.graphEnabled&&this.el.sceneEl.emit(P.POINTER_DOWN,{},!1)},pointerUp(t){this.data.graphEnabled&&this.el.sceneEl.emit(P.POINTER_UP,{},!1)},elClick(t){this.state.left&&this.data.graphEnabled&&this.el.sceneEl.emit(J.ADD_NODE,{aframeEvent:t},!1)},remove(){this.removeEventListeners()}});class K{}K.INTERACTION="al-control-interaction",K.INTERACTION_FINISHED="al-control-interaction-finished",K.ANIMATION_STARTED="al-controls-animation-started",K.ANIMATION_FINISHED="al-controls-animation-finished",AFRAME.registerComponent("al-orbit-control",{dependencies:["camera"],schema:{animating:{type:"boolean",default:!1},autoRotate:{type:"boolean"},autoRotateSpeed:{default:2},controlPosition:{type:"vec3"},controlTarget:{type:"vec3"},dampingFactor:{default:.1},enabled:{default:!0},enableDamping:{default:!0},enableKeys:{default:!0},enablePan:{default:!0},enableRotate:{default:!0},enableZoom:{default:!0},keyPanSpeed:{default:7},maxAzimuthAngle:{type:"number",default:1/0},maxDistance:{default:8e3},maxPolarAngle:{default:88},minAzimuthAngle:{type:"number",default:-1/0},minDistance:{default:1},minPolarAngle:{default:0},rotateSpeed:{default:.05},screenSpacePanning:{default:!1},zoomSpeed:{type:"number",default:.5}},bindMethods(){this.mouseDown=this.mouseDown.bind(this),this.mouseMove=this.mouseMove.bind(this),this.mouseUp=this.mouseUp.bind(this),this.canvasWheel=this.canvasWheel.bind(this),this.getCameraState=this.getCameraState.bind(this),this.handleAnimationCache=this.handleAnimationCache.bind(this),this.onWheel=this.onWheel.bind(this)},addListeners(){window.addEventListener("mouseup",this.mouseUp,{capture:!1,once:!1,passive:!0}),window.addEventListener("mousemove",this.mouseMove,{capture:!1,once:!1,passive:!0}),this.el.sceneEl.canvas.addEventListener("mousedown",this.mouseDown,{capture:!1,once:!1,passive:!0}),this.el.sceneEl.canvas.addEventListener("wheel",this.canvasWheel,{capture:!1,once:!1,passive:!0}),this.el.sceneEl.addEventListener(K.ANIMATION_STARTED,this.handleAnimationCache,!1)},removeListeners(){window.removeEventListener("mouseup",this.mouseUp),window.removeEventListener("mousemove",this.mouseMove),this.el.sceneEl.canvas.removeEventListener("mousedown",this.mouseDown),this.el.sceneEl.canvas.removeEventListener("wheel",this.canvasWheel),this.el.sceneEl.removeEventListener(K.ANIMATION_STARTED,this.handleAnimationCache,!1)},handleAnimationCache(t){this.state.animationCache=t.detail.slerpPath},mouseUp(t){this.state.mouseDown=!1,document.body.style.cursor="grab",this.state.controls.enabled&&this.el.sceneEl.emit(K.INTERACTION_FINISHED,{cameraState:this.getCameraState()},!1)},mouseDown(t){this.state.mouseDown=!0,document.body.style.cursor="grabbing"},mouseMove(t){this.state.mouseDown&&this.el.sceneEl.emit(K.INTERACTION,{cameraState:this.getCameraState()},!1)},onWheel(){const t=this.state;t.wheelMarker=!1,t.wheelCounter2=t.wheelCounter1,setTimeout(()=>{t.wheelCounter2===t.wheelCounter1?(t.wheelMarker=!0,t.wheelCounter1=0,t.wheelCounter2=0,this.el.sceneEl.emit(K.INTERACTION_FINISHED,{cameraState:this.getCameraState()},!1)):this.onWheel()},t.wheelInterval)},canvasWheel(t){const i=this.state;i.wheelCounter1+=1,i.wheelMarker&&this.onWheel(),this.el.sceneEl.emit(K.INTERACTION,{cameraState:this.getCameraState()},!1)},init(){const t=this.el,i=this.data;document.body.style.cursor="grab",this.tickFunction=AFRAME.utils.throttle(this.tickFunction,f.minFrameMS,this);const e=new THREE.OrbitControls(t.getObject3D("camera"),t.sceneEl.renderer.domElement),s=R.objectToVector3(i.controlPosition),n=R.objectToVector3(i.controlTarget);e.object.position.copy(s),t.getObject3D("camera").position.copy(s),e.target.copy(n),this.state={animationCache:[],controls:e,mouseDown:!1,wheelCounter1:0,wheelCounter2:void 0,wheelInterval:50,wheelMarker:!0},this.bindMethods(),this.addListeners(),R.waitOneFrame(()=>{this.el.sceneEl.emit(K.INTERACTION,{cameraState:this.getCameraState()},!1)})},getCameraState(){return{position:this.state.controls.object.position,target:this.state.controls.target}},update(t){const i=this.state.controls,e=this.data;i.target=R.objectToVector3(e.controlTarget),i.autoRotate=e.autoRotate,i.autoRotateSpeed=e.autoRotateSpeed,i.dampingFactor=e.dampingFactor,i.enabled=e.enabled,i.enableDamping=e.enableDamping,i.enableKeys=e.enableKeys,i.enablePan=e.enablePan,i.enableRotate=e.enableRotate,i.enableZoom=e.enableZoom,i.keyPanSpeed=e.keyPanSpeed,i.maxPolarAngle=THREE.Math.degToRad(e.maxPolarAngle),i.maxAzimuthAngle=THREE.Math.degToRad(e.maxAzimuthAngle),i.maxDistance=e.maxDistance,i.minDistance=e.minDistance,i.minPolarAngle=THREE.Math.degToRad(e.minPolarAngle),i.minAzimuthAngle=THREE.Math.degToRad(e.minAzimuthAngle),i.rotateSpeed=e.rotateSpeed,i.screenSpacePanning=e.screenSpacePanning,i.zoomSpeed=e.zoomSpeed,this.el.getObject3D("camera").position.copy(R.objectToVector3(e.controlPosition))},tickFunction(){const t=this.state.controls;if(t.enabled){if(this.data.animating){const i=this.state.animationCache.shift();i&&i.position&&i.target&&(t.object.position.copy(i.position),this.el.getObject3D("camera").position.copy(i.position),t.target.copy(i.target),this.el.sceneEl.emit(K.INTERACTION,{cameraState:this.getCameraState()},!1)),0===this.state.animationCache.length&&(this.el.sceneEl.emit(K.ANIMATION_FINISHED,{},!1),this.el.sceneEl.emit(K.INTERACTION_FINISHED,{cameraState:this.getCameraState()},!1))}t.enabled&&(t.enableDamping||t.autoRotate)&&t.update()}},tick(){this.tickFunction()},remove(){this.removeListeners();let t=this.state;t.controls.dispose(),t=null}}),AFRAME.registerComponent("al-render-order",{schema:{order:{type:"number",default:f.topLayerRenderOrder}},init(){this.bindMethods(),this.addEventListeners(),Object.keys(this.el.object3DMap).forEach(t=>{this.el.object3DMap[t].renderOrder=this.data.order})},bindMethods(){},addEventListeners(){},removeEventListeners(){},update(){Object.keys(this.el.object3DMap).forEach(t=>{this.el.object3DMap[t].renderOrder=this.data.order})},remove(){this.removeEventListeners()}}),AFRAME.registerComponent("al-render-overlaid",{schema:{},init(t){this.bindMethods(),this.addEventListeners(),this.setDepth(this.el.object3DMap.mesh),this.setDepth(this.el.object3DMap.text)},bindMethods(){},addEventListeners(){},removeEventListeners(){},setDepth(t){t&&(t.renderOrder=f.topLayerRenderOrder,t.material&&(t.material.depthTest=!1))},remove(){this.removeEventListeners()}});const q={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},tt={ROTATE:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};class it extends THREE.EventDispatcher{constructor(t,i){super(),this.screen={left:0,top:0,width:0,height:0},this._changeEvent={type:"change"},this._startEvent={type:"start"},this._endEvent={type:"end"},this.object=t,this.domElement=void 0!==i?i:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.target=new THREE.Vector3,this.EPS=1e-6,this._lastPosition=new THREE.Vector3,this._state=q.NONE,this._eye=new THREE.Vector3,this._movePrev=new THREE.Vector2,this._moveCurr=new THREE.Vector2,this._lastAxis=new THREE.Vector3,this._lastAngle=0,this._zoomStart=new THREE.Vector2,this._zoomEnd=new THREE.Vector2,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._panStart=new THREE.Vector2,this._panEnd=new THREE.Vector2,this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._bindMethods(),this._addListeners(),this.update()}get up0(){return this._up0.clone()}_bindMethods(){this._mouseDown=this._mouseDown.bind(this),this._mouseMove=this._mouseMove.bind(this),this._mouseUp=this._mouseUp.bind(this),this._mouseWheel=this._mouseWheel.bind(this),this._touchStart=this._touchStart.bind(this),this._touchEnd=this._touchEnd.bind(this),this._touchMove=this._touchMove.bind(this),this._resize=this._resize.bind(this)}_addListeners(){this.domElement.addEventListener("mousedown",this._mouseDown,{capture:!1,once:!1,passive:!0}),window.addEventListener("mousemove",this._mouseMove,{capture:!1,once:!1,passive:!0}),window.addEventListener("mouseup",this._mouseUp,{capture:!1,once:!1,passive:!0}),this.domElement.addEventListener("wheel",this._mouseWheel,{capture:!1,once:!1,passive:!0}),this.domElement.addEventListener("touchstart",this._touchStart,{capture:!1,once:!1,passive:!0}),window.addEventListener("touchend",this._touchEnd,{capture:!1,once:!1,passive:!0}),window.addEventListener("touchmove",this._touchMove,{capture:!1,once:!1,passive:!0})}_mouseDown(t){if(!1!==this.enabled){if(this._state===q.NONE)switch(t.button){case tt.ROTATE:this._state=q.ROTATE,this.noRotate||(this._moveCurr.copy(this._getMouseOnCircle(t.pageX,t.pageY)),this._movePrev.copy(this._moveCurr));break;case tt.ZOOM:this._state=q.ZOOM,this.noZoom||(this._zoomStart.copy(this._getMouseOnScreen(t.pageX,t.pageY)),this._zoomEnd.copy(this._zoomStart));break;case tt.PAN:this._state=q.PAN,this.noPan||(this._panStart.copy(this._getMouseOnScreen(t.pageX,t.pageY)),this._panEnd.copy(this._panStart));break;default:this._state=q.NONE}this.dispatchEvent(this._startEvent),this.update()}}_mouseMove(t){!1!==this.enabled&&(this._state!==q.ROTATE||this.noRotate?this._state!==q.ZOOM||this.noZoom?this._state!==q.PAN||this.noPan||this._panEnd.copy(this._getMouseOnScreen(t.pageX,t.pageY)):this._zoomEnd.copy(this._getMouseOnScreen(t.pageX,t.pageY)):(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(t.pageX,t.pageY))),this.update())}_mouseUp(t){!1!==this.enabled&&(this._state=q.NONE,this.dispatchEvent(this._endEvent),this.update())}_mouseWheel(t){if(!1!==this.enabled&&!0!==this.noZoom){switch(t.deltaMode){case 2:this._zoomStart.y-=.025*t.deltaY;break;case 1:this._zoomStart.y-=.01*t.deltaY;break;default:this._zoomStart.y-=25e-5*t.deltaY}this.dispatchEvent(this._startEvent),this.dispatchEvent(this._endEvent),this.update()}}_touchStart(t){if(!1!==this.enabled){switch(t.touches.length){case 1:this._state=q.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(t.touches[0].pageX,t.touches[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this._state=q.TOUCH_ZOOM_PAN;const i=t.touches[0].pageX-t.touches[1].pageX,e=t.touches[0].pageY-t.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(i*i+e*e),this._panStart.copy(this._getMouseOnScreen((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2)),this._panEnd.copy(this._panStart)}this.dispatchEvent(this._startEvent),this.update()}}_touchEnd(t){if(!1!==this.enabled){switch(t.touches.length){case 0:this._state=q.NONE;break;case 1:this._state=q.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(t.touches[0].pageX,t.touches[0].pageY)),this._movePrev.copy(this._moveCurr)}this.dispatchEvent(this._endEvent),this.update()}}_touchMove(t){if(!1!==this.enabled){switch(t.touches.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(t.touches[0].pageX,t.touches[0].pageY));break;default:const i=t.touches[0].pageX-t.touches[1].pageX,e=t.touches[0].pageY-t.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(i*i+e*e),this._panEnd.copy(this._getMouseOnScreen((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2))}this.update()}}_resize(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{const t=this.domElement.getBoundingClientRect(),i=this.domElement.ownerDocument.documentElement;this.screen.left=t.left+window.pageXOffset-i.clientLeft,this.screen.top=t.top+window.pageYOffset-i.clientTop,this.screen.width=t.width,this.screen.height=t.height}}_getMouseOnScreen(t,i){const e=new THREE.Vector2;return e.set((t-this.screen.left)/this.screen.width,(i-this.screen.top)/this.screen.height),e}_getMouseOnCircle(t,i){const e=new THREE.Vector2;return e.set((t-.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(this.screen.height+2*(this.screen.top-i))/this.screen.width),e}_rotateCamera(){const t=new THREE.Vector3,i=new THREE.Quaternion,e=new THREE.Vector3,s=new THREE.Vector3,n=new THREE.Vector3,h=new THREE.Vector3;let o;h.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0),(o=h.length())?(this._eye.copy(this.object.position).sub(this.target),e.copy(this._eye).normalize(),s.copy(this.object.up).normalize(),n.crossVectors(s,e).normalize(),s.setLength(this._moveCurr.y-this._movePrev.y),n.setLength(this._moveCurr.x-this._movePrev.x),h.copy(s.add(n)),t.crossVectors(h,this._eye).normalize(),i.setFromAxisAngle(t,o*=this.rotateSpeed),this._eye.applyQuaternion(i),this.object.up.applyQuaternion(i),this._lastAxis.copy(t),this._lastAngle=o):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),i.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(i),this.object.up.applyQuaternion(i)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let t;this._state===q.TOUCH_ZOOM_PAN?(t=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this._eye.multiplyScalar(t)):(1!=(t=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed)&&t>0&&this._eye.multiplyScalar(t),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_panCamera(){const t=new THREE.Vector2,i=new THREE.Vector3,e=new THREE.Vector3;t.copy(this._panEnd).sub(this._panStart),t.lengthSq()&&(t.multiplyScalar(this._eye.length()*this.panSpeed),e.copy(this._eye).cross(this.object.up).setLength(t.x),e.add(i.copy(this.object.up).setLength(t.y)),this.object.position.add(e),this.target.add(e),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(t.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor)))}_checkDistances(){this.noZoom&&this.noPan||(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>this.EPS&&(this.dispatchEvent(this._changeEvent),this._lastPosition.copy(this.object.position))}reset(){this._state=q.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(this._changeEvent),this._lastPosition.copy(this.object.position)}dispose(){this._removeListeners()}_removeListeners(){this.domElement.removeEventListener("mousedown",this._mouseDown,!1),window.removeEventListener("mousemove",this._mouseMove,!1),window.removeEventListener("mouseup",this._mouseUp,!1),this.domElement.removeEventListener("wheel",this._mouseWheel,!1),this.domElement.removeEventListener("touchstart",this._touchStart,!1),window.removeEventListener("touchend",this._touchEnd,!1),window.removeEventListener("touchmove",this._touchMove,!1)}}AFRAME.registerComponent("al-trackball-control",{dependencies:["camera"],schema:{animating:{type:"boolean",default:!1},controlPosition:{type:"vec3"},controlTarget:{type:"vec3"},dynamicDampingFactor:{default:.1},enabled:{type:"boolean",default:!0},maxDistance:{type:"number",default:8e3},minDistance:{type:"number",default:0},noPan:{type:"boolean",default:!1},noRotate:{type:"boolean",default:!1},noZoom:{type:"boolean",default:!1},panSpeed:{type:"number",default:.3},rotateSpeed:{type:"number",default:1},screenHeight:{type:"number",default:0},screenLeft:{type:"number",default:0},screenTop:{type:"number",default:0},screenWidth:{type:"number",default:0},staticMoving:{type:"boolean",default:!0},zoomSpeed:{type:"number",default:.5}},bindMethods(){this.mouseDown=this.mouseDown.bind(this),this.mouseMove=this.mouseMove.bind(this),this.mouseUp=this.mouseUp.bind(this),this.canvasWheel=this.canvasWheel.bind(this),this.getCameraState=this.getCameraState.bind(this),this.handleAnimationCache=this.handleAnimationCache.bind(this),this.onWheel=this.onWheel.bind(this)},addListeners(){window.addEventListener("mouseup",this.mouseUp,{capture:!1,once:!1,passive:!0}),window.addEventListener("mousemove",this.mouseMove,{capture:!1,once:!1,passive:!0}),this.el.sceneEl.canvas.addEventListener("mousedown",this.mouseDown,{capture:!1,once:!1,passive:!0}),this.el.sceneEl.canvas.addEventListener("wheel",this.canvasWheel,{capture:!1,once:!1,passive:!0}),this.el.sceneEl.addEventListener(K.ANIMATION_STARTED,this.handleAnimationCache,!1)},removeListeners(){window.removeEventListener("mouseup",this.mouseUp),window.removeEventListener("mousemove",this.mouseMove),this.el.sceneEl.canvas.removeEventListener("mousedown",this.mouseDown),this.el.sceneEl.canvas.removeEventListener("wheel",this.canvasWheel),this.el.sceneEl.removeEventListener(K.ANIMATION_STARTED,this.handleAnimationCache,!1)},handleAnimationCache(t){this.state.animationCache=t.detail.slerpPath;const i=this.el.getObject3D("camera");this.state.cameraAnimationCache=R.getSlerp3Path(i.up.clone(),this.state.controls.up0)},mouseUp(t){this.state.mouseDown=!1,document.body.style.cursor="grab",this.state.controls.enabled&&this.el.sceneEl.emit(K.INTERACTION_FINISHED,{cameraState:this.getCameraState()},!1)},mouseDown(t){this.state.mouseDown=!0,document.body.style.cursor="grabbing"},mouseMove(t){this.state.mouseDown&&this.el.sceneEl.emit(K.INTERACTION,{cameraState:this.getCameraState()},!1)},onWheel(){const t=this.state;t.wheelMarker=!1,t.wheelCounter2=t.wheelCounter1,setTimeout(()=>{t.wheelCounter2===t.wheelCounter1?(t.wheelMarker=!0,t.wheelCounter1=0,t.wheelCounter2=0,this.el.sceneEl.emit(K.INTERACTION_FINISHED,{cameraState:this.getCameraState()},!1)):this.onWheel()},t.wheelInterval)},canvasWheel(t){const i=this.state;i.wheelCounter1+=1,i.wheelMarker&&this.onWheel(),this.el.sceneEl.emit(K.INTERACTION,{cameraState:this.getCameraState()},!1)},init(){const t=this.el,i=this.data;document.body.style.cursor="grab",this.tickFunction=AFRAME.utils.throttle(this.tickFunction,f.minFrameMS,this);const e=new it(t.getObject3D("camera"),t.sceneEl.renderer.domElement),s=R.objectToVector3(i.controlPosition),n=R.objectToVector3(i.controlTarget);e.object.position.copy(s),t.getObject3D("camera").position.copy(s),e.target.copy(n),this.state={animationCache:[],cameraAnimationCache:null,controls:e,mouseDown:!1,wheelCounter1:0,wheelCounter2:void 0,wheelInterval:50,wheelMarker:!0},this.bindMethods(),this.addListeners(),R.waitOneFrame(()=>{this.el.sceneEl.emit(K.INTERACTION,{cameraState:this.getCameraState()},!1)})},getCameraState(){return{position:this.state.controls.object.position,target:this.state.controls.target}},update(t){const i=this.state.controls,e=this.data;i.target=R.objectToVector3(e.controlTarget),i.dynamicDampingFactor=e.dynamicDampingFactor,i.enabled=e.enabled,i.maxDistance=e.maxDistance,i.minDistance=e.minDistance,i.noPan=e.noPan,i.noRotate=e.noRotate,i.noZoom=e.noZoom,i.panSpeed=e.panSpeed,i.rotateSpeed=e.rotateSpeed,i.screen.height=e.screenHeight,i.screen.left=e.screenLeft,i.screen.top=e.screenTop,i.screen.width=e.screenWidth,i.staticMoving=e.screenHeight,i.zoomSpeed=e.zoomSpeed,this.el.getObject3D("camera").position.copy(R.objectToVector3(e.controlPosition))},tickFunction(){const t=this.state.controls;if(t.enabled){if(this.data.animating){const i=this.state.animationCache.shift(),e=this.state.cameraAnimationCache.shift();if(i&&i.position&&i.target){const s=this.el.getObject3D("camera");t.object.position.copy(i.position),s.position.copy(i.position),e&&s.up.copy(e),t.target.copy(i.target),this.el.sceneEl.emit(K.INTERACTION,{cameraState:this.getCameraState()},!1)}0===this.state.animationCache.length&&(this.el.sceneEl.emit(K.ANIMATION_FINISHED,{},!1),this.el.sceneEl.emit(K.INTERACTION_FINISHED,{cameraState:this.getCameraState()},!1))}t.enabled&&t.update()}},tick(){this.tickFunction()},remove(){this.removeListeners();let t=this.state;t.controls.dispose(),t=null}});class et{load(t,i){return new Promise((e,s)=>{const n=new XMLHttpRequest;n.open("GET",t,!0),n.onload=()=>{let t=JSON.parse(n.responseText);t=this._mapfiles(t.baseurl,t.series);const h=new AMI.VolumeLoader(i);h.load(t).then(()=>{const t=h.data[0].mergeSeries(h.data)[0].stack[0];h.free(),e(t)}).catch(t=>{console.log("Volume load error"),s(t)})},n.onerror=t=>{s(t)},n.send()})}_mapfiles(t,i){return i.map(i=>(t.endsWith("/")||(t+="/"),`${t}${i}`))}}class st{}var nt;st.LOADED="al-volume-loaded",st.ERROR="al-volume-error",st.RENDER_LOW="al-volume-render-low",st.RENDER_FULL="al-volume-render-full",AFRAME.registerComponent("al-volume",{schema:{displayMode:{type:"string"},isWebGl2:{type:"boolean"},slicesIndex:{type:"number"},slicesOrientation:{type:"string"},slicesWindowCenter:{type:"number"},slicesWindowWidth:{type:"number"},src:{type:"string"},srcLoaded:{type:"boolean"},volumeSteps:{type:"number"},volumeWindowCenter:{type:"number"},volumeWindowWidth:{type:"number"}},init(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,f.minFrameMS,this),this.loader=new et,this.state={bufferScene:new THREE.Scene,bufferSceneTextureHeight:this.el.sceneEl.canvas.clientHeight,bufferSceneTextureWidth:this.el.sceneEl.canvas.clientWidth},this.bindMethods(),this.addEventListeners(),this.createBufferTexture(),this.debouncedRenderBufferScene=Y.debounce(this.renderBufferScene,f.minFrameMS).bind(this)},bindMethods(){this.addEventListeners=this.addEventListeners.bind(this),this.handleStack=this.handleStack.bind(this),this.onInteraction=this.onInteraction.bind(this),this.onInteractionFinished=this.onInteractionFinished.bind(this),this.removeEventListeners=this.removeEventListeners.bind(this),this.renderBufferScene=this.renderBufferScene.bind(this),this.rendererResize=this.rendererResize.bind(this),this.createBufferTexture=this.createBufferTexture.bind(this)},addEventListeners(){this.el.sceneEl.addEventListener("rendererresize",this.rendererResize,!1),this.el.sceneEl.addEventListener(K.INTERACTION,this.onInteraction,!1),this.el.sceneEl.addEventListener(K.INTERACTION_FINISHED,this.onInteractionFinished,!1)},removeEventListeners(){this.el.sceneEl.removeEventListener("rendererresize",this.rendererResize),this.el.sceneEl.removeEventListener(K.INTERACTION,this.onInteraction),this.el.sceneEl.removeEventListener(K.INTERACTION_FINISHED,this.onInteractionFinished)},createBufferTexture(){this.state.bufferSceneTexture=new THREE.WebGLRenderTarget(this.state.bufferSceneTextureWidth,this.state.bufferSceneTextureHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter}),this.el.sceneEl.object3D.background=this.state.bufferSceneTexture.texture},onInteraction(t){this.state.stackhelper&&(this.state.stackhelper.steps=2,this.renderBufferScene())},onInteractionFinished(t){this.state.stackhelper&&(this.state.stackhelper.steps=this.data.volumeSteps,this.debouncedRenderBufferScene())},rendererResize(){const t=this.state;(t.bufferSceneTextureWidth!==this.el.sceneEl.canvas.clientWidth||t.bufferSceneTextureHeight!==this.el.sceneEl.canvas.clientHeight)&&this.data.displayMode===d.VOLUME&&(t.bufferSceneTextureWidth=this.el.sceneEl.canvas.clientWidth,t.bufferSceneTextureHeight=this.el.sceneEl.canvas.clientHeight,this.createBufferTexture(),this.renderBufferScene())},renderBufferScene(){this.data.displayMode===d.VOLUME&&this.el.sceneEl.renderer.render(this.state.bufferScene,this.el.sceneEl.camera,this.state.bufferSceneTexture)},handleStack(t){const i=this.state,e=this.el;switch(i.stack=t,this.data.displayMode){case d.SLICES:i.stackhelper=new AMI.StackHelper(i.stack),i.stackhelper.bbox.visible=!1,i.stackhelper.border.color=f.colorValues.blue;break;case d.VOLUME:{const t=e.sceneEl.parentEl.querySelector("#lut-canvases");i.lutHelper=new AMI.LutHelper(t),i.lutHelper.luts=AMI.LutHelper.presetLuts(),i.lutHelper.lutsO=AMI.LutHelper.presetLutsO(),i.stackhelper=new AMI.VolumeRenderHelper(i.stack),i.stackhelper.textureLUT=i.lutHelper.texture;break}}e.object3DMap.mesh&&e.removeObject3D("mesh"),this.data.displayMode===d.SLICES?e.setObject3D("mesh",this.state.stackhelper):(this.state.bufferScene.children.length&&this.state.bufferScene.remove(this.state.bufferScene.children[0]),this.state.bufferScene.add(this.state.stackhelper)),e.sceneEl.emit(st.LOADED,i.stackhelper,!1)},update(t){const i=this.state;this.data.src&&(t&&t.src!==this.data.src?this.loader.load(this.data.src,this.el).then(t=>{this.handleStack(t)}):t&&t.displayMode!==this.data.displayMode&&i.stack&&(this.removeEventListeners(),this.handleStack(i.stack),this.addEventListeners(),this.data.displayMode===d.VOLUME?(this.createBufferTexture(),setTimeout(()=>{this.renderBufferScene()},250)):this.el.sceneEl.object3D.background=null))},tickFunction(){if(this.state.stackhelper)switch(this.data.displayMode){case d.SLICES:this.el.setObject3D("mesh",this.state.stackhelper)}},tick(){this.tickFunction()},remove(){this.el.removeObject3D("mesh"),this.removeEventListeners(),this.el.sceneEl.object3D.background=null}}),function(t){t.NULL="NULL",t.ERROR="ERROR",t.APP_CLEAR_ANGLES="APP_LOAD_ANGLES",t.APP_CLEAR_EDGES="APP_LOAD_EDGES",t.APP_CLEAR_NODES="APP_LOAD_NODES",t.APP_DELETE_ANGLE="APP_DELETE_ANGLE",t.APP_DELETE_EDGE="APP_DELETE_EDGE",t.APP_DELETE_NODE="APP_DELETE_NODE",t.APP_SELECT_ANGLE="APP_SELECT_ANGLE",t.APP_SELECT_EDGE="APP_SELECT_EDGE",t.APP_SELECT_NODE="APP_SELECT_NODE",t.APP_SET_ANGLE="APP_SET_ANGLE",t.APP_SET_BOUNDINGBOX_VISIBLE="APP_SET_BOUNDINGBOX_VISIBLE",t.APP_SET_CAMERA="APP_SET_CAMERA",t.APP_SET_CONTROLS_ENABLED="APP_SET_CONTROLS_ENABLED",t.APP_SET_CONTROLS_TYPE="APP_SET_CONTROLS_TYPE",t.APP_SET_DISPLAY_MODE="APP_SET_DISPLAY_MODE",t.APP_SET_EDGE="APP_SET_EDGE",t.APP_SET_MATERIAL="APP_SET_MATERIAL",t.APP_SET_NODE="APP_SET_NODE",t.APP_SET_NODES_ENABLED="APP_SET_NODES_ENABLED",t.APP_SET_ORIENTATION="APP_SET_ORIENTATION",t.APP_SET_SLICES_INDEX="APP_SET_SLICES_INDEX",t.APP_SET_SLICES_WINDOW_CENTER="APP_SET_SLICES_WINDOW_CENTER",t.APP_SET_SLICES_WINDOW_WIDTH="APP_SET_SLICES_WINDOW_WIDTH",t.APP_SET_SRC="APP_SET_SRC",t.APP_SET_SRC_LOADED="APP_SET_SRC_LOADED",t.APP_SET_UNITS="APP_SET_UNITS",t.APP_SET_VOLUME_STEPS="APP_SET_VOLUME_STEPS",t.APP_SET_VOLUME_WINDOW_CENTER="APP_SET_VOLUME_WINDOW_CENTER",t.APP_SET_VOLUME_WINDOW_WIDTH="APP_SET_VOLUME_WINDOW_WIDTH"}(nt||(nt={}));const ht=t=>async i=>i({type:nt.APP_SET_SRC,payload:t}),ot=t=>async i=>i({type:nt.APP_SET_SRC_LOADED,payload:t}),at=t=>async i=>i({type:nt.APP_SET_NODE,payload:t}),rt=t=>async i=>i({type:nt.APP_DELETE_NODE,payload:t}),ct=t=>async i=>i({type:nt.APP_SELECT_NODE,payload:t}),lt=t=>async i=>i({type:nt.APP_CLEAR_NODES,payload:t}),ut=t=>async i=>i({type:nt.APP_SET_EDGE,payload:t}),dt=t=>async i=>i({type:nt.APP_DELETE_EDGE,payload:t}),Mt=t=>async i=>i({type:nt.APP_SELECT_EDGE,payload:t}),gt=t=>async i=>i({type:nt.APP_CLEAR_EDGES,payload:t}),yt=t=>async i=>i({type:nt.APP_SET_ANGLE,payload:t}),Et=t=>async i=>i({type:nt.APP_DELETE_ANGLE,payload:t}),Tt=t=>async i=>i({type:nt.APP_SELECT_ANGLE,payload:t}),Nt=t=>async i=>i({type:nt.APP_CLEAR_ANGLES,payload:t}),pt=t=>async i=>i({type:nt.APP_SET_BOUNDINGBOX_VISIBLE,payload:t}),wt=t=>async i=>i({type:nt.APP_SET_DISPLAY_MODE,payload:t}),mt=t=>async i=>i({type:nt.APP_SET_NODES_ENABLED,payload:t}),It=t=>async i=>i({type:nt.APP_SET_MATERIAL,payload:t}),jt=t=>async i=>i({type:nt.APP_SET_UNITS,payload:t}),Lt=t=>async i=>i({type:nt.APP_SET_ORIENTATION,payload:t}),Dt=t=>async i=>i({type:nt.APP_SET_SLICES_INDEX,payload:t}),At=t=>async i=>i({type:nt.APP_SET_SLICES_WINDOW_WIDTH,payload:t}),bt=t=>async i=>i({type:nt.APP_SET_SLICES_WINDOW_CENTER,payload:t}),Ct=t=>async i=>i({type:nt.APP_SET_VOLUME_STEPS,payload:t}),ft=t=>async i=>i({type:nt.APP_SET_VOLUME_WINDOW_WIDTH,payload:t}),Ot=t=>async i=>i({type:nt.APP_SET_VOLUME_WINDOW_CENTER,payload:t}),vt=t=>async i=>i({type:nt.APP_SET_CAMERA,payload:t}),xt=t=>async i=>i({type:nt.APP_SET_CONTROLS_ENABLED,payload:t}),St=t=>async i=>i({type:nt.APP_SET_CONTROLS_TYPE,payload:t});var zt=function(){var t,i=("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()).Symbol;return"function"==typeof i?i.observable?t=i.observable:(t=i("observable"),i.observable=t):t="@@observable",t}(),kt=function(){return Math.random().toString(36).substring(7).split("").join(".")},Rt={INIT:"@@redux/INIT"+kt(),REPLACE:"@@redux/REPLACE"+kt(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+kt()}};function _t(t,i,e){var s;if("function"==typeof i&&"function"==typeof e||"function"==typeof e&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function");if("function"==typeof i&&void 0===e&&(e=i,i=void 0),void 0!==e){if("function"!=typeof e)throw new Error("Expected the enhancer to be a function.");return e(_t)(t,i)}if("function"!=typeof t)throw new Error("Expected the reducer to be a function.");var n=t,h=i,o=[],a=o,r=!1;function c(){a===o&&(a=o.slice())}function l(){if(r)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return h}function u(t){if("function"!=typeof t)throw new Error("Expected the listener to be a function.");if(r)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var i=!0;return c(),a.push(t),function(){if(i){if(r)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");i=!1,c();var e=a.indexOf(t);a.splice(e,1)}}}function d(t){if(!function(t){if("object"!=typeof t||null===t)return!1;for(var i=t;null!==Object.getPrototypeOf(i);)i=Object.getPrototypeOf(i);return Object.getPrototypeOf(t)===i}(t))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===t.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(r)throw new Error("Reducers may not dispatch actions.");try{r=!0,h=n(h,t)}finally{r=!1}for(var i=o=a,e=0;e<i.length;e++)(0,i[e])();return t}return d({type:Rt.INIT}),(s={dispatch:d,subscribe:u,getState:l,replaceReducer:function(t){if("function"!=typeof t)throw new Error("Expected the nextReducer to be a function.");n=t,d({type:Rt.REPLACE})}})[zt]=function(){var t,i=u;return(t={subscribe:function(t){if("object"!=typeof t||null===t)throw new TypeError("Expected the observer to be an object.");function e(){t.next&&t.next(l())}return e(),{unsubscribe:i(e)}}})[zt]=function(){return this},t},s}function Yt(t,i){var e=i&&i.type;return"Given "+(e&&'action "'+String(e)+'"'||"an action")+', reducer "'+t+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function Qt(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}function Pt(t){for(var i=1;i<arguments.length;i++){var e=null!=arguments[i]?arguments[i]:{},s=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.forEach(function(i){Qt(t,i,e[i])})}return t}function Ut(){for(var t=arguments.length,i=new Array(t),e=0;e<t;e++)i[e]=arguments[e];return 0===i.length?function(t){return t}:1===i.length?i[0]:i.reduce(function(t,i){return function(){return t(i.apply(void 0,arguments))}})}function Ht(t){return function(i){var e=i.dispatch,s=i.getState;return function(i){return function(n){return"function"==typeof n?n(e,s,t):i(n)}}}}var Wt=Ht();Wt.withExtraArgument=Ht;const $t=function(t){for(var i=Object.keys(t),e={},s=0;s<i.length;s++){var n=i[s];"function"==typeof t[n]&&(e[n]=t[n])}var h,o=Object.keys(e);try{!function(t){Object.keys(t).forEach(function(i){var e=t[i];if(void 0===e(void 0,{type:Rt.INIT}))throw new Error('Reducer "'+i+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===e(void 0,{type:Rt.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+i+"\" returned undefined when probed with a random type. Don't try to handle "+Rt.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')})}(e)}catch(t){h=t}return function(t,i){if(void 0===t&&(t={}),h)throw h;for(var s=!1,n={},a=0;a<o.length;a++){var r=o[a],c=t[r],l=(0,e[r])(c,i);if(void 0===l){var u=Yt(r,i);throw new Error(u)}n[r]=l,s=s||l!==c}return s?n:t}}({app:(t=(()=>({angles:new Map,boundingBoxEnabled:!1,camera:null,controlsEnabled:!0,controlsType:u.ORBIT,displayMode:d.MESH,edges:new Map,material:M.DEFAULT,nodes:new Map,graphEnabled:!1,orientation:y.CORONAL,selected:null,slicesIndex:0,slicesWindowCenter:0,slicesWindowWidth:0,src:null,srcLoaded:!1,units:T.METERS,volumeSteps:16,volumeWindowCenter:0,volumeWindowWidth:0}))(),i)=>{switch(i.type){case nt.APP_SET_SRC:{const[e,s]=i.payload;let n;if(s)n=s;else if(e){const t=Q.getFileExtension(e);n=Object.values(g).includes(t)?d.MESH:d.SLICES}else n=d.MESH;return Object.assign({},t,{angles:new Map,controlsEnabled:!1,displayMode:n,edges:new Map,nodes:new Map,orientation:y.CORONAL,selected:null,slicesIndex:0,slicesWindowCenter:0,slicesWindowWidth:0,src:e,srcLoaded:!1,volumeSteps:16,volumeWindowCenter:0,volumeWindowWidth:0})}case nt.APP_SET_SRC_LOADED:return Object.assign({},t,{controlsEnabled:i.payload,srcLoaded:i.payload,boundingBoxEnabled:t.displayMode!==d.MESH||t.boundingBoxEnabled,units:t.displayMode!==d.MESH?T.MILLIMETERS:T.METERS});case nt.APP_SET_NODE:{const[e,s]=i.payload,n=JSON.parse(JSON.stringify(s)),h=t.nodes.get(e),o=Object.assign({},h,n);return Object.assign({},t,{selected:h?t.selected:e,nodes:new Map(t.nodes).set(e,o)})}case nt.APP_DELETE_NODE:return Object.assign({},t,{selected:t.selected===i.payload?null:t.selected,nodes:new Map([...t.nodes].filter(([t])=>t!==i.payload)),edges:new Map([...t.edges].filter(([t,e])=>i.payload!==e.node1Id&&i.payload!==e.node2Id))});case nt.APP_SELECT_NODE:return Object.assign({},t,{selected:i.payload});case nt.APP_CLEAR_NODES:return Object.assign({},t,{nodes:new Map});case nt.APP_SET_EDGE:{const[e,s]=i.payload,n=JSON.parse(JSON.stringify(s)),h=t.edges.get(e),o=Object.assign({},h,n);return Object.assign({},t,{selected:h?t.selected:e,edges:new Map(t.edges).set(e,o)})}case nt.APP_DELETE_EDGE:return Object.assign({},t,{selected:t.selected===i.payload?null:t.selected,edges:new Map([...t.edges].filter(([t])=>t!==i.payload)),angles:new Map([...t.angles].filter(([t,e])=>i.payload!==e.edge1Id&&i.payload!==e.edge2Id))});case nt.APP_SELECT_EDGE:return Object.assign({},t,{selected:i.payload});case nt.APP_CLEAR_EDGES:return Object.assign({},t,{edges:new Map});case nt.APP_SET_ANGLE:{const[e,s]=i.payload,n=JSON.parse(JSON.stringify(s)),h=t.angles.get(e),o=Object.assign({},h,n);return Object.assign({},t,{selected:h?t.selected:e,angles:new Map(t.angles).set(e,o)})}case nt.APP_DELETE_ANGLE:return Object.assign({},t,{selected:t.selected===i.payload?null:t.selected,angles:new Map([...t.angles].filter(([t])=>t!==i.payload))});case nt.APP_SELECT_ANGLE:return Object.assign({},t,{selected:i.payload});case nt.APP_CLEAR_ANGLES:return Object.assign({},t,{angles:new Map});case nt.APP_SET_DISPLAY_MODE:return Object.assign({},t,{displayMode:i.payload,boundingBoxEnabled:i.payload!==d.MESH||t.boundingBoxEnabled});case nt.APP_SET_ORIENTATION:return Object.assign({},t,{slicesIndex:void 0,orientation:i.payload});case nt.APP_SET_MATERIAL:return Object.assign({},t,{material:i.payload});case nt.APP_SET_NODES_ENABLED:return Object.assign({},t,{graphEnabled:i.payload});case nt.APP_SET_BOUNDINGBOX_VISIBLE:return Object.assign({},t,{boundingBoxEnabled:i.payload});case nt.APP_SET_SLICES_INDEX:return Object.assign({},t,{slicesIndex:i.payload});case nt.APP_SET_SLICES_WINDOW_WIDTH:return Object.assign({},t,{slicesWindowWidth:i.payload});case nt.APP_SET_SLICES_WINDOW_CENTER:return Object.assign({},t,{slicesWindowCenter:i.payload});case nt.APP_SET_UNITS:return Object.assign({},t,{units:i.payload});case nt.APP_SET_VOLUME_STEPS:return Object.assign({},t,{volumeSteps:i.payload});case nt.APP_SET_VOLUME_WINDOW_WIDTH:return Object.assign({},t,{volumeWindowWidth:i.payload});case nt.APP_SET_VOLUME_WINDOW_CENTER:return Object.assign({},t,{volumeWindowCenter:i.payload});case nt.APP_SET_CAMERA:return Object.assign({},t,{camera:Object.assign({},t.camera,i.payload)});case nt.APP_SET_CONTROLS_ENABLED:return Object.assign({},t,{controlsEnabled:i.payload});case nt.APP_SET_CONTROLS_TYPE:return Object.assign({},t,{controlsType:i.payload});default:return Object.assign({},t)}}}),Ft=class{constructor(e){t(this,e),this._hovered=null,this._isShiftDown=!1,this._isWebGl2=!0,this.width="640",this.height="480",this.changed=i(this,"changed",7),this.loaded=i(this,"loaded",7),this.store=h(this,"store")}async load(t,i){this.src?(this._setSrc(null),setTimeout(()=>{this._setSrc(t,i)},f.minLoadingMS)):this._setSrc(t,i)}async resize(){this._resize()}async setNode(t){this._setNode(t)}async setGraph(t){this._setGraph(t)}async deleteNode(t){this._deleteNode(t)}async clearGraph(){this._clearGraph()}async selectNode(t){this._selectNode(t,!0)}async deleteEdge(t){this._deleteEdge(t)}async deleteAngle(t){this._deleteAngle(t)}async setEdge(t){this._setEdge(t)}async recenter(){this._recenter()}async setBoundingBoxEnabled(t){this._setBoundingBoxEnabled(t)}async setDisplayMode(t){this._setDisplayMode(t)}async setControlsEnabled(t){this._setControlsEnabled(t)}async setControlsType(t){this._setControlsType(t)}async setGraphEnabled(t){this._setGraphEnabled(t)}async setMaterial(t){this._setMaterial(t)}async setOrientation(t){this._setOrientation(t)}async setSlicesIndex(t){this._setSlicesIndex(t)}async setSlicesWindowCenter(t){this._setSlicesWindowCenter(t)}async setSlicesWindowWidth(t){this._setSlicesWindowWidth(t)}async setUnits(t){this._setUnits(t)}async setVolumeSteps(t){this._setVolumeSteps(t)}async setVolumeWindowCenter(t){this._setVolumeWindowCenter(t)}async setVolumeWindowWidth(t){this._setVolumeWindowWidth(t)}async componentWillLoad(){this._isWebGl2=R.isWebGL2Available(),this.store.setStore((t=>_t($t,t,function(){for(var t=arguments.length,i=new Array(t),e=0;e<t;e++)i[e]=arguments[e];return function(t){return function(){var e=t.apply(void 0,arguments),s=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},n={getState:e.getState,dispatch:function(){return s.apply(void 0,arguments)}},h=i.map(function(t){return t(n)});return Pt({},e,{dispatch:s=Ut.apply(void 0,h)(e.dispatch)})}}}(Wt)))({})),this.store.mapStateToProps(this,t=>{const{app:{angles:i,boundingBoxEnabled:e,camera:s,controlsEnabled:n,controlsType:h,displayMode:o,edges:a,graphEnabled:r,material:c,nodes:l,orientation:u,selected:d,slicesIndex:M,slicesWindowCenter:g,slicesWindowWidth:y,src:E,srcLoaded:T,units:N,volumeSteps:p,volumeWindowCenter:w,volumeWindowWidth:m}}=t;return{angles:i,boundingBoxEnabled:e,camera:s,controlsEnabled:n,controlsType:h,displayMode:o,edges:a,graphEnabled:r,material:c,nodes:l,orientation:u,selected:d,slicesIndex:M,slicesWindowCenter:g,slicesWindowWidth:y,src:E,srcLoaded:T,units:N,volumeSteps:p,volumeWindowCenter:w,volumeWindowWidth:m}}),this.store.mapDispatchToProps(this,{appClearAngles:Nt,appClearEdges:gt,appClearNodes:lt,appDeleteAngle:Et,appDeleteEdge:dt,appDeleteNode:rt,appSelectAngle:Tt,appSelectEdge:Mt,appSelectNode:ct,appSetAngle:yt,appSetBoundingBoxEnabled:pt,appSetCamera:vt,appSetControlsEnabled:xt,appSetControlsType:St,appSetDisplayMode:wt,appSetEdge:ut,appSetGraphEnabled:mt,appSetMaterial:It,appSetNode:at,appSetOrientation:Lt,appSetSlicesIndex:Dt,appSetSlicesWindowCenter:bt,appSetSlicesWindowWidth:At,appSetSrc:ht,appSetSrcLoaded:ot,appSetUnits:jt,appSetVolumeSteps:Ct,appSetVolumeWindowCenter:Ot,appSetVolumeWindowWidth:ft}),this._controlsAnimationFinishedHandler=this._controlsAnimationFinishedHandler.bind(this),this._controlsInteractionHandler=this._controlsInteractionHandler.bind(this),this._graphEntryDraggedHandler=this._graphEntryDraggedHandler.bind(this),this._graphEntryPointerDownHandler=this._graphEntryPointerDownHandler.bind(this),this._graphEntryPointerOutHandler=this._graphEntryPointerOutHandler.bind(this),this._graphEntryPointerOverHandler=this._graphEntryPointerOverHandler.bind(this),this._graphEntryPointerUpHandler=this._graphEntryPointerUpHandler.bind(this),this._graphEntrySelectedHandler=this._graphEntrySelectedHandler.bind(this),this._graphEntryValidTargetHandler=this._graphEntryValidTargetHandler.bind(this),this._keyDownHandler=this._keyDownHandler.bind(this),this._keyUpHandler=this._keyUpHandler.bind(this),this._controlsInteractionFinishedHandler=this._controlsInteractionFinishedHandler.bind(this),this._spawnNodeHandler=this._spawnNodeHandler.bind(this),this._srcLoaded=this._srcLoaded.bind(this),this._debouncedAppSetCamera=Y.debounce(this.appSetCamera,f.minFrameMS).bind(this),this._lights=[]}_renderSpinner(){if(this.src&&!this.srcLoaded)return e("div",{id:"spinner"},e("div",{class:"square"}))}_renderSrc(){if(!this.src)return null;switch(this.displayMode){case d.MESH:return e("a-entity",{class:"collidable","al-node-spawner":`\n              graphEnabled: ${this.graphEnabled};\n            `,"al-gltf-model":`\n              src: url(${this.src});\n              dracoDecoderPath: ${this.dracoDecoderPath};\n            `,position:"0 0 0",scale:"1 1 1",ref:t=>this._targetEntity=t});case d.SLICES:return e("a-entity",{id:"target-entity",class:"collidable","al-node-spawner":`\n              graphEnabled: ${this.graphEnabled};\n            `,"al-volume":`\n              srcLoaded: ${this.srcLoaded};\n              src: ${this.src};\n              displayMode: ${this.displayMode};\n              slicesIndex: ${this.slicesIndex};\n              slicesOrientation: ${this.orientation};\n              slicesWindowWidth: ${this.slicesWindowWidth};\n              slicesWindowCenter: ${this.slicesWindowCenter};\n              volumeSteps: ${this.volumeSteps};\n              volumeWindowCenter: ${this.volumeWindowCenter};\n              volumeWindowWidth: ${this.volumeWindowWidth};\n              isWebGl2: ${this._isWebGl2};\n            `,position:"0 0 0",ref:t=>this._targetEntity=t});case d.VOLUME:return e("a-entity",{id:"target-entity","al-volume":`\n              srcLoaded: ${this.srcLoaded};\n              src: ${this.src};\n              displayMode: ${this.displayMode};\n              slicesIndex: ${this.slicesIndex};\n              slicesOrientation: ${this.orientation};\n              slicesWindowWidth: ${this.slicesWindowWidth};\n              slicesWindowCenter: ${this.slicesWindowCenter};\n              volumeSteps: ${this.volumeSteps};\n              volumeWindowCenter: ${this.volumeWindowCenter};\n              volumeWindowWidth: ${this.volumeWindowWidth};\n              isWebGl2: ${this._isWebGl2};\n            `,position:"0 0 0",ref:t=>this._targetEntity=t});default:return}}_renderBoundingBox(){if(this.srcLoaded){const t=new THREE.Vector3;this._boundingBox.getSize(t);const i=this._getMesh();if(!i)return null;const s=i.geometry;let n,h;if(h=this.boundingBoxEnabled?1:0,this.displayMode===d.VOLUME)return n=this._targetEntity.object3D.position.clone().add(Q.getGeometryCenter(s)),e("a-entity",{position:R.vector3ToString(n),"al-bounding-box":`\n              scale: ${R.vector3ToString(t)};\n              color: ${f.colorValues.white};\n              opacity: ${h};\n            `,"al-node-spawner":`\n              graphEnabled: ${this.graphEnabled};\n            `,class:"collidable",ref:t=>this._boundingEntity=t});switch(this.displayMode){case d.MESH:if(this._boundingBox.intersectsBox(s.boundingBox)){const t=s.boundingSphere.center.clone();n=this._targetEntity.object3D.position.clone().add(t)}else n=this._targetEntity.object3D.position.clone();break;case d.SLICES:n=this._targetEntity.object3D.position.clone().add(Q.getGeometryCenter(s))}return e("a-entity",{position:R.vector3ToString(n),"al-bounding-box":`\n                scale: ${R.vector3ToString(t)};\n                color: ${f.colorValues.white};\n                opacity: ${h};\n              `,ref:t=>this._boundingEntity=t})}}_renderNodes(){return Array.from(this.nodes).map(t=>{const[i,s]=t,n=R.getFrustrumSpaceDistance(this._scene.camera,R.stringToVector3(s.position),this.camera.position)/this._boundingSphereRadius*f.frustrumScaleFactor,h=new THREE.Vector3(0,4,0);return h.multiplyScalar(s.scale),e("a-entity",{class:"collidable",id:i,position:s.position,"al-node":`\n            scale: ${s.scale};\n            selected: ${this.selected===i};\n            graphEnabled: ${this.graphEnabled};\n          `,scale:` ${n} ${n} ${n};`},e("a-entity",{text:`\n              value: ${s.title};\n              side: double;\n              align: center;\n              baseline: bottom;\n              anchor: center;\n              width: ${f.fontSizeMedium*this._boundingSphereRadius};\n              zOffset: 1e-7;\n            `,position:R.vector3ToString(h),"al-render-overlaid":!0,visible:`${this.selected===i}`,id:`${i}-label`,"al-billboard-baggins":`\n              controlsType: ${this.controlsType};\n              cameraPosition: ${R.vector3ToString(this.camera.position)};\n              worldPosition: ${R.vector3ToString(R.stringToVector3(s.position).add(h))}\n            `,"al-background":`\n                text: ${s.title};\n                boundingRadius: ${f.fontSizeMedium*this._boundingSphereRadius};\n            `}))})}_renderEdges(){return Array.from(this.edges).map(t=>{const[i,s]=t,n=this.nodes.get(s.node1Id),h=this.nodes.get(s.node2Id);if(n&&h){const t=R.stringToVector3(n.position);let s=R.stringToVector3(h.position).clone().sub(t);const o=s.length();s=s.normalize().multiplyScalar(.5*o);const a=t.clone().add(s),r=new THREE.Vector3(0,2.5,0),c=(n.scale+h.scale)/2,l=this._boundingSphereRadius*f.edgeSize;r.multiplyScalar(c);const u=this._convertUnits(o),d=R.getFrustrumSpaceDistance(this._scene.camera,a.clone(),this.camera.position)/this._boundingSphereRadius*f.frustrumScaleFactor;return e("a-entity",{class:"collidable",id:i,position:R.vector3ToString(a),"al-edge":`\n              length: ${o};\n              node1: ${n.position};\n              node2: ${h.position};\n              selected: ${this.selected===i};\n              radius: ${l};\n              nodeScale: ${c};\n              scale: ${d};\n            `},e("a-entity",{id:`${i}-title`,text:`\n                value: ${u};\n                side: double;\n                align: center;\n                baseline: bottom;\n                anchor: center;\n                width: ${f.fontSizeSmall*this._boundingSphereRadius}\n              `,position:R.vector3ToString(r),visible:`${this.selected===i}`,scale:` ${d} ${d} ${d};`,"al-billboard-baggins":`\n                controlsType: ${this.controlsType};\n                cameraPosition: ${R.vector3ToString(this.camera.position)};\n                worldPosition: ${R.vector3ToString(a.clone().add(r.clone()))};\n              `,"al-background":`\n                  text: ${u};\n                  boundingRadius: ${f.fontSizeSmall*this._boundingSphereRadius};\n              `,"al-render-overlaid":!0}))}})}_renderAngles(){return Array.from(this.angles).map(t=>{const[i,s]=t,n=this.edges.get(s.edge1Id),h=this.edges.get(s.edge2Id);if(n&&h){let t,o,a;n.node1Id===h.node1Id?(t=this.nodes.get(h.node1Id),o=this.nodes.get(n.node2Id),a=this.nodes.get(h.node2Id)):n.node1Id===h.node2Id?(t=this.nodes.get(h.node2Id),o=this.nodes.get(n.node2Id),a=this.nodes.get(h.node1Id)):n.node2Id===h.node1Id?(t=this.nodes.get(h.node1Id),o=this.nodes.get(n.node1Id),a=this.nodes.get(h.node2Id)):n.node2Id===h.node2Id&&(t=this.nodes.get(h.node2Id),o=this.nodes.get(n.node1Id),a=this.nodes.get(h.node1Id));const r=this._boundingSphereRadius*f.edgeSize,c=R.stringToVector3(o.position),l=R.stringToVector3(a.position),u=R.stringToVector3(t.position),d=c.clone().sub(u).normalize(),M=l.clone().sub(u).normalize(),g=M.angleTo(d),y=Math.min(u.distanceTo(c),u.distanceTo(l));let E=Math.min(.25*y,25*r);E=Math.max(E,10*r);const T=d.clone().multiplyScalar(E),N=M.clone().multiplyScalar(E),p=T.clone().distanceTo(N.clone()),w=T.clone().add(N.clone()).divideScalar(2),m=new THREE.Vector3(0,2.5,0);m.multiplyScalar((o.scale+a.scale+t.scale)/3);const I=THREE.Math.radToDeg(g).toFixed(f.unitsDecimalPlaces)+" deg",j=R.getFrustrumSpaceDistance(this._scene.camera,u.clone(),this.camera.position)/this._boundingSphereRadius*f.frustrumScaleFactor;return e("a-entity",{class:"collidable",id:i,position:t.position,"al-angle":`\n              selected: ${this.selected===i};\n              edge0Pos: ${R.vector3ToString(T)};\n              edge1Pos: ${R.vector3ToString(N)};\n              position: ${R.vector3ToString(w)};\n              length: ${p};\n              radius: ${r};\n              angle: ${s};\n              scale: ${j};\n            `},e("a-entity",{id:`${i}-title`,scale:` ${j} ${j} ${j};`,text:`\n                value: ${I};\n                side: double;\n                align: center;\n                baseline: bottom;\n                anchor: center;\n                width: ${f.fontSizeSmall*this._boundingSphereRadius}\n              `,position:R.vector3ToString(w.clone().add(m)),visible:`${this.selected===i}`,"al-billboard-baggins":`\n                controlsType: ${this.controlsType};\n                cameraPosition: ${R.vector3ToString(this.camera.position)};\n                worldPosition: ${R.vector3ToString(R.stringToVector3(t.position).add(m.clone()))};\n              `,"al-background":`\n                text: ${I};\n                boundingRadius: ${f.fontSizeSmall*this._boundingSphereRadius};\n              `,"al-render-overlaid":!0}))}})}_renderLights(){return[e("a-entity",{id:"light-1",light:"type: directional; color: #ffffff; intensity: 0.5",position:"1 1 1",ref:t=>this._lights[0]=t}),e("a-entity",{id:"light-2",light:"type: directional; color: #ffffff; intensity: 0.5",position:"-1 -1 -1",ref:t=>this._lights[1]=t}),e("a-entity",{id:"light-3",light:"type: ambient; color: #d0d0d0; intensity: 1"})]}_renderOrbitCamera(){return e("a-camera",{fov:f.cameraValues.fov,near:f.cameraValues.near,"look-controls":"enabled: false",far:f.cameraValues.far,id:"mainCamera","al-cursor":"rayOrigin: mouse",raycaster:"objects: .collidable;","al-orbit-control":`\n          maxPolarAngle: ${f.cameraValues.maxPolarAngle};\n          minDistance: ${f.cameraValues.minDistance};\n          screenSpacePanning: true;\n          rotateSpeed: ${f.cameraValues.rotateSpeed};\n          zoomSpeed: ${f.cameraValues.zoomSpeed};\n          enableDamping: true;\n          dampingFactor: ${f.cameraValues.dampingFactor};\n          controlTarget: ${R.vector3ToString(this.camera?this.camera.target:new THREE.Vector3(0,0,0))};\n          controlPosition: ${R.vector3ToString(this.camera?this.camera.position:new THREE.Vector3(0,0,0))};\n          enabled: ${this.controlsEnabled};\n          animating: ${!(!this.camera||!this.camera.animating)&&this.camera.animating}\n        `,ref:t=>this._camera=t})}_renderTrackballCamera(){return e("a-camera",{fov:f.cameraValues.fov,near:f.cameraValues.near,"look-controls":"enabled: false",far:f.cameraValues.far,id:"mainCamera","al-cursor":"rayOrigin: mouse",raycaster:"objects: .collidable;","al-trackball-control":`\n          screenLeft: 0;\n          screenTop: 0;\n          screenWidth: ${this._scene?this._scene.canvas.width:0};\n          screenHeight: ${this._scene?this._scene.canvas.height:0};\n          rotateSpeed: ${5*f.cameraValues.rotateSpeed};\n          zoomSpeed: ${5*f.cameraValues.zoomSpeed};\n          panSpeed: ${f.cameraValues.panSpeed};\n          dynamicDampingFactor: ${f.cameraValues.dampingFactor};\n          controlTarget: ${R.vector3ToString(this.camera?this.camera.target:new THREE.Vector3(0,0,0))};\n          controlPosition: ${R.vector3ToString(this.camera?this.camera.position:new THREE.Vector3(0,0,0))};\n          enabled: ${this.controlsEnabled};\n          animating: ${!(!this.camera||!this.camera.animating)&&this.camera.animating}\n        `,ref:t=>this._camera=t})}_renderControls(){switch(this.controlsType){case u.TRACKBALL:return this._renderTrackballCamera();case u.ORBIT:return this._renderOrbitCamera();default:return null}}_renderCamera(){return[this._renderControls(),this._renderLights()]}_renderScene(){return e("a-scene",{embedded:!0,renderer:`\n          colorManagement: true;\n          sortObjects: true;\n          webgl2: ${this._isWebGl2};\n          antialias: true;\n        `,"vr-mode-ui":"enabled: false",ref:t=>this._scene=t},this._renderBoundingBox(),this._renderSrc(),this._renderNodes(),this._renderEdges(),this._renderAngles(),this._renderCamera())}render(){return e("div",{id:"al-container",class:this.displayMode,style:{width:Q.addCssUnits(this.width),height:Q.addCssUnits(this.height)}},e("div",{id:"lut-container"},e("div",{id:"lut-min"},"0.0"),e("div",{id:"lut-canvases"}),e("div",{id:"lut-max"},"1.0")),this._renderScene(),this._renderSpinner())}_resize(){this._scene&&this._scene.resize()}_convertUnits(t){if(this.displayMode===d.MESH)switch(this.units){case T.METERS:return t.toFixed(f.unitsDecimalPlaces)+this.units;case T.MILLIMETERS:return(t/.001).toFixed(f.unitsDecimalPlaces)+this.units}else switch(this.units){case T.METERS:return(t/1e3).toFixed(f.unitsDecimalPlaces)+this.units;case T.MILLIMETERS:return t.toFixed(f.unitsDecimalPlaces)+this.units}}_createEdge(t,i){if(Array.from(this.edges).find(([e,s])=>s.node1Id===t&&s.node2Id===i||s.node1Id===i&&s.node2Id===t))console.log("edge already exists");else{const e={node1Id:t,node2Id:i},s=U.getNextId(l.EDGE,this.edges);this._setEdge([s,e])}}_createAngle(t,i){if(Array.from(this.angles).find(([e,s])=>s.edge1Id===t&&s.edge2Id===i||s.edge1Id===i&&s.edge2Id===t))console.warn("cannot create angle: angle already exists");else{const e=this.edges.get(t),s=this.edges.get(i);if(e.node1Id===s.node1Id||e.node1Id===s.node2Id||e.node2Id===s.node1Id||e.node2Id===s.node2Id){const e={edge1Id:t,edge2Id:i},s=U.getNextId(l.ANGLE,this.angles);this._setAngle([s,e])}else console.warn("cannot create angle: edges not connected")}}_stateChanged(){this.changed.emit(this.store.getState().app)}_setGraph(t){t.nodes&&new Map(t.nodes).forEach((t,i)=>{this.appSetNode([i,t])}),t.edges&&new Map(t.edges).forEach((t,i)=>{this.appSetEdge([i,t])}),t.angles&&new Map(t.angles).forEach((t,i)=>{this.appSetAngle([i,t])}),this._stateChanged()}_clearGraph(){this.appClearNodes(),this.appClearEdges(),this.appClearAngles(),this._stateChanged()}_deleteNode(t){this.appDeleteNode(t),this._stateChanged()}_setNode(t){this.appSetNode(t),this._stateChanged()}_animateBetween(t,i){const e={position:i,target:Q.getCameraStateFromMesh(this._getMesh()).target.clone()};if(i){const s=e.position.distanceTo(this.camera.position),n=e.target.distanceTo(this.camera.target),h=s/f.maxAnimationSteps>Number.EPSILON,o=n/f.maxAnimationSteps>Number.EPSILON;if(h||o){e.position.copy(i.clone());const s=R.getSlerpCameraPath(t,e,h,o);this._scene.emit(K.ANIMATION_STARTED,{slerpPath:s},!1),this.appSetCamera({animating:!0}),this._stateChanged()}}}_selectNode(t,i=!1){if(i&&t!==this.selected){const i={position:this.camera.position.clone(),target:this.camera.target.clone()},e=Q.getCameraPositionFromNode(this.nodes.get(t),this._boundingSphereRadius,this.camera.target);this.appSelectNode(t),this._animateBetween(i,e)}else this.appSelectNode(t),this._stateChanged()}_setEdge(t){this.appSetEdge(t),this._stateChanged()}_deleteEdge(t){this.appDeleteEdge(t),this._stateChanged()}_recenter(){const t=Q.getCameraStateFromMesh(this._getMesh()),i={position:this.camera.position.clone(),target:this.camera.target.clone()};this._selectNode(null),this._animateBetween(i,t.position)}_selectEdge(t){this.appSelectEdge(t),this._stateChanged()}_setAngle(t){this.appSetAngle(t),this._stateChanged()}_selectAngle(t){this.appSelectAngle(t),this._stateChanged()}_deleteAngle(t){this.appDeleteAngle(t),this._stateChanged()}_setBoundingBoxEnabled(t){this.appSetBoundingBoxEnabled(t),this._stateChanged()}_setControlsEnabled(t){this.appSetControlsEnabled(t),this._stateChanged()}_setControlsType(t){this.appSetControlsType(t),this._stateChanged()}_setGraphEnabled(t){this.appSetGraphEnabled(t),this._stateChanged()}_setMaterial(t){this.appSetMaterial(t),this._stateChanged()}_setOrientation(t){this.appSetOrientation(t),this._stateChanged()}_setSlicesIndex(t){this.appSetSlicesIndex(t),this._stateChanged()}_setSlicesWindowCenter(t){this.appSetSlicesWindowCenter(t),this._stateChanged()}_setSlicesWindowWidth(t){this.appSetSlicesWindowWidth(t),this._stateChanged()}_setUnits(t){this.appSetUnits(t),this._stateChanged()}_setVolumeSteps(t){this.appSetVolumeSteps(t),this._stateChanged()}_setVolumeWindowCenter(t){this.appSetVolumeWindowCenter(t),this._stateChanged()}_setVolumeWindowWidth(t){this.appSetVolumeWindowWidth(t),this._stateChanged()}_setDisplayMode(t){this.appSetDisplayMode(t),this._stateChanged()}_setSrc(t,i){this.appSetSrc([t,i]),this._stateChanged()}_getStackHelper(){let t=null;return this.displayMode===d.VOLUME&&(t=this._loadedObject),t}_getMesh(){let t=null;if(this._targetEntity&&this.displayMode===d.MESH){const i=this._targetEntity.object3DMap.mesh;i instanceof THREE.Mesh?t=i:i&&i.traverse(i=>{if(i instanceof THREE.Mesh&&null===t)return t=i})}else t=this._loadedObject._bBox?this._loadedObject._bBox._mesh:this._loadedObject._mesh;return t}_srcLoaded(t){this._loadedObject=t.detail;const i=this._getMesh();if(i){i.geometry.computeBoundingSphere(),i.geometry.computeBoundingBox(),this._boundingSphereRadius=i.geometry.boundingSphere.radius,this._boundingBox=Q.getBoundingBox(i);const e=Q.getCameraStateFromMesh(i);this._updateLights(e),e&&this.appSetCamera(e),this.appSetSrcLoaded(!0),this._stateChanged(),this.loaded.emit(t.detail)}}_keyDownHandler(t){this._isShiftDown=t.shiftKey,t.keyCode===z.Delete&&this.selected&&(this.nodes.has(this.selected)?this._deleteNode(this.selected):this.edges.has(this.selected)?this._deleteEdge(this.selected):this.angles.has(this.selected)&&this._deleteAngle(this.selected))}_keyUpHandler(t){this._isShiftDown=!1}_graphEntryPointerUpHandler(t){this.appSetControlsEnabled(!0),R.enableControls(this._camera,!0,this.controlsType)}_graphEntryPointerDownHandler(t){this.appSetControlsEnabled(!1),R.enableControls(this._camera,!1,this.controlsType)}_graphEntryPointerOutHandler(t){this._hovered=null}_graphEntryPointerOverHandler(t){this._hovered=t.detail.id}_controlsInteractionHandler(t){this._updateLights(t.detail.cameraState)}_updateLights(t){this.displayMode===d.MESH&&this._lights.forEach(i=>{const e=t.position.clone().normalize();i.object3D.position.copy(e)})}_controlsInteractionFinishedHandler(t){this._debouncedAppSetCamera(t.detail.cameraState)}_spawnNodeHandler(t){if(this.graphEnabled&&this._validTarget&&null===this._hovered){const i=t.detail.aframeEvent.detail.intersection,e=U.getNextId(l.NODE,this.nodes);let s;if(this.displayMode===d.VOLUME&&i){const t=new THREE.Vector3,i=new THREE.Vector3;_.volumeRay(this._getStackHelper(),this._camera.object3D.children[0].position.clone(),this._camera.getAttribute("raycaster").direction,f.cameraValues.far,t,i)&&(s={position:R.vector3ToString(t),scale:this._boundingSphereRadius/f.nodeSizeRatio,title:e})}else i&&(s={targetId:"0",position:R.vector3ToString(i.point),scale:this._boundingSphereRadius/f.nodeSizeRatio,title:e});if(s){const t=this.selected;this._setNode([e,s]),this._isShiftDown&&this.nodes.has(t)&&(this._createEdge(t,e),this._selectNode(e))}}}_graphEntryValidTargetHandler(t){this._validTarget=t.detail.valid}_controlsAnimationFinishedHandler(t){this.appSetCamera({animating:!1})}_graphEntrySelectedHandler(t){if(!this.graphEnabled)return;const i=t.detail.id;switch(t.detail.type){case l.NODE:null!==this._hovered&&this.nodes.has(this._hovered)&&null!==this.selected&&this.nodes.has(this.selected)&&this.selected!==this._hovered&&this._isShiftDown&&this._createEdge(this.selected,this._hovered),this._selectNode(i);break;case l.EDGE:null!==this._hovered&&this.edges.has(this._hovered)&&null!==this.selected&&this.edges.has(this.selected)&&this.selected!==this._hovered&&this._isShiftDown&&this._createAngle(this.selected,this._hovered),this._selectEdge(i);break;case l.ANGLE:this._selectAngle(i)}}_graphEntryDraggedHandler(t){const i=t.detail.id,e=this._camera.components.raycaster,s=this._camera.getAttribute("raycaster");let n;const h=new THREE.Vector3;let o=!1;const a=this._camera.object3D.children[0].position;if(this.displayMode===d.VOLUME){if(n=e.getIntersection(this._boundingEntity)){const t=new THREE.Vector3;_.volumeRay(this._getStackHelper(),a.clone(),s.direction,f.cameraValues.far,h,t)&&(o=!0)}}else(n=e.getIntersection(this._targetEntity))&&(h.copy(n.point),o=!0);if(!o){const t=a.distanceTo(this._targetEntity.getAttribute("position"));h.copy(a),h.add(s.direction.clone().multiplyScalar(1.5*t))}this._setNode([i,{position:R.vector3ToString(h)}]),this._scene.emit(i+f.movedEventName,{},!0)}_addEventListeners(){window.addEventListener("keydown",this._keyDownHandler,!1),window.addEventListener("keyup",this._keyUpHandler,!1),this._scene.addEventListener(K.ANIMATION_FINISHED,this._controlsAnimationFinishedHandler,!1),this._scene.addEventListener(K.INTERACTION,this._controlsInteractionHandler,!1),this._scene.addEventListener(K.INTERACTION_FINISHED,this._controlsInteractionFinishedHandler,!1),this._scene.addEventListener(P.POINTER_UP,this._graphEntryPointerUpHandler,!1),this._scene.addEventListener(P.POINTER_DOWN,this._graphEntryPointerDownHandler,!1),this._scene.addEventListener(P.DRAGGED,this._graphEntryDraggedHandler,!1),this._scene.addEventListener(P.SELECTED,this._graphEntrySelectedHandler,!1),this._scene.addEventListener(J.ADD_NODE,this._spawnNodeHandler,!1),this._scene.addEventListener(J.VALID_TARGET,this._graphEntryValidTargetHandler,!1),this._scene.addEventListener(X.LOADED,this._srcLoaded,!1),this._scene.addEventListener(st.LOADED,this._srcLoaded,!1),this._scene.addEventListener(P.POINTER_OVER,this._graphEntryPointerOverHandler,!1),this._scene.addEventListener(P.POINTER_OUT,this._graphEntryPointerOutHandler,!1)}componentDidUpdate(){this._scene&&this._addEventListeners()}static get style(){return"#al-container{position:relative;font-family:sans-serif}#al-container a-scene{display:block;width:100%;height:100%}#al-container.mesh a-scene{background-color:var(--al-mesh-viewport-background-color)}#al-container.slices a-scene{background-color:var(--al-slices-viewport-background-color)}#al-container.volume a-scene{background-color:var(--al-volume-viewport-background-color)}#al-container #lut-container{display:none}#al-container .progress.container{position:absolute;top:auto!important;bottom:0!important}#al-container .progress.container .load.progress,#al-container .progress.container .parse.progress{border:none!important;height:4px!important;background-color:var(--load-progress-color,#fff)!important}#al-container #spinner{position:absolute;left:50%;top:50%}#al-container #spinner .square{margin:0 0 0 -15px;width:30px;height:30px;-webkit-animation:sk-rotateplane 1.2s ease-in-out infinite;-moz-animation:sk-rotateplane 1.2s infinite ease-in-out;animation:sk-rotateplane 1.2s ease-in-out infinite}#al-container.mesh #spinner .square,#al-container.slices #spinner .square,#al-container.volume #spinner .square{background-color:var(--spinner-color,#fff)}\@-webkit-keyframes sk-rotateplane{0%{-webkit-transform:perspective(120px)}50%{-webkit-transform:perspective(120px) rotateY(180deg)}to{-webkit-transform:perspective(120px) rotateY(180deg) rotateX(180deg)}}\@keyframes sk-rotateplane{0%{transform:perspective(120px) rotateX(0deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)}to{transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)}}"}};export{a as al_angle_editor,c as al_console,w as al_control_panel,m as al_edge_editor,j as al_node_editor,D as al_node_list,v as al_settings,x as al_tabs,S as al_url_picker,Ft as al_viewer};