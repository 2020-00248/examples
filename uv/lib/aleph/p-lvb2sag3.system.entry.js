var __extends=this&&this.__extends||function(){var e=function(t,n){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return e(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}}();var __awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i["throw"](e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,a)}c((i=i.apply(e,t||[])).next())})};var __generator=this&&this.__generator||function(e,t){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,r,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(e){return function(t){return c([e,t])}}function c(o){if(i)throw new TypeError("Generator is already executing.");while(n)try{if(i=1,r&&(s=o[0]&2?r["return"]:o[0]?r["throw"]||((s=r["return"])&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;if(r=0,s)o=[o[0]&2,s.value];switch(o[0]){case 0:case 1:s=o;break;case 4:n.label++;return{value:o[1],done:false};case 5:n.label++;r=o[1];o=[0];continue;case 7:o=n.ops.pop();n.trys.pop();continue;default:if(!(s=n.trys,s=s.length>0&&s[s.length-1])&&(o[0]===6||o[0]===2)){n=0;continue}if(o[0]===3&&(!s||o[1]>s[0]&&o[1]<s[3])){n.label=o[1];break}if(o[0]===6&&n.label<s[1]){n.label=s[1];s=o;break}if(s&&n.label<s[2]){n.label=s[2];n.ops.push(o);break}if(s[2])n.ops.pop();n.trys.pop();continue}o=t.call(e,n)}catch(e){o=[6,e];r=0}finally{i=s=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}};System.register(["./p-a2d97abb.system.js"],function(e){"use strict";var t,n,i,r,s,o;return{setters:[function(e){t=e.r;n=e.c;i=e.h;r=e.d;s=e.H;o=e.e}],execute:function(){var a=this;var c="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik05NiAyMzVoMzIwdjQySDk2eiI+PC9wYXRoPjwvc3ZnPgo=";var l=e("al_angle_editor",function(){function e(e){t(this,e);this.deleteAngle=n(this,"deleteAngle",7)}e.prototype.render=function(){var e=this;if(this.angle){var t=this.angle[0];return i("form",{onSubmit:function(e){return e.preventDefault()}},i("ion-button",{size:"small",onClick:function(){e.deleteAngle.emit(t);e.angle=null}},i("ion-icon",{src:c})))}return null};Object.defineProperty(e,"style",{get:function(){return""},enumerable:true,configurable:true});return e}());var u="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0xOTIgMTI4bDEyOCAxMjgtMTI4IDEyOHoiPjwvcGF0aD48L3N2Zz4K";var d="Update";var h={update:d};var p=e("al_console",function(){function e(e){t(this,e);this._contentStrings=h;this.tabSize=2;this.graphSubmitted=n(this,"graphSubmitted",7)}e.prototype.render=function(){var e=this;return i("form",{onSubmit:function(e){return e.preventDefault()}},i("ion-item",null,i("ion-textarea",{id:"graph",value:JSON.stringify(JSON.parse(this.graph),undefined,this.tabSize),rows:"10",required:true,onIonChange:function(t){return e.graph=t.detail.value},maxlength:"5000",ref:function(t){return e._graph=t}})),i("ion-item",null,i("ion-button",{size:"small",type:"submit",onClick:function(){if(e.graph){e.graphSubmitted.emit(e._graph.value)}}},i("ion-icon",{src:u})," ",this._contentStrings.update)))};Object.defineProperty(e,"style",{get:function(){return"#graph{--background:var(--al-textarea-background-color);--color:var(--al-textarea-color);--padding-bottom:var(--al-textarea-padding-bottom);--padding-end:var(--al-textarea-padding-end);--padding-start:var(--al-textarea-padding-start);--padding-top:var(--al-textarea-padding-top);font-size:var(--al-console-font-size)}"},enumerable:true,configurable:true});return e}());var g;(function(e){e["NODE"]="node";e["EDGE"]="edge";e["ANGLE"]="angle"})(g||(g={}));var f;(function(e){e["ORBIT"]="orbit";e["TRACKBALL"]="trackball"})(f||(f={}));var E;(function(e){e["SLICES"]="slices";e["VOLUME"]="volume";e["MESH"]="mesh"})(E||(E={}));var v;(function(e){e["DEFAULT"]="default";e["CLAY"]="clay";e["XRAY"]="xray";e["NORMALS"]="normals";e["WIREFRAME"]="wireframe"})(v||(v={}));var m;(function(e){e["GLTF"]="gltf";e["GLB"]="glb"})(m||(m={}));var M;(function(e){e["CORONAL"]="coronal";e["SAGGITAL"]="saggital";e["AXIAL"]="axial"})(M||(M={}));var y;(function(e){e["LOCK"]="LOCK";e["MESH"]="MESH"})(y||(y={}));var _;(function(e){e["METERS"]="m";e["MILLIMETERS"]="mm"})(_||(_={}));var T=function(e,t){return i("div",{style:{"overflow-y":"auto",width:"100%","min-height":"0","max-height":"100%",height:e.height}},t)};var b="console";var S="graph";var N="settings";var L="src";var D={console:b,graph:S,settings:N,src:L};var I=e("al_control_panel",function(){function e(e){t(this,e);this._contentStrings=D;this.angles=null;this.consoleTabEnabled=true;this.displayMode=E.MESH;this.edges=null;this.graphTabEnabled=true;this.nodes=null;this.selected=null;this.settingsTabEnabled=true;this.srcTabEnabled=true;this.tabContentHeight=null;this.url=null;this.urls=null}e.prototype._getGraphJson=function(){if(this.nodes&&this.edges&&this.angles){var e={nodes:Array.from(this.nodes),edges:Array.from(this.edges),angles:Array.from(this.angles)};return JSON.stringify(e)}return""};e.prototype._getSelectedNode=function(){if(this.selected&&this.nodes){var e=this.nodes.get(this.selected);if(e){return[this.selected,e]}}return null};e.prototype._getSelectedEdge=function(){if(this.selected&&this.edges){var e=this.edges.get(this.selected);if(e){return[this.selected,e]}}return null};e.prototype._getSelectedAngle=function(){if(this.selected&&this.angles){var e=this.angles.get(this.selected);if(e){return[this.selected,e]}}return null};e.prototype.render=function(){var e=this.tabContentHeight||this.el.parentElement.clientHeight+"px";return i("ion-app",null,i("al-tabs",null,i("ion-tab-bar",null,this.srcTabEnabled?i("ion-tab-button",{tab:"src"},i("ion-label",null,this._contentStrings.src)):null,this.settingsTabEnabled?i("ion-tab-button",{tab:"settings"},i("ion-label",null,this._contentStrings.settings)):null,this.graphTabEnabled?i("ion-tab-button",{tab:"graph"},i("ion-label",null,this._contentStrings.graph)):null,this.consoleTabEnabled?i("ion-tab-button",{tab:"console"},i("ion-label",null,this._contentStrings.console)):null),this.srcTabEnabled?i("ion-tab",{tab:"src"},i("al-url-picker",{urls:this.urls,url:this.url})):null,this.settingsTabEnabled?i("ion-tab",{tab:"settings"},i(T,{height:e},i("al-settings",{"display-mode":this.displayMode,stackhelper:this.stackhelper}))):null,this.graphTabEnabled?i("ion-tab",{tab:"graph"},i(T,{height:e},i("al-node-list",{nodes:this.nodes,selected:this.selected}),i("ion-item-divider",null),i("al-node-editor",{node:this._getSelectedNode()}),i("al-edge-editor",{edge:this._getSelectedEdge()}),i("al-angle-editor",{angle:this._getSelectedAngle()}))):null,this.consoleTabEnabled?i("ion-tab",{tab:"console"},i(T,{height:e},i("al-console",{graph:this._getGraphJson()}))):null))};e.prototype.selectedChangedHandler=function(e){this.selected=e.detail};Object.defineProperty(e.prototype,"el",{get:function(){return r(this)},enumerable:true,configurable:true});Object.defineProperty(e,"style",{get:function(){return""},enumerable:true,configurable:true});return e}());var w=e("al_edge_editor",function(){function e(e){t(this,e);this.deleteEdge=n(this,"deleteEdge",7)}e.prototype.render=function(){var e=this;if(this.edge){var t=this.edge[0];return i("form",{onSubmit:function(e){return e.preventDefault()}},i("ion-button",{size:"small",onClick:function(){e.deleteEdge.emit(t);e.edge=null}},i("ion-icon",{src:c})))}return null};Object.defineProperty(e,"style",{get:function(){return""},enumerable:true,configurable:true});return e}());var A="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0xODYuMzAxIDMzOS44OTNMOTYgMjQ5LjQ2MWwtMzIgMzAuNTA3TDE4Ni4zMDEgNDAyIDQ0OCAxNDAuNTA2IDQxNiAxMTB6Ij48L3BhdGg+PC9zdmc+Cg==";var C="Description";var O="Title";var j="Update";var x={delete:"Delete",description:C,title:O,update:j};var P=e("al_node_editor",function(){function e(e){t(this,e);this._contentStrings=x;this.deleteNode=n(this,"deleteNode",7);this.saveNode=n(this,"saveNode",7)}e.prototype.render=function(){var e=this;if(this.node){var t=this.node,n=t[0],r=t[1];return i("form",{onSubmit:function(e){return e.preventDefault()}},i("ion-item",null,i("ion-input",{id:"title",value:r.title,placeholder:this._contentStrings.title,required:true,onIonChange:function(e){return r.title=e.detail.value},maxlength:"30"})),i("ion-item",null,i("ion-textarea",{id:"description",value:r.description,placeholder:this._contentStrings.description,rows:"5",onIonChange:function(e){return r.description=e.detail.value},maxlength:"280"})),i("ion-item",null,i("ion-button",{size:"small",onClick:function(){e.deleteNode.emit(n);e.node=null}},i("ion-icon",{src:c})," ",this._contentStrings.delete),i("ion-button",{size:"small",type:"submit",onClick:function(){if(r.title){e.saveNode.emit([n,r])}}},i("ion-icon",{src:A})," ",this._contentStrings.update)))}return null};Object.defineProperty(e,"style",{get:function(){return"#title{--background:var(--al-input-background-color);--color:var(--al-input-color);--padding-bottom:var(--al-input-padding-bottom);--padding-end:var(--al-input-padding-end);--padding-start:var(--al-input-padding-start);--padding-top:var(--al-input-padding-top);font-size:var(--al-input-font-size)}#description{--background:var(--al-textarea-background-color);--color:var(--al-textarea-color);--padding-bottom:var(--al-textarea-padding-bottom);--padding-end:var(--al-textarea-padding-end);--padding-start:var(--al-textarea-padding-start);--padding-top:var(--al-textarea-padding-top);font-size:var(--al-textarea-font-size)}"},enumerable:true,configurable:true});return e}());var z="No nodes exist";var R={noneExist:z};var k=e("al_node_list",function(){function e(e){t(this,e);this._contentStrings=R;this.nodes=null;this.selected=null;this.selectedChanged=n(this,"selectedChanged",7)}e.prototype.render=function(){var e=this;if(this.nodes&&this.nodes.size){return i("ion-list",null,Array.from(this.nodes).map(function(t){var n=t[0],r=t[1];return i("ion-item",{selected:e.selected===n?true:false,onClick:function(){return e.selectedChanged.emit(n)}},r.title)}))}return i("p",null,this._contentStrings.noneExist)};Object.defineProperty(e,"style",{get:function(){return"ion-item{--color:var(--al-item-color);--border-color:var(--al-item-border-color)}ion-item[selected]{--color:var(--al-item-selected-color)}"},enumerable:true,configurable:true});return e}());var W="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik00NjcuMyAxNjguMWMtMS44IDAtMy41LjMtNS4xIDFsLTE3Ny42IDkyLjFoLS4xYy03LjYgNC43LTEyLjUgMTIuNS0xMi41IDIxLjR2MTg1LjljMCA2LjQgNS42IDExLjUgMTIuNyAxMS41IDIuMiAwIDQuMy0uNSA2LjEtMS40LjItLjEuNC0uMi41LS4zTDQ2NiAzODUuNmwuMy0uMWM4LjItNC41IDEzLjctMTIuNyAxMy43LTIyLjFWMTc5LjZjMC02LjQtNS43LTExLjUtMTIuNy0xMS41ek00NTQuMyAxMTguNUwyNzIuNiAzNi44UzI2MS45IDMyIDI1NiAzMmMtNS45IDAtMTYuNSA0LjgtMTYuNSA0LjhMNTcuNiAxMTguNXMtOCAzLjMtOCA5LjVjMCA2LjYgOC4zIDExLjUgOC4zIDExLjVsMTg1LjUgOTcuOGMzLjggMS43IDguMSAyLjYgMTIuNiAyLjYgNC42IDAgOC45LTEgMTIuNy0yLjdsMTg1LjQtOTcuOXM3LjUtNCA3LjUtMTEuNWMuMS02LjMtNy4zLTkuMy03LjMtOS4zek0yMjcuNSAyNjEuMkw0OS44IDE2OWMtMS41LS42LTMuMy0xLTUuMS0xLTcgMC0xMi43IDUuMS0xMi43IDExLjV2MTgzLjhjMCA5LjQgNS41IDE3LjYgMTMuNyAyMi4xbC4yLjEgMTc0LjcgOTIuN2MxLjkgMS4xIDQuMiAxLjcgNi42IDEuNyA3IDAgMTIuNy01LjIgMTIuNy0xMS41VjI4Mi42Yy4xLTguOS00LjktMTYuOC0xMi40LTIxLjR6Ij48L3BhdGg+PC9zdmc+Cg==";var U="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNzcuMyAzMmgtNDIuN3Y2NGg0Mi43VjMyem0xMjkuMSA0My43TDM2OCAxMTQuMWwyOS45IDI5LjkgMzguNC0zOC40LTI5LjktMjkuOXptLTMwMC44IDBsLTI5LjkgMjkuOSAzOC40IDM4LjQgMjkuOS0yOS45LTM4LjQtMzguNHpNMjU2IDEyOGMtNzAuNCAwLTEyOCA1Ny42LTEyOCAxMjhzNTcuNiAxMjggMTI4IDEyOCAxMjgtNTcuNiAxMjgtMTI4LTU3LjYtMTI4LTEyOC0xMjh6bTIyNCAxMDYuN2gtNjR2NDIuN2g2NHYtNDIuN3ptLTM4NCAwSDMydjQyLjdoNjR2LTQyLjd6TTM5Ny45IDM2OEwzNjggMzk3LjlsMzguNCAzOC40IDI5LjktMjkuOS0zOC40LTM4LjR6bS0yODMuOCAwbC0zOC40IDM4LjQgMjkuOSAyOS45IDM4LjQtMzguNC0yOS45LTI5Ljl6bTE2My4yIDQ4aC00Mi43djY0aDQyLjd2LTY0eiI+PC9wYXRoPjwvc3ZnPgo=";var H="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNTYgNDhDMTQxLjEgNDggNDggMTQxLjEgNDggMjU2czkzLjEgMjA4IDIwOCAyMDggMjA4LTkzLjEgMjA4LTIwOFMzNzAuOSA0OCAyNTYgNDh6bTExMy4xIDMyMS4xQzMzOC45IDM5OS40IDI5OC43IDQxNiAyNTYgNDE2Vjk2YzQyLjcgMCA4Mi45IDE2LjYgMTEzLjEgNDYuOUMzOTkuNCAxNzMuMSA0MTYgMjEzLjMgNDE2IDI1NnMtMTYuNiA4Mi45LTQ2LjkgMTEzLjF6Ij48L3BhdGg+PC9zdmc+Cg==";var Y="data:image/svg+xml;base64,PHN2ZwogICB2aWV3Qm94PSIwIDAgNTEyIDUxMiIKICAgY2xhc3M9InMtaW9uLWljb24iPgogIDxwYXRoCiAgICAgZD0ibSAyNDEuMTA0ODIsMzQuNzUwNzA3IGMgLTEwLjQ4NzE4LDIuMjcyMzkyIC0yMS42MjIyOSw4LjU0MzQxNyAtMjkuODQxNywxNi43NTgyMTYgLTMyLjMyNjk4LDMyLjMyNjk3OCAtMTkuMzU0NTQsODYuMjgwODQ3IDI0LjMyNTA1LDEwMS42MzIwODcgbCA1LjYyMzA5LDEuOTQ4NDUgMC4zMjM5NiwxMC43MDQ2NyAwLjMyMzk3LDEwLjcwNDY4IC00LjY1MTE5LDIuMjcyMzkgYyAtMTMuOTM5NzEsNi45MDk2OSAtMTY2LjQ5ODk1NSw5Ni4wMDQ0MSAtMTcwLjgyMTU1OSw5OS43ODU1IC0zLjQ1NzE1NSwyLjkyMDMyIC02LjQ4ODUzMyw3LjEzNjQ4IC05LjE5MTMxNSwxMi43NTk1OCBsIC00LjEwOTcxNCw4LjIxNDgxIC0wLjMyMzk2OCwyOS40MDY2NSBjIC0wLjMyMzk2MiwyNy41NjkzIC0wLjIxNzUxNCwyOS43MzUyNCAxLjk0Mzc4NiwzNi4xMTI3MiAyLjU5NjMzOSw3LjU2Njg3IDYuNTk0OTgxLDEzLjk0ODkyIDEyLjExMTYyMiwxOS4wMzA1NiAzLjQ2MTc4OCwzLjM1MDcgMTYyLjYxMTM3OCw5NS42ODUwNCAxNzIuNTU3MDY4LDEwMC4yMjUxOSA3LjEzNjQ4LDMuMjQ0MjUgMjMuNDY0MjYsMy4zNTA3MSAzMC41OTYxLDAuMTExMTEgMi43MDI3OSwtMS4yOTU5IDQxLjg0MjIxLC0yMy41NzA3MSA4Ny4wMzUxOCwtNDkuNjI2NjcgNTIuNzY0NDcsLTMwLjM4MzIxIDgzLjY4NDUzLC00OC44Njc2NyA4Ni43MTEyOSwtNTEuNzg3OTMgMi41OTYzMywtMi40ODUzIDYuMzc3NDIsLTguMDAxOTUgOC42NDk4MiwtMTIuNDM1NTkgbCAzLjk5ODYzLC04LjEwODM1IHYgLTMxLjQ2MTUyIC0zMS40NjE1MyBsIC00LjEwOTcxLC04LjIxNDggYyAtMi43MDI3OCwtNS42MjMxIC01LjcyOTUsLTkuNzMyODEgLTkuMTkxMjksLTEyLjc1OTU4IC00LjMyMjYyLC0zLjc4NTcyIC0xNTYuODgxODUsLTkyLjg3NTgxIC0xNzAuODI2MiwtOTkuNzk0NzUgbCAtNC42NTExOCwtMi4yNzIzOSAwLjMyMzk4LC0xMC44MTExNCAwLjMyMzk0LC0xMC43MDQ2NiA0LjQzMzcsLTEuMjk1ODYgYyAxNS4xMzgzMiwtNC40MzM3IDI5LjczMDYsLTE2Ljk3NTc1IDM3LjA4NDU3LC0zMS44OTY1OSAyMi43MTQ1MSwtNDYuMjc1OTM2IC0xOC4xNTU4MywtOTguMDYzOTE3IC02OC42NDc5MywtODcuMDM1MjUzIHogbSA0LjQzMzY2LDEyLjU0MjA0OSBjIDguNzU2MjcsMi40ODUyNDYgMTYuNzU4MjIsMTMuNDA3NDU1IDE2Ljc1ODIyLDIzLjEzNTY0IDAsMTIuODY1OTg1IC0xMS40NTkxLDI0LjMyNTA4OSAtMjQuMzI1MDgsMjQuMzI1MDg5IC02LjQ4ODUzLDAgLTExLjg5NDEsLTIuMzc4ODM2IC0xNi44NjQ2MywtNy40NjA0MTYgLTkuODM5MjUsLTkuNzMyODEyIC0xMC4wNTY3NiwtMjMuMzUzMTc5IC0wLjY0Nzk0LC0zMy4zMDM1MjggNi44MDc4OSwtNy4xMzE4MDMgMTUuMjQwMiwtOS40MDQxOTYgMjUuMDc5NDMsLTYuNjk2Nzg1IHogbSAtMy41NjgyMiwyMDcuMzY5MzA0IGMgMC4zMjM5NiwxNi40MzQyMiAwLjQzMDQxLDE3LjQwNjEzIDIuOTIwMzEsMjAuMDAyNDcgNS42MjMwOSw1Ljk0NzAzIDE0LjA1NTQzLDUuOTQ3MDMgMTkuNjc4NDcsMCAyLjQ4NTMsLTIuNTk2MzQgMi41OTYzOCwtMy41NjgyNSAyLjkyMDMxLC0yMC4wMDI0NyAwLjQzNTAyLC0xOS43ODQ5NCAtMC42NDc5MSwtMTguNDg5MSAxMi4xMTE2MiwtMTQuOTIwODUgMTcuMDgyMTQsNC42NDY1NiAzMi4wMDMwNSwxNS41Njg3NiAzOC40OTE1NSwyOC4wMDQzNiAyLjgxMzg2LDUuMjk5MTIgMy4xMzc4NCw3LjAzMDA0IDMuMTM3ODQsMTYuMjE2NjkgMCw5LjE5MTM1IC0wLjMyMzk4LDEwLjkxNzU5IC0zLjEzNzg0LDE2LjIxNjc0IC00LjY1MTE5LDguNzU2MjcgLTE0LjA1NTM4LDE3LjQwNjA5IC0yNC42NDkwMywyMi41OTg4MSAtMTMuNzMxNDQsNi44MTI0OSAtMjAuNDMyODYsOC4yMTk0MyAtMzguNzA0NDEsOC4yMTk0MyAtMTguMjcxNTgsMCAtMjQuOTc3NjMsLTEuNDA2OTQgLTM4LjcwNDQ0LC04LjIxOTQzIC0xMC41OTgyNCwtNS4xODgwOSAtMjAuMDAyNDYsLTEzLjgzNzkxIC0yNC42NTM2NiwtMjIuNTk4ODEgLTIuODA5MjMsLTUuMjk5MTUgLTMuMTMzMTksLTcuMDI1MzkgLTMuMTMzMTksLTE2LjIxNjc0IDAsLTkuMTkxMjggMC4zMjM5NiwtMTAuOTIyMiAzLjEzMzE5LC0xNi4yMTY2OSA2LjM3NzQ3LC0xMi4yMTgwNSAyMC41NDM5NCwtMjIuNzA1MjUgMzcuNDA4NTgsLTI3Ljc4NjgyIDEzLjgyODY0LC00LjEwOTcxIDEyLjc1MDI5LC01LjI5OTE2IDEzLjE4MDcsMTQuNzAzMzEgeiBtIC0xMDMuMjUxOTMsMTcuNjIzNjIgYyA5LjYyMTczLDQuNDMzNyAxMi4xMDcsMTMuNTEzOTUgNS43Mjk1MywyMC43NTY4NSAtNC41NDAxMSw1LjE5MjY1IC0xMS4xMzUwOSw3LjQ2MDQyIC0xOS42Nzg0OCw2LjkxODk0IC0xNS45OTkyLC0wLjk3MTkxIC0yNS40MDgwMzcsLTEzLjA4MzUyIC0xNy41MTcxOSwtMjIuNDg3NzEgNy4wMzAwMSwtOC4zMjEyNSAyMC4yMTk5NywtMTAuNDg3MTkgMzEuNDY2MTQsLTUuMTg4MDggeiIgLz4KPC9zdmc+Cg==";var F="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNTYgMTA1Yy0xMDEuOCAwLTE4OC40IDYyLjQtMjI0IDE1MSAzNS42IDg4LjYgMTIyLjIgMTUxIDIyNCAxNTFzMTg4LjQtNjIuNCAyMjQtMTUxYy0zNS42LTg4LjYtMTIyLjItMTUxLTIyNC0xNTF6bTAgMjUxLjdjLTU2IDAtMTAxLjgtNDUuMy0xMDEuOC0xMDAuN1MyMDAgMTU1LjMgMjU2IDE1NS4zIDM1Ny44IDIwMC42IDM1Ny44IDI1NiAzMTIgMzU2LjcgMjU2IDM1Ni43em0wLTE2MS4xYy0zMy42IDAtNjEuMSAyNy4yLTYxLjEgNjAuNHMyNy41IDYwLjQgNjEuMSA2MC40IDYxLjEtMjcuMiA2MS4xLTYwLjQtMjcuNS02MC40LTYxLjEtNjAuNHoiPjwvcGF0aD48L3N2Zz4K";var V="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNTYgNDhDMTQxLjEyNSA0OCA0OCAxNDEuMTI1IDQ4IDI1NnM5My4xMjUgMjA4IDIwOCAyMDggMjA4LTkzLjEyNSAyMDgtMjA4UzM3MC44NzUgNDggMjU2IDQ4em0xMDcgMjI5aC04NnY4NmgtNDJ2LTg2aC04NnYtNDJoODZ2LTg2aDQydjg2aDg2djQyeiI+PC9wYXRoPjwvc3ZnPgo=";var Q="data:image/svg+xml;base64,PHN2ZwogICB2aWV3Qm94PSIwIDAgNTEyIDUxMiIKICAgY2xhc3M9InMtaW9uLWljb24iPgogIDxwYXRoCiAgICAgZD0iTSAyNTYuOTgwNDcgNDguODk2NDg0IEEgMjA2LjEzODU3IDIwNi4xMzg1NyAwIDAgMCA1MC44NDE3OTcgMjU1LjAzNTE2IEEgMjA2LjEzODU3IDIwNi4xMzg1NyAwIDAgMCAyNTYuOTgwNDcgNDYxLjE3MzgzIEEgMjA2LjEzODU3IDIwNi4xMzg1NyAwIDAgMCA0NjMuMTE5MTQgMjU1LjAzNTE2IEEgMjA2LjEzODU3IDIwNi4xMzg1NyAwIDAgMCAyNTYuOTgwNDcgNDguODk2NDg0IHogTSAyNTcuNjczODMgODcuNjc1NzgxIEEgMTY3Ljk4OTU1IDE2Ny45ODk1NSAwIDAgMSA0MjUuMzAwNzggMjQ1LjQ0NTMxIEMgNDEyLjg3ODY2IDI1Ni41Nzk3NCAzODguOTQyNjMgMjc0LjE5MDk2IDM1MS4zNjUyMyAyODYuNDUzMTIgQyAzMDAuMzIxODIgMzAzLjEwOTQ5IDI1Ny42NjYwMiAzMDEuODQ1NyAyNTcuNjY2MDIgMzAxLjg0NTcgTCAyNTguMjY3NTggNDIzLjYzMjgxIEEgMTY3Ljk4OTU1IDE2Ny45ODk1NSAwIDAgMSAyNTcuNjczODMgNDIzLjY1NDMgQSAxNjcuOTg5NTUgMTY3Ljk4OTU1IDAgMCAxIDg5LjY4MzU5NCAyNTUuNjY2MDIgQSAxNjcuOTg5NTUgMTY3Ljk4OTU1IDAgMCAxIDkwLjIxNjc5NyAyNDUgQyAxMDIuNDg2NzcgMjU2LjEwMzYxIDEyNi41NDYxNSAyNzQuMDIxNTkgMTY0LjY0MjU4IDI4Ni40NTMxMiBDIDIxNS42ODYgMzAzLjEwOTQ4IDI1Ny42NjYwMiAzMDEuODQ1NyAyNTcuNjY2MDIgMzAxLjg0NTcgTCAyNTcuNjczODMgODcuNjc1NzgxIHogIgogICAgIGlkPSJwYXRoODM2IiAvPgo8L3N2Zz4K";var B="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNTYgMjMxLjM1OGMtMTMuNDQyIDAtMjQuNjQzIDExLjItMjQuNjQzIDI0LjY0MnMxMS4yIDI0LjY0MyAyNC42NDMgMjQuNjQzIDI0LjY0My0xMS4yIDI0LjY0My0yNC42NDMtMTEuMjAxLTI0LjY0Mi0yNC42NDMtMjQuNjQyek0yNTYgMzJDMTMyLjggMzIgMzIgMTMyLjggMzIgMjU2czEwMC44IDIyNCAyMjQgMjI0IDIyNC0xMDAuOCAyMjQtMjI0UzM3OS4yIDMyIDI1NiAzMnptNDkuMjg0IDI3My4yODRMMTIxLjYgMzkwLjRsODUuMTE2LTE4My42NzlMMzkwLjQgMTIxLjZsLTg1LjExNiAxODMuNjg0eiI+PC9wYXRoPjwvc3ZnPgo=";var G="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNTYgNDhjLTQyLjkgMC04NC4yIDEzLTExOS4yIDM3LjUtMzQuMiAyNC02MC4yIDU3LjItNzUuMSA5Ni4xTDU4IDE5Mmg0NS43bDEuOS01YzguMi0xNy44IDE5LjQtMzMuOSAzMy41LTQ4IDMxLjItMzEuMiA3Mi43LTQ4LjQgMTE2LjktNDguNHM4NS43IDE3LjIgMTE2LjkgNDguNGMzMS4yIDMxLjIgNDguNCA3Mi43IDQ4LjQgMTE2LjkgMCA0NC4xLTE3LjIgODUuNy00OC40IDExNi45LTMxLjIgMzEuMi03Mi43IDQ4LjQtMTE2LjkgNDguNC00NC4xIDAtODUuNi0xNy4yLTExNi45LTQ4LjQtMTQtMTQtMjUuMy0zMC4xLTMzLjUtNDcuOWwtMS45LTVINThsMy42IDEwLjRjMTQuOSAzOC45IDQwLjkgNzIuMSA3NS4xIDk2LjFDMTcxLjggNDUxLjEgMjEzIDQ2NCAyNTYgNDY0YzExNC43IDAgMjA4LTkzLjMgMjA4LTIwOFMzNzAuNyA0OCAyNTYgNDh6Ij48L3BhdGg+PHBhdGggZD0iTTQ4IDI3Ny40aDE4OS43bC00My42IDQ0LjdMMjI0IDM1Mmw5Ni05Ni05Ni05Ni0zMSAyOS45IDQ0LjcgNDQuN0g0OHY0Mi44eiI+PC9wYXRoPjwvc3ZnPgo=";var X="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0xMzEuMyAyMzEuMUwzMiAzMzAuNmw5OS4zIDk5LjR2LTc0LjZoMTc0LjV2LTQ5LjdIMTMxLjN2LTc0LjZ6TTQ4MCAxODEuNEwzODAuNyA4MnY3NC42SDIwNi4ydjQ5LjdoMTc0LjV2NzQuNmw5OS4zLTk5LjV6Ij48L3BhdGg+PC9zdmc+Cg==";var Z="data:image/svg+xml;base64,PHN2ZwogICB2aWV3Qm94PSIwIDAgNTEyIDUxMiIKICAgY2xhc3M9InMtaW9uLWljb24iPgogIDxwYXRoCiAgICAgZD0iTSAzNzQuNDQxNzQsMTYyLjM0MTQ4IEMgMzIwLjYzNTAzLDExOC4xOTQ1IDI0Ni44MzkzMywxMDcuNTMwNTQgMTgzLjc4NTg3LDEzNC43NzA4IGMgLTI0LjMxODksMTAuNDk0NDIgLTQzLjcyOTY4LDI0LjQwMTUxIC02Mi42MzYxNSw0NC44MTIxNiAtMjkuNTcwNDQsMzEuOTAwNTkgLTQ1LjgwNzY1OSw2OS42MzA5MyAtNDguNzI0Njk5LDExMy4wMzAyMSBsIC0wLjgzNDcwMSwxMi40OTQxOCAtMTAuNzQyMjMzLDAuMDgyNSAtMTAuODI0ODA0LDFlLTUgNWUtNiw0Mi40ODE5OCAxLjVlLTUsNDIuNDgxOTcgMjA2LjU2MjcxNywtMC4wMTMxIDIwNi41NjcwNywxMGUtNiAtNmUtNSwtNDIuNDgxOTggNWUtNSwtNDIuNDgxOTkgLTEwLjQ5ODc4LDAuMDA0IGMgLTUuNjYwMjEsMS4zZS00IC0xMC42NjM5NCwtMC4zMzQ3NCAtMTEuMDc2OTQsLTAuNzQ3NzMgLTAuMzMwMzUsLTAuMzMwNDMgLTAuODMwMzUsLTUuNjY0NTcgLTEuMDgyNDgsLTExLjc0MjEyIC0xLjgzNDU3LC00Ny44MTE3OSAtMjcuNzM1ODksLTk4Ljg2NjY0IC02Ni4wNTMxMywtMTMwLjM0OTkyIHogbSAtMjUuNTcwOTEsODUuODY4MTkgYyA5LjI0Njc0LDE1LjU3NjQzIDE0LjU3MjIsMzIuOTAwNDkgMTUuNjU5MDUsNTAuMzA3MTQgbCAwLjQxNzM1LDYuNzQ3MDUgLTEwOC4zNjEyMywtMC4wNzgzIC0xMDguMzY1NTUsLTAuMDgyNiAwLjQxNzM2LC04LjU4MTYzIGMgMC45OTk4OCwtMTYuODI0MTEgNy42NTk5OSwtMzYuNjQ3ODUgMTcuNDkzNjEsLTUxLjQ3MjIgNi40MTY2MywtOS45MTE4OCAyMS4yNDA5NywtMjQuNzM2MjMgMzEuMjM1NDcsLTMxLjIzNTQ4IDI2LjczNTk5LC0xNy41NzE4NSA2Mi42MzYxLC0yMi4zMTkxMSA5My42MTk0NCwtMTIuMTU5NDQgNy44Mjk1MiwyLjY2NDg1IDIzLjA3MTIsMTAuNTc3MDIgMzAuNTcwMzMsMTYuMDc2MzggOC4zMjUxMiw2LjE2MDE1IDIxLjgxNDgzLDIxLjE1NDAxIDI3LjMxNDE3LDMwLjQ3OTAzIHoiCiAvPgo8L3N2Zz4K";var K=function(){function e(){}return e}();K.controllerName="-controller";K.edgeSize=.005;K.fontSizeLarge=1.6;K.fontSizeMedium=.7;K.fontSizeSmall=.5;K.maxAnimationSteps=50;K.minLoadingMS=500;K.movedEventName="-moved";K.nodeSizeRatio=100;K.stackSpaceMultiplier={x:10,y:10,z:10};K.stepsIncrement=8;K.stepsMax=512;K.stepsMin=1;K.titleIdName="-title";K.topLayerRenderOrder=999;K.unitsDecimalPlaces=2;K.zoomFactor=2.5;K.frustrumScaleFactor=.7;K.textPadding={width:.03,height:.03};K.minFrameMS=15;K.minTimeForThrottle=K.minFrameMS*5;K.buttonColors={active:"#f50057",hover:"#f50057",up:"#00b0ff"};K.colorValues={red:"#f50057",blue:"#00b0ff",black:"#000000",grey:"#222222",white:"#ffffff",yellow:"#ffeb3b",green:"#76ff03",lightRed:"#f77777"};K.lightValues={ambientLightColor:13684944,ambientLightIntensity:1,directionalLight1Color:16777215,directionalLight1Intensity:.75,directionalLight2Color:10584,directionalLight2Intensity:.5};K.cameraValues={near:.05,far:1e4,fov:45,maxPolarAngle:175,rotateSpeed:.5,zoomSpeed:1,panSpeed:.9,dampingFactor:.25,minDistance:0};var q="Axial";var J="Bounding Box Enabled";var $="Brightness";var ee="Clay";var te="Contrast";var ne="Controls Type";var ie="Coronal";var re="Display Mode";var se="Graph Enabled";var oe="Material";var ae="Meters";var ce="Millimeters";var le="Normals";var ue="Orbit";var de="Orientation";var he="Recenter";var pe="Render Steps";var ge="Saggital";var fe="Slice Index";var Ee="Slices";var ve="Trackball";var me="Units";var Me="Volume";var ye="Wireframe";var _e="XRay";var Te={axial:q,boundingBoxEnabled:J,brightness:$,clay:ee,contrast:te,controlsType:ne,coronal:ie,default:"Default",displayMode:re,graphEnabled:se,material:oe,meters:ae,millimeters:ce,normals:le,orbit:ue,orientation:de,recenter:he,renderSteps:pe,saggital:ge,sliceIndex:fe,slices:Ee,trackball:ve,units:me,volume:Me,wireframe:ye,xray:_e};var be=e("al_settings",function(){function e(e){t(this,e);this._contentStrings=Te;this.boundingBoxEnabled=false;this.controlsType=f.ORBIT;this.displayMode=E.MESH;this.material=v.DEFAULT;this.orientation=M.CORONAL;this.graphEnabled=false;this.units=_.METERS;this.boundingBoxEnabledChanged=n(this,"boundingBoxEnabledChanged",7);this.controlsTypeChanged=n(this,"controlsTypeChanged",7);this.displayModeChanged=n(this,"displayModeChanged",7);this.materialChanged=n(this,"materialChanged",7);this.orientationChanged=n(this,"orientationChanged",7);this.recenter=n(this,"recenter",7);this.slicesIndexChanged=n(this,"slicesIndexChanged",7);this.slicesWindowCenterChanged=n(this,"slicesWindowCenterChanged",7);this.slicesWindowWidthChanged=n(this,"slicesWindowWidthChanged",7);this.unitsChanged=n(this,"unitsChanged",7);this.graphEnabledChanged=n(this,"graphEnabledChanged",7);this.volumeStepsChanged=n(this,"volumeStepsChanged",7);this.volumeWindowCenterChanged=n(this,"volumeWindowCenterChanged",7);this.volumeWindowWidthChanged=n(this,"volumeWindowWidthChanged",7)}e.prototype.watchStackhelper=function(){this.slicesIndex=undefined;this.slicesWindowCenter=undefined;this.slicesWindowWidth=undefined;this.volumeSteps=undefined;this.volumeWindowCenter=undefined;this.volumeWindowWidth=undefined};e.prototype._boundingBoxEnabled=function(e){this.boundingBoxEnabled=e;this.boundingBoxEnabledChanged.emit(e)};e.prototype._controlsType=function(e){this.controlsType=e;this.controlsTypeChanged.emit(e)};e.prototype._displayMode=function(e){this.displayMode=e;this.displayModeChanged.emit(e)};e.prototype._graphEnabled=function(e){this.graphEnabled=e;this.graphEnabledChanged.emit(e)};e.prototype._material=function(e){this.material=e;this.materialChanged.emit(e)};e.prototype._orientation=function(e){this.orientation=e;this.orientationChanged.emit(e)};e.prototype._slicesIndex=function(e){this.slicesIndex=e;this.slicesIndexChanged.emit(e)};e.prototype._slicesWindowCenter=function(e){this.slicesWindowCenter=e;this.slicesWindowCenterChanged.emit(e)};e.prototype._slicesWindowWidth=function(e){this.slicesWindowWidth=e;this.slicesWindowWidthChanged.emit(e)};e.prototype._units=function(e){this.units=e;this.unitsChanged.emit(e)};e.prototype._volumeSteps=function(e){this.volumeSteps=e;this.volumeStepsChanged.emit(e)};e.prototype._volumeWindowCenter=function(e){this.volumeWindowCenter=e;this.volumeWindowCenterChanged.emit(e)};e.prototype._volumeWindowWidth=function(e){this.volumeWindowWidth=e;this.volumeWindowWidthChanged.emit(e)};e.prototype.renderDisplayModeToggle=function(){var e=this;if(this.displayMode!==E.MESH){return i("ion-item",{style:{display:"var(--display-mode-display, block)"}},i("ion-icon",{src:F,slot:"start",title:this._contentStrings.displayMode}),i("select",{slot:"end",onChange:function(t){return e._displayMode(t.srcElement.value)}},i("option",{selected:this.displayMode===E.SLICES,value:E.SLICES},this._contentStrings.slices),i("option",{selected:this.displayMode===E.VOLUME,value:E.VOLUME},this._contentStrings.volume)))}return null};e.prototype.renderGraphEnabled=function(){var e=this;return i("ion-item",{style:{display:"var(--graph-enabled-display, block)"}},i("ion-icon",{src:V,slot:"start",title:this._contentStrings.graphEnabled}),i("ion-toggle",{slot:"end",checked:this.graphEnabled,onIonChange:function(t){return e._graphEnabled(t.detail.checked)}}))};e.prototype.renderBoundingBoxEnabled=function(){var e=this;return i("ion-item",{style:{display:"var(--bounding-box-enabled-display, block)"}},i("ion-icon",{src:W,slot:"start",title:this._contentStrings.boundingBoxEnabled}),i("ion-toggle",{slot:"end",checked:this.boundingBoxEnabled,onIonChange:function(t){return e._boundingBoxEnabled(t.detail.checked)}}))};e.prototype.renderControlsTypeSelect=function(){var e=this;return i("ion-item",{style:{display:"var(--controls-type-display, block)"}},i("ion-icon",{src:Y,slot:"start",title:this._contentStrings.controlsType}),i("select",{slot:"end",onChange:function(t){return e._controlsType(t.srcElement.value)}},i("option",{selected:this.controlsType===f.ORBIT,value:f.ORBIT},this._contentStrings.orbit),i("option",{selected:this.controlsType===f.TRACKBALL,value:f.TRACKBALL},this._contentStrings.trackball)))};e.prototype.renderRecenterButton=function(){var e=this;return i("ion-item",{style:{display:"var(--recenter-display, block)"}},i("ion-icon",{src:G,slot:"start",title:this._contentStrings.recenter}),i("ion-button",{slot:"end",size:"small",onClick:function(){e.recenter.emit()}},this._contentStrings.recenter))};e.prototype.renderUnitsSelect=function(){var e=this;return i("ion-item",{style:{display:"var(--units-display, block)"}},i("ion-icon",{src:Z,slot:"start",title:this._contentStrings.units}),i("select",{slot:"end",onChange:function(t){return e._units(t.srcElement.value)}},i("option",{selected:this.units===_.METERS,value:_.METERS},this._contentStrings.meters),i("option",{selected:this.units===_.MILLIMETERS,value:_.MILLIMETERS},this._contentStrings.millimeters)))};e.prototype.renderMaterialSelect=function(){var e=this;return i("ion-item",{style:{display:"var(--material-display, block)"}},i("ion-icon",{src:Q,slot:"start",title:this._contentStrings.material}),i("select",{slot:"end",onChange:function(t){return e._material(t.srcElement.value)}},i("option",{selected:this.material===v.DEFAULT,value:v.DEFAULT},this._contentStrings.default),i("option",{selected:this.material===v.CLAY,value:v.CLAY},this._contentStrings.clay),i("option",{selected:this.material===v.NORMALS,value:v.NORMALS},this._contentStrings.normals),i("option",{selected:this.material===v.WIREFRAME,value:v.WIREFRAME},this._contentStrings.wireframe),i("option",{selected:this.material===v.XRAY,value:v.XRAY},this._contentStrings.xray)))};e.prototype.renderGenericOptions=function(){return[this.renderBoundingBoxEnabled(),this.renderControlsTypeSelect(),this.renderRecenterButton(),this.renderUnitsSelect()]};e.prototype._reverseNumber=function(e,t,n){return n+t-e};e.prototype.renderOptions=function(){var e=this;switch(this.displayMode){case E.SLICES:{if(!this.stackhelper||this.stackhelper&&!this.stackhelper.slice){break}var t=Object.keys(M).indexOf(this.orientation.toUpperCase());var n=this.stackhelper.stack.zCosine;var r=void 0;if(Math.round(n.x)===1){r=1}else if(Math.round(n.y)===1){r=2}else{r=0}var s=Math.round((t+r)%3);var o=Math.round((t+r+2)%3);var a=this.stackhelper.stack.dimensionsIJK[Object.keys(this.stackhelper.stack.dimensionsIJK)[o]]-1;var c=void 0;if(o!==this._lastStackOrientationIndex||this.slicesIndex===undefined){c=Math.floor(a/2)}else{c=this.slicesIndex}this._lastStackOrientationIndex=o;var l=1;var u=this.stackhelper.stack.minMax[1]-this.stackhelper.stack.minMax[0];var d=void 0;if(this.slicesWindowWidth===undefined){d=u/2}else{d=this.slicesWindowWidth}var h=this.stackhelper.stack.minMax[0];var p=this.stackhelper.stack.minMax[1];var g=void 0;if(this.slicesWindowCenter===undefined){g=p/2}else{g=this.slicesWindowCenter}this.stackhelper.orientation=s;this.stackhelper.index=c;this.stackhelper.slice.windowWidth=d;this.stackhelper.slice.windowCenter=g;return i("div",null,this.renderGenericOptions(),i("ion-item",{style:{display:"var(--slices-index-display, block)"}},i("ion-icon",{src:X,slot:"start",title:this._contentStrings.sliceIndex}),i("ion-range",{slot:"end",min:"0",max:a,value:c,pin:true,onIonChange:function(t){return e._slicesIndex(t.detail.value)}})),i("ion-item",{style:{display:"var(--slices-orientation-display, block)"}},i("ion-icon",{src:B,slot:"start",title:this._contentStrings.orientation}),i("select",{slot:"end",onChange:function(t){return e._orientation(t.srcElement.value)}},i("option",{selected:this.orientation===M.CORONAL,value:M.CORONAL},this._contentStrings.coronal),i("option",{selected:this.orientation===M.SAGGITAL,value:M.SAGGITAL},this._contentStrings.saggital),i("option",{selected:this.orientation===M.AXIAL,value:M.AXIAL},this._contentStrings.axial))),i("ion-item",{style:{display:"var(--slices-window-center-display, block)"}},i("ion-icon",{src:U,slot:"start",title:this._contentStrings.brightness}),i("ion-range",{slot:"end",min:h,max:p,value:this._reverseNumber(g,h,p),onIonChange:function(t){return e._slicesWindowCenter(e._reverseNumber(t.detail.value,h,p))}})),i("ion-item",{style:{display:"var(--slices-window-width-display, block)"}},i("ion-icon",{src:H,slot:"start",title:this._contentStrings.contrast}),i("ion-range",{slot:"end",min:l,max:u,value:this._reverseNumber(d,l,u),onIonChange:function(t){return e._slicesWindowWidth(e._reverseNumber(t.detail.value,l,u))}})))}case E.VOLUME:{if(!this.stackhelper){break}var f=void 0;if(this.volumeSteps===undefined){f=16}else{f=this.volumeSteps}var v=1;var m=this.stackhelper.stack.minMax[1]-this.stackhelper.stack.minMax[0];var d=void 0;if(this.volumeWindowWidth===undefined){d=m/2}else{d=this.volumeWindowWidth}var y=this.stackhelper.stack.minMax[0];var _=this.stackhelper.stack.minMax[1];var g=void 0;if(this.volumeWindowCenter===undefined){g=_/2}else{g=this.volumeWindowCenter}this.stackhelper.steps=f;this.stackhelper.windowWidth=d;this.stackhelper.windowCenter=g;return i("div",null,this.renderGenericOptions(),i("ion-item",{style:{display:"var(--volume-steps-display, block)"}},i("ion-icon",{src:X,slot:"start",title:this._contentStrings.renderSteps}),i("ion-range",{slot:"end",min:K.stepsMin,max:K.stepsMax,value:f,step:K.stepsIncrement,pin:true,onIonChange:function(t){return e._volumeSteps(t.detail.value)}})),i("ion-item",{style:{display:"var(--volume-window-center-display, block)"}},i("ion-icon",{src:U,slot:"start",title:this._contentStrings.brightness}),i("ion-range",{slot:"end",min:y,max:_,value:this._reverseNumber(g,y,_),onIonChange:function(t){e._volumeWindowCenter(e._reverseNumber(t.detail.value,y,_))}})),i("ion-item",{style:{display:"var(--volume-window-width-display, block)"}},i("ion-icon",{src:H,slot:"start",title:this._contentStrings.contrast}),i("ion-range",{slot:"end",min:v,max:m,value:this._reverseNumber(d,v,m),onIonChange:function(t){return e._volumeWindowWidth(e._reverseNumber(t.detail.value,v,m))}})))}case E.MESH:{return this.renderGenericOptions()}default:{return}}return null};e.prototype.render=function(){return[this.renderDisplayModeToggle(),this.renderGraphEnabled(),this.renderOptions()]};Object.defineProperty(e,"watchers",{get:function(){return{stackhelper:["watchStackhelper"]}},enumerable:true,configurable:true});Object.defineProperty(e,"style",{get:function(){return"ion-item{--border-width:0 0 0 0;--inner-border-width:0 0 0 0}ion-item select{padding:5px;min-width:100px}"},enumerable:true,configurable:true});return e}());var Se=e("al_tabs",function(){function e(e){var i=this;t(this,e);this.transitioning=false;this.onTabClicked=function(e){var t=e.detail.tab;i.select(t)};this.ionNavWillLoad=n(this,"ionNavWillLoad",7);this.ionTabsWillChange=n(this,"ionTabsWillChange",3);this.ionTabsDidChange=n(this,"ionTabsDidChange",3)}e.prototype.componentWillLoad=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:e=this.tabs;return[4,this.select(e[0])];case 1:t.sent();this.ionNavWillLoad.emit();return[2]}})})};e.prototype.componentWillRender=function(){var e=this.el.querySelector("ion-tab-bar");if(e){var t=this.selectedTab?this.selectedTab.tab:undefined;e.selectedTab=t}};e.prototype.select=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.getTab(e)];case 1:t=n.sent();if(!this.shouldSwitch(t)){return[2,false]}this.setActive(t);this.tabSwitch();return[2,true]}})})};e.prototype.getTab=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){t=typeof e==="string"?this.tabs.find(function(t){return t.tab===e}):e;if(!t){console.error('tab with id: "'+t+'" does not exist')}return[2,t]})})};e.prototype.getSelected=function(){return Promise.resolve(this.selectedTab?this.selectedTab.tab:undefined)};e.prototype.setActive=function(e){if(this.transitioning){return Promise.reject("transitioning already happening")}this.transitioning=true;this.leavingTab=this.selectedTab;this.selectedTab=e;this.ionTabsWillChange.emit({tab:e.tab});e.setActive();return true};e.prototype.tabSwitch=function(){var e=this.selectedTab;var t=this.leavingTab;this.leavingTab=undefined;this.transitioning=false;if(!e){return}if(t!==e){if(t){t.active=false}this.ionTabsDidChange.emit({tab:e.tab})}};e.prototype.shouldSwitch=function(e){var t=this.selectedTab;return e!==undefined&&e!==t&&!this.transitioning};Object.defineProperty(e.prototype,"tabs",{get:function(){return Array.from(this.el.querySelectorAll("ion-tab"))},enumerable:true,configurable:true});e.prototype.render=function(){return i(s,{onIonTabButtonClick:this.onTabClicked},i("slot",{name:"top"}),i("div",{class:"tabs-inner"},i("slot",null)),i("slot",{name:"bottom"}))};Object.defineProperty(e.prototype,"el",{get:function(){return r(this)},enumerable:true,configurable:true});Object.defineProperty(e,"style",{get:function(){return":host{z-index:var(--z-index-page-container)}.tabs-inner{position:relative}"},enumerable:true,configurable:true});return e}());var Ne="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNTYgMzg4Yy03Mi41OTcgMC0xMzItNTkuNDA1LTEzMi0xMzIgMC03Mi42MDEgNTkuNDAzLTEzMiAxMzItMTMyIDM2LjMgMCA2OS4yOTkgMTUuNCA5Mi40MDYgMzkuNjAxTDI3OCAyMzRoMTU0VjgwbC01MS42OTggNTEuNzAyQzM0OC40MDYgOTkuNzk4IDMwNC40MDYgODAgMjU2IDgwYy05Ni43OTcgMC0xNzYgNzkuMjAzLTE3NiAxNzZzNzguMDk0IDE3NiAxNzYgMTc2YzgxLjA0NSAwIDE0OC4yODctNTQuMTM0IDE2OS40MDEtMTI4SDM3OC44NWMtMTguNzQ1IDQ5LjU2MS02Ny4xMzggODQtMTIyLjg1IDg0eiI+PC9wYXRoPjwvc3ZnPgo=";var Le=e("al_url_picker",function(){function e(e){t(this,e);this.urls=null;this.url=null;this.urlChanged=n(this,"urlChanged",7)}e.prototype.render=function(){var e=this;if(this.urls){return i("form",{onSubmit:function(e){return e.preventDefault()}},i("ion-select",{value:this.url,interface:"popover",placeholder:"",onIonChange:function(t){return e.urlChanged.emit(t.detail.value)}},Array.from(this.urls).map(function(e){var t=e[0],n=e[1];return i("ion-select-option",{value:t},n)})),i("ion-input",{type:"url",size:"100",placeholder:"src",required:true,value:this.url,ref:function(t){return e._input=t}}),i("ion-button",{size:"small",type:"submit",onClick:function(){return e.urlChanged.emit(e._input.value)}},i("ion-icon",{src:Ne})," Load"))}return null};Object.defineProperty(e,"style",{get:function(){return""},enumerable:true,configurable:true});return e}());var De;(function(e){e[e["Backspace"]=8]="Backspace";e[e["Tab"]=9]="Tab";e[e["Enter"]=13]="Enter";e[e["Shift"]=16]="Shift";e[e["Ctrl"]=17]="Ctrl";e[e["Alt"]=18]="Alt";e[e["PauseBreak"]=19]="PauseBreak";e[e["CapsLock"]=20]="CapsLock";e[e["Escape"]=27]="Escape";e[e["Spacebar"]=32]="Spacebar";e[e["PageUp"]=33]="PageUp";e[e["PageDown"]=34]="PageDown";e[e["End"]=35]="End";e[e["Home"]=36]="Home";e[e["LeftArrow"]=37]="LeftArrow";e[e["UpArrow"]=38]="UpArrow";e[e["RightArrow"]=39]="RightArrow";e[e["DownArrow"]=40]="DownArrow";e[e["PrintScrn"]=44]="PrintScrn";e[e["Insert"]=45]="Insert";e[e["Delete"]=46]="Delete";e[e["Zero"]=48]="Zero";e[e["One"]=49]="One";e[e["Two"]=50]="Two";e[e["Three"]=51]="Three";e[e["Four"]=52]="Four";e[e["Five"]=53]="Five";e[e["Six"]=54]="Six";e[e["Seven"]=55]="Seven";e[e["Eight"]=56]="Eight";e[e["Nine"]=57]="Nine";e[e["a"]=65]="a";e[e["b"]=66]="b";e[e["c"]=67]="c";e[e["d"]=68]="d";e[e["e"]=69]="e";e[e["f"]=70]="f";e[e["g"]=71]="g";e[e["h"]=72]="h";e[e["i"]=73]="i";e[e["j"]=74]="j";e[e["k"]=75]="k";e[e["l"]=76]="l";e[e["m"]=77]="m";e[e["n"]=78]="n";e[e["o"]=79]="o";e[e["p"]=80]="p";e[e["q"]=81]="q";e[e["r"]=82]="r";e[e["s"]=83]="s";e[e["t"]=84]="t";e[e["u"]=85]="u";e[e["v"]=86]="v";e[e["w"]=87]="w";e[e["x"]=88]="x";e[e["y"]=89]="y";e[e["z"]=90]="z";e[e["LeftWindowKey"]=91]="LeftWindowKey";e[e["RightWindowKey"]=92]="RightWindowKey";e[e["SelectKey"]=93]="SelectKey";e[e["Numpad0"]=96]="Numpad0";e[e["Numpad1"]=97]="Numpad1";e[e["Numpad2"]=98]="Numpad2";e[e["Numpad3"]=99]="Numpad3";e[e["Numpad4"]=100]="Numpad4";e[e["Numpad5"]=101]="Numpad5";e[e["Numpad6"]=102]="Numpad6";e[e["Numpad7"]=103]="Numpad7";e[e["Numpad8"]=104]="Numpad8";e[e["Numpad9"]=105]="Numpad9";e[e["Multiply"]=106]="Multiply";e[e["NumpadPlus"]=107]="NumpadPlus";e[e["NumpadMinus"]=109]="NumpadMinus";e[e["DecimalPoint"]=110]="DecimalPoint";e[e["Divide"]=111]="Divide";e[e["F1"]=112]="F1";e[e["F2"]=113]="F2";e[e["F3"]=114]="F3";e[e["F4"]=115]="F4";e[e["F5"]=116]="F5";e[e["F6"]=117]="F6";e[e["F7"]=118]="F7";e[e["F8"]=119]="F8";e[e["F9"]=120]="F9";e[e["F10"]=121]="F10";e[e["F11"]=122]="F11";e[e["F12"]=123]="F12";e[e["NumLock"]=144]="NumLock";e[e["ScrollLock"]=145]="ScrollLock";e[e["Semicolon"]=186]="Semicolon";e[e["Equals"]=187]="Equals";e[e["Comma"]=188]="Comma";e[e["LessThan"]=188]="LessThan";e[e["Dash"]=189]="Dash";e[e["Period"]=190]="Period";e[e["GreaterThan"]=190]="GreaterThan";e[e["ForwardSlash"]=191]="ForwardSlash";e[e["QuestionMark"]=191]="QuestionMark";e[e["GraveAccent"]=192]="GraveAccent";e[e["Tilde"]=192]="Tilde";e[e["OpenCurlyBracket"]=219]="OpenCurlyBracket";e[e["OpenSquareBracket"]=219]="OpenSquareBracket";e[e["BackSlash"]=220]="BackSlash";e[e["VerticalPipe"]=220]="VerticalPipe";e[e["CloseCurlyBracket"]=221]="CloseCurlyBracket";e[e["CloseSquareBracket"]=221]="CloseSquareBracket";e[e["Quote"]=222]="Quote";e[e["CommandFF"]=224]="CommandFF"})(De||(De={}));var Ie;(function(e){e[e["Backspace"]=8]="Backspace";e[e["Enter"]=13]="Enter";e[e["Spacebar"]=32]="Spacebar";e[e["Hash"]=35]="Hash";e[e["GraveAccent"]=39]="GraveAccent";e[e["DoubleQuote"]=34]="DoubleQuote";e[e["Asterisk"]=42]="Asterisk";e[e["Plus"]=43]="Plus";e[e["Comma"]=44]="Comma";e[e["Minus"]=45]="Minus";e[e["Period"]=46]="Period";e[e["ForwardSlash"]=47]="ForwardSlash";e[e["Zero"]=48]="Zero";e[e["One"]=49]="One";e[e["Two"]=50]="Two";e[e["Three"]=51]="Three";e[e["Four"]=52]="Four";e[e["Five"]=53]="Five";e[e["Six"]=54]="Six";e[e["Seven"]=55]="Seven";e[e["Eight"]=56]="Eight";e[e["Nine"]=57]="Nine";e[e["Colon"]=58]="Colon";e[e["Semicolon"]=59]="Semicolon";e[e["LessThan"]=60]="LessThan";e[e["Equals"]=61]="Equals";e[e["GreaterThan"]=62]="GreaterThan";e[e["QuestionMark"]=63]="QuestionMark";e[e["At"]=64]="At";e[e["OpenSquareBracket"]=91]="OpenSquareBracket";e[e["BackSlash"]=92]="BackSlash";e[e["CloseSquareBracket"]=93]="CloseSquareBracket";e[e["a"]=97]="a";e[e["b"]=98]="b";e[e["c"]=99]="c";e[e["d"]=100]="d";e[e["e"]=101]="e";e[e["f"]=102]="f";e[e["g"]=103]="g";e[e["h"]=104]="h";e[e["i"]=105]="i";e[e["j"]=106]="j";e[e["k"]=107]="k";e[e["l"]=108]="l";e[e["m"]=109]="m";e[e["n"]=110]="n";e[e["o"]=111]="o";e[e["p"]=112]="p";e[e["q"]=113]="q";e[e["r"]=114]="r";e[e["s"]=115]="s";e[e["t"]=116]="t";e[e["u"]=117]="u";e[e["v"]=118]="v";e[e["w"]=119]="w";e[e["x"]=120]="x";e[e["y"]=121]="y";e[e["z"]=122]="z";e[e["OpenCurlyBracket"]=123]="OpenCurlyBracket";e[e["VerticalPipe"]=124]="VerticalPipe";e[e["CloseCurlyBracket"]=125]="CloseCurlyBracket";e[e["Tilde"]=126]="Tilde"})(Ie||(Ie={}));var we=function(){function e(){}e.isWebGL2Available=function(){try{var e=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&e.getContext("webgl2"))}catch(e){return false}};e.enableControls=function(e,t,n){n===f.TRACKBALL?e.setAttribute("al-trackball-control","enabled: "+t):e.setAttribute("al-orbit-control","enabled: "+t)};e.waitOneFrame=function(e){window.setTimeout(function(){e()},K.minFrameMS)};e.objectToVector3=function(e){var t=new THREE.Vector3;t.x=e.x;t.y=e.y;t.z=e.z;return t};e.worldToScreen=function(e,t,n){var i=e.clone();i.project(t);i.x=Math.round((i.x+1)*n.offsetWidth/2);i.y=Math.round((-i.y+1)*n.offsetHeight/2);i.z=0;return i};e.vector3ToString=function(e){return e.toArray().join(" ")};e.stringToVector3=function(e){var t=e.split(" ");var n=new THREE.Vector3;n.x=Number(t[0]);n.y=Number(t[1]);n.z=Number(t[2]);return n};e.slerp=function(e,t,n){var i=n;var r=e;var s=t;var o=r.angleTo(s);if(o){o=THREE.Math.clamp(o,-.99,.99);var a=Math.sin(1-i)*o;var c=Math.sin(i*o);var l=Math.sin(o);var u=a/l;var d=c/l;var h=r.clone().multiplyScalar(u);var p=s.clone().multiplyScalar(d);var g=h.add(p);return g}else{return null}};e.easeInOutCubic=function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1};e.getSlerpCameraPath=function(t,n,i,r){var s=[];var o=t.position.clone().addScalar(Number.EPSILON);var a=t.target.clone().addScalar(Number.EPSILON);var c=n.position.clone().addScalar(Number.EPSILON);var l=n.target.clone().addScalar(Number.EPSILON);for(var u=0;u<=K.maxAnimationSteps;u++){var d=this.easeInOutCubic(u/K.maxAnimationSteps);s.push({position:i?e.slerp(o.clone(),c.clone(),d):c,target:r?e.slerp(a.clone(),l.clone(),d):l})}return s};e.getSlerp3Path=function(t,n){var i=[];var r=t.clone().addScalar(Number.EPSILON);var s=n.clone().addScalar(Number.EPSILON);for(var o=0;o<=K.maxAnimationSteps;o++){var a=this.easeInOutCubic(o/K.maxAnimationSteps);i.push(e.slerp(r.clone(),s.clone(),a))}return i};e.lookToFrustrumSpace=function(e,t,n,i){var r=new THREE.Vector3;t.getWorldDirection(r);var s=i.distanceTo(new THREE.Vector3(0,0,0));var o=new THREE.Plane(r,s);var a=new THREE.Vector3;o.projectPoint(n,a);e.lookAt(a)};e.getFrustrumSpaceDistance=function(e,t,n){var i=new THREE.Vector3;e.getWorldDirection(i);var r=n.distanceTo(new THREE.Vector3(0,0,0));var s=new THREE.Plane(i,r);var o=new THREE.Vector3;s.projectPoint(t,o);var a=new THREE.Ray(t);a.lookAt(o);var c=a.distanceToPlane(s);return c};return e}();var Ae=function(){function e(){}e._traceDataRay=function(e,t,n,i,r,s,o,a,c,l){var u=0;var d=Math.floor;var h=d(t)|0;var p=d(n)|0;var g=d(i)|0;var f=r>0?1:-1;var E=s>0?1:-1;var v=o>0?1:-1;var m=Math.abs(1/r);var M=Math.abs(1/s);var y=Math.abs(1/o);var _=f>0?h+1-t:t-h;var T=E>0?p+1-n:n-p;var b=v>0?g+1-i:i-g;var S=m<Infinity?m*_:Infinity;var N=M<Infinity?M*T:Infinity;var L=y<Infinity?y*b:Infinity;var D=e.windowCenter-e.windowWidth*.5;var I=-1;while(u<=a){var w=void 0;var A=new THREE.Vector3(h,p,g);var C=AMI.CoreUtils.worldToData(e.stack.lps2IJK,A);var O=AMI.CoreUtils.getPixelData(e.stack,C);if(O!==null&&O>D){w=1}else{w=0}if(w){if(c){c.x=t+u*r;c.y=n+u*s;c.z=i+u*o}if(l){l.x=l.y=l.z=0;if(I===0){l.x=-f}if(I===1){l.y=-E}if(I===2){l.z=-v}}return w}if(S<N){if(S<L){h+=f;u=S;S+=m;I=0}else{g+=v;u=L;L+=y;I=2}}else{if(N<L){p+=E;u=N;N+=M;I=1}else{g+=v;u=L;L+=y;I=2}}}if(c){c.x=t+u*r;c.y=n+u*s;c.z=i+u*o}if(l){l.x=l.y=l.z=0}return 0};e.volumeRay=function(e,t,n,i,r,s){var o=+t.x;var a=+t.y;var c=+t.z;var l=+n.x;var u=+n.y;var d=+n.z;var h=Math.sqrt(l*l+u*u+d*d);if(h===0){throw new Error("Can't raycast along a zero vector")}l/=h;u/=h;d/=h;if(typeof i==="undefined"){i=64}else{i=+i}return this._traceDataRay(e,o,a,c,l,u,d,i,r,s)};e.toAframeSpace=function(e){return e.divide(we.objectToVector3(K.stackSpaceMultiplier))};return e}();var Ce=function(){function e(){}e.debounce=function(e,t){t=t||100;return function(){if(!e.debouncing){var n=Array.prototype.slice.apply(arguments);e.lastReturnVal=e.apply(this,n);e.debouncing=true}clearTimeout(e.debounceTimeout);e.debounceTimeout=setTimeout(function(){e.debouncing=false},t);return e.lastReturnVal}};return e}();var Oe=function(){function e(){}e.addCssUnits=function(e){if(!this.cssUnits.some(function(t){return e.includes(t)})){e+="px"}return e};e.getFileExtension=function(e){return e.substring(e.lastIndexOf(".")+1)};e.getGeometryCenter=function(e){var t;if(e instanceof THREE.BufferGeometry){t=(new THREE.Geometry).fromBufferGeometry(e)}else{t=e}t.computeBoundingSphere();return t.boundingSphere.center};e.getCameraStateFromMesh=function(e){var t;var n;var i;if(e){var r=e.geometry;t=this.getGeometryCenter(r);i=K.zoomFactor*r.boundingSphere.radius/Math.tan(K.cameraValues.fov*Math.PI/180);n=new THREE.Vector3;n.copy(t);n.z+=i;return{target:t,position:n}}return null};e.getCameraPositionFromNode=function(e,t,n){if(!e){return null}var i=new THREE.Vector3;i.copy(we.stringToVector3(e.position));var r=i.clone().sub(n.clone()).normalize();var s=new THREE.Vector3;s.copy(i);s.add(r.clone().multiplyScalar(t*K.zoomFactor));return s};e.getBoundingBox=function(e){return(new THREE.Box3).setFromObject(e)};return e}();Oe.cssUnits=["%","ch","cm","em","ex","in","mm","pc","pt","px","rem","vh","vmax","vmin","vw"];var je=function(){function e(){}return e}();je.SELECTED="al-graph-selected";je.POINTER_OVER="al-graph-pointer-over";je.POINTER_OUT="al-graph-pointer-out";je.DRAGGED="al-graph-dragged";je.POINTER_DOWN="al-graph-pointer-down";je.POINTER_UP="al-graph-pointer-up";var xe=function(){function e(){}e.getEntryWithHighestId=function(e){if(e.size){return Math.max.apply(Math,Array.from(e).map(function(e){var t=e[0];return Number(t.split("-")[1])}))}return-1};e.getNextId=function(e,t){return e+"-"+Number(this.getEntryWithHighestId(t)+1)};return e}();var Pe="#define GLSLIFY 1\nvarying vec3 vNormal;\nuniform float r;\nuniform float g;\nuniform float b;\nuniform float a;\nuniform float c;\n\nvoid main()\n{\n    float intensity = pow( c - dot( vNormal, vec3( 0.0, 0.0, 1.0 ) ), 4.0 );\n    gl_FragColor = vec4(r, g, b, a) * intensity;\n}";var ze="#define GLSLIFY 1\nvarying vec3 vNormal;\n\nvoid main()\n{\n    vNormal = normalize( normalMatrix * normal );\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";var Re=function(){function e(){}e.getHaloMaterial=function(e,t,n,i,r){if(e===void 0){e=.5}if(t===void 0){t=.5}if(n===void 0){n=.5}if(i===void 0){i=.1}if(r===void 0){r=.5}return new THREE.ShaderMaterial({uniforms:{r:{value:e},g:{value:t},b:{value:n},a:{value:i},c:{value:r}},vertexShader:ze,fragmentShader:Pe,side:THREE.BackSide,blending:THREE.AdditiveBlending,transparent:true,depthTest:false})};return e}();AFRAME.registerComponent("al-angle",{schema:{selected:{type:"boolean"},edge0Pos:{type:"vec3"},edge1Pos:{type:"vec3"},position:{type:"vec3"},length:{type:"number"},radius:{type:"number"},angle:{type:"number"},scale:{type:"number"}},init:function(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,K.minFrameMS,this);this.bindMethods();this.addEventListeners();this.state={selected:true,hovered:false};this.createMesh()},bindMethods:function(){this.pointerDown=this.pointerDown.bind(this);this.pointerOver=this.pointerOver.bind(this);this.pointerOut=this.pointerOut.bind(this);this.createMesh=this.createMesh.bind(this);this.getMatrix=this.getMatrix.bind(this)},addEventListeners:function(){this.el.addEventListener("mousedown",this.pointerDown,{capture:false,once:false,passive:true});this.el.addEventListener("raycaster-intersected",this.pointerOver,{capture:true,once:false,passive:true});this.el.addEventListener("raycaster-intersected-cleared",this.pointerOut,{capture:false,once:false,passive:true})},removeEventListeners:function(){this.el.removeEventListener("mousedown",this.pointerDown);this.el.removeEventListener("raycaster-intersected",this.pointerOver);this.el.removeEventListener("raycaster-intersected-cleared",this.pointerOut)},pointerDown:function(e){this.el.sceneEl.emit(je.SELECTED,{type:g.ANGLE,id:this.el.id},true)},pointerOver:function(e){var t=this.state;t.hovered=true;this.el.sceneEl.emit(je.POINTER_OVER,{id:this.el.id},true)},pointerOut:function(e){var t=this.state;t.hovered=false;this.el.sceneEl.emit(je.POINTER_OUT,{},true)},getMatrix:function(){var e=we.objectToVector3(this.data.edge0Pos);var t=we.objectToVector3(this.data.edge1Pos);var n=new THREE.Matrix4;n.makeScale(this.data.scale,this.data.scale,1);var i=new THREE.Matrix4;i.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1);var r=new THREE.Matrix4;r.lookAt(e,t,(new THREE.Object3D).up);r.multiply(n);r.multiply(i);return r},createMesh:function(){var e=new THREE.CylinderGeometry(this.data.radius,this.data.radius,this.data.length,6,4);var t=new THREE.MeshBasicMaterial;var n=new THREE.Mesh(e,t);n.applyMatrix(this.getMatrix());n.position.copy(we.objectToVector3(this.data.position));this.state.geometry=e;this.state.material=t;this.state.mesh=n;var i=new THREE.CylinderGeometry(this.data.radius,this.data.radius,this.data.length,6,4);var r=Re.getHaloMaterial();var s=new THREE.Mesh(i,r);this.state.outlineGeometry=i;this.state.outlineMaterialt=r;this.state.outlineMesh=s;n.add(s);this.el.setObject3D("mesh",n);this.el.object3D.renderOrder=K.topLayerRenderOrder-3},update:function(e){var t=this.state;t.selected=this.data.selected;if(e&&(e.angle!==this.data.angle||e.scale!==this.data.scale)){this.createMesh()}},tickFunction:function(){var e=this.el;var t=this.state;if(t.hovered){t.material.color=new THREE.Color(K.buttonColors.hover)}else if(t.selected){t.material.color=new THREE.Color(K.buttonColors.active)}else{t.material.color=new THREE.Color(K.buttonColors.up)}var n=e.firstChild;if(n){var i=n.object3D;if(t.hovered){i.visible=true}else{i.visible=false}}},tick:function(){this.tickFunction()},remove:function(){this.removeEventListeners();this.el.removeObject3D("mesh")}});AFRAME.registerComponent("al-background",{schema:{text:{type:"string",default:""},boundingRadius:{type:"number",default:1},scale:{type:"number",default:8},frustrumDistance:{type:"number",default:1}},init:function(){this.state={hasUpdated:false};this.bindMethods();this.addEventListeners();this.tickFunction=AFRAME.utils.throttle(this.tickFunction,K.minFrameMS,this)},bindMethods:function(){},addEventListeners:function(){},removeEventListeners:function(){},update:function(e){if(this.data.text!==e.text){this.state.hasUpdated=false}},tickFunction:function(){if(!this.state.hasUpdated){var e=this.el.object3DMap.text;var t=void 0;if(e){t=e.geometry;if(t.attributes.position){t.computeBoundingBox();var n=new THREE.Vector3;t.boundingBox.getSize(n);var i=(n.y*.001+K.textPadding.height)*this.data.boundingRadius;var r=new THREE.PlaneGeometry(1,1,1,1);var s=new THREE.MeshStandardMaterial;s.color=new THREE.Color(K.colorValues.black);s.transparent=true;s.opacity=.9;s.flatShading=true;s.roughness=1;s.depthTest=false;var o=new THREE.Mesh(r,s);o.scale.set((n.x*.001+K.textPadding.width)*this.data.boundingRadius,i,1);o.renderOrder=K.topLayerRenderOrder-1;o.position.add(new THREE.Vector3(0,i*(this.data.frustrumDistance/4),0));this.el.object3D.add(o);this.state.hasUpdated=true}}}},tick:function(){this.tickFunction()},remove:function(){this.removeEventListeners()}});AFRAME.registerComponent("al-billboard-baggins",{schema:{controlsType:{type:"string",default:f.ORBIT},cameraPosition:{type:"string"},worldPosition:{type:"string"}},init:function(){this.bindMethods();this.addEventListeners();this.tickFunction=AFRAME.utils.throttle(this.tickFunction,K.minFrameMS,this)},bindMethods:function(){},addEventListeners:function(){},removeEventListeners:function(){},update:function(e){var t=this.el.sceneEl.camera;var n=this.el.object3D;var i=we.stringToVector3(this.data.worldPosition);var r=we.stringToVector3(this.data.cameraPosition);if(this.data.controlsType!==e.controlsType){this.el.object3D.up.copy(this.el.sceneEl.camera.up.clone())}switch(this.data.controlsType){case f.TRACKBALL:{we.lookToFrustrumSpace(n,t,i,r);n.up.copy(this.el.sceneEl.camera.up.clone());break}case f.ORBIT:{we.lookToFrustrumSpace(n,t,i,r);break}default:{we.lookToFrustrumSpace(n,t,i,r);break}}},tickFunction:function(){},tick:function(){this.tickFunction()},remove:function(){this.removeEventListeners()}});AFRAME.registerComponent("al-bounding-box",{schema:{color:{type:"string",default:"#f50057"},scale:{type:"string"},opacity:{type:"number",default:1}},init:function(){this.bindMethods();this.addEventListeners();this.state={box:new THREE.Box3}},bindMethods:function(){},addEventListeners:function(){},removeEventListeners:function(){},update:function(){var e=this.el;var t=this.state;var n=we.stringToVector3(this.data.scale);t.box.setFromCenterAndSize(new THREE.Vector3(0,0,0),n);var i=new THREE.BoxGeometry(n.x,n.y,n.z);var r=new THREE.MeshBasicMaterial({color:this.data.color,visible:false});var s=new THREE.Mesh(i,r);e.setObject3D("mesh2",s);t.boundingBox=new THREE.Box3Helper(t.box,this.data.color);var o=t.boundingBox.material;o.opacity=this.data.opactiy;o.transparent=this.data.opacity===0;t.boundingBox.renderOrder=K.topLayerRenderOrder-5;e.setObject3D("mesh",t.boundingBox);t.geometry=i;t.material=r;t.mesh=s},remove:function(){this.removeEventListeners();this.el.removeObject3D("mesh");this.el.removeObject3D("mesh2")}});var ke={CLICK:"click",FUSING:"fusing",MOUSEENTER:"mouseenter",MOUSEDOWN:"mousedown",MOUSELEAVE:"mouseleave",MOUSEUP:"mouseup"};var We={FUSING:"cursor-fusing",HOVERING:"cursor-hovering",HOVERED:"cursor-hovered"};var Ue={DOWN:["mousedown","touchstart"],UP:["mouseup","touchend"]};var He="a-mouse-cursor-hover";AFRAME.registerComponent("al-cursor",{dependencies:["raycaster"],schema:{downEvents:{default:[]},fuse:{default:AFRAME.utils.device.isMobile()},fuseTimeout:{default:1500,min:0},mouseCursorStylesEnabled:{default:true},upEvents:{default:[]},rayOrigin:{default:"entity",oneOf:["mouse","entity"]}},init:function(){var e=this;this.fuseTimeout=undefined;this.cursorDownEl=null;this.intersectedEl=null;this.canvasBounds=document.body.getBoundingClientRect();this.isCursorDown=false;this.updateCanvasBounds=AFRAME.utils.debounce(function t(){e.canvasBounds=e.el.sceneEl.canvas.getBoundingClientRect()},500);this.eventDetail={};this.intersectedEventDetail={cursorEl:this.el};this.onCursorDown=AFRAME.utils.bind(this.onCursorDown,this);this.onCursorUp=AFRAME.utils.bind(this.onCursorUp,this);this.onIntersection=AFRAME.utils.bind(this.onIntersection,this);this.onIntersectionCleared=AFRAME.utils.bind(this.onIntersectionCleared,this);this.onMouseMove=AFRAME.utils.bind(this.onMouseMove,this)},update:function(e){if(this.data.rayOrigin===e.rayOrigin){return}this.updateMouseEventListeners()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){var e=this.el;e.removeState(We.HOVERING);e.removeState(We.FUSING);clearTimeout(this.fuseTimeout);if(this.intersectedEl){this.intersectedEl.removeState(We.HOVERED)}this.removeEventListeners()},addEventListeners:function(){var e;var t=this.data;var n=this.el;var i=this;function r(){e=n.sceneEl.canvas;if(t.downEvents.length||t.upEvents.length){return}Ue.DOWN.forEach(function(t){e.addEventListener(t,i.onCursorDown)});Ue.UP.forEach(function(t){e.addEventListener(t,i.onCursorUp)})}e=n.sceneEl.canvas;if(e){r()}else{n.sceneEl.addEventListener("render-target-loaded",r)}t.downEvents.forEach(function(e){n.addEventListener(e,i.onCursorDown)});t.upEvents.forEach(function(e){n.addEventListener(e,i.onCursorUp)});n.addEventListener("raycaster-intersection",this.onIntersection);n.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared);n.sceneEl.addEventListener("rendererresize",this.updateCanvasBounds);window.addEventListener("resize",this.updateCanvasBounds);window.addEventListener("scroll",this.updateCanvasBounds);this.updateMouseEventListeners()},removeEventListeners:function(){var e;var t=this.data;var n=this.el;var i=this;e=n.sceneEl.canvas;if(e&&!t.downEvents.length&&!t.upEvents.length){Ue.DOWN.forEach(function(t){e.removeEventListener(t,i.onCursorDown)});Ue.UP.forEach(function(t){e.removeEventListener(t,i.onCursorUp)})}t.downEvents.forEach(function(e){n.removeEventListener(e,i.onCursorDown)});t.upEvents.forEach(function(e){n.removeEventListener(e,i.onCursorUp)});n.removeEventListener("raycaster-intersection",this.onIntersection);n.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared);e.removeEventListener("mousemove",this.onMouseMove);e.removeEventListener("touchstart",this.onMouseMove);e.removeEventListener("touchmove",this.onMouseMove);n.sceneEl.removeEventListener("rendererresize",this.updateCanvasBounds);window.removeEventListener("resize",this.updateCanvasBounds);window.removeEventListener("scroll",this.updateCanvasBounds)},updateMouseEventListeners:function(){var e;var t=this.el;e=t.sceneEl.canvas;e.removeEventListener("mousemove",this.onMouseMove);e.removeEventListener("touchmove",this.onMouseMove);t.setAttribute("raycaster","useWorldCoordinates",false);if(this.data.rayOrigin!=="mouse"){return}e.addEventListener("mousemove",this.onMouseMove,false);e.addEventListener("touchmove",this.onMouseMove,false);t.setAttribute("raycaster","useWorldCoordinates",true);this.updateCanvasBounds()},onMouseMove:function(){var e=new THREE.Vector3;var t=new THREE.Vector2;var n=new THREE.Vector3;var i={origin:n,direction:e};return function(r){var s=this.canvasBounds;var o=this.el.sceneEl.camera;var a;var c;var l;o.parent.updateMatrixWorld();if(r.type==="touchmove"||r.type==="touchstart"){c=r.touches.item(0)}else{c=r}a=c.clientX-s.left;l=c.clientY-s.top;t.x=a/s.width*2-1;t.y=-(l/s.height)*2+1;n.setFromMatrixPosition(o.matrixWorld);e.set(t.x,t.y,.5).unproject(o).sub(n).normalize();this.el.setAttribute("raycaster",i);if(r.type==="touchmove"){r.preventDefault()}}}(),onCursorDown:function(e){this.isCursorDown=true;if(this.data.rayOrigin==="mouse"&&e.type==="touchstart"){this.onMouseMove(e);this.el.components.raycaster.checkIntersections();e.preventDefault()}this.twoWayEmit(ke.MOUSEDOWN);this.cursorDownEl=this.intersectedEl},onCursorUp:function(e){if(!this.isCursorDown){return}this.isCursorDown=false;var t=this.data;this.twoWayEmit(ke.MOUSEUP);if(this.cursorDownEl&&this.cursorDownEl!==this.intersectedEl){this.intersectedEventDetail.intersection=null;this.cursorDownEl.emit(ke.MOUSEUP,this.intersectedEventDetail)}if((!t.fuse||t.rayOrigin==="mouse")&&this.intersectedEl&&this.cursorDownEl===this.intersectedEl){this.twoWayEmit(ke.CLICK)}this.cursorDownEl=null;if(e.type==="touchend"){e.preventDefault()}},onIntersection:function(e){var t;var n=this.el;var i;var r;var s;i=e.detail.els[0]===n?1:0;s=e.detail.intersections[i];r=e.detail.els[i];if(!r){return}if(this.intersectedEl===r){return}if(this.intersectedEl){t=this.el.components.raycaster.getIntersection(this.intersectedEl);if(t&&t.distance<=s.distance){return}}this.clearCurrentIntersection(true);this.setIntersection(r,s)},onIntersectionCleared:function(e){var t=e.detail.clearedEls;if(t.indexOf(this.intersectedEl)===-1){return}this.clearCurrentIntersection()},setIntersection:function(e){var t=this.el;var n=this.data;var i=this;if(this.intersectedEl===e){return}this.intersectedEl=e;t.addState(We.HOVERING);e.addState(We.HOVERED);this.twoWayEmit(ke.MOUSEENTER);if(this.data.mouseCursorStylesEnabled&&this.data.rayOrigin==="mouse"){this.el.sceneEl.canvas.classList.add(He)}if(n.fuseTimeout===0||!n.fuse){return}t.addState(We.FUSING);this.twoWayEmit(ke.FUSING);this.fuseTimeout=setTimeout(function e(){t.removeState(We.FUSING);i.twoWayEmit(ke.CLICK)},n.fuseTimeout)},clearCurrentIntersection:function(e){var t;var n;var i;var r=this.el;if(!this.intersectedEl){return}this.intersectedEl.removeState(We.HOVERED);r.removeState(We.HOVERING);r.removeState(We.FUSING);this.twoWayEmit(ke.MOUSELEAVE);if(this.data.mouseCursorStylesEnabled&&this.data.rayOrigin==="mouse"){this.el.sceneEl.canvas.classList.remove(He)}this.intersectedEl=null;clearTimeout(this.fuseTimeout);if(e===true){return}i=this.el.components.raycaster.intersections;if(i.length===0){return}t=i[0].object.el===r?1:0;n=i[t];if(!n){return}this.setIntersection(n.object.el,n)},twoWayEmit:function(e){var t=this.el;var n=this.intersectedEl;var i;i=this.el.components.raycaster.getIntersection(n);this.eventDetail.intersectedEl=n;this.eventDetail.intersection=i;t.emit(e,this.eventDetail);if(!n){return}this.intersectedEventDetail.intersection=i;n.emit(e,this.intersectedEventDetail)}});AFRAME.registerComponent("al-edge",{schema:{selected:{type:"boolean"},node1:{type:"vec3"},node2:{type:"vec3"},length:{type:"number"},radius:{type:"number"},nodeScale:{type:"number"},scale:{type:"number"}},init:function(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,K.minFrameMS,this);this.bindMethods();this.addEventListeners();this.state={selected:true,hovered:false}},bindMethods:function(){this.pointerDown=this.pointerDown.bind(this);this.pointerOver=this.pointerOver.bind(this);this.pointerOut=this.pointerOut.bind(this);this.createMesh=this.createMesh.bind(this);this.getMatrix=this.getMatrix.bind(this)},addEventListeners:function(){this.el.sceneEl.addEventListener("mousedown",this.pointerDown,{capture:false,once:false,passive:true});this.el.addEventListener("raycaster-intersected",this.pointerOver,{capture:true,once:false,passive:true});this.el.addEventListener("raycaster-intersected-cleared",this.pointerOut,{capture:false,once:false,passive:true})},removeEventListeners:function(){this.el.sceneEl.removeEventListener("mousedown",this.pointerDown);this.el.removeEventListener("raycaster-intersected",this.pointerOver);this.el.removeEventListener("raycaster-intersected-cleared",this.pointerOut)},pointerDown:function(e){var t=this.state;if(t.hovered){this.el.sceneEl.emit(je.SELECTED,{type:g.EDGE,id:this.el.id},false)}},pointerOver:function(e){var t=this.state;t.hovered=true;this.el.sceneEl.emit(je.POINTER_OVER,{id:this.el.id},false)},pointerOut:function(e){var t=this.state;t.hovered=false;this.el.sceneEl.emit(je.POINTER_OUT,{},false)},getMatrix:function(){var e=we.objectToVector3(this.data.node1);var t=we.objectToVector3(this.data.node2);var n=new THREE.Matrix4;n.makeScale(this.data.scale,this.data.scale,1);var i=new THREE.Matrix4;i.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1);var r=new THREE.Matrix4;r.lookAt(e,t,(new THREE.Object3D).up);r.multiply(n);r.multiply(i);return r},createMesh:function(){var e=new THREE.CylinderGeometry(this.data.radius,this.data.radius,this.data.length,6,4);var t=new THREE.MeshBasicMaterial;var n=new THREE.Mesh(e,t);n.applyMatrix(this.getMatrix());this.state.geometry=e;this.state.material=t;this.state.mesh=n;var i=new THREE.CylinderGeometry(this.data.radius,this.data.radius,this.data.length-this.data.nodeScale*2,6,4);var r=Re.getHaloMaterial();var s=new THREE.Mesh(i,r);this.state.outlineGeometry=i;this.state.outlineMaterialt=r;this.state.outlineMesh=s;n.add(s);this.el.setObject3D("mesh",n);this.el.object3D.renderOrder=K.topLayerRenderOrder-2},update:function(e){var t=this.state;t.selected=this.data.selected;if(e&&(e.radius!==this.data.radius||e.length!==this.data.length||e.scale!==this.data.scale)){this.createMesh()}},tickFunction:function(){var e=this.el;var t=this.state;if(t.hovered){t.material.color=new THREE.Color(K.buttonColors.hover)}else if(t.selected){t.material.color=new THREE.Color(K.buttonColors.active)}else{t.material.color=new THREE.Color(K.buttonColors.up)}var n=e.firstChild;if(n){var i=n.object3D;if(t.hovered){i.visible=true}else{i.visible=false}}},tick:function(){this.tickFunction()},remove:function(){this.removeEventListeners();this.el.removeObject3D("mesh")}});AFRAME.registerComponent("al-fixed-to-orbit-camera",{schema:{distanceFromTarget:{type:"number",default:.1},target:{type:"vec3"}},init:function(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,K.minFrameMS/2,this);if(this.data.target){var e=we.objectToVector3(this.data.target);this.state={distanceFromTarget:this.data.distanceFromTarget,target:e}}else{this.state={distanceFromTarget:this.data.distanceFromTarget,target:new THREE.Vector3(0,0,0)}}this.bindMethods();this.addEventListeners()},bindMethods:function(){},addEventListeners:function(){},removeEventListeners:function(){},update:function(){var e=we.objectToVector3(this.data.target);this.state={distanceFromTarget:this.data.distanceFromTarget,target:e}},tickFunction:function(){var e=this.el;var t=this.state;var n=e.sceneEl.camera.position;var i=t.target.clone().sub(n.clone()).normalize();e.object3D.position.copy(i.multiplyScalar(t.distanceFromTarget));e.object3D.lookAt(n)},tick:function(){this.tickFunction()},remove:function(){this.removeEventListeners()}});var Ye=function(){function e(){}return e}();Ye.LOADED="al-model-loaded";Ye.ERROR="al-model-error";AFRAME.registerComponent("al-gltf-model",{schema:{src:{type:"model",default:""},dracoDecoderPath:{type:"string",default:""}},init:function(){this.bindMethods();this.addEventListeners();this.model=null;var e=THREE;this.loader=new e.GLTFLoader;e.DRACOLoader.setDecoderPath(this.data.dracoDecoderPath);this.loader.setDRACOLoader(new e.DRACOLoader)},bindMethods:function(){},addEventListeners:function(){},removeEventListeners:function(){},update:function(e){var t=this;var n=this.el;var i=this.data.src;if(e&&e.src!==i){this.remove();this.loader.load(i,function e(i){t.model=i.scene||i.scenes[0];t.model.animations=i.animations;n.setObject3D("mesh",t.model);n.sceneEl.emit(Ye.LOADED,{format:"gltf",model:t.model},false)},undefined,function e(t){var r=t&&t.message?t.message:"Failed to load glTF model";console.warn(r);n.sceneEl.emit(Ye.ERROR,{format:"gltf",src:i},false)})}},remove:function(){if(!this.model){return}this.removeEventListeners();this.el.removeObject3D("mesh")}});AFRAME.registerComponent("al-node",{schema:{scale:{type:"number",default:1},selected:{type:"boolean"},graphEnabled:{type:"boolean"}},init:function(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,K.minFrameMS,this);this.bindMethods();this.addEventListeners();var e=this.data;var t=this.el;var n=t.sceneEl.camera.el.object3DMap.camera;var i=new THREE.SphereGeometry(e.scale,16,16);var r=new THREE.MeshBasicMaterial;var s=new THREE.Mesh(i,r);var o=new THREE.SphereGeometry(e.scale,16,16);var a=Re.getHaloMaterial();var c=new THREE.Mesh(o,a);s.add(c);t.setObject3D("mesh",s);t.object3D.renderOrder=K.topLayerRenderOrder-1;this.state={selected:true,hovered:false,geometry:i,material:r,mesh:s,outlineGeometry:o,outlineMaterial:a,outlineMesh:c,camera:n,dragging:false}},bindMethods:function(){this.pointerDown=this.pointerDown.bind(this);this.pointerUp=this.pointerUp.bind(this);this.pointerOver=this.pointerOver.bind(this);this.pointerOut=this.pointerOut.bind(this)},addEventListeners:function(){this.el.sceneEl.addEventListener("mousedown",this.pointerDown,{capture:false,once:false,passive:true});this.el.addEventListener("mouseup",this.pointerUp,{capture:false,once:false,passive:true});this.el.sceneEl.addEventListener("mouseup",this.pointerUp,{capture:false,once:false,passive:true});this.el.addEventListener("raycaster-intersected",this.pointerOver,{capture:true,once:false,passive:true});this.el.addEventListener("raycaster-intersected-cleared",this.pointerOut,{capture:false,once:false,passive:true})},removeEventListeners:function(){this.el.sceneEl.removeEventListener("mousedown",this.pointerDown);this.el.sceneEl.removeEventListener("mouseup",this.pointerUp);this.el.removeEventListener("mouseup",this.pointerUp);this.el.removeEventListener("raycaster-intersected",this.pointerOver);this.el.removeEventListener("raycaster-intersected-cleared",this.pointerOut)},pointerDown:function(e){var t=this.state;if(t.hovered){this.el.sceneEl.emit(je.SELECTED,{type:g.NODE,id:this.el.id},true);if(this.data.graphEnabled){var n=this.state;n.mouseDown=true;this.el.sceneEl.emit(je.POINTER_DOWN,{},true)}}},pointerUp:function(e){var t=this.state;if(this.data.graphEnabled){t.dragging=false;t.mouseDown=false;this.el.sceneEl.emit(je.POINTER_UP,{},true)}},pointerOver:function(e){var t=this.state;t.hovered=true;this.el.sceneEl.emit(je.POINTER_OVER,{id:this.el.id},true)},pointerOut:function(e){var t=this.state;t.hovered=false;if(t.mouseDown&&t.selected){t.dragging=true}this.el.sceneEl.emit(je.POINTER_OUT,{},true)},update:function(){var e=this.state;e.selected=this.data.selected},tickFunction:function(){var e=this.el;var t=this.state;if(this.data.graphEnabled&&t.dragging){this.el.sceneEl.emit(je.DRAGGED,{id:this.el.id},true)}if(t.hovered||t.dragging){t.material.color=new THREE.Color(K.buttonColors.hover)}else if(t.selected){t.material.color=new THREE.Color(K.buttonColors.active)}else{t.material.color=new THREE.Color(K.buttonColors.up)}var n=e.firstChild;if(n){var i=n.object3D;if(t.hovered||t.dragging){i.visible=true}else{i.visible=false}}},tick:function(){this.tickFunction()},remove:function(){this.removeEventListeners();this.el.removeObject3D("mesh")}});var Fe=function(){function e(){}return e}();Fe.VALID_TARGET="al-valid-target";Fe.ADD_NODE="al-add-node";AFRAME.registerComponent("al-node-spawner",{schema:{graphEnabled:{type:"boolean"}},init:function(){this.bindMethods();this.addEventListeners();this.state={left:false,intersecting:false}},bindMethods:function(){this.canvasMouseDown=this.canvasMouseDown.bind(this);this.pointerOver=this.pointerOver.bind(this);this.pointerOut=this.pointerOut.bind(this);this.elClick=this.elClick.bind(this);this.canvasMouseUp=this.canvasMouseUp.bind(this);this.pointerDown=this.pointerDown.bind(this);this.pointerUp=this.pointerUp.bind(this)},addEventListeners:function(){this.el.sceneEl.canvas.addEventListener("mousedown",this.canvasMouseDown,{capture:false,once:false,passive:true});this.el.sceneEl.canvas.addEventListener("mouseup",this.canvasMouseUp,{capture:false,once:false,passive:true});this.el.addEventListener("raycaster-intersected",this.pointerOver,{capture:false,once:false,passive:true});this.el.addEventListener("raycaster-intersected-cleared",this.pointerOut,false);this.el.addEventListener("click",this.elClick,{capture:false,once:false,passive:true});this.el.addEventListener("mousedown",this.pointerDown,{capture:false,once:false,passive:true});this.el.addEventListener("mouseup",this.pointerUp,{capture:false,once:false,passive:true})},removeEventListeners:function(){this.el.sceneEl.canvas.removeEventListener("mousedown",this.canvasMouseDown);this.el.sceneEl.canvas.removeEventListener("mouseup",this.canvasMouseUp);this.el.removeEventListener("raycaster-intersected",this.pointerOver);this.el.removeEventListener("raycaster-intersected-cleared",this.pointerOut);this.el.removeEventListener("click",this.elClick);this.el.removeEventListener("mousedown",this.pointerDown);this.el.removeEventListener("mouseup",this.pointerUp)},canvasMouseDown:function(e){this.state.left=e.button===0},canvasMouseUp:function(e){var t=this;we.waitOneFrame(function(){t.state.left=false})},pointerOver:function(e){this.state.intersecting=true;this.el.sceneEl.emit(Fe.VALID_TARGET,{valid:true},false)},pointerOut:function(e){this.state.intersecting=false;this.el.sceneEl.emit(Fe.VALID_TARGET,{valid:false},false)},pointerDown:function(e){if(this.data.graphEnabled){this.el.sceneEl.emit(je.POINTER_DOWN,{},false)}},pointerUp:function(e){if(this.data.graphEnabled){this.el.sceneEl.emit(je.POINTER_UP,{},false)}},elClick:function(e){if(this.state.left&&this.data.graphEnabled){this.el.sceneEl.emit(Fe.ADD_NODE,{aframeEvent:e},false)}},remove:function(){this.removeEventListeners()}});var Ve=function(){function e(){}return e}();Ve.INTERACTION="al-control-interaction";Ve.INTERACTION_FINISHED="al-control-interaction-finished";Ve.ANIMATION_STARTED="al-controls-animation-started";Ve.ANIMATION_FINISHED="al-controls-animation-finished";AFRAME.registerComponent("al-orbit-control",{dependencies:["camera"],schema:{animating:{type:"boolean",default:false},autoRotate:{type:"boolean"},autoRotateSpeed:{default:2},controlPosition:{type:"vec3"},controlTarget:{type:"vec3"},dampingFactor:{default:.1},enabled:{default:true},enableDamping:{default:true},enableKeys:{default:true},enablePan:{default:true},enableRotate:{default:true},enableZoom:{default:true},keyPanSpeed:{default:7},maxAzimuthAngle:{type:"number",default:Infinity},maxDistance:{default:8e3},maxPolarAngle:{default:88},minAzimuthAngle:{type:"number",default:-Infinity},minDistance:{default:1},minPolarAngle:{default:0},rotateSpeed:{default:.05},screenSpacePanning:{default:false},zoomSpeed:{type:"number",default:.5}},bindMethods:function(){this.mouseDown=this.mouseDown.bind(this);this.mouseMove=this.mouseMove.bind(this);this.mouseUp=this.mouseUp.bind(this);this.canvasWheel=this.canvasWheel.bind(this);this.getCameraState=this.getCameraState.bind(this);this.handleAnimationCache=this.handleAnimationCache.bind(this);this.onWheel=this.onWheel.bind(this)},addListeners:function(){window.addEventListener("mouseup",this.mouseUp,{capture:false,once:false,passive:true});window.addEventListener("mousemove",this.mouseMove,{capture:false,once:false,passive:true});this.el.sceneEl.canvas.addEventListener("mousedown",this.mouseDown,{capture:false,once:false,passive:true});this.el.sceneEl.canvas.addEventListener("wheel",this.canvasWheel,{capture:false,once:false,passive:true});this.el.sceneEl.addEventListener(Ve.ANIMATION_STARTED,this.handleAnimationCache,false)},removeListeners:function(){window.removeEventListener("mouseup",this.mouseUp);window.removeEventListener("mousemove",this.mouseMove),this.el.sceneEl.canvas.removeEventListener("mousedown",this.mouseDown);this.el.sceneEl.canvas.removeEventListener("wheel",this.canvasWheel);this.el.sceneEl.removeEventListener(Ve.ANIMATION_STARTED,this.handleAnimationCache,false)},handleAnimationCache:function(e){this.state.animationCache=e.detail.slerpPath},mouseUp:function(e){this.state.mouseDown=false;document.body.style.cursor="grab";var t=this.state.controls;if(t.enabled){this.el.sceneEl.emit(Ve.INTERACTION_FINISHED,{cameraState:this.getCameraState()},false)}},mouseDown:function(e){this.state.mouseDown=true;document.body.style.cursor="grabbing"},mouseMove:function(e){if(this.state.mouseDown){this.el.sceneEl.emit(Ve.INTERACTION,{cameraState:this.getCameraState()},false)}},onWheel:function(){var e=this;var t=this.state;t.wheelMarker=false;t.wheelCounter2=t.wheelCounter1;setTimeout(function(){if(t.wheelCounter2===t.wheelCounter1){t.wheelMarker=true;t.wheelCounter1=0;t.wheelCounter2=0;e.el.sceneEl.emit(Ve.INTERACTION_FINISHED,{cameraState:e.getCameraState()},false)}else{e.onWheel()}},t.wheelInterval)},canvasWheel:function(e){var t=this.state;t.wheelCounter1+=1;if(t.wheelMarker){this.onWheel()}this.el.sceneEl.emit(Ve.INTERACTION,{cameraState:this.getCameraState()},false)},init:function(){var e=this;var t=this.el;var n=this.data;document.body.style.cursor="grab";this.tickFunction=AFRAME.utils.throttle(this.tickFunction,K.minFrameMS,this);var i=new THREE.OrbitControls(t.getObject3D("camera"),t.sceneEl.renderer.domElement);var r=we.objectToVector3(n.controlPosition);var s=we.objectToVector3(n.controlTarget);i.object.position.copy(r);t.getObject3D("camera").position.copy(r);i.target.copy(s);var o=[];this.state={animationCache:o,controls:i,mouseDown:false,wheelCounter1:0,wheelCounter2:undefined,wheelInterval:50,wheelMarker:true};this.bindMethods();this.addListeners();we.waitOneFrame(function(){e.el.sceneEl.emit(Ve.INTERACTION,{cameraState:e.getCameraState()},false)})},getCameraState:function(){return{position:this.state.controls.object.position,target:this.state.controls.target}},update:function(e){var t=this.state.controls;var n=this.data;t.target=we.objectToVector3(n.controlTarget);t.autoRotate=n.autoRotate;t.autoRotateSpeed=n.autoRotateSpeed;t.dampingFactor=n.dampingFactor;t.enabled=n.enabled;t.enableDamping=n.enableDamping;t.enableKeys=n.enableKeys;t.enablePan=n.enablePan;t.enableRotate=n.enableRotate;t.enableZoom=n.enableZoom;t.keyPanSpeed=n.keyPanSpeed;t.maxPolarAngle=THREE.Math.degToRad(n.maxPolarAngle);t.maxAzimuthAngle=THREE.Math.degToRad(n.maxAzimuthAngle);t.maxDistance=n.maxDistance;t.minDistance=n.minDistance;t.minPolarAngle=THREE.Math.degToRad(n.minPolarAngle);t.minAzimuthAngle=THREE.Math.degToRad(n.minAzimuthAngle);t.rotateSpeed=n.rotateSpeed;t.screenSpacePanning=n.screenSpacePanning;t.zoomSpeed=n.zoomSpeed;this.el.getObject3D("camera").position.copy(we.objectToVector3(n.controlPosition))},tickFunction:function(){var e=this.state.controls;if(!e.enabled){return}if(this.data.animating){var t=this.state.animationCache.shift();if(t&&t.position&&t.target){e.object.position.copy(t.position);this.el.getObject3D("camera").position.copy(t.position);e.target.copy(t.target);this.el.sceneEl.emit(Ve.INTERACTION,{cameraState:this.getCameraState()},false)}if(this.state.animationCache.length===0){this.el.sceneEl.emit(Ve.ANIMATION_FINISHED,{},false);this.el.sceneEl.emit(Ve.INTERACTION_FINISHED,{cameraState:this.getCameraState()},false)}}if(e.enabled&&(e.enableDamping||e.autoRotate)){e.update()}},tick:function(){this.tickFunction()},remove:function(){this.removeListeners();var e=this.state;e.controls.dispose();e=null}});AFRAME.registerComponent("al-render-order",{schema:{order:{type:"number",default:K.topLayerRenderOrder}},init:function(){var e=this;this.bindMethods();this.addEventListeners();Object.keys(this.el.object3DMap).forEach(function(t){e.el.object3DMap[t].renderOrder=e.data.order})},bindMethods:function(){},addEventListeners:function(){},removeEventListeners:function(){},update:function(){var e=this;Object.keys(this.el.object3DMap).forEach(function(t){e.el.object3DMap[t].renderOrder=e.data.order})},remove:function(){this.removeEventListeners()}});AFRAME.registerComponent("al-render-overlaid",{schema:{},init:function(e){this.bindMethods();this.addEventListeners();this.setDepth(this.el.object3DMap.mesh);this.setDepth(this.el.object3DMap.text)},bindMethods:function(){},addEventListeners:function(){},removeEventListeners:function(){},setDepth:function(e){if(e){e.renderOrder=K.topLayerRenderOrder;if(e.material){e.material.depthTest=false}}},remove:function(){this.removeEventListeners()}});var Qe={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};var Be={ROTATE:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var Ge=function(e){__extends(t,e);function t(t,n){var i=e.call(this)||this;i.screen={left:0,top:0,width:0,height:0};i._changeEvent={type:"change"};i._startEvent={type:"start"};i._endEvent={type:"end"};i.object=t;i.domElement=n!==undefined?n:document;i.enabled=true;i.screen={left:0,top:0,width:0,height:0};i.rotateSpeed=1;i.zoomSpeed=1.2;i.panSpeed=.3;i.noRotate=false;i.noZoom=false;i.noPan=false;i.staticMoving=false;i.dynamicDampingFactor=.2;i.minDistance=0;i.maxDistance=Infinity;i.target=new THREE.Vector3;i.EPS=1e-6;i._lastPosition=new THREE.Vector3;i._state=Qe.NONE;i._eye=new THREE.Vector3;i._movePrev=new THREE.Vector2;i._moveCurr=new THREE.Vector2;i._lastAxis=new THREE.Vector3;i._lastAngle=0;i._zoomStart=new THREE.Vector2;i._zoomEnd=new THREE.Vector2;i._touchZoomDistanceStart=0;i._touchZoomDistanceEnd=0;i._panStart=new THREE.Vector2;i._panEnd=new THREE.Vector2;i._target0=i.target.clone();i._position0=i.object.position.clone();i._up0=i.object.up.clone();i._bindMethods();i._addListeners();i.update();return i}Object.defineProperty(t.prototype,"up0",{get:function(){return this._up0.clone()},enumerable:true,configurable:true});t.prototype._bindMethods=function(){this._mouseDown=this._mouseDown.bind(this);this._mouseMove=this._mouseMove.bind(this);this._mouseUp=this._mouseUp.bind(this);this._mouseWheel=this._mouseWheel.bind(this);this._touchStart=this._touchStart.bind(this);this._touchEnd=this._touchEnd.bind(this);this._touchMove=this._touchMove.bind(this);this._resize=this._resize.bind(this)};t.prototype._addListeners=function(){this.domElement.addEventListener("mousedown",this._mouseDown,{capture:false,once:false,passive:true});window.addEventListener("mousemove",this._mouseMove,{capture:false,once:false,passive:true});window.addEventListener("mouseup",this._mouseUp,{capture:false,once:false,passive:true});this.domElement.addEventListener("wheel",this._mouseWheel,{capture:false,once:false,passive:true});this.domElement.addEventListener("touchstart",this._touchStart,{capture:false,once:false,passive:true});window.addEventListener("touchend",this._touchEnd,{capture:false,once:false,passive:true});window.addEventListener("touchmove",this._touchMove,{capture:false,once:false,passive:true})};t.prototype._mouseDown=function(e){if(this.enabled===false){return}if(this._state===Qe.NONE){switch(e.button){case Be.ROTATE:this._state=Qe.ROTATE;if(!this.noRotate){this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY));this._movePrev.copy(this._moveCurr)}break;case Be.ZOOM:this._state=Qe.ZOOM;if(!this.noZoom){this._zoomStart.copy(this._getMouseOnScreen(e.pageX,e.pageY));this._zoomEnd.copy(this._zoomStart)}break;case Be.PAN:this._state=Qe.PAN;if(!this.noPan){this._panStart.copy(this._getMouseOnScreen(e.pageX,e.pageY));this._panEnd.copy(this._panStart)}break;default:this._state=Qe.NONE}}this.dispatchEvent(this._startEvent);this.update()};t.prototype._mouseMove=function(e){if(this.enabled===false){return}if(this._state===Qe.ROTATE&&!this.noRotate){this._movePrev.copy(this._moveCurr);this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY))}else if(this._state===Qe.ZOOM&&!this.noZoom){this._zoomEnd.copy(this._getMouseOnScreen(e.pageX,e.pageY))}else if(this._state===Qe.PAN&&!this.noPan){this._panEnd.copy(this._getMouseOnScreen(e.pageX,e.pageY))}this.update()};t.prototype._mouseUp=function(e){if(this.enabled===false){return}this._state=Qe.NONE;this.dispatchEvent(this._endEvent);this.update()};t.prototype._mouseWheel=function(e){if(this.enabled===false||this.noZoom===true){return}switch(e.deltaMode){case 2:this._zoomStart.y-=e.deltaY*.025;break;case 1:this._zoomStart.y-=e.deltaY*.01;break;default:this._zoomStart.y-=e.deltaY*25e-5;break}this.dispatchEvent(this._startEvent);this.dispatchEvent(this._endEvent);this.update()};t.prototype._touchStart=function(e){if(this.enabled===false){return}switch(e.touches.length){case 1:this._state=Qe.TOUCH_ROTATE;this._moveCurr.copy(this._getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY));this._movePrev.copy(this._moveCurr);break;default:this._state=Qe.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX;var n=e.touches[0].pageY-e.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2;var r=(e.touches[0].pageY+e.touches[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(i,r));this._panEnd.copy(this._panStart);break}this.dispatchEvent(this._startEvent);this.update()};t.prototype._touchEnd=function(e){if(this.enabled===false){return}switch(e.touches.length){case 0:this._state=Qe.NONE;break;case 1:this._state=Qe.TOUCH_ROTATE;this._moveCurr.copy(this._getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY));this._movePrev.copy(this._moveCurr);break;default:{break}}this.dispatchEvent(this._endEvent);this.update()};t.prototype._touchMove=function(e){if(this.enabled===false){return}switch(e.touches.length){case 1:this._movePrev.copy(this._moveCurr);this._moveCurr.copy(this._getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX;var n=e.touches[0].pageY-e.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2;var r=(e.touches[0].pageY+e.touches[1].pageY)/2;this._panEnd.copy(this._getMouseOnScreen(i,r));break}this.update()};t.prototype._resize=function(){if(this.domElement===document){this.screen.left=0;this.screen.top=0;this.screen.width=window.innerWidth;this.screen.height=window.innerHeight}else{var e=this.domElement.getBoundingClientRect();var t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft;this.screen.top=e.top+window.pageYOffset-t.clientTop;this.screen.width=e.width;this.screen.height=e.height}};t.prototype._getMouseOnScreen=function(e,t){var n=new THREE.Vector2;n.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height);return n};t.prototype._getMouseOnCircle=function(e,t){var n=new THREE.Vector2;n.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-t))/this.screen.width);return n};t.prototype._rotateCamera=function(){var e=new THREE.Vector3;var t=new THREE.Quaternion;var n=new THREE.Vector3;var i=new THREE.Vector3;var r=new THREE.Vector3;var s=new THREE.Vector3;var o;s.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);o=s.length();if(o){this._eye.copy(this.object.position).sub(this.target);n.copy(this._eye).normalize();i.copy(this.object.up).normalize();r.crossVectors(i,n).normalize();i.setLength(this._moveCurr.y-this._movePrev.y);r.setLength(this._moveCurr.x-this._movePrev.x);s.copy(i.add(r));e.crossVectors(s,this._eye).normalize();o*=this.rotateSpeed;t.setFromAxisAngle(e,o);this._eye.applyQuaternion(t);this.object.up.applyQuaternion(t);this._lastAxis.copy(e);this._lastAngle=o}else if(!this.staticMoving&&this._lastAngle){this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor);this._eye.copy(this.object.position).sub(this.target);t.setFromAxisAngle(this._lastAxis,this._lastAngle);this._eye.applyQuaternion(t);this.object.up.applyQuaternion(t)}this._movePrev.copy(this._moveCurr)};t.prototype._zoomCamera=function(){var e;if(this._state===Qe.TOUCH_ZOOM_PAN){e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd;this._touchZoomDistanceStart=this._touchZoomDistanceEnd;this._eye.multiplyScalar(e)}else{e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed;if(e!==1&&e>0){this._eye.multiplyScalar(e)}if(this.staticMoving){this._zoomStart.copy(this._zoomEnd)}else{this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor}}};t.prototype._panCamera=function(){var e=new THREE.Vector2;var t=new THREE.Vector3;var n=new THREE.Vector3;e.copy(this._panEnd).sub(this._panStart);if(e.lengthSq()){e.multiplyScalar(this._eye.length()*this.panSpeed);n.copy(this._eye).cross(this.object.up).setLength(e.x);n.add(t.copy(this.object.up).setLength(e.y));this.object.position.add(n);this.target.add(n);if(this.staticMoving){this._panStart.copy(this._panEnd)}else{this._panStart.add(e.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}};t.prototype._checkDistances=function(){if(!this.noZoom||!this.noPan){if(this._eye.lengthSq()>this.maxDistance*this.maxDistance){this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance));this._zoomStart.copy(this._zoomEnd)}if(this._eye.lengthSq()<this.minDistance*this.minDistance){this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance));this._zoomStart.copy(this._zoomEnd)}}};t.prototype.update=function(){this._eye.subVectors(this.object.position,this.target);if(!this.noRotate){this._rotateCamera()}if(!this.noZoom){this._zoomCamera()}if(!this.noPan){this._panCamera()}this.object.position.addVectors(this.target,this._eye);this._checkDistances();this.object.lookAt(this.target);if(this._lastPosition.distanceToSquared(this.object.position)>this.EPS){this.dispatchEvent(this._changeEvent);this._lastPosition.copy(this.object.position)}};t.prototype.reset=function(){this._state=Qe.NONE;this.target.copy(this._target0);this.object.position.copy(this._position0);this.object.up.copy(this._up0);this._eye.subVectors(this.object.position,this.target);this.object.lookAt(this.target);this.dispatchEvent(this._changeEvent);this._lastPosition.copy(this.object.position)};t.prototype.dispose=function(){this._removeListeners()};t.prototype._removeListeners=function(){this.domElement.removeEventListener("mousedown",this._mouseDown,false);window.removeEventListener("mousemove",this._mouseMove,false);window.removeEventListener("mouseup",this._mouseUp,false);this.domElement.removeEventListener("wheel",this._mouseWheel,false);this.domElement.removeEventListener("touchstart",this._touchStart,false);window.removeEventListener("touchend",this._touchEnd,false);window.removeEventListener("touchmove",this._touchMove,false)};return t}(THREE.EventDispatcher);AFRAME.registerComponent("al-trackball-control",{dependencies:["camera"],schema:{animating:{type:"boolean",default:false},controlPosition:{type:"vec3"},controlTarget:{type:"vec3"},dynamicDampingFactor:{default:.1},enabled:{type:"boolean",default:true},maxDistance:{type:"number",default:8e3},minDistance:{type:"number",default:0},noPan:{type:"boolean",default:false},noRotate:{type:"boolean",default:false},noZoom:{type:"boolean",default:false},panSpeed:{type:"number",default:.3},rotateSpeed:{type:"number",default:1},screenHeight:{type:"number",default:0},screenLeft:{type:"number",default:0},screenTop:{type:"number",default:0},screenWidth:{type:"number",default:0},staticMoving:{type:"boolean",default:true},zoomSpeed:{type:"number",default:.5}},bindMethods:function(){this.mouseDown=this.mouseDown.bind(this);this.mouseMove=this.mouseMove.bind(this);this.mouseUp=this.mouseUp.bind(this);this.canvasWheel=this.canvasWheel.bind(this);this.getCameraState=this.getCameraState.bind(this);this.handleAnimationCache=this.handleAnimationCache.bind(this);this.onWheel=this.onWheel.bind(this)},addListeners:function(){window.addEventListener("mouseup",this.mouseUp,{capture:false,once:false,passive:true});window.addEventListener("mousemove",this.mouseMove,{capture:false,once:false,passive:true});this.el.sceneEl.canvas.addEventListener("mousedown",this.mouseDown,{capture:false,once:false,passive:true});this.el.sceneEl.canvas.addEventListener("wheel",this.canvasWheel,{capture:false,once:false,passive:true});this.el.sceneEl.addEventListener(Ve.ANIMATION_STARTED,this.handleAnimationCache,false)},removeListeners:function(){window.removeEventListener("mouseup",this.mouseUp);window.removeEventListener("mousemove",this.mouseMove),this.el.sceneEl.canvas.removeEventListener("mousedown",this.mouseDown);this.el.sceneEl.canvas.removeEventListener("wheel",this.canvasWheel);this.el.sceneEl.removeEventListener(Ve.ANIMATION_STARTED,this.handleAnimationCache,false)},handleAnimationCache:function(e){this.state.animationCache=e.detail.slerpPath;var t=this.el.getObject3D("camera");this.state.cameraAnimationCache=we.getSlerp3Path(t.up.clone(),this.state.controls.up0)},mouseUp:function(e){this.state.mouseDown=false;document.body.style.cursor="grab";var t=this.state.controls;if(t.enabled){this.el.sceneEl.emit(Ve.INTERACTION_FINISHED,{cameraState:this.getCameraState()},false)}},mouseDown:function(e){this.state.mouseDown=true;document.body.style.cursor="grabbing"},mouseMove:function(e){if(this.state.mouseDown){this.el.sceneEl.emit(Ve.INTERACTION,{cameraState:this.getCameraState()},false)}},onWheel:function(){var e=this;var t=this.state;t.wheelMarker=false;t.wheelCounter2=t.wheelCounter1;setTimeout(function(){if(t.wheelCounter2===t.wheelCounter1){t.wheelMarker=true;t.wheelCounter1=0;t.wheelCounter2=0;e.el.sceneEl.emit(Ve.INTERACTION_FINISHED,{cameraState:e.getCameraState()},false)}else{e.onWheel()}},t.wheelInterval)},canvasWheel:function(e){var t=this.state;t.wheelCounter1+=1;if(t.wheelMarker){this.onWheel()}this.el.sceneEl.emit(Ve.INTERACTION,{cameraState:this.getCameraState()},false)},init:function(){var e=this;var t=this.el;var n=this.data;document.body.style.cursor="grab";this.tickFunction=AFRAME.utils.throttle(this.tickFunction,K.minFrameMS,this);var i=new Ge(t.getObject3D("camera"),t.sceneEl.renderer.domElement);var r=we.objectToVector3(n.controlPosition);var s=we.objectToVector3(n.controlTarget);i.object.position.copy(r);t.getObject3D("camera").position.copy(r);i.target.copy(s);var o=[];this.state={animationCache:o,cameraAnimationCache:null,controls:i,mouseDown:false,wheelCounter1:0,wheelCounter2:undefined,wheelInterval:50,wheelMarker:true};this.bindMethods();this.addListeners();we.waitOneFrame(function(){e.el.sceneEl.emit(Ve.INTERACTION,{cameraState:e.getCameraState()},false)})},getCameraState:function(){return{position:this.state.controls.object.position,target:this.state.controls.target}},update:function(e){var t=this.state.controls;var n=this.data;t.target=we.objectToVector3(n.controlTarget);t.dynamicDampingFactor=n.dynamicDampingFactor;t.enabled=n.enabled;t.maxDistance=n.maxDistance;t.minDistance=n.minDistance;t.noPan=n.noPan;t.noRotate=n.noRotate;t.noZoom=n.noZoom;t.panSpeed=n.panSpeed;t.rotateSpeed=n.rotateSpeed;t.screen.height=n.screenHeight;t.screen.left=n.screenLeft;t.screen.top=n.screenTop;t.screen.width=n.screenWidth;t.staticMoving=n.screenHeight;t.zoomSpeed=n.zoomSpeed;this.el.getObject3D("camera").position.copy(we.objectToVector3(n.controlPosition))},tickFunction:function(){var e=this.state.controls;if(!e.enabled){return}if(this.data.animating){var t=this.state.animationCache.shift();var n=this.state.cameraAnimationCache.shift();if(t&&t.position&&t.target){var i=this.el.getObject3D("camera");e.object.position.copy(t.position);i.position.copy(t.position);if(n){i.up.copy(n)}e.target.copy(t.target);this.el.sceneEl.emit(Ve.INTERACTION,{cameraState:this.getCameraState()},false)}if(this.state.animationCache.length===0){this.el.sceneEl.emit(Ve.ANIMATION_FINISHED,{},false);this.el.sceneEl.emit(Ve.INTERACTION_FINISHED,{cameraState:this.getCameraState()},false)}}if(e.enabled){e.update()}},tick:function(){this.tickFunction()},remove:function(){this.removeListeners();var e=this.state;e.controls.dispose();e=null}});var Xe=function(){function e(){}e.prototype.load=function(e,t){var n=this;return new Promise(function(i,r){var s=new XMLHttpRequest;s.open("GET",e,true);s.onload=function(){var e=JSON.parse(s.responseText);e=n._mapfiles(e.baseurl,e.series);var o=new AMI.VolumeLoader(t);o.load(e).then(function(){var e=o.data[0].mergeSeries(o.data);var t=e[0].stack[0];o.free();i(t)}).catch(function(e){console.log("Volume load error");r(e)})};s.onerror=function(e){r(e)};s.send()})};e.prototype._mapfiles=function(e,t){return t.map(function(t){if(!e.endsWith("/")){e+="/"}return""+e+t})};return e}();var Ze=function(){function e(){}return e}();Ze.LOADED="al-volume-loaded";Ze.ERROR="al-volume-error";Ze.RENDER_LOW="al-volume-render-low";Ze.RENDER_FULL="al-volume-render-full";AFRAME.registerComponent("al-volume",{schema:{displayMode:{type:"string"},isWebGl2:{type:"boolean"},slicesIndex:{type:"number"},slicesOrientation:{type:"string"},slicesWindowCenter:{type:"number"},slicesWindowWidth:{type:"number"},src:{type:"string"},srcLoaded:{type:"boolean"},volumeSteps:{type:"number"},volumeWindowCenter:{type:"number"},volumeWindowWidth:{type:"number"}},init:function(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,K.minFrameMS,this);this.loader=new Xe;this.state={bufferScene:new THREE.Scene,bufferSceneTextureHeight:this.el.sceneEl.canvas.clientHeight,bufferSceneTextureWidth:this.el.sceneEl.canvas.clientWidth};this.bindMethods();this.addEventListeners();this.createBufferTexture();this.debouncedRenderBufferScene=Ce.debounce(this.renderBufferScene,K.minFrameMS).bind(this)},bindMethods:function(){this.addEventListeners=this.addEventListeners.bind(this);this.handleStack=this.handleStack.bind(this);this.onInteraction=this.onInteraction.bind(this);this.onInteractionFinished=this.onInteractionFinished.bind(this);this.removeEventListeners=this.removeEventListeners.bind(this);this.renderBufferScene=this.renderBufferScene.bind(this);this.rendererResize=this.rendererResize.bind(this);this.createBufferTexture=this.createBufferTexture.bind(this)},addEventListeners:function(){this.el.sceneEl.addEventListener("rendererresize",this.rendererResize,false);this.el.sceneEl.addEventListener(Ve.INTERACTION,this.onInteraction,false);this.el.sceneEl.addEventListener(Ve.INTERACTION_FINISHED,this.onInteractionFinished,false)},removeEventListeners:function(){this.el.sceneEl.removeEventListener("rendererresize",this.rendererResize);this.el.sceneEl.removeEventListener(Ve.INTERACTION,this.onInteraction);this.el.sceneEl.removeEventListener(Ve.INTERACTION_FINISHED,this.onInteractionFinished)},createBufferTexture:function(){this.state.bufferSceneTexture=new THREE.WebGLRenderTarget(this.state.bufferSceneTextureWidth,this.state.bufferSceneTextureHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter});this.el.sceneEl.object3D.background=this.state.bufferSceneTexture.texture},onInteraction:function(e){if(this.state.stackhelper){this.state.stackhelper.steps=2;this.renderBufferScene()}},onInteractionFinished:function(e){if(this.state.stackhelper){this.state.stackhelper.steps=this.data.volumeSteps;this.debouncedRenderBufferScene()}},rendererResize:function(){var e=this.state;var t=e.bufferSceneTextureWidth!==this.el.sceneEl.canvas.clientWidth||e.bufferSceneTextureHeight!==this.el.sceneEl.canvas.clientHeight;if(t&&this.data.displayMode===E.VOLUME){e.bufferSceneTextureWidth=this.el.sceneEl.canvas.clientWidth;e.bufferSceneTextureHeight=this.el.sceneEl.canvas.clientHeight;this.createBufferTexture();this.renderBufferScene()}},renderBufferScene:function(){if(this.data.displayMode===E.VOLUME){this.el.sceneEl.renderer.render(this.state.bufferScene,this.el.sceneEl.camera,this.state.bufferSceneTexture)}},handleStack:function(e){var t=this.state;var n=this.el;t.stack=e;switch(this.data.displayMode){case E.SLICES:{t.stackhelper=new AMI.StackHelper(t.stack);t.stackhelper.bbox.visible=false;t.stackhelper.border.color=K.colorValues.blue;break}case E.VOLUME:{var i=n.sceneEl.parentEl.querySelector("#lut-canvases");t.lutHelper=new AMI.LutHelper(i);t.lutHelper.luts=AMI.LutHelper.presetLuts();t.lutHelper.lutsO=AMI.LutHelper.presetLutsO();t.stackhelper=new AMI.VolumeRenderHelper(t.stack);t.stackhelper.textureLUT=t.lutHelper.texture;break}default:{break}}if(n.object3DMap.mesh){n.removeObject3D("mesh")}if(this.data.displayMode===E.SLICES){n.setObject3D("mesh",this.state.stackhelper)}else{if(this.state.bufferScene.children.length){this.state.bufferScene.remove(this.state.bufferScene.children[0])}this.state.bufferScene.add(this.state.stackhelper)}n.sceneEl.emit(Ze.LOADED,t.stackhelper,false)},update:function(e){var t=this;var n=this.state;var i=this.el;if(!this.data.src){return}else if(e&&e.src!==this.data.src){this.loader.load(this.data.src,i).then(function(e){t.handleStack(e)})}else if(e&&e.displayMode!==this.data.displayMode&&n.stack){this.removeEventListeners();this.handleStack(n.stack);this.addEventListeners();if(this.data.displayMode===E.VOLUME){this.createBufferTexture();setTimeout(function(){t.renderBufferScene()},250)}else{this.el.sceneEl.object3D.background=null}}},tickFunction:function(){if(!this.state.stackhelper){return}switch(this.data.displayMode){case E.SLICES:{this.el.setObject3D("mesh",this.state.stackhelper);break}default:{break}}},tick:function(){this.tickFunction()},remove:function(){this.el.removeObject3D("mesh");this.removeEventListeners();this.el.sceneEl.object3D.background=null}});var Ke;(function(e){e["NULL"]="NULL";e["ERROR"]="ERROR";e["APP_CLEAR_ANGLES"]="APP_LOAD_ANGLES";e["APP_CLEAR_EDGES"]="APP_LOAD_EDGES";e["APP_CLEAR_NODES"]="APP_LOAD_NODES";e["APP_DELETE_ANGLE"]="APP_DELETE_ANGLE";e["APP_DELETE_EDGE"]="APP_DELETE_EDGE";e["APP_DELETE_NODE"]="APP_DELETE_NODE";e["APP_SELECT_ANGLE"]="APP_SELECT_ANGLE";e["APP_SELECT_EDGE"]="APP_SELECT_EDGE";e["APP_SELECT_NODE"]="APP_SELECT_NODE";e["APP_SET_ANGLE"]="APP_SET_ANGLE";e["APP_SET_BOUNDINGBOX_VISIBLE"]="APP_SET_BOUNDINGBOX_VISIBLE";e["APP_SET_CAMERA"]="APP_SET_CAMERA";e["APP_SET_CONTROLS_ENABLED"]="APP_SET_CONTROLS_ENABLED";e["APP_SET_CONTROLS_TYPE"]="APP_SET_CONTROLS_TYPE";e["APP_SET_DISPLAY_MODE"]="APP_SET_DISPLAY_MODE";e["APP_SET_EDGE"]="APP_SET_EDGE";e["APP_SET_MATERIAL"]="APP_SET_MATERIAL";e["APP_SET_NODE"]="APP_SET_NODE";e["APP_SET_NODES_ENABLED"]="APP_SET_NODES_ENABLED";e["APP_SET_ORIENTATION"]="APP_SET_ORIENTATION";e["APP_SET_SLICES_INDEX"]="APP_SET_SLICES_INDEX";e["APP_SET_SLICES_WINDOW_CENTER"]="APP_SET_SLICES_WINDOW_CENTER";e["APP_SET_SLICES_WINDOW_WIDTH"]="APP_SET_SLICES_WINDOW_WIDTH";e["APP_SET_SRC"]="APP_SET_SRC";e["APP_SET_SRC_LOADED"]="APP_SET_SRC_LOADED";e["APP_SET_UNITS"]="APP_SET_UNITS";e["APP_SET_VOLUME_STEPS"]="APP_SET_VOLUME_STEPS";e["APP_SET_VOLUME_WINDOW_CENTER"]="APP_SET_VOLUME_WINDOW_CENTER";e["APP_SET_VOLUME_WINDOW_WIDTH"]="APP_SET_VOLUME_WINDOW_WIDTH"})(Ke||(Ke={}));var qe=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_SRC,payload:e})]})})}};var Je=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_SRC_LOADED,payload:e})]})})}};var $e=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_NODE,payload:e})]})})}};var et=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_DELETE_NODE,payload:e})]})})}};var tt=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SELECT_NODE,payload:e})]})})}};var nt=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_CLEAR_NODES,payload:e})]})})}};var it=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_EDGE,payload:e})]})})}};var rt=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_DELETE_EDGE,payload:e})]})})}};var st=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SELECT_EDGE,payload:e})]})})}};var ot=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_CLEAR_EDGES,payload:e})]})})}};var at=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_ANGLE,payload:e})]})})}};var ct=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_DELETE_ANGLE,payload:e})]})})}};var lt=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SELECT_ANGLE,payload:e})]})})}};var ut=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_CLEAR_ANGLES,payload:e})]})})}};var dt=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_BOUNDINGBOX_VISIBLE,payload:e})]})})}};var ht=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_DISPLAY_MODE,payload:e})]})})}};var pt=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_NODES_ENABLED,payload:e})]})})}};var gt=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_MATERIAL,payload:e})]})})}};var ft=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_UNITS,payload:e})]})})}};var Et=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_ORIENTATION,payload:e})]})})}};var vt=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_SLICES_INDEX,payload:e})]})})}};var mt=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_SLICES_WINDOW_WIDTH,payload:e})]})})}};var Mt=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_SLICES_WINDOW_CENTER,payload:e})]})})}};var yt=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_VOLUME_STEPS,payload:e})]})})}};var _t=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_VOLUME_WINDOW_WIDTH,payload:e})]})})}};var Tt=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_VOLUME_WINDOW_CENTER,payload:e})]})})}};var bt=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_CAMERA,payload:e})]})})}};var St=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_CONTROLS_ENABLED,payload:e})]})})}};var Nt=function(e){return function(t,n){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Ke.APP_SET_CONTROLS_TYPE,payload:e})]})})}};function Lt(e){var t;var n=e.Symbol;if(typeof n==="function"){if(n.observable){t=n.observable}else{t=n("observable");n.observable=t}}else{t="@@observable"}return t}var Dt;if(typeof self!=="undefined"){Dt=self}else if(typeof window!=="undefined"){Dt=window}else if(typeof global!=="undefined"){Dt=global}else if(typeof module!=="undefined"){Dt=module}else{Dt=Function("return this")()}var It=Lt(Dt);var wt=function e(){return Math.random().toString(36).substring(7).split("").join(".")};var At={INIT:"@@redux/INIT"+wt(),REPLACE:"@@redux/REPLACE"+wt(),PROBE_UNKNOWN_ACTION:function e(){return"@@redux/PROBE_UNKNOWN_ACTION"+wt()}};function Ct(e){if(typeof e!=="object"||e===null)return false;var t=e;while(Object.getPrototypeOf(t)!==null){t=Object.getPrototypeOf(t)}return Object.getPrototypeOf(e)===t}function Ot(e,t,n){var i;if(typeof t==="function"&&typeof n==="function"||typeof n==="function"&&typeof arguments[3]==="function"){throw new Error("It looks like you are passing several store enhancers to "+"createStore(). This is not supported. Instead, compose them "+"together to a single function")}if(typeof t==="function"&&typeof n==="undefined"){n=t;t=undefined}if(typeof n!=="undefined"){if(typeof n!=="function"){throw new Error("Expected the enhancer to be a function.")}return n(Ot)(e,t)}if(typeof e!=="function"){throw new Error("Expected the reducer to be a function.")}var r=e;var s=t;var o=[];var a=o;var c=false;function l(){if(a===o){a=o.slice()}}function u(){if(c){throw new Error("You may not call store.getState() while the reducer is executing. "+"The reducer has already received the state as an argument. "+"Pass it down from the top reducer instead of reading it from the store.")}return s}function d(e){if(typeof e!=="function"){throw new Error("Expected the listener to be a function.")}if(c){throw new Error("You may not call store.subscribe() while the reducer is executing. "+"If you would like to be notified after the store has been updated, subscribe from a "+"component and invoke store.getState() in the callback to access the latest state. "+"See https://redux.js.org/api-reference/store#subscribe(listener) for more details.")}var t=true;l();a.push(e);return function n(){if(!t){return}if(c){throw new Error("You may not unsubscribe from a store listener while the reducer is executing. "+"See https://redux.js.org/api-reference/store#subscribe(listener) for more details.")}t=false;l();var i=a.indexOf(e);a.splice(i,1)}}function h(e){if(!Ct(e)){throw new Error("Actions must be plain objects. "+"Use custom middleware for async actions.")}if(typeof e.type==="undefined"){throw new Error('Actions may not have an undefined "type" property. '+"Have you misspelled a constant?")}if(c){throw new Error("Reducers may not dispatch actions.")}try{c=true;s=r(s,e)}finally{c=false}var t=o=a;for(var n=0;n<t.length;n++){var i=t[n];i()}return e}function p(e){if(typeof e!=="function"){throw new Error("Expected the nextReducer to be a function.")}r=e;h({type:At.REPLACE})}function g(){var e;var t=d;return e={subscribe:function e(n){if(typeof n!=="object"||n===null){throw new TypeError("Expected the observer to be an object.")}function i(){if(n.next){n.next(u())}}i();var r=t(i);return{unsubscribe:r}}},e[It]=function(){return this},e}h({type:At.INIT});return i={dispatch:h,subscribe:d,getState:u,replaceReducer:p},i[It]=g,i}function jt(e,t){var n=t&&t.type;var i=n&&'action "'+String(n)+'"'||"an action";return"Given "+i+', reducer "'+e+'" returned undefined. '+"To ignore an action, you must explicitly return the previous state. "+"If you want this reducer to hold no value, you can return null instead of undefined."}function xt(e){Object.keys(e).forEach(function(t){var n=e[t];var i=n(undefined,{type:At.INIT});if(typeof i==="undefined"){throw new Error('Reducer "'+t+'" returned undefined during initialization. '+"If the state passed to the reducer is undefined, you must "+"explicitly return the initial state. The initial state may "+"not be undefined. If you don't want to set a value for this reducer, "+"you can use null instead of undefined.")}if(typeof n(undefined,{type:At.PROBE_UNKNOWN_ACTION()})==="undefined"){throw new Error('Reducer "'+t+'" returned undefined when probed with a random type. '+("Don't try to handle "+At.INIT+' or other actions in "redux/*" ')+"namespace. They are considered private. Instead, you must return the "+"current state for any unknown actions, unless it is undefined, "+"in which case you must return the initial state, regardless of the "+"action type. The initial state may not be undefined, but can be null.")}})}function Pt(e){var t=Object.keys(e);var n={};for(var i=0;i<t.length;i++){var r=t[i];if(typeof e[r]==="function"){n[r]=e[r]}}var s=Object.keys(n);var o;try{xt(n)}catch(e){o=e}return function e(t,i){if(t===void 0){t={}}if(o){throw o}var r=false;var a={};for(var c=0;c<s.length;c++){var l=s[c];var u=n[l];var d=t[l];var h=u(d,i);if(typeof h==="undefined"){var p=jt(l,i);throw new Error(p)}a[l]=h;r=r||h!==d}return r?a:t}}function zt(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function Rt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};var i=Object.keys(n);if(typeof Object.getOwnPropertySymbols==="function"){i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))}i.forEach(function(t){zt(e,t,n[t])})}return e}function kt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}if(t.length===0){return function(e){return e}}if(t.length===1){return t[0]}return t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}function Wt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}return function(e){return function(){var n=e.apply(void 0,arguments);var i=function e(){throw new Error("Dispatching while constructing your middleware is not allowed. "+"Other middleware would not be applied to this dispatch.")};var r={getState:n.getState,dispatch:function e(){return i.apply(void 0,arguments)}};var s=t.map(function(e){return e(r)});i=kt.apply(void 0,s)(n.dispatch);return Rt({},n,{dispatch:i})}}}function Ut(e){return function(t){var n=t.dispatch,i=t.getState;return function(t){return function(r){if(typeof r==="function"){return r(n,i,e)}return t(r)}}}}var Ht=Ut();Ht.withExtraArgument=Ut;var Yt=function(){return{angles:new Map,boundingBoxEnabled:false,camera:null,controlsEnabled:true,controlsType:f.ORBIT,displayMode:E.MESH,edges:new Map,material:v.DEFAULT,nodes:new Map,graphEnabled:false,orientation:M.CORONAL,selected:null,slicesIndex:0,slicesWindowCenter:0,slicesWindowWidth:0,src:null,srcLoaded:false,units:_.METERS,volumeSteps:16,volumeWindowCenter:0,volumeWindowWidth:0}};var Ft=function(e,t){if(e===void 0){e=Yt()}switch(t.type){case Ke.APP_SET_SRC:{var n=t.payload,i=n[0],r=n[1];var s;if(r){s=r}else if(i){var o=Oe.getFileExtension(i);if(Object.values(m).includes(o)){s=E.MESH}else{s=E.SLICES}}else{s=E.MESH}return Object.assign({},e,{angles:new Map,controlsEnabled:false,displayMode:s,edges:new Map,nodes:new Map,orientation:M.CORONAL,selected:null,slicesIndex:0,slicesWindowCenter:0,slicesWindowWidth:0,src:i,srcLoaded:false,volumeSteps:16,volumeWindowCenter:0,volumeWindowWidth:0})}case Ke.APP_SET_SRC_LOADED:{return Object.assign({},e,{controlsEnabled:t.payload,srcLoaded:t.payload,boundingBoxEnabled:e.displayMode!==E.MESH?true:e.boundingBoxEnabled,units:e.displayMode!==E.MESH?_.MILLIMETERS:_.METERS})}case Ke.APP_SET_NODE:{var a=t.payload,c=a[0],l=a[1];var u=JSON.parse(JSON.stringify(l));var d=e.nodes.get(c);var h=Object.assign({},d,u);return Object.assign({},e,{selected:d?e.selected:c,nodes:new Map(e.nodes).set(c,h)})}case Ke.APP_DELETE_NODE:{return Object.assign({},e,{selected:e.selected===t.payload?null:e.selected,nodes:new Map(e.nodes.slice().filter(function(e){var n=e[0];return n!==t.payload})),edges:new Map(e.edges.slice().filter(function(e){var n=e[0],i=e[1];return t.payload!==i.node1Id&&t.payload!==i.node2Id}))})}case Ke.APP_SELECT_NODE:{return Object.assign({},e,{selected:t.payload})}case Ke.APP_CLEAR_NODES:{return Object.assign({},e,{nodes:new Map})}case Ke.APP_SET_EDGE:{var p=t.payload,c=p[0],l=p[1];var u=JSON.parse(JSON.stringify(l));var d=e.edges.get(c);var h=Object.assign({},d,u);return Object.assign({},e,{selected:d?e.selected:c,edges:new Map(e.edges).set(c,h)})}case Ke.APP_DELETE_EDGE:{return Object.assign({},e,{selected:e.selected===t.payload?null:e.selected,edges:new Map(e.edges.slice().filter(function(e){var n=e[0];return n!==t.payload})),angles:new Map(e.angles.slice().filter(function(e){var n=e[0],i=e[1];return t.payload!==i.edge1Id&&t.payload!==i.edge2Id}))})}case Ke.APP_SELECT_EDGE:{return Object.assign({},e,{selected:t.payload})}case Ke.APP_CLEAR_EDGES:{return Object.assign({},e,{edges:new Map})}case Ke.APP_SET_ANGLE:{var g=t.payload,c=g[0],l=g[1];var u=JSON.parse(JSON.stringify(l));var d=e.angles.get(c);var h=Object.assign({},d,u);return Object.assign({},e,{selected:d?e.selected:c,angles:new Map(e.angles).set(c,h)})}case Ke.APP_DELETE_ANGLE:{return Object.assign({},e,{selected:e.selected===t.payload?null:e.selected,angles:new Map(e.angles.slice().filter(function(e){var n=e[0];return n!==t.payload}))})}case Ke.APP_SELECT_ANGLE:{return Object.assign({},e,{selected:t.payload})}case Ke.APP_CLEAR_ANGLES:{return Object.assign({},e,{angles:new Map})}case Ke.APP_SET_DISPLAY_MODE:{return Object.assign({},e,{displayMode:t.payload,boundingBoxEnabled:t.payload!==E.MESH?true:e.boundingBoxEnabled})}case Ke.APP_SET_ORIENTATION:{return Object.assign({},e,{slicesIndex:undefined,orientation:t.payload})}case Ke.APP_SET_MATERIAL:{return Object.assign({},e,{material:t.payload})}case Ke.APP_SET_NODES_ENABLED:{return Object.assign({},e,{graphEnabled:t.payload})}case Ke.APP_SET_BOUNDINGBOX_VISIBLE:{return Object.assign({},e,{boundingBoxEnabled:t.payload})}case Ke.APP_SET_SLICES_INDEX:{return Object.assign({},e,{slicesIndex:t.payload})}case Ke.APP_SET_SLICES_WINDOW_WIDTH:{return Object.assign({},e,{slicesWindowWidth:t.payload})}case Ke.APP_SET_SLICES_WINDOW_CENTER:{return Object.assign({},e,{slicesWindowCenter:t.payload})}case Ke.APP_SET_UNITS:{return Object.assign({},e,{units:t.payload})}case Ke.APP_SET_VOLUME_STEPS:{return Object.assign({},e,{volumeSteps:t.payload})}case Ke.APP_SET_VOLUME_WINDOW_WIDTH:{return Object.assign({},e,{volumeWindowWidth:t.payload})}case Ke.APP_SET_VOLUME_WINDOW_CENTER:{return Object.assign({},e,{volumeWindowCenter:t.payload})}case Ke.APP_SET_CAMERA:{return Object.assign({},e,{camera:Object.assign({},e.camera,t.payload)})}case Ke.APP_SET_CONTROLS_ENABLED:{return Object.assign({},e,{controlsEnabled:t.payload})}case Ke.APP_SET_CONTROLS_TYPE:{return Object.assign({},e,{controlsType:t.payload})}default:{return Object.assign({},e)}}};var Vt=Pt({app:Ft});var Qt=function(e){return Ot(Vt,e,Wt(Ht))};var Bt=e("al_viewer",function(){function e(e){t(this,e);this._hovered=null;this._isShiftDown=false;this._isWebGl2=true;this.width="640";this.height="480";this.changed=n(this,"changed",7);this.loaded=n(this,"loaded",7);this.store=o(this,"store")}e.prototype.load=function(e,t){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(i){if(this.src){this._setSrc(null);setTimeout(function(){n._setSrc(e,t)},K.minLoadingMS)}else{this._setSrc(e,t)}return[2]})})};e.prototype.resize=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){this._resize();return[2]})})};e.prototype.setNode=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setNode(e);return[2]})})};e.prototype.setGraph=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setGraph(e);return[2]})})};e.prototype.deleteNode=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._deleteNode(e);return[2]})})};e.prototype.clearGraph=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){this._clearGraph();return[2]})})};e.prototype.selectNode=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._selectNode(e,true);return[2]})})};e.prototype.deleteEdge=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._deleteEdge(e);return[2]})})};e.prototype.deleteAngle=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._deleteAngle(e);return[2]})})};e.prototype.setEdge=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setEdge(e);return[2]})})};e.prototype.recenter=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){this._recenter();return[2]})})};e.prototype.setBoundingBoxEnabled=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setBoundingBoxEnabled(e);return[2]})})};e.prototype.setDisplayMode=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setDisplayMode(e);return[2]})})};e.prototype.setControlsEnabled=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setControlsEnabled(e);return[2]})})};e.prototype.setControlsType=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setControlsType(e);return[2]})})};e.prototype.setGraphEnabled=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setGraphEnabled(e);return[2]})})};e.prototype.setMaterial=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setMaterial(e);return[2]})})};e.prototype.setOrientation=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setOrientation(e);return[2]})})};e.prototype.setSlicesIndex=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setSlicesIndex(e);return[2]})})};e.prototype.setSlicesWindowCenter=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setSlicesWindowCenter(e);return[2]})})};e.prototype.setSlicesWindowWidth=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setSlicesWindowWidth(e);return[2]})})};e.prototype.setUnits=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setUnits(e);return[2]})})};e.prototype.setVolumeSteps=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setVolumeSteps(e);return[2]})})};e.prototype.setVolumeWindowCenter=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setVolumeWindowCenter(e);return[2]})})};e.prototype.setVolumeWindowWidth=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setVolumeWindowWidth(e);return[2]})})};e.prototype.componentWillLoad=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){this._isWebGl2=we.isWebGL2Available();this.store.setStore(Qt({}));this.store.mapStateToProps(this,function(e){var t=e.app,n=t.angles,i=t.boundingBoxEnabled,r=t.camera,s=t.controlsEnabled,o=t.controlsType,a=t.displayMode,c=t.edges,l=t.graphEnabled,u=t.material,d=t.nodes,h=t.orientation,p=t.selected,g=t.slicesIndex,f=t.slicesWindowCenter,E=t.slicesWindowWidth,v=t.src,m=t.srcLoaded,M=t.units,y=t.volumeSteps,_=t.volumeWindowCenter,T=t.volumeWindowWidth;return{angles:n,boundingBoxEnabled:i,camera:r,controlsEnabled:s,controlsType:o,displayMode:a,edges:c,graphEnabled:l,material:u,nodes:d,orientation:h,selected:p,slicesIndex:g,slicesWindowCenter:f,slicesWindowWidth:E,src:v,srcLoaded:m,units:M,volumeSteps:y,volumeWindowCenter:_,volumeWindowWidth:T}});this.store.mapDispatchToProps(this,{appClearAngles:ut,appClearEdges:ot,appClearNodes:nt,appDeleteAngle:ct,appDeleteEdge:rt,appDeleteNode:et,appSelectAngle:lt,appSelectEdge:st,appSelectNode:tt,appSetAngle:at,appSetBoundingBoxEnabled:dt,appSetCamera:bt,appSetControlsEnabled:St,appSetControlsType:Nt,appSetDisplayMode:ht,appSetEdge:it,appSetGraphEnabled:pt,appSetMaterial:gt,appSetNode:$e,appSetOrientation:Et,appSetSlicesIndex:vt,appSetSlicesWindowCenter:Mt,appSetSlicesWindowWidth:mt,appSetSrc:qe,appSetSrcLoaded:Je,appSetUnits:ft,appSetVolumeSteps:yt,appSetVolumeWindowCenter:Tt,appSetVolumeWindowWidth:_t});this._controlsAnimationFinishedHandler=this._controlsAnimationFinishedHandler.bind(this);this._controlsInteractionHandler=this._controlsInteractionHandler.bind(this);this._graphEntryDraggedHandler=this._graphEntryDraggedHandler.bind(this);this._graphEntryPointerDownHandler=this._graphEntryPointerDownHandler.bind(this);this._graphEntryPointerOutHandler=this._graphEntryPointerOutHandler.bind(this);this._graphEntryPointerOverHandler=this._graphEntryPointerOverHandler.bind(this);this._graphEntryPointerUpHandler=this._graphEntryPointerUpHandler.bind(this);this._graphEntrySelectedHandler=this._graphEntrySelectedHandler.bind(this);this._graphEntryValidTargetHandler=this._graphEntryValidTargetHandler.bind(this);this._keyDownHandler=this._keyDownHandler.bind(this);this._keyUpHandler=this._keyUpHandler.bind(this);this._controlsInteractionFinishedHandler=this._controlsInteractionFinishedHandler.bind(this);this._spawnNodeHandler=this._spawnNodeHandler.bind(this);this._srcLoaded=this._srcLoaded.bind(this);this._debouncedAppSetCamera=Ce.debounce(this.appSetCamera,K.minFrameMS).bind(this);this._lights=[];return[2]})})};e.prototype._renderSpinner=function(){if(this.src&&!this.srcLoaded){return i("div",{id:"spinner"},i("div",{class:"square"}))}};e.prototype._renderSrc=function(){var e=this;if(!this.src){return null}switch(this.displayMode){case E.MESH:{return i("a-entity",{class:"collidable","al-node-spawner":"\n              graphEnabled: "+this.graphEnabled+";\n            ","al-gltf-model":"\n              src: url("+this.src+");\n              dracoDecoderPath: "+this.dracoDecoderPath+";\n            ",position:"0 0 0",scale:"1 1 1",ref:function(t){return e._targetEntity=t}})}case E.SLICES:{return i("a-entity",{id:"target-entity",class:"collidable","al-node-spawner":"\n              graphEnabled: "+this.graphEnabled+";\n            ","al-volume":"\n              srcLoaded: "+this.srcLoaded+";\n              src: "+this.src+";\n              displayMode: "+this.displayMode+";\n              slicesIndex: "+this.slicesIndex+";\n              slicesOrientation: "+this.orientation+";\n              slicesWindowWidth: "+this.slicesWindowWidth+";\n              slicesWindowCenter: "+this.slicesWindowCenter+";\n              volumeSteps: "+this.volumeSteps+";\n              volumeWindowCenter: "+this.volumeWindowCenter+";\n              volumeWindowWidth: "+this.volumeWindowWidth+";\n              isWebGl2: "+this._isWebGl2+";\n            ",position:"0 0 0",ref:function(t){return e._targetEntity=t}})}case E.VOLUME:{return i("a-entity",{id:"target-entity","al-volume":"\n              srcLoaded: "+this.srcLoaded+";\n              src: "+this.src+";\n              displayMode: "+this.displayMode+";\n              slicesIndex: "+this.slicesIndex+";\n              slicesOrientation: "+this.orientation+";\n              slicesWindowWidth: "+this.slicesWindowWidth+";\n              slicesWindowCenter: "+this.slicesWindowCenter+";\n              volumeSteps: "+this.volumeSteps+";\n              volumeWindowCenter: "+this.volumeWindowCenter+";\n              volumeWindowWidth: "+this.volumeWindowWidth+";\n              isWebGl2: "+this._isWebGl2+";\n            ",position:"0 0 0",ref:function(t){return e._targetEntity=t}})}default:{return}}};e.prototype._renderBoundingBox=function(){var e=this;if(this.srcLoaded){var t=new THREE.Vector3;this._boundingBox.getSize(t);var n=this._getMesh();if(!n){return null}var r=n.geometry;var s=void 0;var o=void 0;if(this.boundingBoxEnabled){o=1}else{o=0}if(this.displayMode===E.VOLUME){s=this._targetEntity.object3D.position.clone().add(Oe.getGeometryCenter(r));return i("a-entity",{position:we.vector3ToString(s),"al-bounding-box":"\n              scale: "+we.vector3ToString(t)+";\n              color: "+K.colorValues.white+";\n              opacity: "+o+";\n            ","al-node-spawner":"\n              graphEnabled: "+this.graphEnabled+";\n            ",class:"collidable",ref:function(t){return e._boundingEntity=t}})}else{switch(this.displayMode){case E.MESH:{if(this._boundingBox.intersectsBox(r.boundingBox)){var a=r.boundingSphere.center.clone();s=this._targetEntity.object3D.position.clone().add(a)}else{s=this._targetEntity.object3D.position.clone()}break}case E.SLICES:{s=this._targetEntity.object3D.position.clone().add(Oe.getGeometryCenter(r));break}default:{break}}return i("a-entity",{position:we.vector3ToString(s),"al-bounding-box":"\n                scale: "+we.vector3ToString(t)+";\n                color: "+K.colorValues.white+";\n                opacity: "+o+";\n              ",ref:function(t){return e._boundingEntity=t}})}}};e.prototype._renderNodes=function(){var e=this;return Array.from(this.nodes).map(function(t){var n=t[0],r=t[1];var s=we.getFrustrumSpaceDistance(e._scene.camera,we.stringToVector3(r.position),e.camera.position);var o=s/e._boundingSphereRadius*K.frustrumScaleFactor;var a=new THREE.Vector3(0,4,0);a.multiplyScalar(r.scale);return i("a-entity",{class:"collidable",id:n,position:r.position,"al-node":"\n            scale: "+r.scale+";\n            selected: "+(e.selected===n)+";\n            graphEnabled: "+e.graphEnabled+";\n          ",scale:" "+o+" "+o+" "+o+";"},i("a-entity",{text:"\n              value: "+r.title+";\n              side: double;\n              align: center;\n              baseline: bottom;\n              anchor: center;\n              width: "+K.fontSizeMedium*e._boundingSphereRadius+";\n              zOffset: "+1e-7+";\n            ",position:we.vector3ToString(a),"al-render-overlaid":true,visible:""+(e.selected===n),id:n+"-label","al-billboard-baggins":"\n              controlsType: "+e.controlsType+";\n              cameraPosition: "+we.vector3ToString(e.camera.position)+";\n              worldPosition: "+we.vector3ToString(we.stringToVector3(r.position).add(a))+"\n            ","al-background":"\n                text: "+r.title+";\n                boundingRadius: "+K.fontSizeMedium*e._boundingSphereRadius+";\n            "}))})};e.prototype._renderEdges=function(){var e=this;return Array.from(this.edges).map(function(t){var n=t[0],r=t[1];var s=e.nodes.get(r.node1Id);var o=e.nodes.get(r.node2Id);if(s&&o){var a=we.stringToVector3(s.position);var c=we.stringToVector3(o.position);var l=c.clone().sub(a);var u=l.length();l=l.normalize().multiplyScalar(u*.5);var d=a.clone().add(l);var h=new THREE.Vector3(0,2.5,0);var p=(s.scale+o.scale)/2;var g=e._boundingSphereRadius*K.edgeSize;h.multiplyScalar(p);var f=e._convertUnits(u);var E=we.getFrustrumSpaceDistance(e._scene.camera,d.clone(),e.camera.position);var v=E/e._boundingSphereRadius*K.frustrumScaleFactor;return i("a-entity",{class:"collidable",id:n,position:we.vector3ToString(d),"al-edge":"\n              length: "+u+";\n              node1: "+s.position+";\n              node2: "+o.position+";\n              selected: "+(e.selected===n)+";\n              radius: "+g+";\n              nodeScale: "+p+";\n              scale: "+v+";\n            "},i("a-entity",{id:n+"-title",text:"\n                value: "+f+";\n                side: double;\n                align: center;\n                baseline: bottom;\n                anchor: center;\n                width: "+K.fontSizeSmall*e._boundingSphereRadius+"\n              ",position:we.vector3ToString(h),visible:""+(e.selected===n),scale:" "+v+" "+v+" "+v+";","al-billboard-baggins":"\n                controlsType: "+e.controlsType+";\n                cameraPosition: "+we.vector3ToString(e.camera.position)+";\n                worldPosition: "+we.vector3ToString(d.clone().add(h.clone()))+";\n              ","al-background":"\n                  text: "+f+";\n                  boundingRadius: "+K.fontSizeSmall*e._boundingSphereRadius+";\n              ","al-render-overlaid":true}))}})};e.prototype._renderAngles=function(){var e=this;return Array.from(this.angles).map(function(t){var n=t[0],r=t[1];var s=e.edges.get(r.edge1Id);var o=e.edges.get(r.edge2Id);if(s&&o){var a=void 0;var c=void 0;var l=void 0;if(s.node1Id===o.node1Id){a=e.nodes.get(o.node1Id);c=e.nodes.get(s.node2Id);l=e.nodes.get(o.node2Id)}else if(s.node1Id===o.node2Id){a=e.nodes.get(o.node2Id);c=e.nodes.get(s.node2Id);l=e.nodes.get(o.node1Id)}else if(s.node2Id===o.node1Id){a=e.nodes.get(o.node1Id);c=e.nodes.get(s.node1Id);l=e.nodes.get(o.node2Id)}else if(s.node2Id===o.node2Id){a=e.nodes.get(o.node2Id);c=e.nodes.get(s.node1Id);l=e.nodes.get(o.node1Id)}var u=e._boundingSphereRadius*K.edgeSize;var d=we.stringToVector3(c.position);var h=we.stringToVector3(l.position);var p=we.stringToVector3(a.position);var g=d.clone().sub(p).normalize();var f=h.clone().sub(p).normalize();var E=f.angleTo(g);var v=Math.min(p.distanceTo(d),p.distanceTo(h));var m=Math.min(v*.25,u*25);m=Math.max(m,u*10);var M=g.clone().multiplyScalar(m);var y=f.clone().multiplyScalar(m);var _=M.clone().distanceTo(y.clone());var T=M.clone().add(y.clone()).divideScalar(2);var b=new THREE.Vector3(0,2.5,0);var S=(c.scale+l.scale+a.scale)/3;b.multiplyScalar(S);var N=THREE.Math.radToDeg(E).toFixed(K.unitsDecimalPlaces)+" deg";var L=we.getFrustrumSpaceDistance(e._scene.camera,p.clone(),e.camera.position);var D=L/e._boundingSphereRadius*K.frustrumScaleFactor;return i("a-entity",{class:"collidable",id:n,position:a.position,"al-angle":"\n              selected: "+(e.selected===n)+";\n              edge0Pos: "+we.vector3ToString(M)+";\n              edge1Pos: "+we.vector3ToString(y)+";\n              position: "+we.vector3ToString(T)+";\n              length: "+_+";\n              radius: "+u+";\n              angle: "+r+";\n              scale: "+D+";\n            "},i("a-entity",{id:n+"-title",scale:" "+D+" "+D+" "+D+";",text:"\n                value: "+N+";\n                side: double;\n                align: center;\n                baseline: bottom;\n                anchor: center;\n                width: "+K.fontSizeSmall*e._boundingSphereRadius+"\n              ",position:we.vector3ToString(T.clone().add(b)),visible:""+(e.selected===n),"al-billboard-baggins":"\n                controlsType: "+e.controlsType+";\n                cameraPosition: "+we.vector3ToString(e.camera.position)+";\n                worldPosition: "+we.vector3ToString(we.stringToVector3(a.position).add(b.clone()))+";\n              ","al-background":"\n                text: "+N+";\n                boundingRadius: "+K.fontSizeSmall*e._boundingSphereRadius+";\n              ","al-render-overlaid":true}))}})};e.prototype._renderLights=function(){var e=this;return[i("a-entity",{id:"light-1",light:"type: directional; color: #ffffff; intensity: 0.5",position:"1 1 1",ref:function(t){return e._lights[0]=t}}),i("a-entity",{id:"light-2",light:"type: directional; color: #ffffff; intensity: 0.5",position:"-1 -1 -1",ref:function(t){return e._lights[1]=t}}),i("a-entity",{id:"light-3",light:"type: ambient; color: #d0d0d0; intensity: 1"})]};e.prototype._renderOrbitCamera=function(){var e=this;return i("a-camera",{fov:K.cameraValues.fov,near:K.cameraValues.near,"look-controls":"enabled: false",far:K.cameraValues.far,id:"mainCamera","al-cursor":"rayOrigin: mouse",raycaster:"objects: .collidable;","al-orbit-control":"\n          maxPolarAngle: "+K.cameraValues.maxPolarAngle+";\n          minDistance: "+K.cameraValues.minDistance+";\n          screenSpacePanning: true;\n          rotateSpeed: "+K.cameraValues.rotateSpeed+";\n          zoomSpeed: "+K.cameraValues.zoomSpeed+";\n          enableDamping: true;\n          dampingFactor: "+K.cameraValues.dampingFactor+";\n          controlTarget: "+we.vector3ToString(this.camera?this.camera.target:new THREE.Vector3(0,0,0))+";\n          controlPosition: "+we.vector3ToString(this.camera?this.camera.position:new THREE.Vector3(0,0,0))+";\n          enabled: "+this.controlsEnabled+";\n          animating: "+(this.camera&&this.camera.animating?this.camera.animating:false)+"\n        ",ref:function(t){return e._camera=t}})};e.prototype._renderTrackballCamera=function(){var e=this;return i("a-camera",{fov:K.cameraValues.fov,near:K.cameraValues.near,"look-controls":"enabled: false",far:K.cameraValues.far,id:"mainCamera","al-cursor":"rayOrigin: mouse",raycaster:"objects: .collidable;","al-trackball-control":"\n          screenLeft: "+0+";\n          screenTop: "+0+";\n          screenWidth: "+(this._scene?this._scene.canvas.width:0)+";\n          screenHeight: "+(this._scene?this._scene.canvas.height:0)+";\n          rotateSpeed: "+K.cameraValues.rotateSpeed*5+";\n          zoomSpeed: "+K.cameraValues.zoomSpeed*5+";\n          panSpeed: "+K.cameraValues.panSpeed+";\n          dynamicDampingFactor: "+K.cameraValues.dampingFactor+";\n          controlTarget: "+we.vector3ToString(this.camera?this.camera.target:new THREE.Vector3(0,0,0))+";\n          controlPosition: "+we.vector3ToString(this.camera?this.camera.position:new THREE.Vector3(0,0,0))+";\n          enabled: "+this.controlsEnabled+";\n          animating: "+(this.camera&&this.camera.animating?this.camera.animating:false)+"\n        ",ref:function(t){return e._camera=t}})};e.prototype._renderControls=function(){switch(this.controlsType){case f.TRACKBALL:{return this._renderTrackballCamera()}case f.ORBIT:{return this._renderOrbitCamera()}default:{return null}}};e.prototype._renderCamera=function(){return[this._renderControls(),this._renderLights()]};e.prototype._renderScene=function(){var e=this;return i("a-scene",{embedded:true,renderer:"\n          colorManagement: true;\n          sortObjects: true;\n          webgl2: "+this._isWebGl2+";\n          antialias: true;\n        ","vr-mode-ui":"enabled: false",ref:function(t){return e._scene=t}},this._renderBoundingBox(),this._renderSrc(),this._renderNodes(),this._renderEdges(),this._renderAngles(),this._renderCamera())};e.prototype.render=function(){return i("div",{id:"al-container",class:this.displayMode,style:{width:Oe.addCssUnits(this.width),height:Oe.addCssUnits(this.height)}},i("div",{id:"lut-container"},i("div",{id:"lut-min"},"0.0"),i("div",{id:"lut-canvases"}),i("div",{id:"lut-max"},"1.0")),this._renderScene(),this._renderSpinner())};e.prototype._resize=function(){if(this._scene){this._scene.resize()}};e.prototype._convertUnits=function(e){if(this.displayMode===E.MESH){switch(this.units){case _.METERS:{return e.toFixed(K.unitsDecimalPlaces)+this.units}case _.MILLIMETERS:{return(e/.001).toFixed(K.unitsDecimalPlaces)+this.units}default:{break}}}else{switch(this.units){case _.METERS:{return(e/1e3).toFixed(K.unitsDecimalPlaces)+this.units}case _.MILLIMETERS:{return e.toFixed(K.unitsDecimalPlaces)+this.units}default:{break}}}};e.prototype._createEdge=function(e,t){var n=Array.from(this.edges).find(function(n){var i=n[0],r=n[1];return r.node1Id===e&&r.node2Id===t||r.node1Id===t&&r.node2Id===e});if(!n){var i={node1Id:e,node2Id:t};var r=xe.getNextId(g.EDGE,this.edges);this._setEdge([r,i])}else{console.log("edge already exists")}};e.prototype._createAngle=function(e,t){var n=Array.from(this.angles).find(function(n){var i=n[0],r=n[1];return r.edge1Id===e&&r.edge2Id===t||r.edge1Id===t&&r.edge2Id===e});if(!n){var i=this.edges.get(e);var r=this.edges.get(t);if(i.node1Id===r.node1Id||i.node1Id===r.node2Id||i.node2Id===r.node1Id||i.node2Id===r.node2Id){var s={edge1Id:e,edge2Id:t};var o=xe.getNextId(g.ANGLE,this.angles);this._setAngle([o,s])}else{console.warn("cannot create angle: edges not connected")}}else{console.warn("cannot create angle: angle already exists")}};e.prototype._stateChanged=function(){this.changed.emit(this.store.getState().app)};e.prototype._setGraph=function(e){var t=this;if(e.nodes){var n=new Map(e.nodes);n.forEach(function(e,n){t.appSetNode([n,e])})}if(e.edges){var i=new Map(e.edges);i.forEach(function(e,n){t.appSetEdge([n,e])})}if(e.angles){var r=new Map(e.angles);r.forEach(function(e,n){t.appSetAngle([n,e])})}this._stateChanged()};e.prototype._clearGraph=function(){this.appClearNodes();this.appClearEdges();this.appClearAngles();this._stateChanged()};e.prototype._deleteNode=function(e){this.appDeleteNode(e);this._stateChanged()};e.prototype._setNode=function(e){this.appSetNode(e);this._stateChanged()};e.prototype._animateBetween=function(e,t){var n=Oe.getCameraStateFromMesh(this._getMesh());var i={position:t,target:n.target.clone()};if(t){var r=i.position.distanceTo(this.camera.position);var s=i.target.distanceTo(this.camera.target);var o=r/K.maxAnimationSteps>Number.EPSILON;var a=s/K.maxAnimationSteps>Number.EPSILON;if(o||a){i.position.copy(t.clone());var c=we.getSlerpCameraPath(e,i,o,a);this._scene.emit(Ve.ANIMATION_STARTED,{slerpPath:c},false);this.appSetCamera({animating:true});this._stateChanged()}}};e.prototype._selectNode=function(e,t){if(t===void 0){t=false}if(t&&e!==this.selected){var n={position:this.camera.position.clone(),target:this.camera.target.clone()};var i=Oe.getCameraPositionFromNode(this.nodes.get(e),this._boundingSphereRadius,this.camera.target);this.appSelectNode(e);this._animateBetween(n,i)}else{this.appSelectNode(e);this._stateChanged()}};e.prototype._setEdge=function(e){this.appSetEdge(e);this._stateChanged()};e.prototype._deleteEdge=function(e){this.appDeleteEdge(e);this._stateChanged()};e.prototype._recenter=function(){var e=Oe.getCameraStateFromMesh(this._getMesh());var t={position:this.camera.position.clone(),target:this.camera.target.clone()};this._selectNode(null);this._animateBetween(t,e.position)};e.prototype._selectEdge=function(e){this.appSelectEdge(e);this._stateChanged()};e.prototype._setAngle=function(e){this.appSetAngle(e);this._stateChanged()};e.prototype._selectAngle=function(e){this.appSelectAngle(e);this._stateChanged()};e.prototype._deleteAngle=function(e){this.appDeleteAngle(e);this._stateChanged()};e.prototype._setBoundingBoxEnabled=function(e){this.appSetBoundingBoxEnabled(e);this._stateChanged()};e.prototype._setControlsEnabled=function(e){this.appSetControlsEnabled(e);this._stateChanged()};e.prototype._setControlsType=function(e){this.appSetControlsType(e);this._stateChanged()};e.prototype._setGraphEnabled=function(e){this.appSetGraphEnabled(e);this._stateChanged()};e.prototype._setMaterial=function(e){this.appSetMaterial(e);this._stateChanged()};e.prototype._setOrientation=function(e){this.appSetOrientation(e);this._stateChanged()};e.prototype._setSlicesIndex=function(e){this.appSetSlicesIndex(e);this._stateChanged()};e.prototype._setSlicesWindowCenter=function(e){this.appSetSlicesWindowCenter(e);this._stateChanged()};e.prototype._setSlicesWindowWidth=function(e){this.appSetSlicesWindowWidth(e);this._stateChanged()};e.prototype._setUnits=function(e){this.appSetUnits(e);this._stateChanged()};e.prototype._setVolumeSteps=function(e){this.appSetVolumeSteps(e);this._stateChanged()};e.prototype._setVolumeWindowCenter=function(e){this.appSetVolumeWindowCenter(e);this._stateChanged()};e.prototype._setVolumeWindowWidth=function(e){this.appSetVolumeWindowWidth(e);this._stateChanged()};e.prototype._setDisplayMode=function(e){this.appSetDisplayMode(e);this._stateChanged()};e.prototype._setSrc=function(e,t){this.appSetSrc([e,t]);this._stateChanged()};e.prototype._getStackHelper=function(){var e=null;if(this.displayMode===E.VOLUME){e=this._loadedObject}return e};e.prototype._getMesh=function(){var e=null;if(this._targetEntity&&this.displayMode===E.MESH){var t=this._targetEntity.object3DMap.mesh;if(t instanceof THREE.Mesh){e=t}else if(t){t.traverse(function(t){if(t instanceof THREE.Mesh&&e===null){e=t;return e}})}}else if(this._loadedObject._bBox){e=this._loadedObject._bBox._mesh}else{e=this._loadedObject._mesh}return e};e.prototype._srcLoaded=function(e){this._loadedObject=e.detail;var t=this._getMesh();if(t){t.geometry.computeBoundingSphere();t.geometry.computeBoundingBox();this._boundingSphereRadius=t.geometry.boundingSphere.radius;this._boundingBox=Oe.getBoundingBox(t);var n=Oe.getCameraStateFromMesh(t);this._updateLights(n);if(n){this.appSetCamera(n)}this.appSetSrcLoaded(true);this._stateChanged();this.loaded.emit(e.detail)}};e.prototype._keyDownHandler=function(e){this._isShiftDown=e.shiftKey;if(e.keyCode===De.Delete){if(this.selected){if(this.nodes.has(this.selected)){this._deleteNode(this.selected)}else if(this.edges.has(this.selected)){this._deleteEdge(this.selected)}else if(this.angles.has(this.selected)){this._deleteAngle(this.selected)}}}};e.prototype._keyUpHandler=function(e){this._isShiftDown=false};e.prototype._graphEntryPointerUpHandler=function(e){this.appSetControlsEnabled(true);we.enableControls(this._camera,true,this.controlsType)};e.prototype._graphEntryPointerDownHandler=function(e){this.appSetControlsEnabled(false);we.enableControls(this._camera,false,this.controlsType)};e.prototype._graphEntryPointerOutHandler=function(e){this._hovered=null};e.prototype._graphEntryPointerOverHandler=function(e){this._hovered=e.detail.id};e.prototype._controlsInteractionHandler=function(e){var t=e.detail.cameraState;this._updateLights(t)};e.prototype._updateLights=function(e){if(this.displayMode===E.MESH){this._lights.forEach(function(t){var n=e.position.clone().normalize();t.object3D.position.copy(n)})}};e.prototype._controlsInteractionFinishedHandler=function(e){var t=e.detail.cameraState;this._debouncedAppSetCamera(t)};e.prototype._spawnNodeHandler=function(e){if(this.graphEnabled&&this._validTarget&&this._hovered===null){var t=e.detail.aframeEvent.detail.intersection;var n=xe.getNextId(g.NODE,this.nodes);var i=void 0;if(this.displayMode===E.VOLUME&&t){var r=new THREE.Vector3;var s=new THREE.Vector3;var o=Ae.volumeRay(this._getStackHelper(),this._camera.object3D.children[0].position.clone(),this._camera.getAttribute("raycaster").direction,K.cameraValues.far,r,s);if(o){i={position:we.vector3ToString(r),scale:this._boundingSphereRadius/K.nodeSizeRatio,title:n}}}else if(t){i={targetId:"0",position:we.vector3ToString(t.point),scale:this._boundingSphereRadius/K.nodeSizeRatio,title:n}}if(i){var a=this.selected;this._setNode([n,i]);if(this._isShiftDown&&this.nodes.has(a)){this._createEdge(a,n);this._selectNode(n)}}}};e.prototype._graphEntryValidTargetHandler=function(e){this._validTarget=e.detail.valid};e.prototype._controlsAnimationFinishedHandler=function(e){this.appSetCamera({animating:false})};e.prototype._graphEntrySelectedHandler=function(e){if(!this.graphEnabled){return}var t=e.detail.type;var n=e.detail.id;switch(t){case g.NODE:{if(this._hovered!==null&&this.nodes.has(this._hovered)&&(this.selected!==null&&this.nodes.has(this.selected))&&this.selected!==this._hovered&&this._isShiftDown){this._createEdge(this.selected,this._hovered)}this._selectNode(n);break}case g.EDGE:{if(this._hovered!==null&&this.edges.has(this._hovered)&&(this.selected!==null&&this.edges.has(this.selected))&&this.selected!==this._hovered&&this._isShiftDown){this._createAngle(this.selected,this._hovered)}this._selectEdge(n);break}case g.ANGLE:{this._selectAngle(n);break}default:{break}}};e.prototype._graphEntryDraggedHandler=function(e){var t=e.detail.id;var n=this._camera.components.raycaster;var i=this._camera.getAttribute("raycaster");var r;var s=new THREE.Vector3;var o=false;var a=this._camera.object3D.children[0].position;if(this.displayMode===E.VOLUME){r=n.getIntersection(this._boundingEntity);if(r){var c=new THREE.Vector3;var l=Ae.volumeRay(this._getStackHelper(),a.clone(),i.direction,K.cameraValues.far,s,c);if(l){o=true}}}else{r=n.getIntersection(this._targetEntity);if(r){s.copy(r.point);o=true}}if(!o){var u=a.distanceTo(this._targetEntity.getAttribute("position"));s.copy(a);s.add(i.direction.clone().multiplyScalar(u*1.5))}this._setNode([t,{position:we.vector3ToString(s)}]);var d=t+K.movedEventName;this._scene.emit(d,{},true)};e.prototype._addEventListeners=function(){window.addEventListener("keydown",this._keyDownHandler,false);window.addEventListener("keyup",this._keyUpHandler,false);this._scene.addEventListener(Ve.ANIMATION_FINISHED,this._controlsAnimationFinishedHandler,false);this._scene.addEventListener(Ve.INTERACTION,this._controlsInteractionHandler,false);this._scene.addEventListener(Ve.INTERACTION_FINISHED,this._controlsInteractionFinishedHandler,false);this._scene.addEventListener(je.POINTER_UP,this._graphEntryPointerUpHandler,false);this._scene.addEventListener(je.POINTER_DOWN,this._graphEntryPointerDownHandler,false);this._scene.addEventListener(je.DRAGGED,this._graphEntryDraggedHandler,false);this._scene.addEventListener(je.SELECTED,this._graphEntrySelectedHandler,false);this._scene.addEventListener(Fe.ADD_NODE,this._spawnNodeHandler,false);this._scene.addEventListener(Fe.VALID_TARGET,this._graphEntryValidTargetHandler,false);this._scene.addEventListener(Ye.LOADED,this._srcLoaded,false);this._scene.addEventListener(Ze.LOADED,this._srcLoaded,false);this._scene.addEventListener(je.POINTER_OVER,this._graphEntryPointerOverHandler,false);this._scene.addEventListener(je.POINTER_OUT,this._graphEntryPointerOutHandler,false)};e.prototype.componentDidUpdate=function(){if(this._scene){this._addEventListeners()}};Object.defineProperty(e,"style",{get:function(){return"#al-container{position:relative;font-family:sans-serif}#al-container a-scene{display:block;width:100%;height:100%}#al-container.mesh a-scene{background-color:var(--al-mesh-viewport-background-color)}#al-container.slices a-scene{background-color:var(--al-slices-viewport-background-color)}#al-container.volume a-scene{background-color:var(--al-volume-viewport-background-color)}#al-container #lut-container{display:none}#al-container .progress.container{position:absolute;top:auto!important;bottom:0!important}#al-container .progress.container .load.progress,#al-container .progress.container .parse.progress{border:none!important;height:4px!important;background-color:var(--load-progress-color,#fff)!important}#al-container #spinner{position:absolute;left:50%;top:50%}#al-container #spinner .square{margin:0 0 0 -15px;width:30px;height:30px;-webkit-animation:sk-rotateplane 1.2s ease-in-out infinite;-moz-animation:sk-rotateplane 1.2s infinite ease-in-out;animation:sk-rotateplane 1.2s ease-in-out infinite}#al-container.mesh #spinner .square,#al-container.slices #spinner .square,#al-container.volume #spinner .square{background-color:var(--spinner-color,#fff)}\@-webkit-keyframes sk-rotateplane{0%{-webkit-transform:perspective(120px)}50%{-webkit-transform:perspective(120px) rotateY(180deg)}to{-webkit-transform:perspective(120px) rotateY(180deg) rotateX(180deg)}}\@keyframes sk-rotateplane{0%{transform:perspective(120px) rotateX(0deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)}to{transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)}}"},enumerable:true,configurable:true});return e}())}}});