var __extends=this&&this.__extends||function(){var e=function(t,n){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return e(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}}();var __awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i["throw"](e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,a)}c((i=i.apply(e,t||[])).next())})};var __generator=this&&this.__generator||function(e,t){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,r,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(e){return function(t){return c([e,t])}}function c(o){if(i)throw new TypeError("Generator is already executing.");while(n)try{if(i=1,r&&(s=o[0]&2?r["return"]:o[0]?r["throw"]||((s=r["return"])&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;if(r=0,s)o=[o[0]&2,s.value];switch(o[0]){case 0:case 1:s=o;break;case 4:n.label++;return{value:o[1],done:false};case 5:n.label++;r=o[1];o=[0];continue;case 7:o=n.ops.pop();n.trys.pop();continue;default:if(!(s=n.trys,s=s.length>0&&s[s.length-1])&&(o[0]===6||o[0]===2)){n=0;continue}if(o[0]===3&&(!s||o[1]>s[0]&&o[1]<s[3])){n.label=o[1];break}if(o[0]===6&&n.label<s[1]){n.label=s[1];s=o;break}if(s&&n.label<s[2]){n.label=s[2];n.ops.push(o);break}if(s[2])n.ops.pop();n.trys.pop();continue}o=t.call(e,n)}catch(e){o=[6,e];r=0}finally{i=s=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}};System.register(["./p-be83d47c.system.js"],function(e){"use strict";var t,n,i,r,s;return{setters:[function(e){t=e.r;n=e.c;i=e.h;r=e.d;s=e.e}],execute:function(){var o=this;var a="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik05NiAyMzVoMzIwdjQySDk2eiI+PC9wYXRoPjwvc3ZnPgo=";var c=e("al_angle_editor",function(){function e(e){t(this,e);this.delete=n(this,"delete",7)}e.prototype.render=function(){var e=this;if(this.angle){var t=this.angle[0];return i("form",{onSubmit:function(e){return e.preventDefault()}},i("ion-button",{size:"small",onClick:function(){e.delete.emit(t);e.angle=null}},i("ion-icon",{src:a})))}return null};Object.defineProperty(e,"style",{get:function(){return""},enumerable:true,configurable:true});return e}());var u="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0xOTIgMTI4bDEyOCAxMjgtMTI4IDEyOHoiPjwvcGF0aD48L3N2Zz4K";var l=e("al_console",function(){function e(e){t(this,e);this.runCommand=n(this,"runCommand",7)}e.prototype.render=function(){var e=this;return i("form",{onSubmit:function(e){return e.preventDefault()}},i("ion-item",null,i("ion-textarea",{value:this.cmd,rows:"10",required:true,onIonChange:function(t){return e.cmd=t.detail.value},ref:function(t){return e._cmd=t}})),i("ion-button",{size:"small",type:"submit",onClick:function(){if(e.cmd){e.runCommand.emit(e._cmd.value)}}},i("ion-icon",{src:u})))};Object.defineProperty(e,"style",{get:function(){return""},enumerable:true,configurable:true});return e}());var d="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNTYgNDhDMTQxLjEyNSA0OCA0OCAxNDEuMTI1IDQ4IDI1NnM5My4xMjUgMjA4IDIwOCAyMDggMjA4LTkzLjEyNSAyMDgtMjA4UzM3MC44NzUgNDggMjU2IDQ4em0xMDcgMjI5aC04NnY4NmgtNDJ2LTg2aC04NnYtNDJoODZ2LTg2aDQydjg2aDg2djQyeiI+PC9wYXRoPjwvc3ZnPgo=";var h="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik00NjcuMyAxNjguMWMtMS44IDAtMy41LjMtNS4xIDFsLTE3Ny42IDkyLjFoLS4xYy03LjYgNC43LTEyLjUgMTIuNS0xMi41IDIxLjR2MTg1LjljMCA2LjQgNS42IDExLjUgMTIuNyAxMS41IDIuMiAwIDQuMy0uNSA2LjEtMS40LjItLjEuNC0uMi41LS4zTDQ2NiAzODUuNmwuMy0uMWM4LjItNC41IDEzLjctMTIuNyAxMy43LTIyLjFWMTc5LjZjMC02LjQtNS43LTExLjUtMTIuNy0xMS41ek00NTQuMyAxMTguNUwyNzIuNiAzNi44UzI2MS45IDMyIDI1NiAzMmMtNS45IDAtMTYuNSA0LjgtMTYuNSA0LjhMNTcuNiAxMTguNXMtOCAzLjMtOCA5LjVjMCA2LjYgOC4zIDExLjUgOC4zIDExLjVsMTg1LjUgOTcuOGMzLjggMS43IDguMSAyLjYgMTIuNiAyLjYgNC42IDAgOC45LTEgMTIuNy0yLjdsMTg1LjQtOTcuOXM3LjUtNCA3LjUtMTEuNWMuMS02LjMtNy4zLTkuMy03LjMtOS4zek0yMjcuNSAyNjEuMkw0OS44IDE2OWMtMS41LS42LTMuMy0xLTUuMS0xLTcgMC0xMi43IDUuMS0xMi43IDExLjV2MTgzLjhjMCA5LjQgNS41IDE3LjYgMTMuNyAyMi4xbC4yLjEgMTc0LjcgOTIuN2MxLjkgMS4xIDQuMiAxLjcgNi42IDEuNyA3IDAgMTIuNy01LjIgMTIuNy0xMS41VjI4Mi42Yy4xLTguOS00LjktMTYuOC0xMi40LTIxLjR6Ij48L3BhdGg+PC9zdmc+Cg==";var p="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNzcuMyAzMmgtNDIuN3Y2NGg0Mi43VjMyem0xMjkuMSA0My43TDM2OCAxMTQuMWwyOS45IDI5LjkgMzguNC0zOC40LTI5LjktMjkuOXptLTMwMC44IDBsLTI5LjkgMjkuOSAzOC40IDM4LjQgMjkuOS0yOS45LTM4LjQtMzguNHpNMjU2IDEyOGMtNzAuNCAwLTEyOCA1Ny42LTEyOCAxMjhzNTcuNiAxMjggMTI4IDEyOCAxMjgtNTcuNiAxMjgtMTI4LTU3LjYtMTI4LTEyOC0xMjh6bTIyNCAxMDYuN2gtNjR2NDIuN2g2NHYtNDIuN3ptLTM4NCAwSDMydjQyLjdoNjR2LTQyLjd6TTM5Ny45IDM2OEwzNjggMzk3LjlsMzguNCAzOC40IDI5LjktMjkuOS0zOC40LTM4LjR6bS0yODMuOCAwbC0zOC40IDM4LjQgMjkuOSAyOS45IDM4LjQtMzguNC0yOS45LTI5Ljl6bTE2My4yIDQ4aC00Mi43djY0aDQyLjd2LTY0eiI+PC9wYXRoPjwvc3ZnPgo=";var f="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNTYgNDhDMTQxLjEgNDggNDggMTQxLjEgNDggMjU2czkzLjEgMjA4IDIwOCAyMDggMjA4LTkzLjEgMjA4LTIwOFMzNzAuOSA0OCAyNTYgNDh6bTExMy4xIDMyMS4xQzMzOC45IDM5OS40IDI5OC43IDQxNiAyNTYgNDE2Vjk2YzQyLjcgMCA4Mi45IDE2LjYgMTEzLjEgNDYuOUMzOTkuNCAxNzMuMSA0MTYgMjEzLjMgNDE2IDI1NnMtMTYuNiA4Mi45LTQ2LjkgMTEzLjF6Ij48L3BhdGg+PC9zdmc+Cg==";var E="data:image/svg+xml;base64,PHN2ZwogIHZpZXdCb3g9IjAgMCA1MTIgNTEyIgogIGNsYXNzPSJzLWlvbi1pY29uIj4KICA8cGF0aAogICAgIGQ9Im0gMjQyLjc4MDU0LDYyLjk0Mjg3MSBjIC05LjE3NDczLDEuOTg4MDA3IC0xOC45MTYzLDcuNDc0MjI1IC0yNi4xMDcwNywxNC42NjA5NTggLTI4LjI4MTMyLDI4LjI4MTMyMSAtMTYuOTMyMzYsNzUuNDgyOTcxIDIxLjI4MDgyLDg4LjkxMzAzMSBsIDQuOTE5MzcsMS43MDQ2MSAwLjI4MzQyLDkuMzY1IDAuMjgzNDIsOS4zNjUwMSAtNC4wNjkxLDEuOTg4IGMgLTEyLjE5NTE4LDYuMDQ0OTYgLTE0NS42NjE5MzksODMuOTg5NjUgLTE0OS40NDM1NzgsODcuMjk3NTQgLTMuMDI0NDk5LDIuNTU0ODUgLTUuNjc2NTA2LDYuMjQzMzcgLTguMDQxMDQsMTEuMTYyNzUgbCAtMy41OTUzOTEsNy4xODY3NCAtMC4yODM0MjQsMjUuNzI2NDcgYyAtMC4yODM0MTksMjQuMTE5MDUgLTAuMTkwMjkzLDI2LjAxMzkzIDEuNzAwNTI1LDMxLjU5MzI4IDIuMjcxNDEyLDYuNjE5ODkgNS43Njk2MzIsMTIuMjAzMjQgMTAuNTk1ODc2LDE2LjY0ODkyIDMuMDI4NTUyLDIuOTMxMzcgMTQyLjI2MDg4Miw4My43MTAyNSAxNTAuOTYxODkyLDg3LjY4MjIxIDYuMjQzMzYsMi44MzgyNCAyMC41Mjc3NSwyLjkzMTM3IDI2Ljc2NzA2LDAuMDk3MiAyLjM2NDU0LC0xLjEzMzcyIDM2LjYwNTc0LC0yMC42MjA4OCA3Ni4xNDI5LC00My40MTU5OSA0Ni4xNjExLC0yNi41ODA4MSA3My4yMTE1NywtNDIuNzUxOTcgNzUuODU5NTQsLTQ1LjMwNjc3IDIuMjcxNCwtMi4xNzQyNyA1LjU3OTMsLTcuMDAwNTIgNy41NjczMSwtMTAuODc5MyBsIDMuNDk4MjEsLTcuMDkzNjEgdiAtMjcuNTI0MTcgLTI3LjUyNDE4IGwgLTMuNTk1MzksLTcuMTg2NzMgYyAtMi4zNjQ1MywtNC45MTkzOCAtNS4wMTI0NiwtOC41MTQ3NyAtOC4wNDEwMiwtMTEuMTYyNzUgLTMuNzgxNjUsLTMuMzExOTQgLTEzNy4yNDgzOSwtODEuMjUyNTggLTE0OS40NDc2MywtODcuMzA1NjMgbCAtNC4wNjkxLC0xLjk4ODAxIDAuMjgzNDQsLTkuNDU4MTQgMC4yODM0LC05LjM2NSAzLjg3ODgzLC0xLjEzMzY4IGMgMTMuMjQzNzksLTMuODc4ODMgMjYuMDA5ODcsLTE0Ljg1MTI3IDMyLjQ0MzUxLC0yNy45MDQ4IDE5Ljg3MTgzLC00MC40ODQ1OSAtMTUuODgzNjcsLTg1Ljc5MTQwNyAtNjAuMDU2NzgsLTc2LjE0Mjk1OSB6IG0gMy44Nzg4LDEwLjk3MjQzNiBjIDcuNjYwNDQsMi4xNzQyMjMgMTQuNjYwOTYsMTEuNzI5NTM5IDE0LjY2MDk2LDIwLjI0MDI2MSAwLDExLjI1NTgzMiAtMTAuMDI1MDIsMjEuMjgwODUyIC0yMS4yODA4NSwyMS4yODA4NTIgLTUuNjc2NSwwIC0xMC40MDU1NywtMi4wODExMyAtMTQuNzU0MDUsLTYuNTI2NzYgLTguNjA3ODksLTguNTE0NzcgLTguNzk4MTgsLTIwLjQzMDU3NSAtMC41NjY4NSwtMjkuMTM1NjU3IDUuOTU1ODksLTYuMjM5MjcyIDEzLjMzMjkyLC04LjIyNzI3OSAyMS45NDA3OSwtNS44NTg2OTYgeiBtIC0zLjEyMTY3LDE4MS40MTc0NDMgYyAwLjI4MzQyLDE0LjM3NzUxIDAuMzc2NTUsMTUuMjI3NzkgMi41NTQ4NCwxNy40OTkyIDQuOTE5MzcsNS4yMDI3NyAxMi4yOTY0Miw1LjIwMjc3IDE3LjIxNTc1LDAgMi4xNzQyNywtMi4yNzE0MSAyLjI3MTQ1LC0zLjEyMTY5IDIuNTU0ODQsLTE3LjQ5OTIgMC4zODA1OCwtMTcuMzA4ODkgLTAuNTY2ODMsLTE2LjE3NTIyIDEwLjU5NTg3LC0xMy4wNTM1MyAxNC45NDQzNSw0LjA2NTA1IDI3Ljk5NzkzLDEzLjYyMDM2IDMzLjY3NDQxLDI0LjQ5OTY3IDIuNDYxNzEsNC42MzU5NCAyLjc0NTE1LDYuMTUwMjQgMi43NDUxNSwxNC4xODcyIDAsOC4wNDEwNyAtMC4yODM0NCw5LjU1MTI3IC0yLjc0NTE1LDE0LjE4NzI1IC00LjA2OTEsNy42NjA0NCAtMTIuMjk2MzgsMTUuMjI3NzUgLTIxLjU2NDI1LDE5Ljc3MDYxIC0xMi4wMTI5OCw1Ljk1OTkyIC0xNy44NzU3Myw3LjE5MDc4IC0zMy44NjA2Myw3LjE5MDc4IC0xNS45ODQ5MywwIC0yMS44NTE3MywtMS4yMzA4NiAtMzMuODYwNjYsLTcuMTkwNzggLTkuMjcxODksLTQuNTM4ODEgLTE3LjQ5OTE5LC0xMi4xMDYxMiAtMjEuNTY4MywtMTkuNzcwNjEgLTIuNDU3NjYsLTQuNjM1OTggLTIuNzQxMDgsLTYuMTQ2MTggLTIuNzQxMDgsLTE0LjE4NzI1IDAsLTguMDQxMDEgMC4yODM0MiwtOS41NTUzMSAyLjc0MTA4LC0xNC4xODcyIDUuNTc5MzQsLTEwLjY4ODk5IDE3Ljk3MjkxLC0xOS44NjM3NCAzMi43MjY5NywtMjQuMzA5MzYgMTIuMDk4MDEsLTMuNTk1MzkgMTEuMTU0NjIsLTQuNjM1OTggMTEuNTMxMTYsMTIuODYzMjIgeiBtIC05MC4zMzAxNSwxNS40MTgwNiBjIDguNDE3NTksMy44Nzg4MyAxMC41OTE4MywxMS44MjI3MSA1LjAxMjQ5LDE4LjE1OTE3IC0zLjk3MTkzLDQuNTQyOCAtOS43NDE1Niw2LjUyNjc2IC0xNy4yMTU3Niw2LjA1MzA1IC0xMy45OTY5MywtMC44NTAyOCAtMjIuMjI4MjcsLTExLjQ0NjE0IC0xNS4zMjQ5NSwtMTkuNjczNDIgNi4xNTAyMiwtNy4yNzk4NiAxNy42ODk0OCwtOS4xNzQ3NCAyNy41MjgyMiwtNC41Mzg4IHoiLz4KPC9zdmc+Cg==";var v="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNTYgMTA1Yy0xMDEuOCAwLTE4OC40IDYyLjQtMjI0IDE1MSAzNS42IDg4LjYgMTIyLjIgMTUxIDIyNCAxNTFzMTg4LjQtNjIuNCAyMjQtMTUxYy0zNS42LTg4LjYtMTIyLjItMTUxLTIyNC0xNTF6bTAgMjUxLjdjLTU2IDAtMTAxLjgtNDUuMy0xMDEuOC0xMDAuN1MyMDAgMTU1LjMgMjU2IDE1NS4zIDM1Ny44IDIwMC42IDM1Ny44IDI1NiAzMTIgMzU2LjcgMjU2IDM1Ni43em0wLTE2MS4xYy0zMy42IDAtNjEuMSAyNy4yLTYxLjEgNjAuNHMyNy41IDYwLjQgNjEuMSA2MC40IDYxLjEtMjcuMiA2MS4xLTYwLjQtMjcuNS02MC40LTYxLjEtNjAuNHoiPjwvcGF0aD48L3N2Zz4K";var g="data:image/svg+xml;base64,PHN2ZwogICB2aWV3Qm94PSIwIDAgNTEyIDUxMiIKICAgY2xhc3M9InMtaW9uLWljb24iPgogIDxwYXRoCiAgICAgZD0iTSAyNTYuOTgwNDcgNDguODk2NDg0IEEgMjA2LjEzODU3IDIwNi4xMzg1NyAwIDAgMCA1MC44NDE3OTcgMjU1LjAzNTE2IEEgMjA2LjEzODU3IDIwNi4xMzg1NyAwIDAgMCAyNTYuOTgwNDcgNDYxLjE3MzgzIEEgMjA2LjEzODU3IDIwNi4xMzg1NyAwIDAgMCA0NjMuMTE5MTQgMjU1LjAzNTE2IEEgMjA2LjEzODU3IDIwNi4xMzg1NyAwIDAgMCAyNTYuOTgwNDcgNDguODk2NDg0IHogTSAyNTcuNjczODMgODcuNjc1NzgxIEEgMTY3Ljk4OTU1IDE2Ny45ODk1NSAwIDAgMSA0MjUuMzAwNzggMjQ1LjQ0NTMxIEMgNDEyLjg3ODY2IDI1Ni41Nzk3NCAzODguOTQyNjMgMjc0LjE5MDk2IDM1MS4zNjUyMyAyODYuNDUzMTIgQyAzMDAuMzIxODIgMzAzLjEwOTQ5IDI1Ny42NjYwMiAzMDEuODQ1NyAyNTcuNjY2MDIgMzAxLjg0NTcgTCAyNTguMjY3NTggNDIzLjYzMjgxIEEgMTY3Ljk4OTU1IDE2Ny45ODk1NSAwIDAgMSAyNTcuNjczODMgNDIzLjY1NDMgQSAxNjcuOTg5NTUgMTY3Ljk4OTU1IDAgMCAxIDg5LjY4MzU5NCAyNTUuNjY2MDIgQSAxNjcuOTg5NTUgMTY3Ljk4OTU1IDAgMCAxIDkwLjIxNjc5NyAyNDUgQyAxMDIuNDg2NzcgMjU2LjEwMzYxIDEyNi41NDYxNSAyNzQuMDIxNTkgMTY0LjY0MjU4IDI4Ni40NTMxMiBDIDIxNS42ODYgMzAzLjEwOTQ4IDI1Ny42NjYwMiAzMDEuODQ1NyAyNTcuNjY2MDIgMzAxLjg0NTcgTCAyNTcuNjczODMgODcuNjc1NzgxIHogIgogICAgIGlkPSJwYXRoODM2IiAvPgo8L3N2Zz4K";var m="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNTYgMjMxLjM1OGMtMTMuNDQyIDAtMjQuNjQzIDExLjItMjQuNjQzIDI0LjY0MnMxMS4yIDI0LjY0MyAyNC42NDMgMjQuNjQzIDI0LjY0My0xMS4yIDI0LjY0My0yNC42NDMtMTEuMjAxLTI0LjY0Mi0yNC42NDMtMjQuNjQyek0yNTYgMzJDMTMyLjggMzIgMzIgMTMyLjggMzIgMjU2czEwMC44IDIyNCAyMjQgMjI0IDIyNC0xMDAuOCAyMjQtMjI0UzM3OS4yIDMyIDI1NiAzMnptNDkuMjg0IDI3My4yODRMMTIxLjYgMzkwLjRsODUuMTE2LTE4My42NzlMMzkwLjQgMTIxLjZsLTg1LjExNiAxODMuNjg0eiI+PC9wYXRoPjwvc3ZnPgo=";var M="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNTYgNDhjLTQyLjkgMC04NC4yIDEzLTExOS4yIDM3LjUtMzQuMiAyNC02MC4yIDU3LjItNzUuMSA5Ni4xTDU4IDE5Mmg0NS43bDEuOS01YzguMi0xNy44IDE5LjQtMzMuOSAzMy41LTQ4IDMxLjItMzEuMiA3Mi43LTQ4LjQgMTE2LjktNDguNHM4NS43IDE3LjIgMTE2LjkgNDguNGMzMS4yIDMxLjIgNDguNCA3Mi43IDQ4LjQgMTE2LjkgMCA0NC4xLTE3LjIgODUuNy00OC40IDExNi45LTMxLjIgMzEuMi03Mi43IDQ4LjQtMTE2LjkgNDguNC00NC4xIDAtODUuNi0xNy4yLTExNi45LTQ4LjQtMTQtMTQtMjUuMy0zMC4xLTMzLjUtNDcuOWwtMS45LTVINThsMy42IDEwLjRjMTQuOSAzOC45IDQwLjkgNzIuMSA3NS4xIDk2LjFDMTcxLjggNDUxLjEgMjEzIDQ2NCAyNTYgNDY0YzExNC43IDAgMjA4LTkzLjMgMjA4LTIwOFMzNzAuNyA0OCAyNTYgNDh6Ij48L3BhdGg+PHBhdGggZD0iTTQ4IDI3Ny40aDE4OS43bC00My42IDQ0LjdMMjI0IDM1Mmw5Ni05Ni05Ni05Ni0zMSAyOS45IDQ0LjcgNDQuN0g0OHY0Mi44eiI+PC9wYXRoPjwvc3ZnPgo=";var y="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0xMzEuMyAyMzEuMUwzMiAzMzAuNmw5OS4zIDk5LjR2LTc0LjZoMTc0LjV2LTQ5LjdIMTMxLjN2LTc0LjZ6TTQ4MCAxODEuNEwzODAuNyA4MnY3NC42SDIwNi4ydjQ5LjdoMTc0LjV2NzQuNmw5OS4zLTk5LjV6Ij48L3BhdGg+PC9zdmc+Cg==";var _="data:image/svg+xml;base64,PHN2ZwogICB2aWV3Qm94PSIwIDAgNTEyIDUxMiIKICAgY2xhc3M9InMtaW9uLWljb24iPgogIDxwYXRoCiAgICAgZD0iTSAzNzQuNDQxNzQsMTYyLjM0MTQ4IEMgMzIwLjYzNTAzLDExOC4xOTQ1IDI0Ni44MzkzMywxMDcuNTMwNTQgMTgzLjc4NTg3LDEzNC43NzA4IGMgLTI0LjMxODksMTAuNDk0NDIgLTQzLjcyOTY4LDI0LjQwMTUxIC02Mi42MzYxNSw0NC44MTIxNiAtMjkuNTcwNDQsMzEuOTAwNTkgLTQ1LjgwNzY1OSw2OS42MzA5MyAtNDguNzI0Njk5LDExMy4wMzAyMSBsIC0wLjgzNDcwMSwxMi40OTQxOCAtMTAuNzQyMjMzLDAuMDgyNSAtMTAuODI0ODA0LDFlLTUgNWUtNiw0Mi40ODE5OCAxLjVlLTUsNDIuNDgxOTcgMjA2LjU2MjcxNywtMC4wMTMxIDIwNi41NjcwNywxMGUtNiAtNmUtNSwtNDIuNDgxOTggNWUtNSwtNDIuNDgxOTkgLTEwLjQ5ODc4LDAuMDA0IGMgLTUuNjYwMjEsMS4zZS00IC0xMC42NjM5NCwtMC4zMzQ3NCAtMTEuMDc2OTQsLTAuNzQ3NzMgLTAuMzMwMzUsLTAuMzMwNDMgLTAuODMwMzUsLTUuNjY0NTcgLTEuMDgyNDgsLTExLjc0MjEyIC0xLjgzNDU3LC00Ny44MTE3OSAtMjcuNzM1ODksLTk4Ljg2NjY0IC02Ni4wNTMxMywtMTMwLjM0OTkyIHogbSAtMjUuNTcwOTEsODUuODY4MTkgYyA5LjI0Njc0LDE1LjU3NjQzIDE0LjU3MjIsMzIuOTAwNDkgMTUuNjU5MDUsNTAuMzA3MTQgbCAwLjQxNzM1LDYuNzQ3MDUgLTEwOC4zNjEyMywtMC4wNzgzIC0xMDguMzY1NTUsLTAuMDgyNiAwLjQxNzM2LC04LjU4MTYzIGMgMC45OTk4OCwtMTYuODI0MTEgNy42NTk5OSwtMzYuNjQ3ODUgMTcuNDkzNjEsLTUxLjQ3MjIgNi40MTY2MywtOS45MTE4OCAyMS4yNDA5NywtMjQuNzM2MjMgMzEuMjM1NDcsLTMxLjIzNTQ4IDI2LjczNTk5LC0xNy41NzE4NSA2Mi42MzYxLC0yMi4zMTkxMSA5My42MTk0NCwtMTIuMTU5NDQgNy44Mjk1MiwyLjY2NDg1IDIzLjA3MTIsMTAuNTc3MDIgMzAuNTcwMzMsMTYuMDc2MzggOC4zMjUxMiw2LjE2MDE1IDIxLjgxNDgzLDIxLjE1NDAxIDI3LjMxNDE3LDMwLjQ3OTAzIHoiCiAvPgo8L3N2Zz4K";var T=function(){function e(){}return e}();T.controllerName="-controller";T.edgeSize=.005;T.fontSizeLarge=2;T.fontSizeMedium=1.5;T.fontSizeSmall=1;T.maxAnimationSteps=50;T.minLoadingMS=500;T.movedEventName="-moved";T.nodeSizeRatio=75;T.stackSpaceMultiplier={x:10,y:10,z:10};T.stepsIncrement=8;T.stepsMax=512;T.stepsMin=1;T.titleIdName="-title";T.topLayerRenderOrder=999;T.unitsDecimalPlaces=2;T.zoomFactor=2.5;T.minFrameMS=15;T.minTimeForThrottle=T.minFrameMS*5;T.buttonColors={active:"#f50057",hover:"#f50057",up:"#00b0ff"};T.colorValues={red:"#f50057",blue:"#00b0ff",black:"#000000",grey:"#222222",white:"#ffffff",yellow:"#ffeb3b",green:"#76ff03",lightRed:"#f77777"};T.lightValues={ambientLightColor:13684944,ambientLightIntensity:1,directionalLight1Color:16777215,directionalLight1Intensity:.75,directionalLight2Color:10584,directionalLight2Intensity:.5};T.cameraValues={near:.05,far:1e4,fov:45,maxPolarAngle:175,rotateSpeed:.5,zoomSpeed:1,dampingFactor:.25,minDistance:0};var N;(function(e){e["NODE"]="node";e["EDGE"]="edge";e["ANGLE"]="angle"})(N||(N={}));var L;(function(e){e["ORBIT"]="orbit";e["TRACKBALL"]="trackball"})(L||(L={}));var D;(function(e){e["SLICES"]="slices";e["VOLUME"]="volume";e["MESH"]="mesh"})(D||(D={}));var S;(function(e){e["DEFAULT"]="default";e["CLAY"]="clay";e["XRAY"]="xray";e["NORMALS"]="normals";e["WIREFRAME"]="wireframe"})(S||(S={}));var b;(function(e){e["GLTF"]="gltf";e["GLB"]="glb"})(b||(b={}));var I;(function(e){e["CORONAL"]="coronal";e["SAGGITAL"]="saggital";e["AXIAL"]="axial"})(I||(I={}));var w;(function(e){e["LOCK"]="LOCK";e["MESH"]="MESH"})(w||(w={}));var A;(function(e){e["METERS"]="m";e["MILLIMETERS"]="mm"})(A||(A={}));var C="Axial";var O="Clay";var j="Coronal";var x="Meters";var P="Millimeters";var z="Normals";var R="Orbit";var k="Recenter";var W="Saggital";var U="Slices";var H="Trackball";var Y="Volume";var F="Wireframe";var Q="XRay";var V={axial:C,clay:O,coronal:j,default:"Default",meters:x,millimeters:P,normals:z,orbit:R,recenter:k,saggital:W,slices:U,trackball:H,volume:Y,wireframe:F,xray:Q};var B=e("al_control_panel",function(){function e(e){t(this,e);this._contentStrings=V;this.boundingBoxEnabled=false;this.controlsType=L.ORBIT;this.displayMode=D.MESH;this.material=S.DEFAULT;this.orientation=I.CORONAL;this.graphEnabled=false;this.units=A.METERS;this.boundingBoxEnabledChanged=n(this,"boundingBoxEnabledChanged",7);this.controlsTypeChanged=n(this,"controlsTypeChanged",7);this.displayModeChanged=n(this,"displayModeChanged",7);this.materialChanged=n(this,"materialChanged",7);this.orientationChanged=n(this,"orientationChanged",7);this.recenter=n(this,"recenter",7);this.slicesIndexChanged=n(this,"slicesIndexChanged",7);this.slicesWindowCenterChanged=n(this,"slicesWindowCenterChanged",7);this.slicesWindowWidthChanged=n(this,"slicesWindowWidthChanged",7);this.unitsChanged=n(this,"unitsChanged",7);this.graphEnabledChanged=n(this,"graphEnabledChanged",7);this.volumeStepsChanged=n(this,"volumeStepsChanged",7);this.volumeWindowCenterChanged=n(this,"volumeWindowCenterChanged",7);this.volumeWindowWidthChanged=n(this,"volumeWindowWidthChanged",7)}e.prototype.watchStackhelper=function(){this.slicesIndex=undefined;this.slicesWindowCenter=undefined;this.slicesWindowWidth=undefined;this.volumeSteps=undefined;this.volumeWindowCenter=undefined;this.volumeWindowWidth=undefined};e.prototype._boundingBoxEnabled=function(e){this.boundingBoxEnabled=e;this.boundingBoxEnabledChanged.emit(e)};e.prototype._controlsType=function(e){this.controlsType=e;this.controlsTypeChanged.emit(e)};e.prototype._displayMode=function(e){this.displayMode=e;this.displayModeChanged.emit(e)};e.prototype._graphEnabled=function(e){this.graphEnabled=e;this.graphEnabledChanged.emit(e)};e.prototype._material=function(e){this.material=e;this.materialChanged.emit(e)};e.prototype._orientation=function(e){this.orientation=e;this.orientationChanged.emit(e)};e.prototype._slicesIndex=function(e){this.slicesIndex=e;this.slicesIndexChanged.emit(e)};e.prototype._slicesWindowCenter=function(e){this.slicesWindowCenter=e;this.slicesWindowCenterChanged.emit(e)};e.prototype._slicesWindowWidth=function(e){this.slicesWindowWidth=e;this.slicesWindowWidthChanged.emit(e)};e.prototype._units=function(e){this.units=e;this.unitsChanged.emit(e)};e.prototype._volumeSteps=function(e){this.volumeSteps=e;this.volumeStepsChanged.emit(e)};e.prototype._volumeWindowCenter=function(e){this.volumeWindowCenter=e;this.volumeWindowCenterChanged.emit(e)};e.prototype._volumeWindowWidth=function(e){this.volumeWindowWidth=e;this.volumeWindowWidthChanged.emit(e)};e.prototype.renderDisplayModeToggle=function(){var e=this;if(this.displayMode!==D.MESH){return i("ion-item",{style:{display:"var(--display-mode-display, block)"}},i("ion-icon",{src:v,slot:"start"}),i("select",{slot:"end",onChange:function(t){return e._displayMode(t.srcElement.value)}},i("option",{selected:this.displayMode===D.SLICES,value:D.SLICES},this._contentStrings.slices),i("option",{selected:this.displayMode===D.VOLUME,value:D.VOLUME},this._contentStrings.volume)))}return null};e.prototype.renderNodesToggle=function(){var e=this;return i("ion-item",{style:{display:"var(--graph-enabled-display, block)"}},i("ion-icon",{src:d,slot:"start"}),i("ion-toggle",{slot:"end",checked:this.graphEnabled,onIonChange:function(t){return e._graphEnabled(t.detail.checked)}}))};e.prototype.renderBoundingBoxEnabled=function(){var e=this;return i("ion-item",{style:{display:"var(--bounding-box-enabled-display, block)"}},i("ion-icon",{src:h,slot:"start"}),i("ion-toggle",{slot:"end",checked:this.boundingBoxEnabled,onIonChange:function(t){return e._boundingBoxEnabled(t.detail.checked)}}))};e.prototype.renderControlsTypeSelect=function(){var e=this;return i("ion-item",{style:{display:"var(--controls-type-display, block)"}},i("ion-icon",{src:E,slot:"start"}),i("select",{slot:"end",onChange:function(t){return e._controlsType(t.srcElement.value)}},i("option",{selected:this.controlsType===L.ORBIT,value:L.ORBIT},this._contentStrings.orbit),i("option",{selected:this.controlsType===L.TRACKBALL,value:L.TRACKBALL},this._contentStrings.trackball)))};e.prototype.renderRecenterButton=function(){var e=this;return i("ion-item",{style:{display:"var(--recenter-display, block)"}},i("ion-icon",{src:M,slot:"start"}),i("ion-button",{slot:"end",size:"small",onClick:function(){e.recenter.emit()}},this._contentStrings.recenter))};e.prototype.renderUnitsSelect=function(){var e=this;return i("ion-item",{style:{display:"var(--units-display, block)"}},i("ion-icon",{src:_,slot:"start"}),i("select",{slot:"end",onChange:function(t){return e._units(t.srcElement.value)}},i("option",{selected:this.units===A.METERS,value:A.METERS},this._contentStrings.meters),i("option",{selected:this.units===A.MILLIMETERS,value:A.MILLIMETERS},this._contentStrings.millimeters)))};e.prototype.renderMaterialSelect=function(){var e=this;return i("ion-item",{style:{display:"var(--material-display, block)"}},i("ion-icon",{src:g,slot:"start"}),i("select",{slot:"end",onChange:function(t){return e._material(t.srcElement.value)}},i("option",{selected:this.material===S.DEFAULT,value:S.DEFAULT},this._contentStrings.default),i("option",{selected:this.material===S.CLAY,value:S.CLAY},this._contentStrings.clay),i("option",{selected:this.material===S.NORMALS,value:S.NORMALS},this._contentStrings.normals),i("option",{selected:this.material===S.WIREFRAME,value:S.WIREFRAME},this._contentStrings.wireframe),i("option",{selected:this.material===S.XRAY,value:S.XRAY},this._contentStrings.xray)))};e.prototype.renderGenericOptions=function(){return[this.renderBoundingBoxEnabled(),this.renderControlsTypeSelect(),this.renderRecenterButton(),this.renderUnitsSelect()]};e.prototype._reverseNumber=function(e,t,n){return n+t-e};e.prototype.renderOptions=function(){var e=this;switch(this.displayMode){case D.SLICES:{if(!this.stackhelper||this.stackhelper&&!this.stackhelper.slice){break}var t=Object.keys(I).indexOf(this.orientation.toUpperCase());var n=this.stackhelper.stack.zCosine;var r=void 0;if(Math.round(n.x)===1){r=1}else if(Math.round(n.y)===1){r=2}else{r=0}var s=Math.round((t+r)%3);var o=Math.round((t+r+2)%3);var a=this.stackhelper.stack.dimensionsIJK[Object.keys(this.stackhelper.stack.dimensionsIJK)[o]]-1;var c=void 0;if(o!==this._lastStackOrientationIndex||this.slicesIndex===undefined){c=Math.floor(a/2)}else{c=this.slicesIndex}this._lastStackOrientationIndex=o;var u=1;var l=this.stackhelper.stack.minMax[1]-this.stackhelper.stack.minMax[0];var d=void 0;if(this.slicesWindowWidth===undefined){d=l/2}else{d=this.slicesWindowWidth}var h=this.stackhelper.stack.minMax[0];var E=this.stackhelper.stack.minMax[1];var v=void 0;if(this.slicesWindowCenter===undefined){v=E/2}else{v=this.slicesWindowCenter}this.stackhelper.orientation=s;this.stackhelper.index=c;this.stackhelper.slice.windowWidth=d;this.stackhelper.slice.windowCenter=v;return i("div",null,this.renderGenericOptions(),i("ion-item",{style:{display:"var(--slices-index-display, block)"}},i("ion-icon",{src:y,slot:"start"}),i("ion-range",{slot:"end",min:"0",max:a,value:c,pin:true,onIonChange:function(t){return e._slicesIndex(t.detail.value)}})),i("ion-item",{style:{display:"var(--slices-orientation-display, block)"}},i("ion-icon",{src:m,slot:"start"}),i("select",{slot:"end",onChange:function(t){return e._orientation(t.srcElement.value)}},i("option",{selected:this.orientation===I.CORONAL,value:I.CORONAL},this._contentStrings.coronal),i("option",{selected:this.orientation===I.SAGGITAL,value:I.SAGGITAL},this._contentStrings.saggital),i("option",{selected:this.orientation===I.AXIAL,value:I.AXIAL},this._contentStrings.axial))),i("ion-item",{style:{display:"var(--slices-window-center-display, block)"}},i("ion-icon",{src:p,slot:"start"}),i("ion-range",{slot:"end",min:h,max:E,value:this._reverseNumber(v,h,E),onIonChange:function(t){return e._slicesWindowCenter(e._reverseNumber(t.detail.value,h,E))}})),i("ion-item",{style:{display:"var(--slices-window-width-display, block)"}},i("ion-icon",{src:f,slot:"start"}),i("ion-range",{slot:"end",min:u,max:l,value:this._reverseNumber(d,u,l),onIonChange:function(t){return e._slicesWindowWidth(e._reverseNumber(t.detail.value,u,l))}})))}case D.VOLUME:{if(!this.stackhelper){break}var g=void 0;if(this.volumeSteps===undefined){g=16}else{g=this.volumeSteps}var M=1;var _=this.stackhelper.stack.minMax[1]-this.stackhelper.stack.minMax[0];var d=void 0;if(this.volumeWindowWidth===undefined){d=_/2}else{d=this.volumeWindowWidth}var N=this.stackhelper.stack.minMax[0];var L=this.stackhelper.stack.minMax[1];var v=void 0;if(this.volumeWindowCenter===undefined){v=L/2}else{v=this.volumeWindowCenter}this.stackhelper.steps=g;this.stackhelper.windowWidth=d;this.stackhelper.windowCenter=v;return i("div",null,this.renderGenericOptions(),i("ion-item",{style:{display:"var(--volume-steps-display, block)"}},i("ion-icon",{src:y,slot:"start"}),i("ion-range",{slot:"end",min:T.stepsMin,max:T.stepsMax,value:g,step:T.stepsIncrement,pin:true,onIonChange:function(t){return e._volumeSteps(t.detail.value)}})),i("ion-item",{style:{display:"var(--volume-window-center-display, block)"}},i("ion-icon",{src:p,slot:"start"}),i("ion-range",{slot:"end",min:N,max:L,value:this._reverseNumber(v,N,L),onIonChange:function(t){e._volumeWindowCenter(e._reverseNumber(t.detail.value,N,L))}})),i("ion-item",{style:{display:"var(--volume-window-width-display, block)"}},i("ion-icon",{src:f,slot:"start"}),i("ion-range",{slot:"end",min:M,max:_,value:this._reverseNumber(d,M,_),onIonChange:function(t){return e._volumeWindowWidth(e._reverseNumber(t.detail.value,M,_))}})))}case D.MESH:{return this.renderGenericOptions()}default:{return}}return null};e.prototype.render=function(){return[this.renderDisplayModeToggle(),this.renderNodesToggle(),this.renderOptions()]};Object.defineProperty(e,"watchers",{get:function(){return{stackhelper:["watchStackhelper"]}},enumerable:true,configurable:true});Object.defineProperty(e,"style",{get:function(){return"ion-item{--border-width:0 0 0 0;--inner-border-width:0 0 0 0}ion-item select{padding:5px;min-width:100px}"},enumerable:true,configurable:true});return e}());var G=e("al_edge_editor",function(){function e(e){t(this,e);this.delete=n(this,"delete",7)}e.prototype.render=function(){var e=this;if(this.edge){var t=this.edge[0];return i("form",{onSubmit:function(e){return e.preventDefault()}},i("ion-button",{size:"small",onClick:function(){e.delete.emit(t);e.edge=null}},i("ion-icon",{src:a})))}return null};Object.defineProperty(e,"style",{get:function(){return""},enumerable:true,configurable:true});return e}());var Z="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0xODYuMzAxIDMzOS44OTNMOTYgMjQ5LjQ2MWwtMzIgMzAuNTA3TDE4Ni4zMDEgNDAyIDQ0OCAxNDAuNTA2IDQxNiAxMTB6Ij48L3BhdGg+PC9zdmc+Cg==";var X="Title";var K="Description";var q={title:X,description:K};var J=e("al_node_editor",function(){function e(e){t(this,e);this._contentStrings=q;this.delete=n(this,"delete",7);this.save=n(this,"save",7)}e.prototype.render=function(){var e=this;if(this.node){var t=this.node,n=t[0],r=t[1];return i("form",{onSubmit:function(e){return e.preventDefault()}},i("ion-item",null,i("ion-input",{value:r.title,placeholder:this._contentStrings.title,required:true,onIonChange:function(e){return r.title=e.detail.value}})),i("ion-item",null,i("ion-textarea",{value:r.description,placeholder:this._contentStrings.description,rows:"10",onIonChange:function(e){return r.description=e.detail.value}})),i("ion-button",{size:"small",onClick:function(){e.delete.emit(n);e.node=null}},i("ion-icon",{src:a})),i("ion-button",{size:"small",type:"submit",onClick:function(){if(r.title){e.save.emit([n,r])}}},i("ion-icon",{src:Z})))}return null};Object.defineProperty(e,"style",{get:function(){return""},enumerable:true,configurable:true});return e}());var $="No nodes exist";var ee={noneExist:$};var te=e("al_node_list",function(){function e(e){t(this,e);this._contentStrings=ee;this.nodes=null;this.selected=null;this.selectedChanged=n(this,"selectedChanged",7)}e.prototype.render=function(){var e=this;console.log("selected",this.selected);if(this.nodes&&this.nodes.size){return i("ion-list",null,Array.from(this.nodes).map(function(t){var n=t[0],r=t[1];return i("ion-item",{class:e.selected===n?"selected":null,onClick:function(){return e.selectedChanged.emit(n)}},r.title)}))}return i("p",null,this._contentStrings.noneExist)};Object.defineProperty(e,"style",{get:function(){return"ion-item.selected{--color:#6495ed}"},enumerable:true,configurable:true});return e}());var ne=e("al_tabs",function(){function e(e){t(this,e);this.transitioning=false;this.tabs=[];this.ionNavWillLoad=n(this,"ionNavWillLoad",7);this.ionTabsWillChange=n(this,"ionTabsWillChange",3);this.ionTabsDidChange=n(this,"ionTabsDidChange",3);this.doc=r(this,"document")}e.prototype.componentWillLoad=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){this.tabs=Array.from(this.el.querySelectorAll("ion-tab"));this.ionNavWillLoad.emit();this.componentWillUpdate();return[2]})})};e.prototype.componentDidLoad=function(){this.initSelect()};e.prototype.componentDidUnload=function(){this.tabs.length=0;this.selectedTab=this.leavingTab=undefined};e.prototype.componentWillUpdate=function(){var e=this.el.querySelector("ion-tab-bar");if(e){var t=this.selectedTab?this.selectedTab.tab:undefined;e.selectedTab=t}};e.prototype.onTabClicked=function(e){var t=e.detail.tab;var n=this.tabs.find(function(e){return e.tab===t});if(n){this.select(n)}};e.prototype.select=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.getTab(e)];case 1:t=n.sent();if(!this.shouldSwitch(t)){return[2,false]}return[4,this.setActive(t)];case 2:n.sent();this.tabSwitch();return[2,true]}})})};e.prototype.getTab=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){t=typeof e==="string"?this.tabs.find(function(t){return t.tab===e}):e;if(!t){console.error('tab with id: "'+t+'" does not exist')}return[2,t]})})};e.prototype.getSelected=function(){return Promise.resolve(this.selectedTab?this.selectedTab.tab:undefined)};e.prototype.initSelect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,Promise.all(this.tabs.map(function(e){return e.componentOnReady()}))];case 1:e.sent();return[4,this.select(this.tabs[0])];case 2:e.sent();return[2]}})})};e.prototype.setActive=function(e){if(this.transitioning){return Promise.reject("transitioning already happening")}this.transitioning=true;this.leavingTab=this.selectedTab;this.selectedTab=e;this.ionTabsWillChange.emit({tab:e.tab});return e.setActive()};e.prototype.tabSwitch=function(){var e=this.selectedTab;var t=this.leavingTab;this.leavingTab=undefined;this.transitioning=false;if(!e){return}if(t!==e){if(t){t.active=false}this.ionTabsDidChange.emit({tab:e.tab})}};e.prototype.shouldSwitch=function(e){var t=this.selectedTab;return e!==undefined&&e!==t&&!this.transitioning};e.prototype.render=function(){return[i("slot",{name:"top"}),i("div",{class:"tabs-inner"},i("slot",null)),i("slot",{name:"bottom"})]};Object.defineProperty(e.prototype,"el",{get:function(){return s(this)},enumerable:true,configurable:true});Object.defineProperty(e,"style",{get:function(){return":host{z-index:var(--z-index-page-container)}.tabs-inner{position:relative}"},enumerable:true,configurable:true});return e}());var ie="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgY2xhc3M9InMtaW9uLWljb24iPjxwYXRoIGQ9Ik0yNTYgMzg4Yy03Mi41OTcgMC0xMzItNTkuNDA1LTEzMi0xMzIgMC03Mi42MDEgNTkuNDAzLTEzMiAxMzItMTMyIDM2LjMgMCA2OS4yOTkgMTUuNCA5Mi40MDYgMzkuNjAxTDI3OCAyMzRoMTU0VjgwbC01MS42OTggNTEuNzAyQzM0OC40MDYgOTkuNzk4IDMwNC40MDYgODAgMjU2IDgwYy05Ni43OTcgMC0xNzYgNzkuMjAzLTE3NiAxNzZzNzguMDk0IDE3NiAxNzYgMTc2YzgxLjA0NSAwIDE0OC4yODctNTQuMTM0IDE2OS40MDEtMTI4SDM3OC44NWMtMTguNzQ1IDQ5LjU2MS02Ny4xMzggODQtMTIyLjg1IDg0eiI+PC9wYXRoPjwvc3ZnPgo=";var re=e("al_url_picker",function(){function e(e){t(this,e);this.urls=null;this.url=null;this.urlChanged=n(this,"urlChanged",7)}e.prototype.render=function(){var e=this;if(this.urls){return i("form",{onSubmit:function(e){return e.preventDefault()}},i("ion-select",{value:this.url,interface:"popover",placeholder:"",onIonChange:function(t){return e.urlChanged.emit(t.detail.value)}},Array.from(this.urls).map(function(e){var t=e[0],n=e[1];return i("ion-select-option",{value:t},n)})),i("ion-input",{type:"url",size:"100",placeholder:"src",required:true,value:this.url,ref:function(t){return e._input=t}}),i("ion-button",{size:"small",type:"submit",onClick:function(){return e.urlChanged.emit(e._input.value)}},i("ion-icon",{src:ie})))}return null};Object.defineProperty(e,"style",{get:function(){return""},enumerable:true,configurable:true});return e}());var se;(function(e){e[e["Backspace"]=8]="Backspace";e[e["Tab"]=9]="Tab";e[e["Enter"]=13]="Enter";e[e["Shift"]=16]="Shift";e[e["Ctrl"]=17]="Ctrl";e[e["Alt"]=18]="Alt";e[e["PauseBreak"]=19]="PauseBreak";e[e["CapsLock"]=20]="CapsLock";e[e["Escape"]=27]="Escape";e[e["Spacebar"]=32]="Spacebar";e[e["PageUp"]=33]="PageUp";e[e["PageDown"]=34]="PageDown";e[e["End"]=35]="End";e[e["Home"]=36]="Home";e[e["LeftArrow"]=37]="LeftArrow";e[e["UpArrow"]=38]="UpArrow";e[e["RightArrow"]=39]="RightArrow";e[e["DownArrow"]=40]="DownArrow";e[e["PrintScrn"]=44]="PrintScrn";e[e["Insert"]=45]="Insert";e[e["Delete"]=46]="Delete";e[e["Zero"]=48]="Zero";e[e["One"]=49]="One";e[e["Two"]=50]="Two";e[e["Three"]=51]="Three";e[e["Four"]=52]="Four";e[e["Five"]=53]="Five";e[e["Six"]=54]="Six";e[e["Seven"]=55]="Seven";e[e["Eight"]=56]="Eight";e[e["Nine"]=57]="Nine";e[e["a"]=65]="a";e[e["b"]=66]="b";e[e["c"]=67]="c";e[e["d"]=68]="d";e[e["e"]=69]="e";e[e["f"]=70]="f";e[e["g"]=71]="g";e[e["h"]=72]="h";e[e["i"]=73]="i";e[e["j"]=74]="j";e[e["k"]=75]="k";e[e["l"]=76]="l";e[e["m"]=77]="m";e[e["n"]=78]="n";e[e["o"]=79]="o";e[e["p"]=80]="p";e[e["q"]=81]="q";e[e["r"]=82]="r";e[e["s"]=83]="s";e[e["t"]=84]="t";e[e["u"]=85]="u";e[e["v"]=86]="v";e[e["w"]=87]="w";e[e["x"]=88]="x";e[e["y"]=89]="y";e[e["z"]=90]="z";e[e["LeftWindowKey"]=91]="LeftWindowKey";e[e["RightWindowKey"]=92]="RightWindowKey";e[e["SelectKey"]=93]="SelectKey";e[e["Numpad0"]=96]="Numpad0";e[e["Numpad1"]=97]="Numpad1";e[e["Numpad2"]=98]="Numpad2";e[e["Numpad3"]=99]="Numpad3";e[e["Numpad4"]=100]="Numpad4";e[e["Numpad5"]=101]="Numpad5";e[e["Numpad6"]=102]="Numpad6";e[e["Numpad7"]=103]="Numpad7";e[e["Numpad8"]=104]="Numpad8";e[e["Numpad9"]=105]="Numpad9";e[e["Multiply"]=106]="Multiply";e[e["NumpadPlus"]=107]="NumpadPlus";e[e["NumpadMinus"]=109]="NumpadMinus";e[e["DecimalPoint"]=110]="DecimalPoint";e[e["Divide"]=111]="Divide";e[e["F1"]=112]="F1";e[e["F2"]=113]="F2";e[e["F3"]=114]="F3";e[e["F4"]=115]="F4";e[e["F5"]=116]="F5";e[e["F6"]=117]="F6";e[e["F7"]=118]="F7";e[e["F8"]=119]="F8";e[e["F9"]=120]="F9";e[e["F10"]=121]="F10";e[e["F11"]=122]="F11";e[e["F12"]=123]="F12";e[e["NumLock"]=144]="NumLock";e[e["ScrollLock"]=145]="ScrollLock";e[e["Semicolon"]=186]="Semicolon";e[e["Equals"]=187]="Equals";e[e["Comma"]=188]="Comma";e[e["LessThan"]=188]="LessThan";e[e["Dash"]=189]="Dash";e[e["Period"]=190]="Period";e[e["GreaterThan"]=190]="GreaterThan";e[e["ForwardSlash"]=191]="ForwardSlash";e[e["QuestionMark"]=191]="QuestionMark";e[e["GraveAccent"]=192]="GraveAccent";e[e["Tilde"]=192]="Tilde";e[e["OpenCurlyBracket"]=219]="OpenCurlyBracket";e[e["OpenSquareBracket"]=219]="OpenSquareBracket";e[e["BackSlash"]=220]="BackSlash";e[e["VerticalPipe"]=220]="VerticalPipe";e[e["CloseCurlyBracket"]=221]="CloseCurlyBracket";e[e["CloseSquareBracket"]=221]="CloseSquareBracket";e[e["Quote"]=222]="Quote";e[e["CommandFF"]=224]="CommandFF"})(se||(se={}));var oe;(function(e){e[e["Backspace"]=8]="Backspace";e[e["Enter"]=13]="Enter";e[e["Spacebar"]=32]="Spacebar";e[e["Hash"]=35]="Hash";e[e["GraveAccent"]=39]="GraveAccent";e[e["DoubleQuote"]=34]="DoubleQuote";e[e["Asterisk"]=42]="Asterisk";e[e["Plus"]=43]="Plus";e[e["Comma"]=44]="Comma";e[e["Minus"]=45]="Minus";e[e["Period"]=46]="Period";e[e["ForwardSlash"]=47]="ForwardSlash";e[e["Zero"]=48]="Zero";e[e["One"]=49]="One";e[e["Two"]=50]="Two";e[e["Three"]=51]="Three";e[e["Four"]=52]="Four";e[e["Five"]=53]="Five";e[e["Six"]=54]="Six";e[e["Seven"]=55]="Seven";e[e["Eight"]=56]="Eight";e[e["Nine"]=57]="Nine";e[e["Colon"]=58]="Colon";e[e["Semicolon"]=59]="Semicolon";e[e["LessThan"]=60]="LessThan";e[e["Equals"]=61]="Equals";e[e["GreaterThan"]=62]="GreaterThan";e[e["QuestionMark"]=63]="QuestionMark";e[e["At"]=64]="At";e[e["OpenSquareBracket"]=91]="OpenSquareBracket";e[e["BackSlash"]=92]="BackSlash";e[e["CloseSquareBracket"]=93]="CloseSquareBracket";e[e["a"]=97]="a";e[e["b"]=98]="b";e[e["c"]=99]="c";e[e["d"]=100]="d";e[e["e"]=101]="e";e[e["f"]=102]="f";e[e["g"]=103]="g";e[e["h"]=104]="h";e[e["i"]=105]="i";e[e["j"]=106]="j";e[e["k"]=107]="k";e[e["l"]=108]="l";e[e["m"]=109]="m";e[e["n"]=110]="n";e[e["o"]=111]="o";e[e["p"]=112]="p";e[e["q"]=113]="q";e[e["r"]=114]="r";e[e["s"]=115]="s";e[e["t"]=116]="t";e[e["u"]=117]="u";e[e["v"]=118]="v";e[e["w"]=119]="w";e[e["x"]=120]="x";e[e["y"]=121]="y";e[e["z"]=122]="z";e[e["OpenCurlyBracket"]=123]="OpenCurlyBracket";e[e["VerticalPipe"]=124]="VerticalPipe";e[e["CloseCurlyBracket"]=125]="CloseCurlyBracket";e[e["Tilde"]=126]="Tilde"})(oe||(oe={}));var ae=function(){function e(){}return e}();ae.SELECTED="al-graph-selected";ae.POINTER_OVER="al-graph-pointer-over";ae.POINTER_OUT="al-graph-pointer-out";ae.DRAGGED="al-graph-dragged";ae.POINTER_DOWN="al-graph-pointer-down";ae.POINTER_UP="al-graph-pointer-up";var ce=function(){function e(){}e.getEntryWithHighestId=function(e){if(e.size){return Math.max.apply(Math,Array.from(e).map(function(e){var t=e[0];return Number(t.split("-")[1])}))}return-1};e.getNextId=function(e,t){return e+"-"+Number(this.getEntryWithHighestId(t)+1)};return e}();var ue=function(){function e(){}e.isWebGL2Available=function(){try{var e=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&e.getContext("webgl2"))}catch(e){return false}};e.enableControls=function(e,t,n){n===L.TRACKBALL?e.setAttribute("al-trackball-control","enabled: "+t):e.setAttribute("al-orbit-control","enabled: "+t)};e.waitOneFrame=function(e){window.setTimeout(function(){e()},T.minFrameMS)};e.objectToVector3=function(e){var t=new THREE.Vector3;t.x=e.x;t.y=e.y;t.z=e.z;return t};e.worldToScreen=function(e,t,n){var i=e.clone();i.project(t);i.x=Math.round((i.x+1)*n.offsetWidth/2);i.y=Math.round((-i.y+1)*n.offsetHeight/2);i.z=0;return i};e.vector3ToString=function(e){return e.toArray().join(" ")};e.stringToVector3=function(e){var t=e.split(" ");var n=new THREE.Vector3;n.x=Number(t[0]);n.y=Number(t[1]);n.z=Number(t[2]);return n};e.slerp=function(e,t,n){var i=n;var r=e;var s=t;var o=r.angleTo(s);if(o){o=THREE.Math.clamp(o,-.99,.99);var a=Math.sin(1-i)*o;var c=Math.sin(i*o);var u=Math.sin(o);var l=a/u;var d=c/u;var h=r.clone().multiplyScalar(l);var p=s.clone().multiplyScalar(d);var f=h.add(p);return f}else{return null}};e.easeInOutCubic=function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1};e.getSlerpCameraPath=function(t,n,i,r){var s=[];var o=t.position.clone().addScalar(Number.EPSILON);var a=t.target.clone().addScalar(Number.EPSILON);var c=n.position.clone().addScalar(Number.EPSILON);var u=n.target.clone().addScalar(Number.EPSILON);for(var l=0;l<=T.maxAnimationSteps;l++){var d=this.easeInOutCubic(l/T.maxAnimationSteps);s.push({position:i?e.slerp(o.clone(),c.clone(),d):c,target:r?e.slerp(a.clone(),u.clone(),d):u})}return s};e.getSlerpPath=function(t,n){var i=[];var r=t.clone().addScalar(Number.EPSILON);var s=n.clone().addScalar(Number.EPSILON);for(var o=0;o<=T.maxAnimationSteps;o++){var a=this.easeInOutCubic(o/T.maxAnimationSteps);i.push(e.slerp(r.clone(),s.clone(),a))}return i};return e}();var le=function(){function e(){}e._traceDataRay=function(e,t,n,i,r,s,o,a,c,u){var l=0;var d=Math.floor;var h=d(t)|0;var p=d(n)|0;var f=d(i)|0;var E=r>0?1:-1;var v=s>0?1:-1;var g=o>0?1:-1;var m=Math.abs(1/r);var M=Math.abs(1/s);var y=Math.abs(1/o);var _=E>0?h+1-t:t-h;var T=v>0?p+1-n:n-p;var N=g>0?f+1-i:i-f;var L=m<Infinity?m*_:Infinity;var D=M<Infinity?M*T:Infinity;var S=y<Infinity?y*N:Infinity;var b=e.windowCenter-e.windowWidth*.5;var I=-1;while(l<=a){var w=void 0;var A=new THREE.Vector3(h,p,f);var C=AMI.CoreUtils.worldToData(e.stack.lps2IJK,A);var O=AMI.CoreUtils.getPixelData(e.stack,C);if(O!==null&&O>b){w=1}else{w=0}if(w){if(c){c.x=t+l*r;c.y=n+l*s;c.z=i+l*o}if(u){u.x=u.y=u.z=0;if(I===0){u.x=-E}if(I===1){u.y=-v}if(I===2){u.z=-g}}return w}if(L<D){if(L<S){h+=E;l=L;L+=m;I=0}else{f+=g;l=S;S+=y;I=2}}else{if(D<S){p+=v;l=D;D+=M;I=1}else{f+=g;l=S;S+=y;I=2}}}if(c){c.x=t+l*r;c.y=n+l*s;c.z=i+l*o}if(u){u.x=u.y=u.z=0}return 0};e.volumeRay=function(e,t,n,i,r,s){var o=+t.x;var a=+t.y;var c=+t.z;var u=+n.x;var l=+n.y;var d=+n.z;var h=Math.sqrt(u*u+l*l+d*d);if(h===0){throw new Error("Can't raycast along a zero vector")}u/=h;l/=h;d/=h;if(typeof i==="undefined"){i=64}else{i=+i}return this._traceDataRay(e,o,a,c,u,l,d,i,r,s)};e.toAframeSpace=function(e){return e.divide(ue.objectToVector3(T.stackSpaceMultiplier))};return e}();var de=function(){function e(){}e.debounce=function(e,t){t=t||100;return function(){if(!e.debouncing){var n=Array.prototype.slice.apply(arguments);e.lastReturnVal=e.apply(this,n);e.debouncing=true}clearTimeout(e.debounceTimeout);e.debounceTimeout=setTimeout(function(){e.debouncing=false},t);return e.lastReturnVal}};return e}();var he=function(){function e(){}e.addCssUnits=function(e){if(!this.cssUnits.some(function(t){return e.includes(t)})){e+="px"}return e};e.getFileExtension=function(e){return e.substring(e.lastIndexOf(".")+1)};e.getGeometryCenter=function(e){var t;if(e instanceof THREE.BufferGeometry){t=(new THREE.Geometry).fromBufferGeometry(e)}else{t=e}t.computeBoundingSphere();return t.boundingSphere.center};e.getCameraStateFromMesh=function(e){var t;var n;var i;if(e){var r=e.geometry;t=this.getGeometryCenter(r);i=T.zoomFactor*r.boundingSphere.radius/Math.tan(T.cameraValues.fov*Math.PI/180);n=new THREE.Vector3;n.copy(t);n.z+=i;return{target:t,position:n}}return null};e.getCameraPositionFromNode=function(e,t,n){if(!e){return null}var i=new THREE.Vector3;i.copy(ue.stringToVector3(e.position));var r=i.clone().sub(n.clone()).normalize();var s=new THREE.Vector3;s.copy(i);s.add(r.clone().multiplyScalar(t*T.zoomFactor));return s};e.getBoundingBox=function(e){return(new THREE.Box3).setFromObject(e)};return e}();he.cssUnits=["%","ch","cm","em","ex","in","mm","pc","pt","px","rem","vh","vmax","vmin","vw"];var pe=function(){function e(){}e.getHaloMaterial=function(e,t,n,i,r){if(e===void 0){e=.5}if(t===void 0){t=.5}if(n===void 0){n=.5}if(i===void 0){i=.1}if(r===void 0){r=.5}return new THREE.ShaderMaterial({uniforms:{r:{value:e},g:{value:t},b:{value:n},a:{value:i},c:{value:r}},vertexShader:this.haloVertex,fragmentShader:this.haloFragment,side:THREE.BackSide,blending:THREE.AdditiveBlending,transparent:true,depthTest:false})};return e}();pe.haloVertex="\n    varying vec3 vNormal;\n\n    void main()\n    {\n        vNormal = normalize( normalMatrix * normal );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }\n  ";pe.haloFragment="\n    varying vec3 vNormal;\n    uniform float r;\n    uniform float g;\n    uniform float b;\n    uniform float a;\n    uniform float c;\n\n    void main()\n    {\n        float intensity = pow( c - dot( vNormal, vec3( 0.0, 0.0, 1.0 ) ), 4.0 );\n        gl_FragColor = vec4(r, g, b, a) * intensity;\n    }\n  ";AFRAME.registerComponent("al-angle",{schema:{selected:{type:"boolean"},edge0Pos:{type:"vec3"},edge1Pos:{type:"vec3"},position:{type:"vec3"},length:{type:"number"},radius:{type:"number"},angle:{type:"number"}},init:function(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,T.minFrameMS,this);this.bindMethods();this.addEventListeners();this.state={selected:true,hovered:false};this.createMesh()},bindMethods:function(){this.pointerDown=this.pointerDown.bind(this);this.pointerOver=this.pointerOver.bind(this);this.pointerOut=this.pointerOut.bind(this);this.createMesh=this.createMesh.bind(this)},addEventListeners:function(){this.el.addEventListener("mousedown",this.pointerDown,{capture:false,once:false,passive:true});this.el.addEventListener("raycaster-intersected",this.pointerOver,{capture:false,once:false,passive:true});this.el.addEventListener("raycaster-intersected-cleared",this.pointerOut,{capture:false,once:false,passive:true})},removeEventListeners:function(){this.el.removeEventListener("mousedown",this.pointerDown);this.el.removeEventListener("raycaster-intersected",this.pointerOver);this.el.removeEventListener("raycaster-intersected-cleared",this.pointerOut)},pointerDown:function(e){this.el.sceneEl.emit(ae.SELECTED,{type:N.ANGLE,id:this.el.id},true)},pointerOver:function(e){var t=this.state;t.hovered=true;this.el.sceneEl.emit(ae.POINTER_OVER,{id:this.el.id},true)},pointerOut:function(e){var t=this.state;t.hovered=false;this.el.sceneEl.emit(ae.POINTER_OUT,{},true)},createMesh:function(){var e=ue.objectToVector3(this.data.edge0Pos);var t=ue.objectToVector3(this.data.edge1Pos);var n=new THREE.Matrix4;n.lookAt(e,t,(new THREE.Object3D).up);n.multiply((new THREE.Matrix4).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1));var i=new THREE.CylinderGeometry(this.data.radius,this.data.radius,this.data.length,6,4);var r=new THREE.MeshBasicMaterial;var s=new THREE.Mesh(i,r);s.applyMatrix(n);s.position.copy(ue.objectToVector3(this.data.position));this.state.geometry=i;this.state.material=r;this.state.mesh=s;var o=new THREE.CylinderGeometry(this.data.radius,this.data.radius,this.data.length,6,4);var a=pe.getHaloMaterial();var c=new THREE.Mesh(o,a);this.state.outlineGeometry=o;this.state.outlineMaterialt=a;this.state.outlineMesh=c;s.add(c);this.el.setObject3D("mesh",s);this.el.object3D.renderOrder=T.topLayerRenderOrder-3},update:function(e){var t=this.state;t.selected=this.data.selected;if(e&&e.angle!==this.data.angle){this.createMesh()}},tickFunction:function(){var e=this.el;var t=this.state;if(t.hovered){t.material.color=new THREE.Color(T.buttonColors.hover)}else if(t.selected){t.material.color=new THREE.Color(T.buttonColors.active)}else{t.material.color=new THREE.Color(T.buttonColors.up)}var n=e.firstChild;if(n){var i=n.object3D;if(t.hovered){i.visible=true}else{i.visible=false}}},tick:function(){this.tickFunction()},remove:function(){this.removeEventListeners();this.el.removeObject3D("mesh")}});AFRAME.registerComponent("al-background",{schema:{text:{type:"string",default:""},boundingRadius:{type:"number",default:1},scale:{type:"number",default:8}},init:function(){this.state={hasUpdated:false};this.bindMethods();this.addEventListeners();this.tickFunction=AFRAME.utils.throttle(this.tickFunction,T.minFrameMS,this)},bindMethods:function(){},addEventListeners:function(){},removeEventListeners:function(){},update:function(e){if(this.data.text!==e.text){this.state.hasUpdated=false}},tickFunction:function(){if(!this.state.hasUpdated){var e=this.el.parentEl.object3DMap.text.geometry;if(e.attributes.position){e.computeBoundingBox();var t=new THREE.Vector3;e.boundingBox.getSize(t);var n=t.y*this.data.boundingRadius/(this.data.scale*T.nodeSizeRatio);var i=t.x*this.data.boundingRadius/(this.data.scale*T.nodeSizeRatio);var r=this.el.object3DMap.mesh;r.scale.set(i*1.1,n*1.2,1);var s=r.material;s.flatShading=true;s.roughness=1;var o=this.el.getAttribute("position");o.sub(new THREE.Vector3(0,o.y*.05,1e-5));this.el.setAttribute("position",o);this.state.hasUpdated=true}}},tick:function(){this.tickFunction()},remove:function(){this.removeEventListeners()}});AFRAME.registerComponent("al-bounding-box",{schema:{color:{type:"string",default:"#f50057"},scale:{type:"string"},opacity:{type:"number",default:1}},init:function(){this.bindMethods();this.addEventListeners();this.state={box:new THREE.Box3}},bindMethods:function(){},addEventListeners:function(){},removeEventListeners:function(){},update:function(){var e=this.el;var t=this.state;var n=ue.stringToVector3(this.data.scale);t.box.setFromCenterAndSize(new THREE.Vector3(0,0,0),n);var i=new THREE.BoxGeometry(n.x,n.y,n.z);var r=new THREE.MeshBasicMaterial({color:this.data.color,visible:false});var s=new THREE.Mesh(i,r);e.setObject3D("mesh2",s);t.boundingBox=new THREE.Box3Helper(t.box,this.data.color);var o=t.boundingBox.material;o.opacity=this.data.opactiy;o.transparent=this.data.opacity===0;t.boundingBox.renderOrder=T.topLayerRenderOrder-5;e.setObject3D("mesh",t.boundingBox);t.geometry=i;t.material=r;t.mesh=s},remove:function(){this.removeEventListeners();this.el.removeObject3D("mesh");this.el.removeObject3D("mesh2")}});var fe={CLICK:"click",FUSING:"fusing",MOUSEENTER:"mouseenter",MOUSEDOWN:"mousedown",MOUSELEAVE:"mouseleave",MOUSEUP:"mouseup"};var Ee={FUSING:"cursor-fusing",HOVERING:"cursor-hovering",HOVERED:"cursor-hovered"};var ve={DOWN:["mousedown","touchstart"],UP:["mouseup","touchend"]};var ge="a-mouse-cursor-hover";AFRAME.registerComponent("al-cursor",{dependencies:["raycaster"],schema:{downEvents:{default:[]},fuse:{default:AFRAME.utils.device.isMobile()},fuseTimeout:{default:1500,min:0},mouseCursorStylesEnabled:{default:true},upEvents:{default:[]},rayOrigin:{default:"entity",oneOf:["mouse","entity"]}},init:function(){var e=this;this.fuseTimeout=undefined;this.cursorDownEl=null;this.intersectedEl=null;this.canvasBounds=document.body.getBoundingClientRect();this.isCursorDown=false;this.updateCanvasBounds=AFRAME.utils.debounce(function t(){e.canvasBounds=e.el.sceneEl.canvas.getBoundingClientRect()},500);this.eventDetail={};this.intersectedEventDetail={cursorEl:this.el};this.onCursorDown=AFRAME.utils.bind(this.onCursorDown,this);this.onCursorUp=AFRAME.utils.bind(this.onCursorUp,this);this.onIntersection=AFRAME.utils.bind(this.onIntersection,this);this.onIntersectionCleared=AFRAME.utils.bind(this.onIntersectionCleared,this);this.onMouseMove=AFRAME.utils.bind(this.onMouseMove,this)},update:function(e){if(this.data.rayOrigin===e.rayOrigin){return}this.updateMouseEventListeners()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){var e=this.el;e.removeState(Ee.HOVERING);e.removeState(Ee.FUSING);clearTimeout(this.fuseTimeout);if(this.intersectedEl){this.intersectedEl.removeState(Ee.HOVERED)}this.removeEventListeners()},addEventListeners:function(){var e;var t=this.data;var n=this.el;var i=this;function r(){e=n.sceneEl.canvas;if(t.downEvents.length||t.upEvents.length){return}ve.DOWN.forEach(function(t){e.addEventListener(t,i.onCursorDown)});ve.UP.forEach(function(t){e.addEventListener(t,i.onCursorUp)})}e=n.sceneEl.canvas;if(e){r()}else{n.sceneEl.addEventListener("render-target-loaded",r)}t.downEvents.forEach(function(e){n.addEventListener(e,i.onCursorDown)});t.upEvents.forEach(function(e){n.addEventListener(e,i.onCursorUp)});n.addEventListener("raycaster-intersection",this.onIntersection);n.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared);n.sceneEl.addEventListener("rendererresize",this.updateCanvasBounds);window.addEventListener("resize",this.updateCanvasBounds);window.addEventListener("scroll",this.updateCanvasBounds);this.updateMouseEventListeners()},removeEventListeners:function(){var e;var t=this.data;var n=this.el;var i=this;e=n.sceneEl.canvas;if(e&&!t.downEvents.length&&!t.upEvents.length){ve.DOWN.forEach(function(t){e.removeEventListener(t,i.onCursorDown)});ve.UP.forEach(function(t){e.removeEventListener(t,i.onCursorUp)})}t.downEvents.forEach(function(e){n.removeEventListener(e,i.onCursorDown)});t.upEvents.forEach(function(e){n.removeEventListener(e,i.onCursorUp)});n.removeEventListener("raycaster-intersection",this.onIntersection);n.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared);e.removeEventListener("mousemove",this.onMouseMove);e.removeEventListener("touchstart",this.onMouseMove);e.removeEventListener("touchmove",this.onMouseMove);n.sceneEl.removeEventListener("rendererresize",this.updateCanvasBounds);window.removeEventListener("resize",this.updateCanvasBounds);window.removeEventListener("scroll",this.updateCanvasBounds)},updateMouseEventListeners:function(){var e;var t=this.el;e=t.sceneEl.canvas;e.removeEventListener("mousemove",this.onMouseMove);e.removeEventListener("touchmove",this.onMouseMove);t.setAttribute("raycaster","useWorldCoordinates",false);if(this.data.rayOrigin!=="mouse"){return}e.addEventListener("mousemove",this.onMouseMove,false);e.addEventListener("touchmove",this.onMouseMove,false);t.setAttribute("raycaster","useWorldCoordinates",true);this.updateCanvasBounds()},onMouseMove:function(){var e=new THREE.Vector3;var t=new THREE.Vector2;var n=new THREE.Vector3;var i={origin:n,direction:e};return function(r){var s=this.canvasBounds;var o=this.el.sceneEl.camera;var a;var c;var u;o.parent.updateMatrixWorld();if(r.type==="touchmove"||r.type==="touchstart"){c=r.touches.item(0)}else{c=r}a=c.clientX-s.left;u=c.clientY-s.top;t.x=a/s.width*2-1;t.y=-(u/s.height)*2+1;n.setFromMatrixPosition(o.matrixWorld);e.set(t.x,t.y,.5).unproject(o).sub(n).normalize();this.el.setAttribute("raycaster",i);if(r.type==="touchmove"){r.preventDefault()}}}(),onCursorDown:function(e){this.isCursorDown=true;if(this.data.rayOrigin==="mouse"&&e.type==="touchstart"){this.onMouseMove(e);this.el.components.raycaster.checkIntersections();e.preventDefault()}this.twoWayEmit(fe.MOUSEDOWN);this.cursorDownEl=this.intersectedEl},onCursorUp:function(e){if(!this.isCursorDown){return}this.isCursorDown=false;var t=this.data;this.twoWayEmit(fe.MOUSEUP);if(this.cursorDownEl&&this.cursorDownEl!==this.intersectedEl){this.intersectedEventDetail.intersection=null;this.cursorDownEl.emit(fe.MOUSEUP,this.intersectedEventDetail)}if((!t.fuse||t.rayOrigin==="mouse")&&this.intersectedEl&&this.cursorDownEl===this.intersectedEl){this.twoWayEmit(fe.CLICK)}this.cursorDownEl=null;if(e.type==="touchend"){e.preventDefault()}},onIntersection:function(e){var t;var n=this.el;var i;var r;var s;i=e.detail.els[0]===n?1:0;s=e.detail.intersections[i];r=e.detail.els[i];if(!r){return}if(this.intersectedEl===r){return}if(this.intersectedEl){t=this.el.components.raycaster.getIntersection(this.intersectedEl);if(t&&t.distance<=s.distance){return}}this.clearCurrentIntersection(true);this.setIntersection(r,s)},onIntersectionCleared:function(e){var t=e.detail.clearedEls;if(t.indexOf(this.intersectedEl)===-1){return}this.clearCurrentIntersection()},setIntersection:function(e){var t=this.el;var n=this.data;var i=this;if(this.intersectedEl===e){return}this.intersectedEl=e;t.addState(Ee.HOVERING);e.addState(Ee.HOVERED);this.twoWayEmit(fe.MOUSEENTER);if(this.data.mouseCursorStylesEnabled&&this.data.rayOrigin==="mouse"){this.el.sceneEl.canvas.classList.add(ge)}if(n.fuseTimeout===0||!n.fuse){return}t.addState(Ee.FUSING);this.twoWayEmit(fe.FUSING);this.fuseTimeout=setTimeout(function e(){t.removeState(Ee.FUSING);i.twoWayEmit(fe.CLICK)},n.fuseTimeout)},clearCurrentIntersection:function(e){var t;var n;var i;var r=this.el;if(!this.intersectedEl){return}this.intersectedEl.removeState(Ee.HOVERED);r.removeState(Ee.HOVERING);r.removeState(Ee.FUSING);this.twoWayEmit(fe.MOUSELEAVE);if(this.data.mouseCursorStylesEnabled&&this.data.rayOrigin==="mouse"){this.el.sceneEl.canvas.classList.remove(ge)}this.intersectedEl=null;clearTimeout(this.fuseTimeout);if(e===true){return}i=this.el.components.raycaster.intersections;if(i.length===0){return}t=i[0].object.el===r?1:0;n=i[t];if(!n){return}this.setIntersection(n.object.el,n)},twoWayEmit:function(e){var t=this.el;var n=this.intersectedEl;var i;i=this.el.components.raycaster.getIntersection(n);this.eventDetail.intersectedEl=n;this.eventDetail.intersection=i;t.emit(e,this.eventDetail);if(!n){return}this.intersectedEventDetail.intersection=i;n.emit(e,this.intersectedEventDetail)}});AFRAME.registerComponent("al-edge",{schema:{selected:{type:"boolean"},node1:{type:"vec3"},node2:{type:"vec3"},length:{type:"number"},radius:{type:"number"},nodeScale:{type:"number"}},init:function(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,T.minFrameMS,this);this.bindMethods();this.addEventListeners();this.state={selected:true,hovered:false}},bindMethods:function(){this.pointerDown=this.pointerDown.bind(this);this.pointerOver=this.pointerOver.bind(this);this.pointerOut=this.pointerOut.bind(this);this.createMesh=this.createMesh.bind(this)},addEventListeners:function(){this.el.sceneEl.addEventListener("mousedown",this.pointerDown,{capture:false,once:false,passive:true});this.el.addEventListener("raycaster-intersected",this.pointerOver,{capture:false,once:false,passive:true});this.el.addEventListener("raycaster-intersected-cleared",this.pointerOut,{capture:false,once:false,passive:true})},removeEventListeners:function(){this.el.sceneEl.removeEventListener("mousedown",this.pointerDown);this.el.removeEventListener("raycaster-intersected",this.pointerOver);this.el.removeEventListener("raycaster-intersected-cleared",this.pointerOut)},pointerDown:function(e){var t=this.state;if(t.hovered){this.el.sceneEl.emit(ae.SELECTED,{type:N.EDGE,id:this.el.id},false)}},pointerOver:function(e){var t=this.state;t.hovered=true;this.el.sceneEl.emit(ae.POINTER_OVER,{id:this.el.id},false)},pointerOut:function(e){var t=this.state;t.hovered=false;this.el.sceneEl.emit(ae.POINTER_OUT,{},false)},createMesh:function(){var e=ue.objectToVector3(this.data.node1);var t=ue.objectToVector3(this.data.node2);var n=new THREE.Matrix4;n.lookAt(e,t,(new THREE.Object3D).up);n.multiply((new THREE.Matrix4).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1));var i=new THREE.CylinderGeometry(this.data.radius,this.data.radius,this.data.length,6,4);var r=new THREE.MeshBasicMaterial;var s=new THREE.Mesh(i,r);s.applyMatrix(n);this.state.geometry=i;this.state.material=r;this.state.mesh=s;var o=new THREE.CylinderGeometry(this.data.radius,this.data.radius,this.data.length-this.data.nodeScale*2,6,4);var a=pe.getHaloMaterial();var c=new THREE.Mesh(o,a);this.state.outlineGeometry=o;this.state.outlineMaterialt=a;this.state.outlineMesh=c;s.add(c);this.el.setObject3D("mesh",s);this.el.object3D.renderOrder=T.topLayerRenderOrder-2},update:function(e){var t=this.state;t.selected=this.data.selected;if(e&&(e.radius!==this.data.radius||e.length!==this.data.length)){this.createMesh()}},tickFunction:function(){var e=this.el;var t=this.state;if(t.hovered){t.material.color=new THREE.Color(T.buttonColors.hover)}else if(t.selected){t.material.color=new THREE.Color(T.buttonColors.active)}else{t.material.color=new THREE.Color(T.buttonColors.up)}var n=e.firstChild;if(n){var i=n.object3D;if(t.hovered){i.visible=true}else{i.visible=false}}},tick:function(){this.tickFunction()},remove:function(){this.removeEventListeners();this.el.removeObject3D("mesh")}});AFRAME.registerComponent("al-fixed-to-orbit-camera",{schema:{distanceFromTarget:{type:"number",default:.1},target:{type:"vec3"}},init:function(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,T.minFrameMS/2,this);if(this.data.target){var e=ue.objectToVector3(this.data.target);this.state={distanceFromTarget:this.data.distanceFromTarget,target:e}}else{this.state={distanceFromTarget:this.data.distanceFromTarget,target:new THREE.Vector3(0,0,0)}}this.bindMethods();this.addEventListeners()},bindMethods:function(){},addEventListeners:function(){},removeEventListeners:function(){},update:function(){var e=ue.objectToVector3(this.data.target);this.state={distanceFromTarget:this.data.distanceFromTarget,target:e}},tickFunction:function(){var e=this.el;var t=this.state;var n=e.sceneEl.camera.position;var i=t.target.clone().sub(n.clone()).normalize();e.object3D.position.copy(i.multiplyScalar(t.distanceFromTarget));e.object3D.lookAt(n)},tick:function(){this.tickFunction()},remove:function(){this.removeEventListeners()}});var me=function(){function e(){}return e}();me.LOADED="al-model-loaded";me.ERROR="al-model-error";AFRAME.registerComponent("al-gltf-model",{schema:{src:{type:"model",default:""},dracoDecoderPath:{type:"string",default:""}},init:function(){this.bindMethods();this.addEventListeners();this.model=null;var e=THREE;this.loader=new e.GLTFLoader;e.DRACOLoader.setDecoderPath(this.data.dracoDecoderPath);this.loader.setDRACOLoader(new e.DRACOLoader)},bindMethods:function(){},addEventListeners:function(){},removeEventListeners:function(){},update:function(e){var t=this;var n=this.el;var i=this.data.src;if(e&&e.src!==i){this.remove();this.loader.load(i,function e(i){t.model=i.scene||i.scenes[0];t.model.animations=i.animations;n.setObject3D("mesh",t.model);n.sceneEl.emit(me.LOADED,{format:"gltf",model:t.model},false)},undefined,function e(t){var r=t&&t.message?t.message:"Failed to load glTF model";console.warn(r);n.sceneEl.emit(me.ERROR,{format:"gltf",src:i},false)})}},remove:function(){if(!this.model){return}this.removeEventListeners();this.el.removeObject3D("mesh")}});AFRAME.registerComponent("al-look-to-camera",{schema:{controlsType:{type:"string",default:L.ORBIT}},init:function(){this.bindMethods();this.addEventListeners();this.tickFunction=AFRAME.utils.throttle(this.tickFunction,T.minFrameMS,this)},bindMethods:function(){},addEventListeners:function(){},removeEventListeners:function(){},update:function(e){if(this.data.controlsType!==e.controlsType){this.el.object3D.up.copy(this.el.sceneEl.camera.up.clone())}},tickFunction:function(){switch(this.data.controlsType){case L.TRACKBALL:{this.el.object3D.lookAt(this.el.sceneEl.camera.position);this.el.object3D.up.copy(this.el.sceneEl.camera.up.clone());break}case L.ORBIT:{var e=this.el.object3D.position;var t=this.el.sceneEl.camera.position;var n=new THREE.Vector3;n.crossVectors(e.clone(),t.clone()).normalize();this.el.object3D.up.copy(n);this.el.object3D.lookAt(t);this.el.object3D.rotateZ(Math.PI/2);break}default:{this.el.object3D.lookAt(this.el.sceneEl.camera.position);break}}},tick:function(){this.tickFunction()},remove:function(){this.removeEventListeners()}});AFRAME.registerComponent("al-node",{schema:{scale:{type:"number",default:1},selected:{type:"boolean"},graphEnabled:{type:"boolean"}},init:function(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,T.minFrameMS,this);this.bindMethods();this.addEventListeners();var e=this.data;var t=this.el;var n=t.sceneEl.camera.el.object3DMap.camera;var i=new THREE.SphereGeometry(e.scale,16,16);var r=new THREE.MeshBasicMaterial;var s=new THREE.Mesh(i,r);var o=new THREE.SphereGeometry(e.scale,16,16);var a=pe.getHaloMaterial();var c=new THREE.Mesh(o,a);s.add(c);t.setObject3D("mesh",s);t.object3D.renderOrder=T.topLayerRenderOrder-1;this.state={selected:true,hovered:false,geometry:i,material:r,mesh:s,outlineGeometry:o,outlineMaterial:a,outlineMesh:c,camera:n,dragging:false}},bindMethods:function(){this.pointerDown=this.pointerDown.bind(this);this.pointerUp=this.pointerUp.bind(this);this.pointerOver=this.pointerOver.bind(this);this.pointerOut=this.pointerOut.bind(this)},addEventListeners:function(){this.el.sceneEl.addEventListener("mousedown",this.pointerDown,{capture:false,once:false,passive:true});this.el.addEventListener("mouseup",this.pointerUp,{capture:false,once:false,passive:true});this.el.sceneEl.addEventListener("mouseup",this.pointerUp,{capture:false,once:false,passive:true});this.el.addEventListener("raycaster-intersected",this.pointerOver,{capture:false,once:false,passive:true});this.el.addEventListener("raycaster-intersected-cleared",this.pointerOut,{capture:false,once:false,passive:true})},removeEventListeners:function(){this.el.sceneEl.removeEventListener("mousedown",this.pointerDown);this.el.sceneEl.removeEventListener("mouseup",this.pointerUp);this.el.removeEventListener("mouseup",this.pointerUp);this.el.removeEventListener("raycaster-intersected",this.pointerOver);this.el.removeEventListener("raycaster-intersected-cleared",this.pointerOut)},pointerDown:function(e){var t=this.state;if(t.hovered){this.el.sceneEl.emit(ae.SELECTED,{type:N.NODE,id:this.el.id},true);if(this.data.graphEnabled){var n=this.state;n.mouseDown=true;this.el.sceneEl.emit(ae.POINTER_DOWN,{},true)}}},pointerUp:function(e){var t=this.state;if(this.data.graphEnabled){t.dragging=false;t.mouseDown=false;this.el.sceneEl.emit(ae.POINTER_UP,{},true)}},pointerOver:function(e){var t=this.state;t.hovered=true;this.el.sceneEl.emit(ae.POINTER_OVER,{id:this.el.id},true)},pointerOut:function(e){var t=this.state;t.hovered=false;if(t.mouseDown&&t.selected){t.dragging=true}this.el.sceneEl.emit(ae.POINTER_OUT,{},true)},update:function(){var e=this.state;e.selected=this.data.selected},tickFunction:function(){var e=this.el;var t=this.state;if(this.data.graphEnabled&&t.dragging){this.el.sceneEl.emit(ae.DRAGGED,{id:this.el.id},true)}if(t.hovered||t.dragging){t.material.color=new THREE.Color(T.buttonColors.hover)}else if(t.selected){t.material.color=new THREE.Color(T.buttonColors.active)}else{t.material.color=new THREE.Color(T.buttonColors.up)}var n=e.firstChild;if(n){var i=n.object3D;if(t.hovered||t.dragging){i.visible=true}else{i.visible=false}}},tick:function(){this.tickFunction()},remove:function(){this.removeEventListeners();this.el.removeObject3D("mesh")}});var Me=function(){function e(){}return e}();Me.VALID_TARGET="al-valid-target";Me.ADD_NODE="al-add-node";AFRAME.registerComponent("al-node-spawner",{schema:{graphEnabled:{type:"boolean"}},init:function(){this.bindMethods();this.addEventListeners();this.state={left:false,intersecting:false}},bindMethods:function(){this.canvasMouseDown=this.canvasMouseDown.bind(this);this.pointerOver=this.pointerOver.bind(this);this.pointerOut=this.pointerOut.bind(this);this.elClick=this.elClick.bind(this);this.canvasMouseUp=this.canvasMouseUp.bind(this);this.pointerDown=this.pointerDown.bind(this);this.pointerUp=this.pointerUp.bind(this)},addEventListeners:function(){this.el.sceneEl.canvas.addEventListener("mousedown",this.canvasMouseDown,{capture:false,once:false,passive:true});this.el.sceneEl.canvas.addEventListener("mouseup",this.canvasMouseUp,{capture:false,once:false,passive:true});this.el.addEventListener("raycaster-intersected",this.pointerOver,{capture:false,once:false,passive:true});this.el.addEventListener("raycaster-intersected-cleared",this.pointerOut,false);this.el.addEventListener("click",this.elClick,{capture:false,once:false,passive:true});this.el.addEventListener("mousedown",this.pointerDown,{capture:false,once:false,passive:true});this.el.addEventListener("mouseup",this.pointerUp,{capture:false,once:false,passive:true})},removeEventListeners:function(){this.el.sceneEl.canvas.removeEventListener("mousedown",this.canvasMouseDown);this.el.sceneEl.canvas.removeEventListener("mouseup",this.canvasMouseUp);this.el.removeEventListener("raycaster-intersected",this.pointerOver);this.el.removeEventListener("raycaster-intersected-cleared",this.pointerOut);this.el.removeEventListener("click",this.elClick);this.el.removeEventListener("mousedown",this.pointerDown);this.el.removeEventListener("mouseup",this.pointerUp)},canvasMouseDown:function(e){this.state.left=e.button===0},canvasMouseUp:function(e){var t=this;ue.waitOneFrame(function(){t.state.left=false})},pointerOver:function(e){this.state.intersecting=true;this.el.sceneEl.emit(Me.VALID_TARGET,{valid:true},false)},pointerOut:function(e){this.state.intersecting=false;this.el.sceneEl.emit(Me.VALID_TARGET,{valid:false},false)},pointerDown:function(e){if(this.data.graphEnabled){this.el.sceneEl.emit(ae.POINTER_DOWN,{},false)}},pointerUp:function(e){if(this.data.graphEnabled){this.el.sceneEl.emit(ae.POINTER_UP,{},false)}},elClick:function(e){if(this.state.left&&this.data.graphEnabled){this.el.sceneEl.emit(Me.ADD_NODE,{aframeEvent:e},false)}},remove:function(){this.removeEventListeners()}});var ye=function(){function e(){}return e}();ye.INTERACTION="al-control-interaction";ye.INTERACTION_FINISHED="al-control-interaction-finished";ye.ANIMATION_STARTED="al-controls-animation-started";ye.ANIMATION_FINISHED="al-controls-animation-finished";AFRAME.registerComponent("al-orbit-control",{dependencies:["camera"],schema:{animating:{type:"boolean",default:false},autoRotate:{type:"boolean"},autoRotateSpeed:{default:2},controlPosition:{type:"vec3"},controlTarget:{type:"vec3"},dampingFactor:{default:.1},enabled:{default:true},enableDamping:{default:true},enableKeys:{default:true},enablePan:{default:true},enableRotate:{default:true},enableZoom:{default:true},keyPanSpeed:{default:7},maxAzimuthAngle:{type:"number",default:Infinity},maxDistance:{default:8e3},maxPolarAngle:{default:88},minAzimuthAngle:{type:"number",default:-Infinity},minDistance:{default:1},minPolarAngle:{default:0},rotateSpeed:{default:.05},screenSpacePanning:{default:false},zoomSpeed:{type:"number",default:.5}},bindMethods:function(){this.mouseDown=this.mouseDown.bind(this);this.mouseMove=this.mouseMove.bind(this);this.mouseUp=this.mouseUp.bind(this);this.canvasWheel=this.canvasWheel.bind(this);this.getCameraState=this.getCameraState.bind(this);this.handleAnimationCache=this.handleAnimationCache.bind(this);this.onWheel=this.onWheel.bind(this)},addListeners:function(){window.addEventListener("mouseup",this.mouseUp,{capture:false,once:false,passive:true});window.addEventListener("mousemove",this.mouseMove,{capture:false,once:false,passive:true});this.el.sceneEl.canvas.addEventListener("mousedown",this.mouseDown,{capture:false,once:false,passive:true});this.el.sceneEl.canvas.addEventListener("wheel",this.canvasWheel,{capture:false,once:false,passive:true});this.el.sceneEl.addEventListener(ye.ANIMATION_STARTED,this.handleAnimationCache,false)},removeListeners:function(){window.removeEventListener("mouseup",this.mouseUp);window.removeEventListener("mousemove",this.mouseMove),this.el.sceneEl.canvas.removeEventListener("mousedown",this.mouseDown);this.el.sceneEl.canvas.removeEventListener("wheel",this.canvasWheel);this.el.sceneEl.removeEventListener(ye.ANIMATION_STARTED,this.handleAnimationCache,false)},handleAnimationCache:function(e){this.state.animationCache=e.detail.slerpPath},mouseUp:function(e){this.state.mouseDown=false;document.body.style.cursor="grab";var t=this.state.controls;if(t.enabled){this.el.sceneEl.emit(ye.INTERACTION_FINISHED,{cameraState:this.getCameraState()},false)}},mouseDown:function(e){this.state.mouseDown=true;document.body.style.cursor="grabbing"},mouseMove:function(e){if(this.state.mouseDown){this.el.sceneEl.emit(ye.INTERACTION,{cameraState:this.getCameraState()},false)}},onWheel:function(){var e=this;var t=this.state;t.wheelMarker=false;t.wheelCounter2=t.wheelCounter1;setTimeout(function(){if(t.wheelCounter2===t.wheelCounter1){t.wheelMarker=true;t.wheelCounter1=0;t.wheelCounter2=0;e.el.sceneEl.emit(ye.INTERACTION_FINISHED,{cameraState:e.getCameraState()},false)}else{e.onWheel()}},t.wheelInterval)},canvasWheel:function(e){var t=this.state;t.wheelCounter1+=1;if(t.wheelMarker){this.onWheel()}this.el.sceneEl.emit(ye.INTERACTION,{cameraState:this.getCameraState()},false)},init:function(){var e=this;var t=this.el;var n=this.data;document.body.style.cursor="grab";this.tickFunction=AFRAME.utils.throttle(this.tickFunction,T.minFrameMS,this);var i=new THREE.OrbitControls(t.getObject3D("camera"),t.sceneEl.renderer.domElement);var r=ue.objectToVector3(n.controlPosition);var s=ue.objectToVector3(n.controlTarget);i.object.position.copy(r);t.getObject3D("camera").position.copy(r);i.target.copy(s);var o=[];this.state={animationCache:o,controls:i,mouseDown:false,wheelCounter1:0,wheelCounter2:undefined,wheelInterval:50,wheelMarker:true};this.bindMethods();this.addListeners();ue.waitOneFrame(function(){e.el.sceneEl.emit(ye.INTERACTION,{cameraState:e.getCameraState()},false)})},getCameraState:function(){return{position:this.state.controls.object.position,target:this.state.controls.target}},update:function(e){var t=this.state.controls;var n=this.data;t.target=ue.objectToVector3(n.controlTarget);t.autoRotate=n.autoRotate;t.autoRotateSpeed=n.autoRotateSpeed;t.dampingFactor=n.dampingFactor;t.enabled=n.enabled;t.enableDamping=n.enableDamping;t.enableKeys=n.enableKeys;t.enablePan=n.enablePan;t.enableRotate=n.enableRotate;t.enableZoom=n.enableZoom;t.keyPanSpeed=n.keyPanSpeed;t.maxPolarAngle=THREE.Math.degToRad(n.maxPolarAngle);t.maxAzimuthAngle=THREE.Math.degToRad(n.maxAzimuthAngle);t.maxDistance=n.maxDistance;t.minDistance=n.minDistance;t.minPolarAngle=THREE.Math.degToRad(n.minPolarAngle);t.minAzimuthAngle=THREE.Math.degToRad(n.minAzimuthAngle);t.rotateSpeed=n.rotateSpeed;t.screenSpacePanning=n.screenSpacePanning;t.zoomSpeed=n.zoomSpeed;this.el.getObject3D("camera").position.copy(ue.objectToVector3(n.controlPosition))},tickFunction:function(){var e=this.state.controls;if(!e.enabled){return}if(this.data.animating){var t=this.state.animationCache.shift();if(t&&t.position&&t.target){e.object.position.copy(t.position);this.el.getObject3D("camera").position.copy(t.position);e.target.copy(t.target);this.el.sceneEl.emit(ye.INTERACTION,{cameraState:this.getCameraState()},false)}if(this.state.animationCache.length===0){this.el.sceneEl.emit(ye.ANIMATION_FINISHED,{},false);this.el.sceneEl.emit(ye.INTERACTION_FINISHED,{cameraState:this.getCameraState()},false)}}if(e.enabled&&(e.enableDamping||e.autoRotate)){e.update()}},tick:function(){this.tickFunction()},remove:function(){this.removeListeners();var e=this.state;e.controls.dispose();e=null}});AFRAME.registerComponent("al-render-order",{schema:{order:{type:"number",default:T.topLayerRenderOrder}},init:function(){var e=this;this.bindMethods();this.addEventListeners();Object.keys(this.el.object3DMap).forEach(function(t){e.el.object3DMap[t].renderOrder=e.data.order})},bindMethods:function(){},addEventListeners:function(){},removeEventListeners:function(){},update:function(){var e=this;Object.keys(this.el.object3DMap).forEach(function(t){e.el.object3DMap[t].renderOrder=e.data.order})},remove:function(){this.removeEventListeners()}});AFRAME.registerComponent("al-render-overlaid",{schema:{},init:function(e){this.bindMethods();this.addEventListeners();this.setDepth(this.el.object3DMap.mesh);this.setDepth(this.el.object3DMap.text)},bindMethods:function(){},addEventListeners:function(){},removeEventListeners:function(){},setDepth:function(e){if(e){e.renderOrder=T.topLayerRenderOrder;if(e.material){e.material.depthTest=false}}},remove:function(){this.removeEventListeners()}});AFRAME.registerComponent("al-screen-space",{schema:{position:{type:"string"},boundingRadius:{type:"number",default:1},cameraPosition:{type:"string"}},init:function(){this.bindMethods();this.addEventListeners();this.tickFunction=AFRAME.utils.throttle(this.tickFunction,T.minFrameMS,this)},bindMethods:function(){},addEventListeners:function(){},removeEventListeners:function(){},update:function(){var e=this.el.sceneEl.camera;var t=this.el.object3D;var n=ue.stringToVector3(this.data.position);var i=new THREE.Vector3;e.getWorldDirection(i);var r=ue.stringToVector3(this.data.cameraPosition).distanceTo(new THREE.Vector3(0,0,0));var s=new THREE.Plane(i,r);var o=new THREE.Vector3;s.projectPoint(n,o);var a=new THREE.Ray(n);a.lookAt(o);var c=a.distanceToPlane(s);t.lookAt(o);var u=c*T.zoomFactor;this.el.setAttribute("scale",u+" "+u+" "+u)},tickFunction:function(){},tick:function(){this.tickFunction()},remove:function(){this.removeEventListeners()}});var _e={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};var Te={ROTATE:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var Ne=function(e){__extends(t,e);function t(t,n){var i=e.call(this)||this;i.screen={left:0,top:0,width:0,height:0};i._changeEvent={type:"change"};i._startEvent={type:"start"};i._endEvent={type:"end"};i.object=t;i.domElement=n!==undefined?n:document;i.enabled=true;i.screen={left:0,top:0,width:0,height:0};i.rotateSpeed=1;i.zoomSpeed=1.2;i.panSpeed=.3;i.noRotate=false;i.noZoom=false;i.noPan=false;i.staticMoving=false;i.dynamicDampingFactor=.2;i.minDistance=0;i.maxDistance=Infinity;i.target=new THREE.Vector3;i.EPS=1e-6;i._lastPosition=new THREE.Vector3;i._state=_e.NONE;i._eye=new THREE.Vector3;i._movePrev=new THREE.Vector2;i._moveCurr=new THREE.Vector2;i._lastAxis=new THREE.Vector3;i._lastAngle=0;i._zoomStart=new THREE.Vector2;i._zoomEnd=new THREE.Vector2;i._touchZoomDistanceStart=0;i._touchZoomDistanceEnd=0;i._panStart=new THREE.Vector2;i._panEnd=new THREE.Vector2;i._target0=i.target.clone();i._position0=i.object.position.clone();i._up0=i.object.up.clone();i._bindMethods();i._addListeners();i.update();return i}Object.defineProperty(t.prototype,"up0",{get:function(){return this._up0.clone()},enumerable:true,configurable:true});t.prototype._bindMethods=function(){this._mouseDown=this._mouseDown.bind(this);this._mouseMove=this._mouseMove.bind(this);this._mouseUp=this._mouseUp.bind(this);this._mouseWheel=this._mouseWheel.bind(this);this._touchStart=this._touchStart.bind(this);this._touchEnd=this._touchEnd.bind(this);this._touchMove=this._touchMove.bind(this);this._resize=this._resize.bind(this)};t.prototype._addListeners=function(){this.domElement.addEventListener("mousedown",this._mouseDown,{capture:false,once:false,passive:true});window.addEventListener("mousemove",this._mouseMove,{capture:false,once:false,passive:true});window.addEventListener("mouseup",this._mouseUp,{capture:false,once:false,passive:true});this.domElement.addEventListener("wheel",this._mouseWheel,{capture:false,once:false,passive:true});this.domElement.addEventListener("touchstart",this._touchStart,{capture:false,once:false,passive:true});window.addEventListener("touchend",this._touchEnd,{capture:false,once:false,passive:true});window.addEventListener("touchmove",this._touchMove,{capture:false,once:false,passive:true})};t.prototype._mouseDown=function(e){if(this.enabled===false){return}if(this._state===_e.NONE){switch(e.button){case Te.ROTATE:this._state=_e.ROTATE;if(!this.noRotate){this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY));this._movePrev.copy(this._moveCurr)}break;case Te.ZOOM:this._state=_e.ZOOM;if(!this.noZoom){this._zoomStart.copy(this._getMouseOnScreen(e.pageX,e.pageY));this._zoomEnd.copy(this._zoomStart)}break;case Te.PAN:this._state=_e.PAN;if(!this.noPan){this._panStart.copy(this._getMouseOnScreen(e.pageX,e.pageY));this._panEnd.copy(this._panStart)}break;default:this._state=_e.NONE}}this.dispatchEvent(this._startEvent);this.update()};t.prototype._mouseMove=function(e){if(this.enabled===false){return}if(this._state===_e.ROTATE&&!this.noRotate){this._movePrev.copy(this._moveCurr);this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY))}else if(this._state===_e.ZOOM&&!this.noZoom){this._zoomEnd.copy(this._getMouseOnScreen(e.pageX,e.pageY))}else if(this._state===_e.PAN&&!this.noPan){this._panEnd.copy(this._getMouseOnScreen(e.pageX,e.pageY))}this.update()};t.prototype._mouseUp=function(e){if(this.enabled===false){return}this._state=_e.NONE;this.dispatchEvent(this._endEvent);this.update()};t.prototype._mouseWheel=function(e){if(this.enabled===false||this.noZoom===true){return}switch(e.deltaMode){case 2:this._zoomStart.y-=e.deltaY*.025;break;case 1:this._zoomStart.y-=e.deltaY*.01;break;default:this._zoomStart.y-=e.deltaY*25e-5;break}this.dispatchEvent(this._startEvent);this.dispatchEvent(this._endEvent);this.update()};t.prototype._touchStart=function(e){if(this.enabled===false){return}switch(e.touches.length){case 1:this._state=_e.TOUCH_ROTATE;this._moveCurr.copy(this._getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY));this._movePrev.copy(this._moveCurr);break;default:this._state=_e.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX;var n=e.touches[0].pageY-e.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2;var r=(e.touches[0].pageY+e.touches[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(i,r));this._panEnd.copy(this._panStart);break}this.dispatchEvent(this._startEvent);this.update()};t.prototype._touchEnd=function(e){if(this.enabled===false){return}switch(e.touches.length){case 0:this._state=_e.NONE;break;case 1:this._state=_e.TOUCH_ROTATE;this._moveCurr.copy(this._getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY));this._movePrev.copy(this._moveCurr);break;default:{break}}this.dispatchEvent(this._endEvent);this.update()};t.prototype._touchMove=function(e){if(this.enabled===false){return}switch(e.touches.length){case 1:this._movePrev.copy(this._moveCurr);this._moveCurr.copy(this._getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX;var n=e.touches[0].pageY-e.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2;var r=(e.touches[0].pageY+e.touches[1].pageY)/2;this._panEnd.copy(this._getMouseOnScreen(i,r));break}this.update()};t.prototype._resize=function(){if(this.domElement===document){this.screen.left=0;this.screen.top=0;this.screen.width=window.innerWidth;this.screen.height=window.innerHeight}else{var e=this.domElement.getBoundingClientRect();var t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft;this.screen.top=e.top+window.pageYOffset-t.clientTop;this.screen.width=e.width;this.screen.height=e.height}};t.prototype._getMouseOnScreen=function(e,t){var n=new THREE.Vector2;n.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height);return n};t.prototype._getMouseOnCircle=function(e,t){var n=new THREE.Vector2;n.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-t))/this.screen.width);return n};t.prototype._rotateCamera=function(){var e=new THREE.Vector3;var t=new THREE.Quaternion;var n=new THREE.Vector3;var i=new THREE.Vector3;var r=new THREE.Vector3;var s=new THREE.Vector3;var o;s.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);o=s.length();if(o){this._eye.copy(this.object.position).sub(this.target);n.copy(this._eye).normalize();i.copy(this.object.up).normalize();r.crossVectors(i,n).normalize();i.setLength(this._moveCurr.y-this._movePrev.y);r.setLength(this._moveCurr.x-this._movePrev.x);s.copy(i.add(r));e.crossVectors(s,this._eye).normalize();o*=this.rotateSpeed;t.setFromAxisAngle(e,o);this._eye.applyQuaternion(t);this.object.up.applyQuaternion(t);this._lastAxis.copy(e);this._lastAngle=o}else if(!this.staticMoving&&this._lastAngle){this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor);this._eye.copy(this.object.position).sub(this.target);t.setFromAxisAngle(this._lastAxis,this._lastAngle);this._eye.applyQuaternion(t);this.object.up.applyQuaternion(t)}this._movePrev.copy(this._moveCurr)};t.prototype._zoomCamera=function(){var e;if(this._state===_e.TOUCH_ZOOM_PAN){e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd;this._touchZoomDistanceStart=this._touchZoomDistanceEnd;this._eye.multiplyScalar(e)}else{e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed;if(e!==1&&e>0){this._eye.multiplyScalar(e)}if(this.staticMoving){this._zoomStart.copy(this._zoomEnd)}else{this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor}}};t.prototype._panCamera=function(){var e=new THREE.Vector2;var t=new THREE.Vector3;var n=new THREE.Vector3;e.copy(this._panEnd).sub(this._panStart);if(e.lengthSq()){e.multiplyScalar(this._eye.length()*this.panSpeed);n.copy(this._eye).cross(this.object.up).setLength(e.x);n.add(t.copy(this.object.up).setLength(e.y));this.object.position.add(n);this.target.add(n);if(this.staticMoving){this._panStart.copy(this._panEnd)}else{this._panStart.add(e.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}};t.prototype._checkDistances=function(){if(!this.noZoom||!this.noPan){if(this._eye.lengthSq()>this.maxDistance*this.maxDistance){this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance));this._zoomStart.copy(this._zoomEnd)}if(this._eye.lengthSq()<this.minDistance*this.minDistance){this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance));this._zoomStart.copy(this._zoomEnd)}}};t.prototype.update=function(){this._eye.subVectors(this.object.position,this.target);if(!this.noRotate){this._rotateCamera()}if(!this.noZoom){this._zoomCamera()}if(!this.noPan){this._panCamera()}this.object.position.addVectors(this.target,this._eye);this._checkDistances();this.object.lookAt(this.target);if(this._lastPosition.distanceToSquared(this.object.position)>this.EPS){this.dispatchEvent(this._changeEvent);this._lastPosition.copy(this.object.position)}};t.prototype.reset=function(){this._state=_e.NONE;this.target.copy(this._target0);this.object.position.copy(this._position0);this.object.up.copy(this._up0);this._eye.subVectors(this.object.position,this.target);this.object.lookAt(this.target);this.dispatchEvent(this._changeEvent);this._lastPosition.copy(this.object.position)};t.prototype.dispose=function(){this._removeListeners()};t.prototype._removeListeners=function(){this.domElement.removeEventListener("mousedown",this._mouseDown,false);window.removeEventListener("mousemove",this._mouseMove,false);window.removeEventListener("mouseup",this._mouseUp,false);this.domElement.removeEventListener("wheel",this._mouseWheel,false);this.domElement.removeEventListener("touchstart",this._touchStart,false);window.removeEventListener("touchend",this._touchEnd,false);window.removeEventListener("touchmove",this._touchMove,false)};return t}(THREE.EventDispatcher);AFRAME.registerComponent("al-trackball-control",{dependencies:["camera"],schema:{animating:{type:"boolean",default:false},controlPosition:{type:"vec3"},controlTarget:{type:"vec3"},dynamicDampingFactor:{default:.1},enabled:{type:"boolean",default:true},maxDistance:{type:"number",default:8e3},minDistance:{type:"number",default:0},noPan:{type:"boolean",default:false},noRotate:{type:"boolean",default:false},noZoom:{type:"boolean",default:false},panSpeed:{type:"number",default:.3},rotateSpeed:{type:"number",default:1},screenHeight:{type:"number",default:0},screenLeft:{type:"number",default:0},screenTop:{type:"number",default:0},screenWidth:{type:"number",default:0},staticMoving:{type:"boolean",default:true},zoomSpeed:{type:"number",default:.5}},bindMethods:function(){this.mouseDown=this.mouseDown.bind(this);this.mouseMove=this.mouseMove.bind(this);this.mouseUp=this.mouseUp.bind(this);this.canvasWheel=this.canvasWheel.bind(this);this.getCameraState=this.getCameraState.bind(this);this.handleAnimationCache=this.handleAnimationCache.bind(this);this.onWheel=this.onWheel.bind(this)},addListeners:function(){window.addEventListener("mouseup",this.mouseUp,{capture:false,once:false,passive:true});window.addEventListener("mousemove",this.mouseMove,{capture:false,once:false,passive:true});this.el.sceneEl.canvas.addEventListener("mousedown",this.mouseDown,{capture:false,once:false,passive:true});this.el.sceneEl.canvas.addEventListener("wheel",this.canvasWheel,{capture:false,once:false,passive:true});this.el.sceneEl.addEventListener(ye.ANIMATION_STARTED,this.handleAnimationCache,false)},removeListeners:function(){window.removeEventListener("mouseup",this.mouseUp);window.removeEventListener("mousemove",this.mouseMove),this.el.sceneEl.canvas.removeEventListener("mousedown",this.mouseDown);this.el.sceneEl.canvas.removeEventListener("wheel",this.canvasWheel);this.el.sceneEl.removeEventListener(ye.ANIMATION_STARTED,this.handleAnimationCache,false)},handleAnimationCache:function(e){this.state.animationCache=e.detail.slerpPath;var t=this.el.getObject3D("camera");this.state.cameraAnimationCache=ue.getSlerpPath(t.up.clone(),this.state.controls.up0)},mouseUp:function(e){this.state.mouseDown=false;document.body.style.cursor="grab";var t=this.state.controls;if(t.enabled){this.el.sceneEl.emit(ye.INTERACTION_FINISHED,{cameraState:this.getCameraState()},false)}},mouseDown:function(e){this.state.mouseDown=true;document.body.style.cursor="grabbing"},mouseMove:function(e){if(this.state.mouseDown){this.el.sceneEl.emit(ye.INTERACTION,{cameraState:this.getCameraState()},false)}},onWheel:function(){var e=this;var t=this.state;t.wheelMarker=false;t.wheelCounter2=t.wheelCounter1;setTimeout(function(){if(t.wheelCounter2===t.wheelCounter1){t.wheelMarker=true;t.wheelCounter1=0;t.wheelCounter2=0;e.el.sceneEl.emit(ye.INTERACTION_FINISHED,{cameraState:e.getCameraState()},false)}else{e.onWheel()}},t.wheelInterval)},canvasWheel:function(e){var t=this.state;t.wheelCounter1+=1;if(t.wheelMarker){this.onWheel()}this.el.sceneEl.emit(ye.INTERACTION,{cameraState:this.getCameraState()},false)},init:function(){var e=this;var t=this.el;var n=this.data;document.body.style.cursor="grab";this.tickFunction=AFRAME.utils.throttle(this.tickFunction,T.minFrameMS,this);var i=new Ne(t.getObject3D("camera"),t.sceneEl.renderer.domElement);var r=ue.objectToVector3(n.controlPosition);var s=ue.objectToVector3(n.controlTarget);i.object.position.copy(r);t.getObject3D("camera").position.copy(r);i.target.copy(s);var o=[];this.state={animationCache:o,cameraAnimationCache:null,controls:i,mouseDown:false,wheelCounter1:0,wheelCounter2:undefined,wheelInterval:50,wheelMarker:true};this.bindMethods();this.addListeners();ue.waitOneFrame(function(){e.el.sceneEl.emit(ye.INTERACTION,{cameraState:e.getCameraState()},false)})},getCameraState:function(){return{position:this.state.controls.object.position,target:this.state.controls.target}},update:function(e){var t=this.state.controls;var n=this.data;t.target=ue.objectToVector3(n.controlTarget);t.dynamicDampingFactor=n.dynamicDampingFactor;t.enabled=n.enabled;t.maxDistance=n.maxDistance;t.minDistance=n.minDistance;t.noPan=n.noPan;t.noRotate=n.noRotate;t.noZoom=n.noZoom;t.panSpeed=n.panSpeed;t.rotateSpeed=n.rotateSpeed;t.screen.height=n.screenHeight;t.screen.left=n.screenLeft;t.screen.top=n.screenTop;t.screen.width=n.screenWidth;t.staticMoving=n.screenHeight;t.zoomSpeed=n.zoomSpeed;this.el.getObject3D("camera").position.copy(ue.objectToVector3(n.controlPosition))},tickFunction:function(){var e=this.state.controls;if(!e.enabled){return}if(this.data.animating){var t=this.state.animationCache.shift();var n=this.state.cameraAnimationCache.shift();if(t&&t.position&&t.target){var i=this.el.getObject3D("camera");e.object.position.copy(t.position);i.position.copy(t.position);if(n){i.up.copy(n)}e.target.copy(t.target);this.el.sceneEl.emit(ye.INTERACTION,{cameraState:this.getCameraState()},false)}if(this.state.animationCache.length===0){this.el.sceneEl.emit(ye.ANIMATION_FINISHED,{},false);this.el.sceneEl.emit(ye.INTERACTION_FINISHED,{cameraState:this.getCameraState()},false)}}if(e.enabled){e.update()}},tick:function(){this.tickFunction()},remove:function(){this.removeListeners();var e=this.state;e.controls.dispose();e=null}});var Le=function(){function e(){}e.prototype.load=function(e,t){var n=this;return new Promise(function(i,r){var s=new XMLHttpRequest;s.open("GET",e,true);s.onload=function(){var e=JSON.parse(s.responseText);e=n._mapfiles(e.baseurl,e.series);var o=new AMI.VolumeLoader(t);o.load(e).then(function(){var e=o.data[0].mergeSeries(o.data);var t=e[0].stack[0];o.free();i(t)}).catch(function(e){console.log("Volume load error");r(e)})};s.onerror=function(e){r(e)};s.send()})};e.prototype._mapfiles=function(e,t){return t.map(function(t){if(!e.endsWith("/")){e+="/"}return""+e+t})};return e}();var De=function(){function e(){}return e}();De.LOADED="al-volume-loaded";De.ERROR="al-volume-error";De.RENDER_LOW="al-volume-render-low";De.RENDER_FULL="al-volume-render-full";AFRAME.registerComponent("al-volume",{schema:{displayMode:{type:"string"},isWebGl2:{type:"boolean"},slicesIndex:{type:"number"},slicesOrientation:{type:"string"},slicesWindowCenter:{type:"number"},slicesWindowWidth:{type:"number"},src:{type:"string"},srcLoaded:{type:"boolean"},volumeSteps:{type:"number"},volumeWindowCenter:{type:"number"},volumeWindowWidth:{type:"number"}},init:function(){this.tickFunction=AFRAME.utils.throttle(this.tickFunction,T.minFrameMS,this);this.loader=new Le;this.state={bufferScene:new THREE.Scene,bufferSceneTextureHeight:this.el.sceneEl.canvas.clientHeight,bufferSceneTextureWidth:this.el.sceneEl.canvas.clientWidth};this.bindMethods();this.addEventListeners();this.createBufferTexture();this.debouncedRenderBufferScene=de.debounce(this.renderBufferScene,T.minFrameMS).bind(this)},bindMethods:function(){this.addEventListeners=this.addEventListeners.bind(this);this.handleStack=this.handleStack.bind(this);this.onInteraction=this.onInteraction.bind(this);this.onInteractionFinished=this.onInteractionFinished.bind(this);this.removeEventListeners=this.removeEventListeners.bind(this);this.renderBufferScene=this.renderBufferScene.bind(this);this.rendererResize=this.rendererResize.bind(this);this.createBufferTexture=this.createBufferTexture.bind(this)},addEventListeners:function(){this.el.sceneEl.addEventListener("rendererresize",this.rendererResize,false);this.el.sceneEl.addEventListener(ye.INTERACTION,this.onInteraction,false);this.el.sceneEl.addEventListener(ye.INTERACTION_FINISHED,this.onInteractionFinished,false)},removeEventListeners:function(){this.el.sceneEl.removeEventListener("rendererresize",this.rendererResize);this.el.sceneEl.removeEventListener(ye.INTERACTION,this.onInteraction);this.el.sceneEl.removeEventListener(ye.INTERACTION_FINISHED,this.onInteractionFinished)},createBufferTexture:function(){this.state.bufferSceneTexture=new THREE.WebGLRenderTarget(this.state.bufferSceneTextureWidth,this.state.bufferSceneTextureHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter});this.el.sceneEl.object3D.background=this.state.bufferSceneTexture.texture},onInteraction:function(e){if(this.state.stackhelper){this.state.stackhelper.steps=2;this.renderBufferScene()}},onInteractionFinished:function(e){if(this.state.stackhelper){this.state.stackhelper.steps=this.data.volumeSteps;this.debouncedRenderBufferScene()}},rendererResize:function(){var e=this.state;var t=e.bufferSceneTextureWidth!==this.el.sceneEl.canvas.clientWidth||e.bufferSceneTextureHeight!==this.el.sceneEl.canvas.clientHeight;if(t&&this.data.displayMode===D.VOLUME){e.bufferSceneTextureWidth=this.el.sceneEl.canvas.clientWidth;e.bufferSceneTextureHeight=this.el.sceneEl.canvas.clientHeight;this.createBufferTexture();this.renderBufferScene()}},renderBufferScene:function(){if(this.data.displayMode===D.VOLUME){this.el.sceneEl.renderer.render(this.state.bufferScene,this.el.sceneEl.camera,this.state.bufferSceneTexture)}},handleStack:function(e){var t=this.state;var n=this.el;t.stack=e;switch(this.data.displayMode){case D.SLICES:{t.stackhelper=new AMI.StackHelper(t.stack);t.stackhelper.bbox.visible=false;t.stackhelper.border.color=T.colorValues.blue;break}case D.VOLUME:{var i=n.sceneEl.parentEl.querySelector("#lut-canvases");t.lutHelper=new AMI.LutHelper(i);t.lutHelper.luts=AMI.LutHelper.presetLuts();t.lutHelper.lutsO=AMI.LutHelper.presetLutsO();t.stackhelper=new AMI.VolumeRenderHelper(t.stack);t.stackhelper.textureLUT=t.lutHelper.texture;break}default:{break}}if(n.object3DMap.mesh){n.removeObject3D("mesh")}if(this.data.displayMode===D.SLICES){n.setObject3D("mesh",this.state.stackhelper)}else{if(this.state.bufferScene.children.length){this.state.bufferScene.remove(this.state.bufferScene.children[0])}this.state.bufferScene.add(this.state.stackhelper)}n.sceneEl.emit(De.LOADED,t.stackhelper,false)},update:function(e){var t=this;var n=this.state;var i=this.el;if(!this.data.src){return}else if(e&&e.src!==this.data.src){this.loader.load(this.data.src,i).then(function(e){t.handleStack(e)})}else if(e&&e.displayMode!==this.data.displayMode&&n.stack){this.removeEventListeners();this.handleStack(n.stack);this.addEventListeners();if(this.data.displayMode===D.VOLUME){this.createBufferTexture();setTimeout(function(){t.renderBufferScene()},250)}else{this.el.sceneEl.object3D.background=null}}},tickFunction:function(){if(!this.state.stackhelper){return}switch(this.data.displayMode){case D.SLICES:{this.el.setObject3D("mesh",this.state.stackhelper);break}default:{break}}},tick:function(){this.tickFunction()},remove:function(){this.el.removeObject3D("mesh");this.removeEventListeners();this.el.sceneEl.object3D.background=null}});var Se;(function(e){e["NULL"]="NULL";e["ERROR"]="ERROR";e["APP_CLEAR_ANGLES"]="APP_LOAD_ANGLES";e["APP_CLEAR_EDGES"]="APP_LOAD_EDGES";e["APP_CLEAR_NODES"]="APP_LOAD_NODES";e["APP_DELETE_ANGLE"]="APP_DELETE_ANGLE";e["APP_DELETE_EDGE"]="APP_DELETE_EDGE";e["APP_DELETE_NODE"]="APP_DELETE_NODE";e["APP_SELECT_ANGLE"]="APP_SELECT_ANGLE";e["APP_SELECT_EDGE"]="APP_SELECT_EDGE";e["APP_SELECT_NODE"]="APP_SELECT_NODE";e["APP_SET_ANGLE"]="APP_SET_ANGLE";e["APP_SET_BOUNDINGBOX_VISIBLE"]="APP_SET_BOUNDINGBOX_VISIBLE";e["APP_SET_CAMERA"]="APP_SET_CAMERA";e["APP_SET_CONTROLS_ENABLED"]="APP_SET_CONTROLS_ENABLED";e["APP_SET_CONTROLS_TYPE"]="APP_SET_CONTROLS_TYPE";e["APP_SET_DISPLAY_MODE"]="APP_SET_DISPLAY_MODE";e["APP_SET_EDGE"]="APP_SET_EDGE";e["APP_SET_MATERIAL"]="APP_SET_MATERIAL";e["APP_SET_NODE"]="APP_SET_NODE";e["APP_SET_NODES_ENABLED"]="APP_SET_NODES_ENABLED";e["APP_SET_ORIENTATION"]="APP_SET_ORIENTATION";e["APP_SET_SLICES_INDEX"]="APP_SET_SLICES_INDEX";e["APP_SET_SLICES_WINDOW_CENTER"]="APP_SET_SLICES_WINDOW_CENTER";e["APP_SET_SLICES_WINDOW_WIDTH"]="APP_SET_SLICES_WINDOW_WIDTH";e["APP_SET_SRC"]="APP_SET_SRC";e["APP_SET_SRC_LOADED"]="APP_SET_SRC_LOADED";e["APP_SET_UNITS"]="APP_SET_UNITS";e["APP_SET_VOLUME_STEPS"]="APP_SET_VOLUME_STEPS";e["APP_SET_VOLUME_WINDOW_CENTER"]="APP_SET_VOLUME_WINDOW_CENTER";e["APP_SET_VOLUME_WINDOW_WIDTH"]="APP_SET_VOLUME_WINDOW_WIDTH"})(Se||(Se={}));var be=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_SRC,payload:e})]})})}};var Ie=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_SRC_LOADED,payload:e})]})})}};var we=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_NODE,payload:e})]})})}};var Ae=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_DELETE_NODE,payload:e})]})})}};var Ce=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SELECT_NODE,payload:e})]})})}};var Oe=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_CLEAR_NODES,payload:e})]})})}};var je=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_EDGE,payload:e})]})})}};var xe=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_DELETE_EDGE,payload:e})]})})}};var Pe=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SELECT_EDGE,payload:e})]})})}};var ze=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_CLEAR_EDGES,payload:e})]})})}};var Re=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_ANGLE,payload:e})]})})}};var ke=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_DELETE_ANGLE,payload:e})]})})}};var We=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SELECT_ANGLE,payload:e})]})})}};var Ue=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_CLEAR_ANGLES,payload:e})]})})}};var He=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_BOUNDINGBOX_VISIBLE,payload:e})]})})}};var Ye=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_DISPLAY_MODE,payload:e})]})})}};var Fe=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_NODES_ENABLED,payload:e})]})})}};var Qe=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_MATERIAL,payload:e})]})})}};var Ve=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_UNITS,payload:e})]})})}};var Be=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_ORIENTATION,payload:e})]})})}};var Ge=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_SLICES_INDEX,payload:e})]})})}};var Ze=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_SLICES_WINDOW_WIDTH,payload:e})]})})}};var Xe=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_SLICES_WINDOW_CENTER,payload:e})]})})}};var Ke=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_VOLUME_STEPS,payload:e})]})})}};var qe=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_VOLUME_WINDOW_WIDTH,payload:e})]})})}};var Je=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_VOLUME_WINDOW_CENTER,payload:e})]})})}};var $e=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_CAMERA,payload:e})]})})}};var et=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_CONTROLS_ENABLED,payload:e})]})})}};var tt=function(e){return function(t,n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(n){return[2,t({type:Se.APP_SET_CONTROLS_TYPE,payload:e})]})})}};function nt(e){var t;var n=e.Symbol;if(typeof n==="function"){if(n.observable){t=n.observable}else{t=n("observable");n.observable=t}}else{t="@@observable"}return t}var it;if(typeof self!=="undefined"){it=self}else if(typeof window!=="undefined"){it=window}else if(typeof global!=="undefined"){it=global}else if(typeof module!=="undefined"){it=module}else{it=Function("return this")()}var rt=nt(it);var st=function e(){return Math.random().toString(36).substring(7).split("").join(".")};var ot={INIT:"@@redux/INIT"+st(),REPLACE:"@@redux/REPLACE"+st(),PROBE_UNKNOWN_ACTION:function e(){return"@@redux/PROBE_UNKNOWN_ACTION"+st()}};function at(e){if(typeof e!=="object"||e===null)return false;var t=e;while(Object.getPrototypeOf(t)!==null){t=Object.getPrototypeOf(t)}return Object.getPrototypeOf(e)===t}function ct(e,t,n){var i;if(typeof t==="function"&&typeof n==="function"||typeof n==="function"&&typeof arguments[3]==="function"){throw new Error("It looks like you are passing several store enhancers to "+"createStore(). This is not supported. Instead, compose them "+"together to a single function")}if(typeof t==="function"&&typeof n==="undefined"){n=t;t=undefined}if(typeof n!=="undefined"){if(typeof n!=="function"){throw new Error("Expected the enhancer to be a function.")}return n(ct)(e,t)}if(typeof e!=="function"){throw new Error("Expected the reducer to be a function.")}var r=e;var s=t;var o=[];var a=o;var c=false;function u(){if(a===o){a=o.slice()}}function l(){if(c){throw new Error("You may not call store.getState() while the reducer is executing. "+"The reducer has already received the state as an argument. "+"Pass it down from the top reducer instead of reading it from the store.")}return s}function d(e){if(typeof e!=="function"){throw new Error("Expected the listener to be a function.")}if(c){throw new Error("You may not call store.subscribe() while the reducer is executing. "+"If you would like to be notified after the store has been updated, subscribe from a "+"component and invoke store.getState() in the callback to access the latest state. "+"See https://redux.js.org/api-reference/store#subscribe(listener) for more details.")}var t=true;u();a.push(e);return function n(){if(!t){return}if(c){throw new Error("You may not unsubscribe from a store listener while the reducer is executing. "+"See https://redux.js.org/api-reference/store#subscribe(listener) for more details.")}t=false;u();var i=a.indexOf(e);a.splice(i,1)}}function h(e){if(!at(e)){throw new Error("Actions must be plain objects. "+"Use custom middleware for async actions.")}if(typeof e.type==="undefined"){throw new Error('Actions may not have an undefined "type" property. '+"Have you misspelled a constant?")}if(c){throw new Error("Reducers may not dispatch actions.")}try{c=true;s=r(s,e)}finally{c=false}var t=o=a;for(var n=0;n<t.length;n++){var i=t[n];i()}return e}function p(e){if(typeof e!=="function"){throw new Error("Expected the nextReducer to be a function.")}r=e;h({type:ot.REPLACE})}function f(){var e;var t=d;return e={subscribe:function e(n){if(typeof n!=="object"||n===null){throw new TypeError("Expected the observer to be an object.")}function i(){if(n.next){n.next(l())}}i();var r=t(i);return{unsubscribe:r}}},e[rt]=function(){return this},e}h({type:ot.INIT});return i={dispatch:h,subscribe:d,getState:l,replaceReducer:p},i[rt]=f,i}function ut(e,t){var n=t&&t.type;var i=n&&'action "'+String(n)+'"'||"an action";return"Given "+i+', reducer "'+e+'" returned undefined. '+"To ignore an action, you must explicitly return the previous state. "+"If you want this reducer to hold no value, you can return null instead of undefined."}function lt(e){Object.keys(e).forEach(function(t){var n=e[t];var i=n(undefined,{type:ot.INIT});if(typeof i==="undefined"){throw new Error('Reducer "'+t+'" returned undefined during initialization. '+"If the state passed to the reducer is undefined, you must "+"explicitly return the initial state. The initial state may "+"not be undefined. If you don't want to set a value for this reducer, "+"you can use null instead of undefined.")}if(typeof n(undefined,{type:ot.PROBE_UNKNOWN_ACTION()})==="undefined"){throw new Error('Reducer "'+t+'" returned undefined when probed with a random type. '+("Don't try to handle "+ot.INIT+' or other actions in "redux/*" ')+"namespace. They are considered private. Instead, you must return the "+"current state for any unknown actions, unless it is undefined, "+"in which case you must return the initial state, regardless of the "+"action type. The initial state may not be undefined, but can be null.")}})}function dt(e){var t=Object.keys(e);var n={};for(var i=0;i<t.length;i++){var r=t[i];if(typeof e[r]==="function"){n[r]=e[r]}}var s=Object.keys(n);var o;try{lt(n)}catch(e){o=e}return function e(t,i){if(t===void 0){t={}}if(o){throw o}var r=false;var a={};for(var c=0;c<s.length;c++){var u=s[c];var l=n[u];var d=t[u];var h=l(d,i);if(typeof h==="undefined"){var p=ut(u,i);throw new Error(p)}a[u]=h;r=r||h!==d}return r?a:t}}function ht(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function pt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};var i=Object.keys(n);if(typeof Object.getOwnPropertySymbols==="function"){i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))}i.forEach(function(t){ht(e,t,n[t])})}return e}function ft(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}if(t.length===0){return function(e){return e}}if(t.length===1){return t[0]}return t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}function Et(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}return function(e){return function(){var n=e.apply(void 0,arguments);var i=function e(){throw new Error("Dispatching while constructing your middleware is not allowed. "+"Other middleware would not be applied to this dispatch.")};var r={getState:n.getState,dispatch:function e(){return i.apply(void 0,arguments)}};var s=t.map(function(e){return e(r)});i=ft.apply(void 0,s)(n.dispatch);return pt({},n,{dispatch:i})}}}function vt(e){return function(t){var n=t.dispatch,i=t.getState;return function(t){return function(r){if(typeof r==="function"){return r(n,i,e)}return t(r)}}}}var gt=vt();gt.withExtraArgument=vt;var mt=function(){return{angles:new Map,boundingBoxEnabled:false,camera:null,controlsEnabled:true,controlsType:L.ORBIT,displayMode:D.MESH,edges:new Map,material:S.DEFAULT,nodes:new Map,graphEnabled:false,orientation:I.CORONAL,selected:null,slicesIndex:0,slicesWindowCenter:0,slicesWindowWidth:0,src:null,srcLoaded:false,units:A.METERS,volumeSteps:16,volumeWindowCenter:0,volumeWindowWidth:0}};var Mt=function(e,t){if(e===void 0){e=mt()}switch(t.type){case Se.APP_SET_SRC:{var n=t.payload,i=n[0],r=n[1];var s=void 0;if(r){s=r}else if(i){var o=he.getFileExtension(i);if(Object.values(b).includes(o)){s=D.MESH}else{s=D.SLICES}}else{s=D.MESH}return Object.assign({},e,{angles:new Map,controlsEnabled:false,displayMode:s,edges:new Map,nodes:new Map,orientation:I.CORONAL,selected:null,slicesIndex:0,slicesWindowCenter:0,slicesWindowWidth:0,src:i,srcLoaded:false,volumeSteps:16,volumeWindowCenter:0,volumeWindowWidth:0})}case Se.APP_SET_SRC_LOADED:{return Object.assign({},e,{controlsEnabled:t.payload,srcLoaded:t.payload,boundingBoxEnabled:e.displayMode!==D.MESH?true:e.boundingBoxEnabled,units:e.displayMode!==D.MESH?A.MILLIMETERS:A.METERS})}case Se.APP_SET_NODE:{var a=t.payload,c=a[0],u=a[1];var l=JSON.parse(JSON.stringify(u));var d=e.nodes.get(c);var h=Object.assign({},d,l);return Object.assign({},e,{selected:d?e.selected:c,nodes:new Map(e.nodes).set(c,h)})}case Se.APP_DELETE_NODE:{return Object.assign({},e,{selected:e.selected===t.payload?null:e.selected,nodes:new Map(e.nodes.slice().filter(function(e){var n=e[0];return n!==t.payload})),edges:new Map(e.edges.slice().filter(function(e){var n=e[0],i=e[1];return t.payload!==i.node1Id&&t.payload!==i.node2Id}))})}case Se.APP_SELECT_NODE:{return Object.assign({},e,{selected:t.payload})}case Se.APP_CLEAR_NODES:{return Object.assign({},e,{nodes:new Map})}case Se.APP_SET_EDGE:{var p=t.payload,c=p[0],u=p[1];var l=JSON.parse(JSON.stringify(u));var d=e.edges.get(c);var h=Object.assign({},d,l);return Object.assign({},e,{selected:d?e.selected:c,edges:new Map(e.edges).set(c,h)})}case Se.APP_DELETE_EDGE:{return Object.assign({},e,{selected:e.selected===t.payload?null:e.selected,edges:new Map(e.edges.slice().filter(function(e){var n=e[0];return n!==t.payload})),angles:new Map(e.angles.slice().filter(function(e){var n=e[0],i=e[1];return t.payload!==i.edge1Id&&t.payload!==i.edge2Id}))})}case Se.APP_SELECT_EDGE:{return Object.assign({},e,{selected:t.payload})}case Se.APP_CLEAR_EDGES:{return Object.assign({},e,{edges:new Map})}case Se.APP_SET_ANGLE:{var f=t.payload,c=f[0],u=f[1];var l=JSON.parse(JSON.stringify(u));var d=e.angles.get(c);var h=Object.assign({},d,l);return Object.assign({},e,{selected:d?e.selected:c,angles:new Map(e.angles).set(c,h)})}case Se.APP_DELETE_ANGLE:{return Object.assign({},e,{selected:e.selected===t.payload?null:e.selected,angles:new Map(e.angles.slice().filter(function(e){var n=e[0];return n!==t.payload}))})}case Se.APP_SELECT_ANGLE:{return Object.assign({},e,{selected:t.payload})}case Se.APP_CLEAR_ANGLES:{return Object.assign({},e,{angles:new Map})}case Se.APP_SET_DISPLAY_MODE:{return Object.assign({},e,{displayMode:t.payload,boundingBoxEnabled:t.payload!==D.MESH?true:e.boundingBoxEnabled})}case Se.APP_SET_ORIENTATION:{return Object.assign({},e,{slicesIndex:undefined,orientation:t.payload})}case Se.APP_SET_MATERIAL:{return Object.assign({},e,{material:t.payload})}case Se.APP_SET_NODES_ENABLED:{return Object.assign({},e,{graphEnabled:t.payload})}case Se.APP_SET_BOUNDINGBOX_VISIBLE:{return Object.assign({},e,{boundingBoxEnabled:t.payload})}case Se.APP_SET_SLICES_INDEX:{return Object.assign({},e,{slicesIndex:t.payload})}case Se.APP_SET_SLICES_WINDOW_WIDTH:{return Object.assign({},e,{slicesWindowWidth:t.payload})}case Se.APP_SET_SLICES_WINDOW_CENTER:{return Object.assign({},e,{slicesWindowCenter:t.payload})}case Se.APP_SET_UNITS:{return Object.assign({},e,{units:t.payload})}case Se.APP_SET_VOLUME_STEPS:{return Object.assign({},e,{volumeSteps:t.payload})}case Se.APP_SET_VOLUME_WINDOW_WIDTH:{return Object.assign({},e,{volumeWindowWidth:t.payload})}case Se.APP_SET_VOLUME_WINDOW_CENTER:{return Object.assign({},e,{volumeWindowCenter:t.payload})}case Se.APP_SET_CAMERA:{return Object.assign({},e,{camera:Object.assign({},e.camera,t.payload)})}case Se.APP_SET_CONTROLS_ENABLED:{return Object.assign({},e,{controlsEnabled:t.payload})}case Se.APP_SET_CONTROLS_TYPE:{return Object.assign({},e,{controlsType:t.payload})}default:{return Object.assign({},e)}}};var yt=dt({app:Mt});var _t=function(e){return ct(yt,e,Et(gt))};var Tt=e("uv_aleph",function(){function e(e){t(this,e);this._hovered=null;this._isShiftDown=false;this._isWebGl2=true;this.width="640";this.height="480";this.changed=n(this,"changed",7);this.loaded=n(this,"loaded",7);this.store=r(this,"store")}e.prototype.load=function(e,t){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(i){if(this.src){this._setSrc(null);setTimeout(function(){n._setSrc(e,t)},T.minLoadingMS)}else{this._setSrc(e,t)}return[2]})})};e.prototype.resize=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){this._resize();return[2]})})};e.prototype.setNode=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setNode(e);return[2]})})};e.prototype.setGraph=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setGraph(e);return[2]})})};e.prototype.deleteNode=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._deleteNode(e);return[2]})})};e.prototype.clearGraph=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){this._clearGraph();return[2]})})};e.prototype.selectNode=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._selectNode(e,true);return[2]})})};e.prototype.deleteEdge=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._deleteEdge(e);return[2]})})};e.prototype.deleteAngle=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._deleteAngle(e);return[2]})})};e.prototype.setEdge=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setEdge(e);return[2]})})};e.prototype.recenter=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){this._recenter();return[2]})})};e.prototype.setBoundingBoxEnabled=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setBoundingBoxEnabled(e);return[2]})})};e.prototype.setDisplayMode=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setDisplayMode(e);return[2]})})};e.prototype.setControlsEnabled=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setControlsEnabled(e);return[2]})})};e.prototype.setControlsType=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setControlsType(e);return[2]})})};e.prototype.setGraphEnabled=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setGraphEnabled(e);return[2]})})};e.prototype.setMaterial=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setMaterial(e);return[2]})})};e.prototype.setOrientation=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setOrientation(e);return[2]})})};e.prototype.setSlicesIndex=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setSlicesIndex(e);return[2]})})};e.prototype.setSlicesWindowCenter=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setSlicesWindowCenter(e);return[2]})})};e.prototype.setSlicesWindowWidth=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setSlicesWindowWidth(e);return[2]})})};e.prototype.setUnits=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setUnits(e);return[2]})})};e.prototype.setVolumeSteps=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setVolumeSteps(e);return[2]})})};e.prototype.setVolumeWindowCenter=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setVolumeWindowCenter(e);return[2]})})};e.prototype.setVolumeWindowWidth=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._setVolumeWindowWidth(e);return[2]})})};e.prototype.componentWillLoad=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){this._isWebGl2=ue.isWebGL2Available();this.store.setStore(_t({}));this.store.mapStateToProps(this,function(e){var t=e.app,n=t.angles,i=t.boundingBoxEnabled,r=t.camera,s=t.controlsEnabled,o=t.controlsType,a=t.displayMode,c=t.edges,u=t.graphEnabled,l=t.material,d=t.nodes,h=t.orientation,p=t.selected,f=t.slicesIndex,E=t.slicesWindowCenter,v=t.slicesWindowWidth,g=t.src,m=t.srcLoaded,M=t.units,y=t.volumeSteps,_=t.volumeWindowCenter,T=t.volumeWindowWidth;return{angles:n,boundingBoxEnabled:i,camera:r,controlsEnabled:s,controlsType:o,displayMode:a,edges:c,graphEnabled:u,material:l,nodes:d,orientation:h,selected:p,slicesIndex:f,slicesWindowCenter:E,slicesWindowWidth:v,src:g,srcLoaded:m,units:M,volumeSteps:y,volumeWindowCenter:_,volumeWindowWidth:T}});this.store.mapDispatchToProps(this,{appClearAngles:Ue,appClearEdges:ze,appClearNodes:Oe,appDeleteAngle:ke,appDeleteEdge:xe,appDeleteNode:Ae,appSelectAngle:We,appSelectEdge:Pe,appSelectNode:Ce,appSetAngle:Re,appSetBoundingBoxEnabled:He,appSetCamera:$e,appSetControlsEnabled:et,appSetControlsType:tt,appSetDisplayMode:Ye,appSetEdge:je,appSetGraphEnabled:Fe,appSetMaterial:Qe,appSetNode:we,appSetOrientation:Be,appSetSlicesIndex:Ge,appSetSlicesWindowCenter:Xe,appSetSlicesWindowWidth:Ze,appSetSrc:be,appSetSrcLoaded:Ie,appSetUnits:Ve,appSetVolumeSteps:Ke,appSetVolumeWindowCenter:Je,appSetVolumeWindowWidth:qe});this._controlsAnimationFinishedHandler=this._controlsAnimationFinishedHandler.bind(this);this._controlsInteractionHandler=this._controlsInteractionHandler.bind(this);this._graphEntryDraggedHandler=this._graphEntryDraggedHandler.bind(this);this._graphEntryPointerDownHandler=this._graphEntryPointerDownHandler.bind(this);this._graphEntryPointerOutHandler=this._graphEntryPointerOutHandler.bind(this);this._graphEntryPointerOverHandler=this._graphEntryPointerOverHandler.bind(this);this._graphEntryPointerUpHandler=this._graphEntryPointerUpHandler.bind(this);this._graphEntrySelectedHandler=this._graphEntrySelectedHandler.bind(this);this._graphEntryValidTargetHandler=this._graphEntryValidTargetHandler.bind(this);this._keyDownHandler=this._keyDownHandler.bind(this);this._keyUpHandler=this._keyUpHandler.bind(this);this._controlsInteractionFinishedHandler=this._controlsInteractionFinishedHandler.bind(this);this._spawnNodeHandler=this._spawnNodeHandler.bind(this);this._srcLoaded=this._srcLoaded.bind(this);this._debouncedAppSetCamera=de.debounce(this.appSetCamera,T.minFrameMS).bind(this);this._lights=[];return[2]})})};e.prototype._renderSpinner=function(){if(this.src&&!this.srcLoaded){return i("div",{id:"spinner"},i("div",{class:"square"}))}};e.prototype._renderSrc=function(){var e=this;if(!this.src){return null}switch(this.displayMode){case D.MESH:{return i("a-entity",{class:"collidable","al-node-spawner":"\n              graphEnabled: "+this.graphEnabled+";\n            ","al-gltf-model":"\n              src: url("+this.src+");\n              dracoDecoderPath: "+this.dracoDecoderPath+";\n            ",position:"0 0 0",scale:"1 1 1",ref:function(t){return e._targetEntity=t}})}case D.SLICES:{return i("a-entity",{id:"target-entity",class:"collidable","al-node-spawner":"\n              graphEnabled: "+this.graphEnabled+";\n            ","al-volume":"\n              srcLoaded: "+this.srcLoaded+";\n              src: "+this.src+";\n              displayMode: "+this.displayMode+";\n              slicesIndex: "+this.slicesIndex+";\n              slicesOrientation: "+this.orientation+";\n              slicesWindowWidth: "+this.slicesWindowWidth+";\n              slicesWindowCenter: "+this.slicesWindowCenter+";\n              volumeSteps: "+this.volumeSteps+";\n              volumeWindowCenter: "+this.volumeWindowCenter+";\n              volumeWindowWidth: "+this.volumeWindowWidth+";\n              isWebGl2: "+this._isWebGl2+";\n            ",position:"0 0 0",ref:function(t){return e._targetEntity=t}})}case D.VOLUME:{return i("a-entity",{id:"target-entity","al-volume":"\n              srcLoaded: "+this.srcLoaded+";\n              src: "+this.src+";\n              displayMode: "+this.displayMode+";\n              slicesIndex: "+this.slicesIndex+";\n              slicesOrientation: "+this.orientation+";\n              slicesWindowWidth: "+this.slicesWindowWidth+";\n              slicesWindowCenter: "+this.slicesWindowCenter+";\n              volumeSteps: "+this.volumeSteps+";\n              volumeWindowCenter: "+this.volumeWindowCenter+";\n              volumeWindowWidth: "+this.volumeWindowWidth+";\n              isWebGl2: "+this._isWebGl2+";\n            ",position:"0 0 0",ref:function(t){return e._targetEntity=t}})}default:{return}}};e.prototype._renderBoundingBox=function(){var e=this;if(this.srcLoaded){var t=new THREE.Vector3;this._boundingBox.getSize(t);var n=this._getMesh().geometry;var r=void 0;var s=void 0;if(this.boundingBoxEnabled){s=1}else{s=0}if(this.displayMode===D.VOLUME){r=this._targetEntity.object3D.position.clone().add(he.getGeometryCenter(n));return i("a-entity",{position:ue.vector3ToString(r),"al-bounding-box":"\n              scale: "+ue.vector3ToString(t)+";\n              color: "+T.colorValues.white+";\n              opacity: "+s+";\n            ","al-node-spawner":"\n              graphEnabled: "+this.graphEnabled+";\n            ",class:"collidable",ref:function(t){return e._boundingEntity=t}})}else{switch(this.displayMode){case D.MESH:{if(this._boundingBox.intersectsBox(n.boundingBox)){var o=n.boundingSphere.center.clone();r=this._targetEntity.object3D.position.clone().add(o)}else{r=this._targetEntity.object3D.position.clone()}break}case D.SLICES:{r=this._targetEntity.object3D.position.clone().add(he.getGeometryCenter(n));break}default:{break}}return i("a-entity",{position:ue.vector3ToString(r),"al-bounding-box":"\n                scale: "+ue.vector3ToString(t)+";\n                color: "+T.colorValues.white+";\n                opacity: "+s+";\n              ",ref:function(t){return e._boundingEntity=t}})}}};e.prototype._renderNodes=function(){var e=this;return Array.from(this.nodes).map(function(t){var n=t[0],r=t[1];var s=new THREE.Vector3(0,2.5,0);s.multiplyScalar(r.scale);return i("a-entity",{class:"collidable",id:n,position:r.position,"al-node":"\n            scale: "+r.scale+";\n            selected: "+(e.selected===n)+";\n            graphEnabled: "+e.graphEnabled+";\n          "},i("a-entity",{text:"\n              value: "+r.title+";\n              side: double;\n              align: center;\n              baseline: bottom;\n              anchor: center;\n              width: "+T.fontSizeMedium*e._boundingSphereRadius+";\n            ","al-screen-space":"\n              position: "+ue.vector3ToString(ue.stringToVector3(r.position).add(s.clone()))+";\n              boundingRadius: "+e._boundingSphereRadius+";\n              cameraPosition: "+ue.vector3ToString(e.camera.position)+";\n            ","al-render-overlaid":true,visible:""+(e.selected===n),id:n+"-label"},i("a-plane",{position:ue.vector3ToString(s),color:T.colorValues.black,opacity:"0.9","al-background":"\n                text: "+r.title+";\n                boundingRadius: "+T.fontSizeMedium*e._boundingSphereRadius+";\n              ","al-render-overlaid":true})))})};e.prototype._renderEdges=function(){var e=this;return Array.from(this.edges).map(function(t){var n=t[0],r=t[1];var s=e.nodes.get(r.node1Id);var o=e.nodes.get(r.node2Id);if(s&&o){var a=ue.stringToVector3(s.position);var c=ue.stringToVector3(o.position);var u=c.clone().sub(a);var l=u.length();u=u.normalize().multiplyScalar(l*.5);var d=a.clone().add(u);var h=new THREE.Vector3(0,2.5,0);var p=(s.scale+o.scale)/2;var f=e._boundingSphereRadius*T.edgeSize;h.multiplyScalar(p);var E=e._convertUnits(l);return i("a-entity",{class:"collidable",id:n,position:ue.vector3ToString(d),"al-edge":"\n              length: "+l+";\n              node1: "+s.position+";\n              node2: "+o.position+";\n              selected: "+(e.selected===n)+";\n              radius: "+f+";\n              nodeScale: "+p+";\n            "},i("a-entity",{id:n+"-title",text:"\n                value: "+E+";\n                side: double;\n                align: center;\n                baseline: bottom;\n                anchor: center;\n                width: "+T.fontSizeSmall*e._boundingSphereRadius+"\n              ",position:ue.vector3ToString(h),visible:""+(e.selected===n),"al-screen-space":"\n                position: "+ue.vector3ToString(d.clone().add(h.clone()))+";\n                boundingRadius: "+e._boundingSphereRadius+";\n                cameraPosition: "+ue.vector3ToString(e.camera.position)+";\n              ","al-render-overlaid":true},i("a-plane",{position:ue.vector3ToString(h),color:T.colorValues.black,opacity:"0.9","al-background":"\n                text: "+E+";\n                boundingRadius: "+T.fontSizeSmall*e._boundingSphereRadius+";\n              ","al-render-overlaid":true})))}})};e.prototype._renderAngles=function(){var e=this;return Array.from(this.angles).map(function(t){var n=t[0],r=t[1];var s=e.edges.get(r.edge1Id);var o=e.edges.get(r.edge2Id);if(s&&o){var a=e._boundingSphereRadius*T.edgeSize;var c=void 0;var u=void 0;var l=void 0;if(s.node1Id===o.node1Id){c=e.nodes.get(o.node1Id);u=e.nodes.get(s.node2Id);l=e.nodes.get(o.node2Id)}else if(s.node1Id===o.node2Id){c=e.nodes.get(o.node2Id);u=e.nodes.get(s.node2Id);l=e.nodes.get(o.node1Id)}else if(s.node2Id===o.node1Id){c=e.nodes.get(o.node1Id);u=e.nodes.get(s.node1Id);l=e.nodes.get(o.node2Id)}else if(s.node2Id===o.node2Id){c=e.nodes.get(o.node2Id);u=e.nodes.get(s.node1Id);l=e.nodes.get(o.node1Id)}var d=ue.stringToVector3(u.position);var h=ue.stringToVector3(l.position);var p=ue.stringToVector3(c.position);var f=d.clone().sub(p).normalize();var E=h.clone().sub(p).normalize();var v=E.angleTo(f);var g=Math.min(p.distanceTo(d),p.distanceTo(h));var m=Math.min(g*.25,a*25);m=Math.max(m,a*10);var M=f.clone().multiplyScalar(m);var y=E.clone().multiplyScalar(m);var _=M.clone().distanceTo(y.clone());var N=M.clone().add(y.clone()).divideScalar(2);var L=new THREE.Vector3(0,2.5,0);var D=(u.scale+l.scale+c.scale)/3;L.multiplyScalar(D);var S=THREE.Math.radToDeg(v).toFixed(T.unitsDecimalPlaces)+" deg";return i("a-entity",{class:"collidable",id:n,position:c.position,"al-angle":"\n              selected: "+(e.selected===n)+";\n              edge0Pos: "+ue.vector3ToString(M)+";\n              edge1Pos: "+ue.vector3ToString(y)+";\n              position: "+ue.vector3ToString(N)+";\n              length: "+_+";\n              radius: "+a+";\n              angle: "+r+";\n            "},i("a-entity",{id:n+"-title",text:"\n                value: "+S+";\n                side: double;\n                align: center;\n                baseline: bottom;\n                anchor: center;\n                width: "+T.fontSizeSmall*e._boundingSphereRadius+"\n              ",position:ue.vector3ToString(N.clone().add(L)),visible:""+(e.selected===n),"al-screen-space":"\n                position: "+ue.vector3ToString(p.clone().add(L.clone()))+";\n                boundingRadius: "+e._boundingSphereRadius+";\n                cameraPosition: "+ue.vector3ToString(e.camera.position)+";\n              ","al-render-overlaid":true},i("a-plane",{position:ue.vector3ToString(L),color:T.colorValues.black,opacity:"0.9","al-background":"\n                text: "+S+";\n                boundingRadius: "+T.fontSizeSmall*e._boundingSphereRadius+";\n              ","al-render-overlaid":true})))}})};e.prototype._renderLights=function(){var e=this;return[i("a-entity",{id:"light-1",light:"type: directional; color: #ffffff; intensity: 0.5",position:"1 1 1",ref:function(t){return e._lights[0]=t}}),i("a-entity",{id:"light-2",light:"type: directional; color: #ffffff; intensity: 0.5",position:"-1 -1 -1",ref:function(t){return e._lights[1]=t}}),i("a-entity",{id:"light-3",light:"type: ambient; color: #d0d0d0; intensity: 1"})]};e.prototype._renderOrbitCamera=function(){var e=this;return i("a-camera",{fov:T.cameraValues.fov,near:T.cameraValues.near,"look-controls":"enabled: false",far:T.cameraValues.far,id:"mainCamera","al-cursor":"rayOrigin: mouse",raycaster:"objects: .collidable;","al-orbit-control":"\n          maxPolarAngle: "+T.cameraValues.maxPolarAngle+";\n          minDistance: "+T.cameraValues.minDistance+";\n          screenSpacePanning: true;\n          rotateSpeed: "+T.cameraValues.rotateSpeed+";\n          zoomSpeed: "+T.cameraValues.zoomSpeed+";\n          enableDamping: true;\n          dampingFactor: "+T.cameraValues.dampingFactor+";\n          controlTarget: "+ue.vector3ToString(this.camera?this.camera.target:new THREE.Vector3(0,0,0))+";\n          controlPosition: "+ue.vector3ToString(this.camera?this.camera.position:new THREE.Vector3(0,0,0))+";\n          enabled: "+this.controlsEnabled+";\n          animating: "+(this.camera&&this.camera.animating?this.camera.animating:false)+"\n        ",ref:function(t){return e._camera=t}})};e.prototype._renderTrackballCamera=function(){var e=this;return i("a-camera",{fov:T.cameraValues.fov,near:T.cameraValues.near,"look-controls":"enabled: false",far:T.cameraValues.far,id:"mainCamera","al-cursor":"rayOrigin: mouse",raycaster:"objects: .collidable;","al-trackball-control":"\n          screenLeft: "+0+";\n          screenTop: "+0+";\n          screenWidth: "+(this._scene?this._scene.canvas.width:0)+";\n          screenHeight: "+(this._scene?this._scene.canvas.height:0)+";\n          rotateSpeed: "+T.cameraValues.rotateSpeed*2+";\n          zoomSpeed: "+T.cameraValues.zoomSpeed*2+";\n          dynamicDampingFactor: "+T.cameraValues.dampingFactor+";\n          controlTarget: "+ue.vector3ToString(this.camera?this.camera.target:new THREE.Vector3(0,0,0))+";\n          controlPosition: "+ue.vector3ToString(this.camera?this.camera.position:new THREE.Vector3(0,0,0))+";\n          enabled: "+this.controlsEnabled+";\n          animating: "+(this.camera&&this.camera.animating?this.camera.animating:false)+"\n        ",ref:function(t){return e._camera=t}})};e.prototype._renderControls=function(){switch(this.controlsType){case L.TRACKBALL:{return this._renderTrackballCamera()}case L.ORBIT:{return this._renderOrbitCamera()}default:{return null}}};e.prototype._renderCamera=function(){return[this._renderControls(),this._renderLights()]};e.prototype._renderScene=function(){var e=this;return i("a-scene",{embedded:true,renderer:"\n          colorManagement: true;\n          sortObjects: true;\n          webgl2: "+this._isWebGl2+";\n          antialias: true;\n        ","vr-mode-ui":"enabled: false",ref:function(t){return e._scene=t}},this._renderBoundingBox(),this._renderSrc(),this._renderNodes(),this._renderEdges(),this._renderAngles(),this._renderCamera())};e.prototype.render=function(){return i("div",{id:"al-container",class:this.displayMode,style:{width:he.addCssUnits(this.width),height:he.addCssUnits(this.height)}},i("div",{id:"lut-container"},i("div",{id:"lut-min"},"0.0"),i("div",{id:"lut-canvases"}),i("div",{id:"lut-max"},"1.0")),this._renderScene(),this._renderSpinner())};e.prototype._resize=function(){if(this._scene){this._scene.resize()}};e.prototype._convertUnits=function(e){if(this.displayMode===D.MESH){switch(this.units){case A.METERS:{return e.toFixed(T.unitsDecimalPlaces)+this.units}case A.MILLIMETERS:{return(e/.001).toFixed(T.unitsDecimalPlaces)+this.units}default:{break}}}else{switch(this.units){case A.METERS:{return(e/1e3).toFixed(T.unitsDecimalPlaces)+this.units}case A.MILLIMETERS:{return e.toFixed(T.unitsDecimalPlaces)+this.units}default:{break}}}};e.prototype._createEdge=function(e,t){var n=Array.from(this.edges).find(function(n){var i=n[0],r=n[1];return r.node1Id===e&&r.node2Id===t||r.node1Id===t&&r.node2Id===e});if(!n){var i={node1Id:e,node2Id:t};var r=ce.getNextId(N.EDGE,this.edges);this._setEdge([r,i])}else{console.log("edge already exists")}};e.prototype._createAngle=function(e,t){var n=Array.from(this.angles).find(function(n){var i=n[0],r=n[1];return r.edge1Id===e&&r.edge2Id===t||r.edge1Id===t&&r.edge2Id===e});if(!n){var i=this.edges.get(e);var r=this.edges.get(t);if(i.node1Id===r.node1Id||i.node1Id===r.node2Id||i.node2Id===r.node1Id||i.node2Id===r.node2Id){var s={edge1Id:e,edge2Id:t};var o=ce.getNextId(N.ANGLE,this.angles);this._setAngle([o,s])}else{console.warn("cannot create angle: edges not connected")}}else{console.warn("cannot create angle: angle already exists")}};e.prototype._stateChanged=function(){this.changed.emit(this.store.getState().app)};e.prototype._setGraph=function(e){var t=this;if(e.nodes){var n=new Map(e.nodes);n.forEach(function(e,n){t.appSetNode([n,e])})}if(e.edges){var i=new Map(e.edges);i.forEach(function(e,n){t.appSetEdge([n,e])})}if(e.angles){var r=new Map(e.angles);r.forEach(function(e,n){t.appSetAngle([n,e])})}this._stateChanged()};e.prototype._clearGraph=function(){this.appClearNodes();this.appClearEdges();this.appClearAngles();this._stateChanged()};e.prototype._deleteNode=function(e){this.appDeleteNode(e);this._stateChanged()};e.prototype._setNode=function(e){this.appSetNode(e);this._stateChanged()};e.prototype._animateBetween=function(e,t){var n={position:t,target:this.camera.target.clone()};if(t){var i=t.distanceTo(this.camera.position);if(i>0){n.position.copy(t.clone());var r=ue.getSlerpCameraPath(e,n,i>0,false);this._scene.emit(ye.ANIMATION_STARTED,{slerpPath:r},false);this.appSetCamera({animating:true});this._stateChanged()}}};e.prototype._selectNode=function(e,t){if(t===void 0){t=false}if(t&&e!==this.selected){var n={position:this.camera.position.clone(),target:this.camera.target.clone()};var i=he.getCameraPositionFromNode(this.nodes.get(e),this._boundingSphereRadius,this.camera.target);this.appSelectNode(e);this._animateBetween(n,i)}else{this.appSelectNode(e);this._stateChanged()}};e.prototype._setEdge=function(e){this.appSetEdge(e);this._stateChanged()};e.prototype._deleteEdge=function(e){this.appDeleteEdge(e);this._stateChanged()};e.prototype._recenter=function(){var e=he.getCameraStateFromMesh(this._getMesh());var t={position:this.camera.position.clone(),target:this.camera.target.clone()};this._selectNode(null);this._animateBetween(t,e.position)};e.prototype._selectEdge=function(e){this.appSelectEdge(e);this._stateChanged()};e.prototype._setAngle=function(e){this.appSetAngle(e);this._stateChanged()};e.prototype._selectAngle=function(e){this.appSelectAngle(e);this._stateChanged()};e.prototype._deleteAngle=function(e){this.appDeleteAngle(e);this._stateChanged()};e.prototype._setBoundingBoxEnabled=function(e){this.appSetBoundingBoxEnabled(e);this._stateChanged()};e.prototype._setControlsEnabled=function(e){this.appSetControlsEnabled(e);this._stateChanged()};e.prototype._setControlsType=function(e){this.appSetControlsType(e);this._stateChanged()};e.prototype._setGraphEnabled=function(e){this.appSetGraphEnabled(e);this._stateChanged()};e.prototype._setMaterial=function(e){this.appSetMaterial(e);this._stateChanged()};e.prototype._setOrientation=function(e){this.appSetOrientation(e);this._stateChanged()};e.prototype._setSlicesIndex=function(e){this.appSetSlicesIndex(e);this._stateChanged()};e.prototype._setSlicesWindowCenter=function(e){this.appSetSlicesWindowCenter(e);this._stateChanged()};e.prototype._setSlicesWindowWidth=function(e){this.appSetSlicesWindowWidth(e);this._stateChanged()};e.prototype._setUnits=function(e){this.appSetUnits(e);this._stateChanged()};e.prototype._setVolumeSteps=function(e){this.appSetVolumeSteps(e);this._stateChanged()};e.prototype._setVolumeWindowCenter=function(e){this.appSetVolumeWindowCenter(e);this._stateChanged()};e.prototype._setVolumeWindowWidth=function(e){this.appSetVolumeWindowWidth(e);this._stateChanged()};e.prototype._setDisplayMode=function(e){this.appSetDisplayMode(e);this._stateChanged()};e.prototype._setSrc=function(e,t){this.appSetSrc([e,t]);this._stateChanged()};e.prototype._getStackHelper=function(){var e=null;if(this.displayMode===D.VOLUME){e=this._loadedObject}return e};e.prototype._getMesh=function(){var e=null;if(this.displayMode===D.MESH){var t=this._targetEntity.object3DMap.mesh;if(t instanceof THREE.Mesh){e=t}else{t.traverse(function(t){if(t instanceof THREE.Mesh&&e===null){e=t;return e}})}}else if(this._loadedObject._bBox){e=this._loadedObject._bBox._mesh}else{e=this._loadedObject._mesh}return e};e.prototype._srcLoaded=function(e){this._loadedObject=e.detail;var t=this._getMesh();if(t){t.geometry.computeBoundingSphere();t.geometry.computeBoundingBox();this._boundingSphereRadius=t.geometry.boundingSphere.radius;this._boundingBox=he.getBoundingBox(t);var n=he.getCameraStateFromMesh(t);this._updateLights(n);if(n){this.appSetCamera(n)}this.appSetSrcLoaded(true);this._stateChanged();this.loaded.emit(e.detail)}else{throw new Error("Unable to find a mesh in loaded object")}};e.prototype._keyDownHandler=function(e){this._isShiftDown=e.shiftKey;if(e.keyCode===se.Delete){if(this.selected){if(this.nodes.has(this.selected)){this._deleteNode(this.selected)}else if(this.edges.has(this.selected)){this._deleteEdge(this.selected)}else if(this.angles.has(this.selected)){this._deleteAngle(this.selected)}}}};e.prototype._keyUpHandler=function(e){this._isShiftDown=false};e.prototype._graphEntryPointerUpHandler=function(e){this.appSetControlsEnabled(true);ue.enableControls(this._camera,true,this.controlsType)};e.prototype._graphEntryPointerDownHandler=function(e){this.appSetControlsEnabled(false);ue.enableControls(this._camera,false,this.controlsType)};e.prototype._graphEntryPointerOutHandler=function(e){this._hovered=null};e.prototype._graphEntryPointerOverHandler=function(e){this._hovered=e.detail.id};e.prototype._controlsInteractionHandler=function(e){var t=e.detail.cameraState;this._updateLights(t)};e.prototype._updateLights=function(e){if(this.displayMode===D.MESH){this._lights.forEach(function(t){var n=e.position.clone().normalize();t.object3D.position.copy(n)})}};e.prototype._controlsInteractionFinishedHandler=function(e){var t=e.detail.cameraState;this._debouncedAppSetCamera(t)};e.prototype._spawnNodeHandler=function(e){if(this.graphEnabled&&this._validTarget&&this._hovered===null){var t=e.detail.aframeEvent.detail.intersection;var n=ce.getNextId(N.NODE,this.nodes);var i=void 0;if(this.displayMode===D.VOLUME&&t){var r=new THREE.Vector3;var s=new THREE.Vector3;var o=le.volumeRay(this._getStackHelper(),this._camera.object3D.children[0].position.clone(),this._camera.getAttribute("raycaster").direction,T.cameraValues.far,r,s);if(o){i={position:ue.vector3ToString(r),scale:this._boundingSphereRadius/T.nodeSizeRatio,title:n}}}else if(t){i={targetId:"0",position:ue.vector3ToString(t.point),scale:this._boundingSphereRadius/T.nodeSizeRatio,title:n}}if(i){var a=this.selected;this._setNode([n,i]);if(this._isShiftDown&&this.nodes.has(a)){this._createEdge(a,n);this._selectNode(n)}}}};e.prototype._graphEntryValidTargetHandler=function(e){this._validTarget=e.detail.valid};e.prototype._controlsAnimationFinishedHandler=function(e){this.appSetCamera({animating:false})};e.prototype._graphEntrySelectedHandler=function(e){if(!this.graphEnabled){return}var t=e.detail.type;var n=e.detail.id;switch(t){case N.NODE:{if(this._hovered!==null&&this.nodes.has(this._hovered)&&(this.selected!==null&&this.nodes.has(this.selected))&&this.selected!==this._hovered&&this._isShiftDown){this._createEdge(this.selected,this._hovered)}this._selectNode(n);break}case N.EDGE:{if(this._hovered!==null&&this.edges.has(this._hovered)&&(this.selected!==null&&this.edges.has(this.selected))&&this.selected!==this._hovered&&this._isShiftDown){this._createAngle(this.selected,this._hovered)}this._selectEdge(n);break}case N.ANGLE:{this._selectAngle(n);break}default:{break}}};e.prototype._graphEntryDraggedHandler=function(e){var t=e.detail.id;var n=this._camera.components.raycaster;var i=this._camera.getAttribute("raycaster");var r;var s=new THREE.Vector3;var o=false;var a=this._camera.object3D.children[0].position;if(this.displayMode===D.VOLUME){r=n.getIntersection(this._boundingEntity);if(r){var c=new THREE.Vector3;var u=le.volumeRay(this._getStackHelper(),a.clone(),i.direction,T.cameraValues.far,s,c);if(u){o=true}}}else{r=n.getIntersection(this._targetEntity);if(r){s.copy(r.point);o=true}}if(!o){var l=a.distanceTo(this._targetEntity.getAttribute("position"));s.copy(a);s.add(i.direction.clone().multiplyScalar(l*1.5))}this._setNode([t,{position:ue.vector3ToString(s)}]);var d=t+T.movedEventName;this._scene.emit(d,{},true)};e.prototype._addEventListeners=function(){window.addEventListener("keydown",this._keyDownHandler,false);window.addEventListener("keyup",this._keyUpHandler,false);this._scene.addEventListener(ye.ANIMATION_FINISHED,this._controlsAnimationFinishedHandler,false);this._scene.addEventListener(ye.INTERACTION,this._controlsInteractionHandler,false);this._scene.addEventListener(ye.INTERACTION_FINISHED,this._controlsInteractionFinishedHandler,false);this._scene.addEventListener(ae.POINTER_UP,this._graphEntryPointerUpHandler,false);this._scene.addEventListener(ae.POINTER_DOWN,this._graphEntryPointerDownHandler,false);this._scene.addEventListener(ae.DRAGGED,this._graphEntryDraggedHandler,false);this._scene.addEventListener(ae.SELECTED,this._graphEntrySelectedHandler,false);this._scene.addEventListener(Me.ADD_NODE,this._spawnNodeHandler,false);this._scene.addEventListener(Me.VALID_TARGET,this._graphEntryValidTargetHandler,false);this._scene.addEventListener(me.LOADED,this._srcLoaded,false);this._scene.addEventListener(De.LOADED,this._srcLoaded,false);this._scene.addEventListener(ae.POINTER_OVER,this._graphEntryPointerOverHandler,false);this._scene.addEventListener(ae.POINTER_OUT,this._graphEntryPointerOutHandler,false)};e.prototype.componentDidUpdate=function(){if(this._scene){this._addEventListeners()}};Object.defineProperty(e,"style",{get:function(){return"#al-container{position:relative;font-family:sans-serif}#al-container a-scene{display:block;width:100%;height:100%}#al-container.mesh a-scene{background-color:var(--mesh-viewport-background-color)}#al-container.slices a-scene{background-color:var(--slices-viewport-background-color)}#al-container.volume a-scene{background-color:var(--volume-viewport-background-color)}#al-container #lut-container{display:none}#al-container .progress.container{position:absolute;top:auto!important;bottom:0!important}#al-container .progress.container .load.progress,#al-container .progress.container .parse.progress{border:none!important;height:4px!important;background-color:var(--load-progress-color,#fff)!important}#al-container #spinner{position:absolute;left:50%;top:50%}#al-container #spinner .square{margin:0 0 0 -15px;width:30px;height:30px;-webkit-animation:sk-rotateplane 1.2s ease-in-out infinite;-moz-animation:sk-rotateplane 1.2s infinite ease-in-out;animation:sk-rotateplane 1.2s ease-in-out infinite}#al-container.mesh #spinner .square,#al-container.slices #spinner .square,#al-container.volume #spinner .square{background-color:var(--spinner-color,#fff)}\@-webkit-keyframes sk-rotateplane{0%{-webkit-transform:perspective(120px)}50%{-webkit-transform:perspective(120px) rotateY(180deg)}to{-webkit-transform:perspective(120px) rotateY(180deg) rotateX(180deg)}}\@keyframes sk-rotateplane{0%{transform:perspective(120px) rotateX(0deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)}to{transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)}}"},enumerable:true,configurable:true});return e}())}}});